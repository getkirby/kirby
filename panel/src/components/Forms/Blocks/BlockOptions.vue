<template>
	<div class="k-block-options">
		<template v-if="isBatched">
			<k-button
				:title="$t('copy')"
				class="k-block-options-button"
				icon="template"
				@click="$emit('copy')"
			/>
			<k-button
				v-if="isMergable"
				:title="$t('merge')"
				class="k-block-options-button"
				icon="merge"
				@click="$emit('merge')"
			/>
			<k-button
				:title="$t('remove')"
				class="k-block-options-button"
				icon="trash"
				@click="$emit('removeSelected')"
			/>
		</template>
		<template v-else>
			<k-button
				v-if="isEditable"
				:title="$t('edit')"
				icon="edit"
				class="k-block-options-button"
				@click="$emit('open')"
			/>
			<k-button
				:disabled="isFull"
				:title="$t('insert.after')"
				class="k-block-options-button"
				icon="add"
				@click="$emit('chooseToAppend')"
			/>
			<k-button
				:title="$t('delete')"
				class="k-block-options-button"
				icon="trash"
				@click="$emit('remove')"
			/>
			<k-button
				:title="$t('more')"
				class="k-block-options-button"
				icon="dots"
				@click="$refs.options.toggle()"
			/>
			<k-button
				:title="$t('sort.drag')"
				class="k-block-options-button k-sort-handle"
				icon="sort"
				@keydown.native.up.prevent="$emit('sortUp')"
				@keydown.native.down.prevent="$emit('sortDown')"
			/>
			<k-dropdown-content ref="options" align-x="end">
				<k-dropdown-item
					:disabled="isFull"
					icon="angle-up"
					@click="$emit('chooseToPrepend')"
				>
					{{ $t("insert.before") }}
				</k-dropdown-item>
				<k-dropdown-item
					:disabled="isFull"
					icon="angle-down"
					@click="$emit('chooseToAppend')"
				>
					{{ $t("insert.after") }}
				</k-dropdown-item>
				<hr />
				<k-dropdown-item v-if="isEditable" icon="edit" @click="$emit('open')">
					{{ $t("edit") }}
				</k-dropdown-item>
				<k-dropdown-item icon="refresh" @click="$emit('chooseToConvert')">
					{{ $t("field.blocks.changeType") }}
				</k-dropdown-item>
				<k-dropdown-item
					v-if="isSplitable"
					icon="split"
					@click="$emit('split')"
				>
					{{ $t("split") }}
				</k-dropdown-item>
				<hr />
				<k-dropdown-item icon="template" @click="$emit('copy')">
					{{ $t("copy") }}
				</k-dropdown-item>
				<k-dropdown-item
					:disabled="isFull"
					icon="download"
					@click="$emit('paste')"
				>
					{{ $t("paste.after") }}
				</k-dropdown-item>
				<hr />
				<k-dropdown-item
					:icon="isHidden ? 'preview' : 'hidden'"
					@click="$emit(isHidden ? 'show' : 'hide')"
				>
					{{ isHidden === true ? $t("show") : $t("hide") }}
				</k-dropdown-item>
				<k-dropdown-item
					:disabled="isFull"
					icon="copy"
					@click="$emit('duplicate')"
				>
					{{ $t("duplicate") }}
				</k-dropdown-item>
				<hr />
				<k-dropdown-item icon="trash" @click="$emit('remove')">
					{{ $t("delete") }}
				</k-dropdown-item>
			</k-dropdown-content>
		</template>
	</div>
</template>

<script>
/**
 * Floating options menu for a block that
 * appears when the block is focused/selected.
 *
 * @example <k-block-options :is-editable="true" />
 */
export default {
	props: {
		/**
		 * Block is slected together with other blocks
		 */
		isBatched: Boolean,
		/**
		 * Block can be edited
		 */
		isEditable: Boolean,
		/**
		 * No more blocks can be added
		 */
		isFull: Boolean,
		/**
		 * Block is hidden
		 */
		isHidden: Boolean,
		/**
		 * Block can be merged with other blocks
		 * @since 4.0.0
		 */
		isMergable: Boolean,
		/**
		 * Block can be split into multiple blocks
		 * @since 4.0.0
		 */
		isSplitable: Boolean
	},
	methods: {
		open() {
			this.$refs.options.open();
		}
	}
};
</script>

<style>
.k-block-options {
	display: flex;
	align-items: center;
	background: var(--color-white);
	z-index: var(--z-dropdown);
	box-shadow: var(--shadow-toolbar);
	color: var(--color-black);
	border-radius: var(--rounded);
}
.k-block-options-button {
	--block-options-button-size: 30px;

	width: var(--block-options-button-size);
	height: var(--block-options-button-size);
	line-height: 1;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	border-inline-end: 1px solid var(--color-background);
}
.k-block-options-button:first-child {
	border-start-start-radius: var(--rounded);
	border-end-start-radius: var(--rounded);
}
.k-block-options-button:last-child {
	border-start-end-radius: var(--rounded);
	border-end-end-radius: var(--rounded);
}
.k-block-options-button:last-of-type {
	border-inline-end: 0;
}
.k-block-options-button[aria-current] {
	color: var(--color-focus);
}
.k-block-options-button:hover {
	background: var(--color-gray-100);
}
.k-block-options .k-dropdown-content {
	margin-top: 0.5rem;
}
</style>
