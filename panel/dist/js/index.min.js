const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./IndexView.min.js","./vendor.min.js","./DocsView.min.js","./Docs.min.js","./PlaygroundView.min.js"])))=>i.map(i=>d[i]);
import{h as e,resolveComponent as t,useId as i,createBlock as s,openBlock as n,mergeProps as o,createSlots as l,withCtx as a,renderSlot as r,normalizeProps as c,guardReactiveProps as d,normalizeStyle as u,normalizeClass as p,createElementBlock as h,Fragment as m,renderList as f,createCommentVNode as g,toHandlers as k,createVNode as b,getCurrentInstance as y,createTextVNode as v,toDisplayString as $,resolveDynamicComponent as w,createElementVNode as x,withModifiers as S,isRef as C,isReactive as O,isProxy as A,toRaw as I,Teleport as M,withKeys as _,resolveDirective as D,withDirectives as E,vShow as j,reactive as L,defineAsyncComponent as B,cloneVNode as T,createApp as q}from"vue";import{I as z,P,S as N,F,N as R,s as Y,l as H,w as U,a as V,b as K,c as W,d as J,e as G,t as X,f as Z,g as Q,h as ee,i as te,k as ie,D as se,j as ne,E as oe,m as le,n as ae,o as re,T as ce,u as de,p as ue,r as pe,q as he,v as me,x as fe,y as ge,z as ke,A as be,B as ye,C as ve}from"./vendor.min.js";const $e={computed:{component(){return this.$panel.view.component},view(){return this.$panel.view.props}},created(){this.$panel.events.subscribe();for(const e of this.$panel.plugins.created)e(this);this.$panel.events.on("popstate",()=>{this.$panel.open(window.location.href)}),this.$panel.events.on("drop",()=>{this.$panel.drag.stop()})},unmounted(){this.$panel.events.unsubscribe()},render(){if(this.component)return e(t(this.component),{key:this.component,...this.view})}},we={props:{after:String}},xe={props:{autocomplete:String}},Se={props:{autofocus:Boolean}},Ce={props:{before:String}},Oe={props:{disabled:Boolean}},Ae={props:{font:String}},Ie={props:{help:String}},Me={props:{id:{type:[Number,String],default:()=>i()}}},_e={props:{label:[String,Boolean]}},De={props:{layout:{type:String,default:"list"}}},Ee={props:{maxlength:Number}},je={props:{minlength:Number}},Le={props:{name:[Number,String]}},Be={props:{options:{default:()=>[],type:Array}}},Te={props:{pattern:String}},qe={props:{placeholder:[Number,String]}},ze={props:{required:Boolean}},Pe={props:{spellcheck:{type:Boolean,default:!0}}},Ne=(e,t)=>{const i=e.__vccOpts||e;for(const[s,n]of t)i[s]=n;return i},Fe={mixins:[De],inheritAttrs:!1,props:{columns:{type:[Object,Array],default:()=>({})},fields:{type:Object,default:()=>({})},items:{type:Array,default:()=>[]},link:{type:Boolean,default:!0},selecting:Boolean,selected:{type:Array,default:()=>[]},selectmode:{type:String,default:"multiple"},sortable:Boolean,size:{type:String,default:"medium"},theme:String}};const Re=Ne({mixins:[Fe],props:{image:{type:[Object,Boolean],default:()=>({})}},emits:["change","hover","item","option","select","sort"],computed:{dragOptions(){return{sort:this.sortable,disabled:!1===this.sortable,draggable:".k-draggable-item"}},itemsWithIds(){return this.items.map(e=>({...e,id:e.id??e.uuid??this.$helper.uuid()}))},table(){return{columns:this.columns,fields:this.fields,rows:this.items,selecting:this.selecting,selected:this.selected,selectmode:this.selectmode,sortable:this.sortable}}},methods:{findSelectedIndex(e){return this.selected.findIndex(t=>t===(e._id??e.uuid??e.id))},isSelected(e){return-1!==this.findSelectedIndex(e)},onDragStart(e,t){this.$panel.drag.start("text",t)},onOption(e,t,i){this.$emit("option",e,t,i)},onSelect(e){if("single"===this.selectmode)return this.$emit("select",[e._id??e.uuid??e.id]);const t=this.findSelectedIndex(e);return-1!==t?this.$emit("select",this.selected.toSpliced(t,1)):this.$emit("select",[...this.selected,e._id??e.uuid??e.id])},imageOptions(e){let t=this.image,i=e.image;return!1!==t&&!1!==i&&("object"!=typeof t&&(t={}),"object"!=typeof i&&(i={}),{...i,...t})}}},[["render",function(e,i,g,k,b,y){const v=t("k-table"),$=t("k-item"),w=t("k-draggable");return"table"===e.layout?(n(),s(v,o({key:0},y.table,{class:e.$attrs.class,style:e.$attrs.style,onChange:i[0]||(i[0]=t=>e.$emit("change",t)),onSelect:i[1]||(i[1]=t=>e.$emit("select",t)),onSort:i[2]||(i[2]=t=>e.$emit("sort",t)),onOption:y.onOption}),l({_:2},[e.$slots.options?{name:"options",fn:a(({row:t,rowIndex:i})=>[r(e.$slots,"options",c(d({item:t,index:i})))]),key:"0"}:void 0]),1040,["class","style","onOption"])):(n(),s(w,{key:1,class:p(["k-items","k-"+e.layout+"-items",e.$attrs.class]),"data-layout":e.layout,"data-size":e.size,handle:!0,list:e.items,options:y.dragOptions,style:u(e.$attrs.style),onChange:i[3]||(i[3]=t=>e.$emit("change",t)),onEnd:i[4]||(i[4]=t=>e.$emit("sort",e.items,t))},{default:a(()=>[(n(!0),h(m,null,f(y.itemsWithIds,(t,i)=>r(e.$slots,"default",o({ref_for:!0},{item:t,itemIndex:i}),()=>[(n(),s($,o({key:t.id},{ref_for:!0},t,{class:{"k-draggable-item":e.sortable&&!1!==t.sortable},image:y.imageOptions(t),layout:e.layout,link:!!e.link&&t.link,selectable:!1!==t.selectable,selecting:e.selecting,selected:y.isSelected(t),selectmode:e.selectmode,sortable:e.sortable&&!1!==t.sortable,theme:t.theme??e.theme,width:t.column,onClick:s=>e.$emit("item",t,i),onDrag:e=>y.onDragStart(e,t.dragText),onMouseover:s=>e.$emit("hover",s,t,i),onOption:e=>y.onOption(e,t,i),onSelect:e=>y.onSelect(t)}),l({_:2},[e.$slots.options?{name:"options",fn:a(()=>[r(e.$slots,"options",o({ref_for:!0},{item:t,index:i}))]),key:"0"}:void 0]),1040,["class","image","layout","link","selectable","selecting","selected","selectmode","sortable","theme","width","onClick","onDrag","onMouseover","onOption","onSelect"]))])),256))]),_:3},8,["class","data-layout","data-size","list","options","style"]))}]]),Ye={mixins:[Fe],props:{empty:{type:Object,default:()=>({})},help:String,pagination:{type:[Boolean,Object],default:!1}},emits:["action","change","empty","item","option","paginate","select","sort"],computed:{hasPagination(){return!1!==this.pagination&&(!0!==this.paginationOptions.hide&&!(this.pagination.total<=this.pagination.limit))},listeners(){const e=y();return void 0!==e?.vnode?.props?.onEmpty?{click:this.onEmpty}:{}},paginationOptions(){return{limit:10,details:!0,keys:!1,total:0,hide:!1,..."object"!=typeof this.pagination?{}:this.pagination}}},watch:{$props(){this.$forceUpdate()}},methods:{onEmpty(e){e.stopPropagation(),this.$emit("empty")},onOption(...e){this.$emit("action",...e),this.$emit("option",...e)},onSelect(...e){this.$emit("select",...e)}}},He={class:"k-collection"},Ue={key:2,class:"k-collection-footer"};const Ve=Ne(Ye,[["render",function(e,i,u,p,m,f){const y=t("k-empty"),v=t("k-items"),$=t("k-text"),w=t("k-pagination");return n(),h("div",He,[0===e.items.length?(n(),s(y,o({key:0},u.empty,{layout:e.layout},k(f.listeners)),null,16,["layout"])):(n(),s(v,o({key:1},{columns:e.columns,fields:e.fields,items:e.items,layout:e.layout,link:e.link,selecting:e.selecting,selectmode:e.selectmode,selected:e.selected,size:e.size,sortable:e.sortable,theme:e.theme},{onChange:i[0]||(i[0]=t=>e.$emit("change",t)),onItem:i[1]||(i[1]=t=>e.$emit("item",t)),onOption:f.onOption,onSelect:f.onSelect,onSort:i[2]||(i[2]=t=>e.$emit("sort",t))}),l({_:2},[e.$slots.options?{name:"options",fn:a(({item:t,index:i})=>[r(e.$slots,"options",c(d({item:t,index:i})))]),key:"0"}:void 0]),1040,["onOption","onSelect"])),u.help||f.hasPagination?(n(),h("footer",Ue,[b($,{class:"k-help k-collection-help",html:u.help},null,8,["html"]),f.hasPagination?(n(),s(w,o({key:0},f.paginationOptions,{onPaginate:i[3]||(i[3]=t=>e.$emit("paginate",t))}),null,16)):g("",!0)])):g("",!0)])}]]);const Ke=Ne({mixins:[De],props:{text:String,icon:String},emits:["click"],computed:{attrs(){const e=y(),t={button:void 0!==e?.vnode?.props?.onClick,icon:this.icon,theme:"empty"};return"cardlets"!==this.layout&&"cards"!==this.layout||(t.align="center",t.height="var(--item-height-cardlet)"),t}}},[["render",function(e,i,l,c,d,u){const p=t("k-box");return n(),s(p,o(u.attrs,{class:"k-empty",onClick:i[0]||(i[0]=t=>e.$emit("click",t))}),{default:a(()=>[r(e.$slots,"default",{},()=>[v($(l.text),1)])]),_:3},16)}]]),We={mixins:[De],props:{image:[Object,Boolean],width:{type:String,default:"1/1"}}};const Je=Ne({mixins:[We],inheritAttrs:!1,computed:{attrs(){return{back:this.image.back,cover:!0,...this.image,ratio:"list"===this.layout?"auto":this.image.ratio,size:this.sizes}},component(){return this.image.src?"k-image-frame":"k-icon-frame"},sizes(){switch(this.width){case"1/2":case"2/4":return"(min-width: 30em) and (max-width: 65em) 59em, (min-width: 65em) 44em, 27em";case"1/3":return"(min-width: 30em) and (max-width: 65em) 59em, (min-width: 65em) 29.333em, 27em";case"1/4":return"(min-width: 30em) and (max-width: 65em) 59em, (min-width: 65em) 22em, 27em";case"2/3":return"(min-width: 30em) and (max-width: 65em) 59em, (min-width: 65em) 27em, 27em";case"3/4":return"(min-width: 30em) and (max-width: 65em) 59em, (min-width: 65em) 66em, 27em";default:return"(min-width: 30em) and (max-width: 65em) 59em, (min-width: 65em) 88em, 27em"}}}},[["render",function(e,t,i,l,a,r){return n(),s(w(r.component),o(r.attrs,{class:["k-item-image",e.$attrs.class],style:e.$attrs.style}),null,16,["class","style"])}]]),Ge={mixins:[We,De],inheritAttrs:!1,props:{buttons:{type:Array,default:()=>[]},data:Object,info:String,link:{type:[Boolean,String,Function]},options:{type:[Array,Function,String]},selectable:{type:Boolean,default:!0},selecting:Boolean,selected:Boolean,selectmode:{type:String,default:"multiple"},sortable:Boolean,target:String,text:String,theme:String},emits:["action","click","drag","option","select"],computed:{hasFigure(){return!1!==this.image&&this.$helper.object.length(this.image)>0}},methods:{onClick(e){if(this.selecting&&this.selectable)return this.$refs.selector.click();this.$emit("click",e)},onOption(e){this.$emit("action",e),this.$emit("option",e)},title(e){return this.$helper.string.stripHTML(this.$helper.string.unescapeHTML(e)).trim()}}},Xe=["data-has-image","data-layout","data-selecting","data-selectable","data-theme"],Ze={class:"k-item-box"},Qe={class:"k-item-content"},et=["title"],tt=["innerHTML"],it=["innerHTML"],st=["title","innerHTML"],nt={key:0,class:"k-item-options"},ot=["checked","disabled","type"];const lt=Ne(Ge,[["render",function(e,i,l,c,d,u){const p=t("k-sort-handle"),k=t("k-item-image"),b=t("k-link"),y=t("k-button"),v=t("k-options-dropdown");return n(),h("div",o(l.data,{class:["k-item",`k-${e.layout}-item`,e.$attrs.class],"data-has-image":u.hasFigure,"data-layout":e.layout,"data-selecting":l.selecting,"data-selectable":l.selectable,"data-theme":l.theme,style:e.$attrs.style,onClick:i[2]||(i[2]=(...e)=>u.onClick&&u.onClick(...e)),onDragstart:i[3]||(i[3]=t=>e.$emit("drag",t))}),[l.sortable?(n(),s(p,{key:0,class:"k-item-sort-handle",tabindex:"-1"})):g("",!0),x("div",Ze,[r(e.$slots,"image",{},()=>[u.hasFigure?(n(),s(k,{key:0,image:e.image,layout:e.layout,width:e.width},null,8,["image","layout","width"])):g("",!0)]),x("div",Qe,[x("h3",{class:"k-item-title",title:u.title(l.text)},[!1!==l.link&&!0!==l.selecting?(n(),s(b,{key:0,target:l.target,to:l.link},{default:a(()=>[x("span",{innerHTML:l.text??" "},null,8,tt)]),_:1},8,["target","to"])):(n(),h("span",{key:1,innerHTML:l.text??" "},null,8,it))],8,et),l.info?(n(),h("p",{key:0,title:u.title(l.info),class:"k-item-info",innerHTML:l.info},null,8,st)):g("",!0)]),l.buttons?.length||l.options||e.$slots.options||l.selecting?(n(),h("div",nt,[(n(!0),h(m,null,f(l.buttons,e=>(n(),s(y,o({key:JSON.stringify(e)},{ref_for:!0},e),null,16))),128)),l.selecting?(n(),h("label",{key:0,class:"k-item-options-checkbox",onClick:i[1]||(i[1]=S(()=>{},["stop"]))},[x("input",{ref:"selector",checked:l.selected,disabled:!l.selectable,type:"single"===l.selectmode?"radio":"checkbox",onChange:i[0]||(i[0]=t=>e.$emit("select",t))},null,40,ot)])):g("",!0),r(e.$slots,"options",{},()=>[l.options&&!l.selecting?(n(),s(v,{key:0,options:l.options,class:"k-item-options-dropdown",onOption:u.onOption},null,8,["options","onOption"])):g("",!0)])])):g("",!0)])],16,Xe)}]]),at={install(e){e.component("k-collection",Ve),e.component("k-empty",Ke),e.component("k-item",lt),e.component("k-item-image",Je),e.component("k-items",Re)}},rt={class:"k-dialog-body"};const ct=Ne({},[["render",function(e,t,i,s,o,l){return n(),h("div",rt,[r(e.$slots,"default")])}]]);function dt(e){if(void 0===e)return;const t=e=>Array.isArray(e)?e.map(e=>t(e)):C(e)||O(e)||A(e)?t(I(e)):ut(e)?Object.keys(e).reduce((i,s)=>(i[s]=t(e[s]),i),{}):e;return t(e)}function ut(e){return"object"==typeof e&&e?.constructor===Object}function pt(e){return Object.keys(e??{}).length}function ht(e){return Object.keys(e).reduce((t,i)=>(t[i.toLowerCase()]=e[i],t),{})}const mt={clone:dt,filter:function(e,t){return Object.fromEntries(Object.entries(e).filter(([e,i])=>t(i,e)))},isEmpty:function(e){return null==e||""===e||(!(!ut(e)||0!==pt(e))||0===e.length)},isObject:ut,length:pt,merge:function e(t,i={}){for(const s in i)i[s]instanceof Object&&Object.assign(i[s],e(t[s]??{},i[s]));return Object.assign(t??{},i),t},same:function(e,t){return JSON.stringify(e)===JSON.stringify(t)},toLowerKeys:ht},ft={props:{cancelButton:{default:!0,type:[Boolean,String,Object]},disabled:{default:!1,type:Boolean},icon:{default:"check",type:String},submitButton:{type:[Boolean,String,Object],default:!0},theme:{default:"positive",type:String}}};const gt=Ne({mixins:[ft],emits:["cancel"],computed:{cancel(){return this.button(this.cancelButton,{click:()=>this.$emit("cancel"),class:"k-dialog-button-cancel",icon:"cancel",text:this.$t("cancel"),variant:"filled"})},submit(){return this.button(this.submitButton,{class:"k-dialog-button-submit",disabled:this.disabled||this.$panel.dialog.isLoading,icon:this.$panel.dialog.isLoading?"loader":this.icon,text:this.$t("confirm"),theme:this.theme,type:"submit",variant:"filled"})}},methods:{button:(e,t)=>"string"==typeof e?{...t,text:e}:!1!==e&&(!1===ut(e)?t:{...t,...e})}},[["render",function(e,i,l,r,d,u){const p=t("k-button"),h=t("k-button-group");return n(),s(h,{class:"k-dialog-buttons"},{default:a(()=>[u.cancel?(n(),s(p,c(o({key:0},u.cancel)),null,16)):g("",!0),u.submit?(n(),s(p,c(o({key:1},u.submit)),null,16)):g("",!0)]),_:1})}]]),kt={props:{empty:{default:()=>window.panel.t("dialog.fields.empty"),type:String},fields:{default:()=>[],type:[Array,Object]},value:{default:()=>({}),type:Object}}};const bt=Ne({mixins:[kt],emits:["input","submit"],computed:{hasFields(){return this.$helper.object.length(this.fields)>0}}},[["render",function(e,i,o,l,r,c){const d=t("k-fieldset"),u=t("k-box");return c.hasFields?(n(),s(d,{key:0,fields:e.fields,value:e.value,class:"k-dialog-fields",onInput:i[0]||(i[0]=t=>e.$emit("input",t)),onSubmit:i[1]||(i[1]=t=>e.$emit("submit",t))},null,8,["fields","value"])):(n(),s(u,{key:1,theme:"info"},{default:a(()=>[v($(e.empty),1)]),_:1}))}]]),yt={class:"k-dialog-footer"};const vt=Ne({},[["render",function(e,t,i,s,o,l){return n(),h("footer",yt,[r(e.$slots,"default")])}]]);const $t=Ne({},[["render",function(e,i,o,l,a,r){const c=t("k-notification");return"dialog"===e.$panel.notification.context?(n(),s(c,{key:0,class:"k-dialog-notification"})):g("",!0)}]]);const wt=Ne({props:{autofocus:{default:!0,type:Boolean},placeholder:{type:String},value:{type:String}},emits:["search"],computed:{icon(){return this.value?"cancel-small":"search"}},methods:{onIconClick(){this.value?this.$emit("search",null):this.$refs.input.focus()}}},[["render",function(e,i,o,l,r,c){const d=t("k-button"),u=t("k-input");return n(),s(u,{ref:"input",autofocus:o.autofocus,placeholder:o.placeholder,value:o.value,class:"k-dialog-search",type:"search",onInput:i[0]||(i[0]=t=>e.$emit("search",t))},{icon:a(()=>[b(d,{icon:c.icon,tabindex:"-1",onClick:c.onIconClick},null,8,["icon","onClick"])]),_:1},8,["autofocus","placeholder","value"])}]]),xt={props:{empty:{type:String,default:()=>window.panel.t("dialog.text.empty")},text:{type:String}}};const St=Ne({mixins:[xt]},[["render",function(e,i,o,l,r,c){const d=t("k-text"),u=t("k-box");return e.text?(n(),s(d,{key:0,html:e.text},null,8,["html"])):(n(),s(u,{key:1,theme:"info"},{default:a(()=>[v($(e.empty),1)]),_:1}))}]]),Ct={install(e){e.component("k-dialog-body",ct),e.component("k-dialog-buttons",gt),e.component("k-dialog-fields",bt),e.component("k-dialog-footer",vt),e.component("k-dialog-notification",$t),e.component("k-dialog-search",wt),e.component("k-dialog-text",St)}},Ot={mixins:[ft],props:{size:{default:"default",type:String},visible:{default:!1,type:Boolean}},emits:["cancel","close","input","submit","success"],methods:{cancel(){this.$emit("cancel")},close(){this.$emit("close")},error(e){this.$panel.notification.error(e)},focus(e){this.$panel.dialog.focus(e)},input(e){this.$emit("input",e)},open(){this.$panel.dialog.open(this)},submit(){this.$emit("submit",this.value)},success(e){this.$emit("success",e)}}},At=["data-size"];const It=Ne({mixins:[Ot],emits:["cancel","drop","submit"],computed:{hasDropzone(){const e=y();return void 0!==e?.vnode?.props?.onDrop}}},[["render",function(e,i,o,l,c,d){const u=t("k-dialog-notification"),h=t("k-dialog-body"),m=t("k-dialog-buttons"),f=t("k-dialog-footer"),k=t("k-dropzone");return e.visible?(n(),s(M,{key:0,to:".k-dialog-portal"},[x("form",{class:p(["k-dialog",e.$attrs.class]),"data-size":e.size,method:"dialog",onClick:i[2]||(i[2]=S(()=>{},["stop"])),onSubmit:i[3]||(i[3]=S(t=>e.$emit("submit"),["prevent"]))},[b(k,{disabled:!d.hasDropzone,onDrop:i[1]||(i[1]=t=>e.$emit("drop",t))},{default:a(()=>[r(e.$slots,"header",{},()=>[b(u)]),e.$slots.default?(n(),s(h,{key:0},{default:a(()=>[r(e.$slots,"default")]),_:3})):g("",!0),r(e.$slots,"footer",{},()=>[e.cancelButton||e.submitButton?(n(),s(f,{key:0},{default:a(()=>[b(m,{"cancel-button":e.cancelButton,disabled:e.disabled,icon:e.icon,"submit-button":e.submitButton,theme:e.theme,onCancel:i[0]||(i[0]=t=>e.$emit("cancel"))},null,8,["cancel-button","disabled","icon","submit-button","theme"])]),_:1})):g("",!0)])]),_:3},8,["disabled"])],42,At)])):g("",!0)}]]),Mt={key:0},_t={key:1},Dt={key:2},Et={key:3};const jt=Ne({mixins:[Ot],props:{cancelButton:{default:!1},files:{type:Array,default:()=>[]},pages:{type:Array,default:()=>[]},size:{default:"medium"},submitButton:{default:!1},users:{type:Array,default:()=>[]}}},[["render",function(e,i,l,r,c,d){const u=t("k-headline"),p=t("k-items"),m=t("k-empty"),f=t("k-dialog");return n(),s(f,o(e.$props,{class:"k-changes-dialog"}),{default:a(()=>[l.pages.length?(n(),h("section",Mt,[b(u,null,{default:a(()=>[v($(e.$t("lock.unsaved.pages")),1)]),_:1}),b(p,{items:l.pages,layout:"list"},null,8,["items"])])):g("",!0),l.files.length?(n(),h("section",_t,[b(u,null,{default:a(()=>[v($(e.$t("lock.unsaved.files")),1)]),_:1}),b(p,{items:l.files,layout:"list"},null,8,["items"])])):g("",!0),l.users.length?(n(),h("section",Dt,[b(u,null,{default:a(()=>[v($(e.$t("lock.unsaved.users")),1)]),_:1}),b(p,{items:l.users,layout:"list"},null,8,["items"])])):g("",!0),l.pages.length||l.files.length||l.users.length?g("",!0):(n(),h("section",Et,[b(u,null,{default:a(()=>[v($(e.$t("lock.unsaved")),1)]),_:1}),b(m,{icon:"edit-line"},{default:a(()=>[v($(e.$t("lock.unsaved.empty")),1)]),_:1})]))]),_:1},16)}]]);const Lt=Ne({mixins:[Ot,kt],props:{fields:{default:()=>({href:{label:window.panel.t("email"),type:"email",icon:"email"},title:{label:window.panel.t("title"),type:"text",icon:"title"}})},size:{default:"medium"},submitButton:{default:()=>window.panel.t("insert")}},emits:["cancel","submit"],data(){return{values:{href:"",title:null,...this.value}}},methods:{submit(){this.$emit("submit",this.values)}}},[["render",function(e,i,l,a,r,c){const d=t("k-form-dialog");return n(),s(d,o(e.$props,{value:r.values,onCancel:i[0]||(i[0]=t=>e.$emit("cancel")),onInput:i[1]||(i[1]=e=>r.values=e),onSubmit:c.submit}),null,16,["value","onSubmit"])}]]),Bt={key:0,class:"k-error-details"},Tt={key:0};const qt=Ne({mixins:[Ot],props:{details:[Object,Array],message:String,size:{default:"medium",type:String}},emits:["cancel"],computed:{detailsList(){return this.$helper.array.fromObject(this.details)}}},[["render",function(e,i,o,l,r,c){const d=t("k-text"),u=t("k-dialog");return n(),s(u,{ref:"dialog","cancel-button":!1,"submit-button":!1,size:o.size,visible:e.visible,class:"k-error-dialog",onCancel:i[0]||(i[0]=t=>e.$emit("cancel"))},{default:a(()=>[b(d,null,{default:a(()=>[v($(o.message),1)]),_:1}),c.detailsList.length?(n(),h("dl",Bt,[(n(!0),h(m,null,f(c.detailsList,(e,t)=>(n(),h(m,{key:"detail-"+t},[x("dt",null,$(e.label),1),x("dd",null,["object"==typeof e.message?(n(),h("ul",Tt,[(n(!0),h(m,null,f(e.message,(e,t)=>(n(),h("li",{key:t},$(e),1))),128))])):(n(),h(m,{key:1},[v($(e.message),1)],64))])],64))),128))])):g("",!0)]),_:1},8,["size","visible"])}]]);const zt=Ne({},[["render",function(e,t){return n(),s(w(e.$panel.dialog.component),o({key:e.$panel.dialog.timestamp,visible:!0},e.$panel.dialog.props,k(e.$panel.dialog.listeners())),null,16)}]]);const Pt=Ne({mixins:[Ot,kt],props:{size:{default:"medium"},submitButton:{default:()=>window.panel.t("save")},text:{type:String}},emits:["cancel","input","submit"]},[["render",function(e,i,l,c,d,u){const p=t("k-dialog-text"),h=t("k-dialog-fields"),m=t("k-dialog");return n(),s(m,o({ref:"dialog"},e.$props,{onCancel:i[2]||(i[2]=t=>e.$emit("cancel")),onSubmit:i[3]||(i[3]=t=>e.$emit("submit",e.value))}),{default:a(()=>[r(e.$slots,"default",{},()=>[l.text?(n(),s(p,{key:0,text:l.text},null,8,["text"])):g("",!0),b(h,{fields:e.fields,value:e.value,onInput:i[0]||(i[0]=t=>e.$emit("input",t)),onSubmit:i[1]||(i[1]=t=>e.$emit("submit",t))},null,8,["fields","value"])])]),_:3},16)}]]),Nt={extends:Pt,watch:{"value.name"(e){this.fields.code.disabled||this.onNameChanges(e)},"value.code"(e){this.fields.code.disabled||(this.value.code=this.$helper.slug(e,[this.$panel.system.ascii]),this.onCodeChanges(this.value.code))}},methods:{onCodeChanges(e){if(!e)return this.value.locale=null;if(e.length>=2)if(-1!==e.indexOf("-")){let t=e.split("-"),i=[t[0],t[1].toUpperCase()];this.value.locale=i.join("_")}else{let t=this.$panel.system.locales??[];this.value.locale=t?.[e]}},onNameChanges(e){this.value.code=this.$helper.slug(e,[this.value.rules,this.$panel.system.ascii]).substr(0,2)}}},Ft={class:"k-headline"},Rt={class:"k-table"},Yt={style:{"table-layout":"auto"}},Ht={"data-mobile":"true"},Ut={"data-mobile":"true"},Vt={key:0},Kt={"data-mobile":"true"},Wt={"data-mobile":"true",class:"k-text"},Jt={key:1},Gt={"data-mobile":"true"},Xt=["data-theme"],Zt={class:"k-license-dialog-status"};const Qt=Ne({mixins:[{mixins:[Ot],props:{license:Object,size:{default:"large"}}}],emits:["cancel","submit"]},[["render",function(e,i,l,r,c,d){const u=t("k-button"),p=t("k-bar"),m=t("k-icon"),f=t("k-dialog");return n(),s(f,o({ref:"dialog"},e.$props,{class:"k-license-dialog",onCancel:i[0]||(i[0]=t=>e.$emit("cancel")),onSubmit:i[1]||(i[1]=t=>e.$emit("submit"))}),{default:a(()=>[b(p,{style:{"margin-bottom":"var(--spacing-2)"}},{default:a(()=>[x("h2",Ft,$(e.$t("license")),1),b(u,{text:e.$t("remove"),icon:"trash",size:"xs",variant:"filled",dialog:"license/remove"},null,8,["text"])]),_:1}),x("div",Rt,[x("table",Yt,[x("tbody",null,[x("tr",null,[x("th",Ht,$(e.$t("type")),1),x("td",Ut,$(e.license.type),1)]),e.license.code?(n(),h("tr",Vt,[x("th",Kt,$(e.$t("license.code")),1),x("td",Wt,[x("code",null,$(e.license.code),1)])])):g("",!0),e.license.info?(n(),h("tr",Jt,[x("th",Gt,$(e.$t("status")),1),x("td",{"data-mobile":"true","data-theme":e.license.theme},[x("p",Zt,[b(m,{type:e.license.icon},null,8,["type"]),v(" "+$(e.license.info),1)])],8,Xt)])):g("",!0)])])])]),_:1},16)}]]);const ei=Ne({mixins:[{mixins:[Ot],props:{cancelButton:null,submitButton:null,lock:Object,preview:String}}],emits:["cancel","submit"]},[["render",function(e,i,l,r,c,d){const u=t("k-dialog-text"),p=t("k-icon"),h=t("k-dialog");return n(),s(h,o({ref:"dialog"},e.$props,{"cancel-button":!1,"submit-button":{theme:"passive"},class:"k-lock-alert-dialog",onCancel:i[0]||(i[0]=t=>e.$emit("cancel")),onSubmit:i[1]||(i[1]=t=>e.$emit("submit"))}),{default:a(()=>[b(u,{text:e.$t("form.locked")},null,8,["text"]),x("dl",null,[x("div",null,[x("dt",null,[b(p,{type:"user"})]),x("dd",null,$(e.lock.user.email),1)]),x("div",null,[x("dt",null,[b(p,{type:"clock"})]),x("dd",null,$(e.$library.dayjs(e.lock.modified).format("YYYY-MM-DD HH:mm:ss")),1)])])]),_:1},16)}]]);const ti=Ne({mixins:[Ot,kt],props:{fields:{default:()=>({href:{label:window.panel.t("link"),type:"link",placeholder:window.panel.t("url.placeholder"),icon:"url"},title:{label:window.panel.t("title"),type:"text",icon:"title"},target:{label:window.panel.t("open.newWindow"),type:"toggle",text:[window.panel.t("no"),window.panel.t("yes")]}})},size:{default:"medium"},submitButton:{default:()=>window.panel.t("insert")}},emits:["cancel","submit"],data(){return{values:{href:"",title:null,...this.value,target:Boolean(this.value.target??!1)}}},methods:{submit(){let e="/@/$1/";this.values.href.startsWith("page://")&&window.panel.language.code&&!1===window.panel.language.default&&!1===window.panel.language.hasCustomDomain&&(e="/"+window.panel.language.code+e);const t=this.values.href.replace(/(file|page):\/\//,e);this.$emit("submit",{...this.values,href:t,target:this.values.target?"_blank":null})}}},[["render",function(e,i,l,a,r,c){const d=t("k-form-dialog");return n(),s(d,o(e.$props,{value:r.values,onCancel:i[0]||(i[0]=t=>e.$emit("cancel")),onInput:i[1]||(i[1]=e=>r.values=e),onSubmit:c.submit}),null,16,["value","onSubmit"])}]]),ii=(e,t,i={leading:!1,trailing:!0})=>{let s=null,n=null;return!1===i.leading&&!1===i.trailing?()=>null:function(...o){!s&&i.leading?e.apply(this,o):n=o,clearTimeout(s),s=setTimeout(()=>{i.trailing&&n&&e.apply(this,n),s=null,n=null},t)}},si={props:{delay:{default:200,type:Number},hasSearch:{default:!0,type:Boolean}},data:()=>({query:""}),watch:{query(){!1!==this.hasSearch&&this.search()}},created(){this.search=ii(this.search,this.delay)},methods:{async search(){console.warn("Search mixin: Please implement a `search` method.")}}},ni={mixins:[Ot,si],props:{empty:{type:Object,default:()=>({})},help:{type:String},items:{type:Array,default:()=>[]},layout:{type:String,default:"list"},max:Number,multiple:{type:Boolean,default:!0},pagination:{type:Object,default:()=>({})},size:{default:"medium"},value:{type:Array,default:()=>[]}}},oi={class:"k-model-picker-dialog-header"};const li=Ne({mixins:[ni],props:{payload:{type:Object,default:()=>({})}},emits:["cancel","drop","submit"],data(){return{selected:this.value}},computed:{collection(){return{empty:{...this.empty,text:this.$panel.dialog.isLoading?this.$t("loading"):this.empty.text},help:this.help,items:this.items,layout:this.layout,link:!1,pagination:{details:!0,dropdown:!1,align:"center",...this.pagination},selecting:!0,selectmode:this.multiple?"multiple":"single",selected:this.selected,sortable:!1,onPaginate:this.paginate,onSelect:this.select}}},watch:{value(e){this.selected=e}},methods:{paginate({page:e}){this.refresh({page:e})},refresh(e={}){this.$panel.dialog.refresh({query:{...this.payload,value:this.selected,...e}})},search(){this.refresh({search:this.query})},select(e){this.selected=e},submit(){this.$emit("submit",{ids:this.selected,items:this.selected.map(e=>this.items.find(t=>t.uuid?t.uuid===e:t.id===e)).filter(Boolean)})}}},[["render",function(e,i,l,u,p,h){const m=t("k-dialog-search"),f=t("k-collection"),y=t("k-dialog");return n(),s(y,o(e.$props,{class:"k-model-picker-dialog",onCancel:i[1]||(i[1]=t=>e.$emit("cancel")),onSubmit:h.submit},k(e.$panel.dialog.hasEventListener("drop")?{drop:t=>e.$emit("drop",t)}:{})),{default:a(()=>[r(e.$slots,"header"),r(e.$slots,"search",{},()=>[x("header",oi,[e.hasSearch?(n(),s(m,{key:0,value:e.query,class:"k-model-picker-dialog-search",onSearch:i[0]||(i[0]=t=>e.query=t)},null,8,["value"])):g("",!0),r(e.$slots,"buttons")])]),b(f,c(d(h.collection)),{options:a(({item:t})=>[r(e.$slots,"options",c(d({item:t})))]),_:3},16)]),_:3},16,["onSubmit"])}]]);const ai=Ne({mixins:[Pt],props:{blueprints:{type:Array},size:{default:"medium",type:String},submitButton:{type:[String,Boolean],default:()=>window.panel.t("save")},template:{type:String}},emits:["cancel","input","submit"],computed:{templates(){return this.blueprints.map(e=>({text:e.title,value:e.name}))}},methods:{pick(e){this.$panel.dialog.refresh({query:{...this.$panel.dialog.query,slug:this.value.slug,template:e,title:this.value.title}})}}},[["render",function(e,i,l,r,c,d){const u=t("k-select-field"),p=t("k-dialog-fields"),h=t("k-form-dialog");return n(),s(h,o({ref:"dialog"},e.$props,{class:"k-page-create-dialog",onCancel:i[3]||(i[3]=t=>e.$emit("cancel")),onSubmit:i[4]||(i[4]=t=>e.$emit("submit",e.value))}),{default:a(()=>[d.templates.length>1?(n(),s(u,{key:0,empty:!1,label:e.$t("template"),options:d.templates,required:!0,value:l.template,class:"k-page-template-switch",onInput:i[0]||(i[0]=e=>d.pick(e))},null,8,["label","options","value"])):g("",!0),b(p,{fields:e.fields,value:e.value,onInput:i[1]||(i[1]=t=>e.$emit("input",t)),onSubmit:i[2]||(i[2]=t=>e.$emit("submit",t))},null,8,["fields","value"])]),_:1},16)}]]),ri={class:"k-page-move-parent",tabindex:"0","data-autofocus":""};const ci=Ne({mixins:[Ot],props:{value:{default:()=>({}),type:Object}},emits:["cancel","input","submit"],methods:{select(e){this.$emit("input",{...this.value,parent:e.value})}}},[["render",function(e,i,l,r,c,d){const u=t("k-headline"),p=t("k-page-tree"),h=t("k-dialog");return n(),s(h,o({ref:"dialog"},e.$props,{"submit-button":{icon:"parent",text:e.$t("move")},class:"k-page-move-dialog",size:"medium",onCancel:i[0]||(i[0]=t=>e.$emit("cancel")),onSubmit:i[1]||(i[1]=t=>e.$emit("submit",l.value))}),{default:a(()=>[b(u,null,{default:a(()=>[v($(e.$t("page.move")),1)]),_:1}),x("div",ri,[b(p,{current:l.value.parent,move:l.value.move,identifier:"id",onSelect:d.select},null,8,["current","move","onSelect"])])]),_:1},16,["submit-button"])}]]),di={class:"k-page-picker-navigation"};const ui=Ne({mixins:[ni],props:{parent:{type:Object}},emits:["cancel","submit"],computed:{payload(){return{parent:this.parent?.id}}},methods:{badge(e){if(e.selectedChildren>0)return{text:e.selectedChildren,theme:"info"}},navigate(e){this.$refs.dialog.refresh({parent:e})}}},[["render",function(e,i,r,c,d,u){const p=t("k-button"),h=t("k-headline"),m=t("k-model-picker-dialog");return n(),s(m,o({ref:"dialog"},e.$props,{payload:u.payload,onCancel:i[1]||(i[1]=t=>e.$emit("cancel")),onSubmit:i[2]||(i[2]=t=>e.$emit("submit",t))}),l({_:2},[r.parent?{name:"header",fn:a(()=>[x("header",di,[b(p,{disabled:!r.parent.id,title:e.$t("back"),icon:"angle-left",size:"sm",variant:"filled",onClick:i[0]||(i[0]=e=>u.navigate(r.parent.parent))},null,8,["disabled","title"]),b(h,null,{default:a(()=>[v($(r.parent.title),1)]),_:1})])]),key:"0"}:void 0,r.parent?{name:"options",fn:a(({item:t})=>[b(p,{badge:u.badge(t),disabled:!t.hasChildren,title:e.$t("open"),icon:"angle-right",class:"k-page-picker-option",onClick:S(e=>u.navigate(t.id),["stop"])},null,8,["badge","disabled","title","onClick"])]),key:"1"}:void 0]),1040,["payload"])}]]);const pi=Ne({mixins:[{mixins:[Ot,xt]}],emits:["cancel","submit"]},[["render",function(e,i,l,c,d,u){const p=t("k-dialog-text"),h=t("k-dialog");return n(),s(h,o({ref:"dialog"},e.$props,{onCancel:i[0]||(i[0]=t=>e.$emit("cancel")),onSubmit:i[1]||(i[1]=t=>e.$emit("submit"))}),{default:a(()=>[r(e.$slots,"default",{},()=>[b(p,{text:e.text},null,8,["text"])])]),_:3},16)}]]);const hi=Ne({mixins:[pi],props:{icon:{default:"trash"},submitButton:{default:()=>window.panel.t("delete")},theme:{default:"negative"}},emits:["cancel","submit"]},[["render",function(e,i,l,c,d,u){const p=t("k-text-dialog");return n(),s(p,o({ref:"dialog"},e.$props,{onCancel:i[0]||(i[0]=t=>e.$emit("cancel")),onSubmit:i[1]||(i[1]=t=>e.$emit("submit"))}),{default:a(()=>[r(e.$slots,"default")]),_:3},16)}]]);const mi=Ne({mixins:[Ot],props:{details:[Array,Object],exception:Object,message:String,request:Object,response:Object,trace:Array},emits:["cancel"],computed:{hasDetails(){return!!this.details&&(!0!==Array.isArray(this.details)||0!==this.details.length)},url(){return new URL(this.request.url)}}},[["render",function(e,i,o,l,r,c){const d=t("k-headline"),u=t("k-box"),p=t("k-stack"),h=t("k-definition"),m=t("k-code-token"),f=t("k-definitions"),k=t("k-button"),y=t("k-code"),w=t("k-error-trace"),S=t("k-dialog");return n(),s(S,{ref:"dialog","cancel-button":!1,"submit-button":!1,visible:e.visible,class:"k-request-error-dialog",size:"large",onCancel:i[0]||(i[0]=t=>e.$emit("cancel"))},{default:a(()=>[b(p,{gap:"var(--spacing-6)"},{default:a(()=>[b(p,{gap:"var(--spacing-3)"},{default:a(()=>[b(d,null,{default:a(()=>[...i[1]||(i[1]=[v("Error",-1)])]),_:1}),b(u,{icon:"alert",theme:"negative"},{default:a(()=>[v($(o.message),1)]),_:1})]),_:1}),b(p,{gap:"var(--spacing-3)"},{default:a(()=>[b(d,null,{default:a(()=>[...i[2]||(i[2]=[v("Request",-1)])]),_:1}),b(f,null,{default:a(()=>[b(h,{term:"Path"},{default:a(()=>[x("span",null,$(c.url.pathname),1)]),_:1}),c.url.search?(n(),s(h,{key:0,term:"Query"},{default:a(()=>[x("span",null,$(c.url.search),1)]),_:1})):g("",!0),b(h,{term:"Method"},{default:a(()=>[b(m,{type:"black"},{default:a(()=>[v($(o.request.method),1)]),_:1})]),_:1}),b(h,{term:"Code"},{default:a(()=>[b(m,{type:"blue"},{default:a(()=>[v($(o.response.status),1)]),_:1})]),_:1})]),_:1})]),_:1}),b(p,{gap:"var(--spacing-3)"},{default:a(()=>[b(p,{direction:"row",justify:"space-between",align:"center"},{default:a(()=>[b(d,null,{default:a(()=>[...i[3]||(i[3]=[v("Exception",-1)])]),_:1}),o.exception.url?(n(),s(k,{key:0,link:o.exception.url,icon:"open",size:"xs",variant:"filled"},null,8,["link"])):g("",!0)]),_:1}),b(f,null,{default:a(()=>[o.exception.type?(n(),s(h,{key:0,term:"Type"},{default:a(()=>[b(m,{type:"object"},{default:a(()=>[v($(o.exception.type),1)]),_:1})]),_:1})):g("",!0),o.exception.file?(n(),s(h,{key:1,term:"File"},{default:a(()=>[v($(o.exception.file),1)]),_:1})):g("",!0),o.exception.line?(n(),s(h,{key:2,term:"Line"},{default:a(()=>[b(m,{type:"purple"},{default:a(()=>[v($(o.exception.line),1)]),_:1})]),_:1})):g("",!0)]),_:1})]),_:1}),c.hasDetails?(n(),s(p,{key:0,gap:"var(--spacing-3)"},{default:a(()=>[b(d,null,{default:a(()=>[...i[4]||(i[4]=[v("Details",-1)])]),_:1}),b(y,{language:"js"},{default:a(()=>[v($(o.details),1)]),_:1})]),_:1})):g("",!0),e.$panel.debug&&o.trace?(n(),s(p,{key:1,gap:"var(--spacing-3)"},{default:a(()=>[x("details",null,[i[5]||(i[5]=x("summary",null,"Trace",-1)),b(w,{trace:o.trace},null,8,["trace"])])]),_:1})):g("",!0)]),_:1})]),_:1},8,["visible"])}]]);const fi=Ne({mixins:[Ot],props:{type:String},emits:["cancel"],data:()=>({results:null,pagination:{}}),methods:{focus(){this.$refs.search?.focus()},navigate(e){e&&(this.$go(e.link),this.close())},async search({type:e,query:t}){const i=await this.$panel.search(e,t);i&&(this.results=i.results,this.pagination=i.pagination)}}},[["render",function(e,i,o,l,r,c){const d=t("k-search-bar"),u=t("k-dialog");return n(),s(u,{"cancel-button":!1,"submit-button":!1,visible:!0,class:"k-search-dialog",role:"search",size:"medium",onCancel:i[1]||(i[1]=t=>e.$emit("cancel")),onSubmit:e.submit},{default:a(()=>[b(d,{ref:"search","default-type":o.type??e.$panel.view.search,"is-loading":e.$panel.searcher.isLoading,pagination:r.pagination,results:r.results,types:e.$panel.searches,onClose:e.close,onMore:i[0]||(i[0]=t=>e.$go("search",{query:t})),onNavigate:c.navigate,onSearch:c.search},null,8,["default-type","is-loading","pagination","results","types","onClose","onNavigate","onSearch"])]),_:1},8,["onSubmit"])}]]),gi={class:"k-totp-dialog-grid"},ki={class:"k-totp-qrcode"};const bi=Ne({mixins:[{mixins:[Ot,kt]}],props:{fields:null,qr:{type:String,required:!0},size:{default:"large"},submitButton:{default:()=>({text:window.panel.t("activate"),icon:"lock",theme:"notice"})}},emits:["cancel","input","submit"]},[["render",function(e,i,l,r,c,d){const u=t("k-dialog-text"),p=t("k-info-field"),h=t("k-dialog-fields"),m=t("k-dialog");return n(),s(m,o({ref:"dialog"},e.$props,{onCancel:i[2]||(i[2]=t=>e.$emit("cancel")),onSubmit:i[3]||(i[3]=t=>e.$emit("submit"))}),{default:a(()=>[b(u,{text:e.$t("login.totp.enable.intro"),class:"k-totp-dialog-intro"},null,8,["text"]),x("div",gi,[x("div",ki,[b(p,{label:e.$t("login.totp.enable.qr.label"),text:l.qr,help:e.$t("login.totp.enable.qr.help",{secret:e.value.secret}),theme:"passive"},null,8,["label","text","help"])]),b(h,{fields:{info:{label:e.$t("login.totp.enable.confirm.headline"),type:"info",text:e.$t("login.totp.enable.confirm.text"),theme:"none"},confirm:{label:e.$t("login.totp.enable.confirm.label"),type:"text",counter:!1,font:"monospace",required:!0,placeholder:e.$t("login.code.placeholder.totp"),help:e.$t("login.totp.enable.confirm.help")},secret:{type:"hidden"}},value:e.value,class:"k-totp-dialog-fields",onInput:i[0]||(i[0]=t=>e.$emit("input",t)),onSubmit:i[1]||(i[1]=t=>e.$emit("submit",t))},null,8,["fields","value"])])]),_:1},16)}]]);const yi=Ne({mixins:[Ot],props:{submitButton:{type:[String,Boolean,Object],default:()=>({icon:"upload",text:window.panel.t("upload")})}},emits:["cancel","submit"]},[["render",function(e,i,l,r,c,d){const u=t("k-empty"),p=t("k-upload-items"),h=t("k-dialog");return n(),s(h,o({ref:"dialog",class:"k-upload-dialog"},e.$props,{disabled:e.disabled||0===e.$panel.upload.files.length,onCancel:i[3]||(i[3]=t=>e.$emit("cancel")),onDrop:i[4]||(i[4]=t=>e.$panel.upload.select(t)),onSubmit:i[5]||(i[5]=t=>e.$emit("submit"))}),{default:a(()=>[0===e.$panel.upload.files.length?(n(),s(u,{key:0,icon:"upload",layout:"cards",onClick:i[0]||(i[0]=t=>e.$panel.upload.pick())},{default:a(()=>[v($(e.$t("files.empty")),1)]),_:1})):(n(),s(p,{key:1,items:e.$panel.upload.files,onRemove:i[1]||(i[1]=t=>{e.$panel.upload.remove(t.id)}),onRename:i[2]||(i[2]=(e,t)=>{e.name=t})},null,8,["items"]))]),_:1},16,["disabled"])}]]),vi={extends:yi,props:{original:Object,submitButton:{type:[String,Boolean,Object],default:()=>({icon:"upload",text:window.panel.t("replace")})}},emits:["cancel","submit"],computed:{file(){return this.$panel.upload.files[0]}}},$i={class:"k-upload-items"},wi={class:"k-upload-original"};const xi=Ne(vi,[["render",function(e,i,l,r,c,d){const u=t("k-upload-item-preview"),p=t("k-upload-item"),h=t("k-dialog");return n(),s(h,o({ref:"dialog",class:"k-upload-dialog k-upload-replace-dialog"},e.$props,{onCancel:i[0]||(i[0]=t=>e.$emit("cancel")),onSubmit:i[1]||(i[1]=t=>e.$emit("submit"))}),{default:a(()=>[x("ul",$i,[x("li",wi,[b(u,{color:l.original.image?.color,icon:l.original.image?.icon,url:l.original.url,type:l.original.mime},null,8,["color","icon","url","type"])]),i[2]||(i[2]=x("li",null,"←",-1)),b(p,o(d.file,{color:l.original.image?.color,editable:!1,icon:l.original.image?.icon,name:e.$helper.file.name(l.original.filename),removable:!1}),null,16,["color","icon","name"])])]),_:1},16)}]]),Si={props:{endpoint:String,empty:Object,fetchParams:Object,item:{type:Function,default:e=>e},max:Number,multiple:{type:Boolean,default:!0},size:{type:String,default:"medium"},value:{type:Array,default:()=>[]}}};const Ci=Ne({mixins:[Ot,si,Si],emits:["cancel","fetched","submit"],data(){return{models:[],selected:this.value.reduce((e,t)=>({...e,[t]:{id:t}}),{}),pagination:{limit:20,page:1,total:0}}},computed:{items(){return this.models.map(this.item)}},watch:{fetchParams(e,t){!1===this.$helper.object.same(e,t)&&(this.pagination.page=1,this.fetch())}},mounted(){this.fetch()},methods:{async fetch(){const e={page:this.pagination.page,search:this.query,...this.fetchParams};try{this.$panel.dialog.isLoading=!0;const t=await this.$api.get(this.endpoint,e);this.models=t.data,this.pagination=t.pagination,this.$emit("fetched",t)}catch(t){this.$panel.error(t),this.models=[]}finally{this.$panel.dialog.isLoading=!1}},isSelected(e){return void 0!==this.selected[e.id]},paginate(e){this.pagination.page=e.page,this.pagination.limit=e.limit,this.fetch()},submit(){this.$emit("submit",Object.values(this.selected))},async search(){this.pagination.page=0,await this.fetch()},toggle(e){if(!1!==this.multiple&&1!==this.max||(this.selected={}),this.isSelected(e))return delete this.selected[e.id];this.max&&this.max<=this.$helper.object.length(this.selected)||(this.selected[e.id]=e)}}},[["render",function(e,i,l,u,p,h){const m=t("k-dialog-search"),f=t("k-choice-input"),k=t("k-collection"),y=t("k-dialog");return n(),s(y,o(e.$props,{class:"k-models-dialog",onCancel:i[1]||(i[1]=t=>e.$emit("cancel")),onSubmit:h.submit}),{default:a(()=>[r(e.$slots,"header"),e.hasSearch?(n(),s(m,{key:0,value:e.query,onSearch:i[0]||(i[0]=t=>e.query=t)},null,8,["value"])):g("",!0),b(k,{empty:{...e.empty,text:e.$panel.dialog.isLoading?e.$t("loading"):e.empty.text},items:h.items,link:!1,pagination:{details:!0,dropdown:!1,align:"center",...p.pagination},sortable:!1,layout:"list",onItem:h.toggle,onPaginate:h.paginate},{options:a(({item:t})=>[b(f,{checked:h.isSelected(t),type:e.multiple&&1!==e.max?"checkbox":"radio",title:h.isSelected(t)?e.$t("remove"):e.$t("select"),onClick:S(e=>h.toggle(t),["stop"])},null,8,["checked","type","title","onClick"]),r(e.$slots,"options",c(d({item:t})))]),_:3},8,["empty","items","pagination","onItem","onPaginate"])]),_:3},16,["onSubmit"])}]]);const Oi=Ne({mixins:[Ot,Si],props:{empty:{type:Object,default:()=>({icon:"image",text:window.panel.t("dialog.files.empty")})}},emits:["cancel","submit"]},[["render",function(e,i,l,a,r,c){const d=t("k-models-dialog");return n(),s(d,o(e.$props,{onCancel:i[0]||(i[0]=t=>e.$emit("cancel")),onSubmit:i[1]||(i[1]=t=>e.$emit("submit",t))}),null,16)}]]),Ai={class:"k-pages-dialog-navbar"};const Ii=Ne({mixins:[Ot,Si],props:{empty:{type:Object,default:()=>({icon:"page",text:window.panel.t("dialog.pages.empty")})}},emits:["cancel","submit"],data:()=>({model:null,parent:null})},[["render",function(e,i,r,c,d,u){const p=t("k-button"),h=t("k-headline"),m=t("k-models-dialog");return n(),s(m,o(e.$props,{"fetch-params":{parent:d.parent},onCancel:i[1]||(i[1]=t=>e.$emit("cancel")),onFetched:i[2]||(i[2]=e=>d.model=e.model),onSubmit:i[3]||(i[3]=t=>e.$emit("submit",t))}),l({_:2},[d.model?{name:"header",fn:a(()=>[x("header",Ai,[b(p,{disabled:!d.model.id,title:e.$t("back"),icon:"angle-left",onClick:i[0]||(i[0]=e=>d.parent=d.model.parent)},null,8,["disabled","title"]),b(h,null,{default:a(()=>[v($(d.model.title),1)]),_:1})])]),key:"0"}:void 0,d.model?{name:"options",fn:a(({item:t})=>[b(p,{disabled:!t.hasChildren,title:e.$t("open"),icon:"angle-right",class:"k-pages-dialog-option",onClick:S(e=>d.parent=t.id,["stop"])},null,8,["disabled","title","onClick"])]),key:"1"}:void 0]),1040,["fetch-params"])}]]);const Mi=Ne({mixins:[Ot,Si],props:{empty:{type:Object,default:()=>({icon:"users",text:window.panel.t("dialog.users.empty")})},item:{type:Function,default:e=>({...e,key:e.email,info:e.info!==e.text?e.info:null})}},emits:["cancel","submit"]},[["render",function(e,i,l,a,r,c){const d=t("k-models-dialog");return n(),s(d,o(e.$props,{onCancel:i[0]||(i[0]=t=>e.$emit("cancel")),onSubmit:i[1]||(i[1]=t=>e.$emit("submit",t))}),null,16)}]]);const _i=Ne({mixins:[Ot],props:{fields:Object,message:String},emits:["cancel"]},[["render",function(e,i,o,l,r,c){const d=t("k-box"),u=t("k-headline"),p=t("k-validation-issues"),h=t("k-stack"),m=t("k-dialog");return n(),s(m,{ref:"dialog","cancel-button":!1,"submit-button":!1,visible:e.visible,class:"k-validation-error-dialog",size:"large",onCancel:i[0]||(i[0]=t=>e.$emit("cancel"))},{default:a(()=>[b(h,{gap:"var(--spacing-6)"},{default:a(()=>[b(d,{icon:"alert",theme:"notice"},{default:a(()=>[v($(o.message),1)]),_:1}),b(h,null,{default:a(()=>[b(u,null,{default:a(()=>[...i[1]||(i[1]=[v("Please, fix the following issues:",-1)])]),_:1}),b(p,{fields:o.fields},null,8,["fields"])]),_:1})]),_:1})]),_:1},8,["visible"])}]]),Di={install(e){e.use(Ct),e.component("k-dialog",It),e.component("k-changes-dialog",jt),e.component("k-email-dialog",Lt),e.component("k-error-dialog",qt),e.component("k-state-dialog",zt),e.component("k-form-dialog",Pt),e.component("k-license-dialog",Qt),e.component("k-link-dialog",ti),e.component("k-lock-alert-dialog",ei),e.component("k-language-dialog",Nt),e.component("k-model-picker-dialog",li),e.component("k-page-create-dialog",ai),e.component("k-page-move-dialog",ci),e.component("k-page-picker-dialog",ui),e.component("k-remove-dialog",hi),e.component("k-request-error-dialog",mi),e.component("k-search-dialog",fi),e.component("k-text-dialog",pi),e.component("k-totp-dialog",bi),e.component("k-upload-dialog",yi),e.component("k-upload-replace-dialog",xi),e.component("k-files-dialog",Oi),e.component("k-models-dialog",Ci),e.component("k-pages-dialog",Ii),e.component("k-users-dialog",Mi),e.component("k-validation-error-dialog",_i)}},Ei={class:"k-drawer-body scroll-y-auto"};const ji=Ne({},[["render",function(e,t,i,s,o,l){return n(),h("div",Ei,[r(e.$slots,"default")])}]]),Li={props:{disabled:Boolean,empty:{type:String,default:()=>window.panel.t("drawer.fields.empty")},fields:Object,value:Object}};const Bi=Ne({mixins:[Li],emits:["input","submit"],computed:{hasFields(){return this.$helper.object.length(this.fields)>0}}},[["render",function(e,i,o,l,r,c){const d=t("k-fieldset"),u=t("k-box");return c.hasFields?(n(),s(d,{key:0,disabled:e.disabled,fields:e.fields,value:e.value,class:"k-drawer-fields",onInput:i[0]||(i[0]=t=>e.$emit("input",t)),onSubmit:i[1]||(i[1]=t=>e.$emit("submit",t))},null,8,["disabled","fields","value"])):(n(),s(u,{key:1,theme:"info"},{default:a(()=>[v($(e.empty),1)]),_:1}))}]]),Ti={props:{breadcrumb:{default:()=>[],type:Array},tab:{type:String},tabs:{default:()=>({}),type:Object}},computed:{crumbs(){return this.breadcrumb.map((e,t)=>({click:()=>this.$emit("crumb",e.id),current:t===this.breadcrumb.length-1,icon:e.props.icon,text:e.props.title,variant:"dimmed"}))}}},qi={class:"k-drawer-header"},zi={class:"k-drawer-options"};const Pi=Ne({mixins:[Ti],emits:["crumb","tab"]},[["render",function(e,i,s,o,l,a){const c=t("k-breadcrumb"),d=t("k-drawer-tabs"),u=t("k-button");return n(),h("header",qi,[b(c,{crumbs:e.crumbs,icon:"bars",class:"k-drawer-breadcrumb",onCrumb:i[0]||(i[0]=t=>e.$emit("crumb",t))},null,8,["crumbs"]),b(d,{tab:e.tab,tabs:e.tabs,onOpen:i[1]||(i[1]=t=>e.$emit("tab",t))},null,8,["tab","tabs"]),x("nav",zi,[r(e.$slots,"default"),b(u,{class:"k-drawer-option",icon:"check",type:"submit"})])])}]]);const Ni=Ne({},[["render",function(e,i,o,l,a,r){const c=t("k-notification");return"drawer"===e.$panel.notification.context?(n(),s(c,{key:0,class:"k-drawer-notification"})):g("",!0)}]]);const Fi=Ne({mixins:[{props:{tab:{type:String},tabs:{default:()=>({}),type:[Array,Object]}}}],emits:["open"],computed:{hasTabs(){return this.$helper.object.length(this.tabs)>1},tabsWithClickHandler(){let e=this.tabs;return!1===Array.isArray(e)&&(e=Object.values(e)),e.map(e=>({...e,click:()=>this.$emit("open",e.name)}))}}},[["render",function(e,i,o,l,a,r){const c=t("k-tabs");return r.hasTabs?(n(),s(c,{key:0,class:"k-drawer-tabs",tab:e.tab,tabs:r.tabsWithClickHandler},null,8,["tab","tabs"])):g("",!0)}]]),Ri={props:{empty:{type:String,default:()=>window.panel.t("drawer.text.empty")},text:{type:String}}};const Yi=Ne({mixins:[Ri]},[["render",function(e,i,o,l,r,c){const d=t("k-text"),u=t("k-box");return e.text?(n(),s(d,{key:0,html:e.text},null,8,["html"])):(n(),s(u,{key:1,theme:"info"},{default:a(()=>[v($(e.empty),1)]),_:1}))}]]),Hi={install(e){e.component("k-drawer-body",ji),e.component("k-drawer-fields",Bi),e.component("k-drawer-header",Pi),e.component("k-drawer-notification",Ni),e.component("k-drawer-tabs",Fi),e.component("k-drawer-text",Yi)}},Ui={mixins:[Ti],props:{current:{default:!0,type:Boolean},icon:String,size:{default:"default",type:String},id:String,options:{type:Array},title:String,visible:{default:!1,type:Boolean}}},Vi=["aria-current","data-size"];const Ki=Ne({mixins:[Ui],emits:["cancel","crumb","drop","submit","tab"],computed:{hasDropzone(){const e=y();return void 0!==e?.vnode?.props?.onDrop}}},[["render",function(e,i,l,c,d,u){const k=t("k-drawer-notification"),y=t("k-button"),v=t("k-dropdown"),$=t("k-drawer-header"),w=t("k-drawer-body"),C=t("k-dropzone");return e.visible?(n(),s(M,{key:0,to:".k-drawer-portal"},[x("form",{class:p([e.$attrs.class,"k-drawer"]),"aria-current":e.current,"data-size":e.size,method:"dialog",onSubmit:i[3]||(i[3]=S(t=>e.$emit("submit"),["prevent"]))},[b(C,{disabled:!u.hasDropzone,onDrop:i[2]||(i[2]=t=>e.$emit("drop",t))},{default:a(()=>[b(k),b($,{breadcrumb:e.breadcrumb,tab:e.tab,tabs:e.tabs,onCrumb:i[0]||(i[0]=t=>e.$emit("crumb",t)),onTab:i[1]||(i[1]=t=>e.$emit("tab",t))},{default:a(()=>[r(e.$slots,"options",{},()=>[(n(!0),h(m,null,f(e.options,(t,i)=>(n(),h(m,null,[t.dropdown?(n(),h(m,{key:0},[(n(),s(y,o({key:"btn-"+i},{ref_for:!0},t,{class:"k-drawer-option",onClick:t=>e.$refs["dropdown-"+i][0].toggle()}),null,16,["onClick"])),(n(),s(v,{ref_for:!0,ref:"dropdown-"+i,key:"dropdown-"+i,options:t.dropdown,"align-x":"end",theme:"light"},null,8,["options"]))],64)):(n(),s(y,o({key:i},{ref_for:!0},t,{class:"k-drawer-option"}),null,16))],64))),256))])]),_:3},8,["breadcrumb","tab","tabs"]),b(w,null,{default:a(()=>[r(e.$slots,"default")]),_:3})]),_:3},8,["disabled"])],42,Vi)])):g("",!0)}]]),Wi={props:{hidden:{type:Boolean},next:{type:Object},prev:{type:Object}}};const Ji=Ne({mixins:[Ui,Li,Wi],emits:["cancel","crumb","input","next","prev","remove","show","submit","tab"]},[["render",function(e,i,l,r,c,d){const u=t("k-button"),p=t("k-form-drawer");return n(),s(p,o({ref:"drawer",class:"k-block-drawer"},e.$props,{onCancel:i[4]||(i[4]=t=>e.$emit("cancel",t)),onCrumb:i[5]||(i[5]=t=>e.$emit("crumb",t)),onInput:i[6]||(i[6]=t=>e.$emit("input",t)),onSubmit:i[7]||(i[7]=t=>e.$emit("submit",t)),onTab:i[8]||(i[8]=t=>e.$emit("tab",t))}),{options:a(()=>[e.hidden?(n(),s(u,{key:0,class:"k-drawer-option",icon:"hidden",onClick:i[0]||(i[0]=t=>e.$emit("show"))})):g("",!0),b(u,{disabled:!e.prev,class:"k-drawer-option",icon:"angle-left",onClick:i[1]||(i[1]=t=>e.$emit("prev"))},null,8,["disabled"]),b(u,{disabled:!e.next,class:"k-drawer-option",icon:"angle-right",onClick:i[2]||(i[2]=t=>e.$emit("next"))},null,8,["disabled"]),b(u,{class:"k-drawer-option",icon:"trash",onClick:i[3]||(i[3]=t=>e.$emit("remove"))})]),_:1},16)}]]);const Gi=Ne({methods:{isCurrent(e){return this.$panel.drawer.id===e}}},[["render",function(e,t,i,l,a,r){return n(),h("div",null,[(n(!0),h(m,null,f(e.$panel.drawer.history.milestones,t=>(n(),s(w(t.component),o({key:t.id},{ref_for:!0},r.isCurrent(t.id)?e.$panel.drawer.props:t.props,{breadcrumb:e.$panel.drawer.breadcrumb,current:!0===r.isCurrent(t.id),visible:!0},k(r.isCurrent(t.id)?e.$panel.drawer.listeners():t.on)),null,16,["breadcrumb","current"]))),128))])}]]);const Xi=Ne({mixins:[Ui,Li],emits:["cancel","crumb","input","submit","tab"]},[["render",function(e,i,c,d,u,p){const h=t("k-drawer-fields"),m=t("k-drawer");return n(),s(m,o({ref:"drawer",class:"k-form-drawer"},e.$props,{onCancel:i[2]||(i[2]=t=>e.$emit("cancel")),onCrumb:i[3]||(i[3]=t=>e.$emit("crumb",t)),onSubmit:i[4]||(i[4]=t=>e.$emit("submit",e.value)),onTab:i[5]||(i[5]=t=>e.$emit("tab",t))}),l({default:a(()=>[b(h,{disabled:e.disabled,fields:e.fields,value:e.value,onInput:i[0]||(i[0]=t=>e.$emit("input",t)),onSubmit:i[1]||(i[1]=t=>e.$emit("submit",t))},null,8,["disabled","fields","value"])]),_:2},[e.$slots.options?{name:"options",fn:a(()=>[r(e.$slots,"options")]),key:"0"}:void 0]),1040)}]]),Zi={props:{next:Boolean,prev:Boolean}};const Qi=Ne({mixins:[Ui,Li,Zi],emits:["cancel","crumb","input","next","prev","remove","submit","tab"]},[["render",function(e,i,r,c,d,u){const p=t("k-button"),h=t("k-form-drawer");return n(),s(h,o({ref:"drawer",class:"k-structure-drawer"},e.$props,{onCancel:i[3]||(i[3]=t=>e.$emit("cancel",t)),onCrumb:i[4]||(i[4]=t=>e.$emit("crumb",t)),onInput:i[5]||(i[5]=t=>e.$emit("input",t)),onSubmit:i[6]||(i[6]=t=>e.$emit("submit",t)),onTab:i[7]||(i[7]=t=>e.$emit("tab",t))}),l({_:2},[e.disabled?void 0:{name:"options",fn:a(()=>[b(p,{disabled:!e.prev,class:"k-drawer-option",icon:"angle-left",onClick:i[0]||(i[0]=t=>e.$emit("prev"))},null,8,["disabled"]),b(p,{disabled:!e.next,class:"k-drawer-option",icon:"angle-right",onClick:i[1]||(i[1]=t=>e.$emit("next"))},null,8,["disabled"]),b(p,{class:"k-drawer-option",icon:"trash",onClick:i[2]||(i[2]=t=>e.$emit("remove"))})]),key:"0"}]),1040)}]]);const es=Ne({mixins:[Ui,Ri],emits:["cancel","crumb","input","submit","tab"]},[["render",function(e,i,c,d,u,p){const h=t("k-dialog-text"),m=t("k-drawer");return n(),s(m,o({ref:"drawer",class:"k-text-drawer"},e.$props,{onCancel:i[0]||(i[0]=t=>e.$emit("cancel")),onCrumb:i[1]||(i[1]=t=>e.$emit("crumb",t)),onSubmit:i[2]||(i[2]=t=>e.$emit("submit",e.value)),onTab:i[3]||(i[3]=t=>e.$emit("tab",t))}),l({default:a(()=>[b(h,{text:e.text},null,8,["text"])]),_:2},[e.$slots.options?{name:"options",fn:a(()=>[r(e.$slots,"options")]),key:"0"}:void 0]),1040)}]]),ts={install(e){e.use(Hi),e.component("k-drawer",Ki),e.component("k-block-drawer",Ji),e.component("k-state-drawer",Gi),e.component("k-form-drawer",Xi),e.component("k-structure-drawer",Qi),e.component("k-text-drawer",es)}};let is=null;const ss={props:{alignX:{type:String,default:"start"},alignY:{type:String,default:"bottom"},disabled:{type:Boolean,default:!1},navigate:{default:!0,type:Boolean},options:[Array,Function,String],theme:{type:String,default:"dark"}},emits:["action","close","open"],data(){return{align:{x:this.alignX,y:this.alignY},position:{x:0,y:0},isOpen:!1,items:[],opener:null}},methods:{close(){this.$refs.dropdown?.close()},async fetchOptions(e){return this.options?"string"==typeof this.options?this.$dropdown(this.options)(e):"function"==typeof this.options?this.options(e):Array.isArray(this.options)?e(this.options):void 0:e(this.items)},focus(e=0){this.$refs.navigate.focus(e)},onClick(){this.close()},onClose(){this.resetPosition(),this.isOpen=is=!1,this.$emit("close"),window.removeEventListener("resize",this.setPosition)},async onOpen(){this.isOpen=!0;const e=window.scrollY;is=this,await this.$nextTick(),this.$el&&this.opener&&(window.addEventListener("resize",this.setPosition),await this.setPosition(),window.scrollTo(0,e),this.$emit("open"))},onOptionClick(e){return this.close(),"function"==typeof e.click?e.click.call(this):"string"==typeof e.click?this.$emit("action",e.click):void(e.click&&(e.click.name&&this.$emit(e.click.name,e.click.payload),e.click.global&&this.$events.emit(e.click.global,e.click.payload)))},open(e){if(!0===this.disabled)return!1;is&&is!==this&&is.close(),this.opener=e??window.event?.target.closest("button")??window.event?.target,this.fetchOptions(e=>{this.items=e,this.onOpen()})},async setPosition(){this.align={x:this.alignX??this.align,y:this.alignY},"right"===this.align.x?this.align.x="end":"left"===this.align.x&&(this.align.x="start"),"rtl"===this.$panel.direction&&("start"===this.align.x?this.align.x="end":"end"===this.align.x&&(this.align.x="start")),this.opener.$el&&(this.opener=this.opener.$el);const e=this.opener.getBoundingClientRect();this.position.x=e.left+window.scrollX+e.width,this.position.y=e.top+window.scrollY+e.height,!0!==this.$el.open&&this.$el.showModal(),await this.$nextTick();const t=this.$el.getBoundingClientRect(),i=10;"end"===this.align.x?e.left-t.width<i&&(this.align.x="start"):e.left+t.width>window.innerWidth-i&&t.width+i<t.left&&(this.align.x="end"),"start"===this.align.x&&(this.position.x=this.position.x-e.width),"top"===this.align.y?t.height+i>t.top&&(this.align.y="bottom"):e.top+t.height>window.innerHeight-i&&t.height+i<t.top&&(this.align.y="top"),"top"===this.align.y&&(this.position.y=this.position.y-e.height)},resetPosition(){this.position={x:0,y:0}},toggle(e){this.isOpen?this.close():this.open(e)}}},ns=["data-align-x","data-align-y","data-theme"];const os=Ne(ss,[["render",function(e,i,l,p,k,y){const w=t("k-dropdown-item"),x=t("k-navigate");return k.isOpen?(n(),h("dialog",{key:0,ref:"dropdown","data-align-x":k.align.x,"data-align-y":k.align.y,"data-theme":l.theme,style:u({top:k.position.y+"px",left:k.position.x+"px"}),class:"k-dropdown k-dropdown-content",onClose:i[0]||(i[0]=(...e)=>y.onClose&&y.onClose(...e)),onClick:i[1]||(i[1]=(...e)=>y.onClick&&y.onClick(...e))},[b(x,{ref:"navigate",disabled:!1===l.navigate,align:"y"},{default:a(()=>[r(e.$slots,"default",c(d({items:k.items})),()=>[(n(!0),h(m,null,f(k.items,(t,i)=>(n(),h(m,null,["-"===t?(n(),h("hr",{key:"separator-"+i})):t.when??1?r(e.$slots,"item",o({key:1,ref_for:!0},{item:t,index:i}),()=>[(n(),s(w,o({key:"item-"+i},{ref_for:!0},t,{click:()=>y.onOptionClick(t)}),{default:a(()=>[v($(t.label??t.text),1)]),_:2},1040,["click"]))]):g("",!0)],64))),256))])]),_:3},8,["disabled"])],44,ns)):g("",!0)}]]),ls={props:{disabled:Boolean,download:Boolean,rel:String,tabindex:[String,Number],target:String,title:String}},as=["download","href","rel","tabindex","target","title"],rs=["title"];const cs=Ne({mixins:[ls],props:{to:[String,Function]},emits:["click"],computed:{downloadAttr(){return this.download?this.href.split("/").pop():void 0},href(){return"function"==typeof this.to?"":"/"!==this.to[0]||this.target?!0===this.to.includes("@")&&!1===this.to.includes("/")&&!1===this.to.startsWith("mailto:")?"mailto:"+this.to:this.to:this.$url(this.to)},relAttr(){return"_blank"===this.target?"noreferrer noopener":this.rel}},methods:{isRoutable(e){if(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)return!1;if(e.defaultPrevented)return!1;if(void 0!==e.button&&0!==e.button)return!1;if(this.target)return!1;if("string"==typeof this.href){if(this.href.includes("://")||this.href.startsWith("//"))return!1;if(this.href.includes("mailto:"))return!1}return!0},onClick(e){if(!0===this.disabled)return e.preventDefault(),!1;"function"==typeof this.to&&(e.preventDefault(),this.to()),this.isRoutable(e)&&(e.preventDefault(),this.$go(this.to)),this.$emit("click",e)}}},[["render",function(e,t,i,s,o,l){return i.to&&!e.disabled?(n(),h("a",{key:0,ref:"link",download:l.downloadAttr,href:l.href,rel:l.relAttr,tabindex:e.tabindex,target:e.target,title:e.title,class:"k-link",onClick:t[0]||(t[0]=(...e)=>l.onClick&&l.onClick(...e))},[r(e.$slots,"default")],8,as)):(n(),h("span",{key:1,title:e.title,class:"k-link","aria-disabled":""},[r(e.$slots,"default")],8,rs))}]]),ds={mixins:[ls],props:{autofocus:Boolean,badge:Object,click:{type:Function,default:()=>{}},current:[String,Boolean],dialog:[String,Object],drawer:[String,Object],dropdown:Boolean,element:String,icon:String,id:[String,Number],link:String,responsive:[Boolean,String],role:String,selected:[String,Boolean],size:String,text:[String,Number],theme:String,type:{type:String,default:"button"},variant:String}},us={key:0,class:"k-button-icon"},ps={key:1,class:"k-button-text"},hs={key:2,class:"k-button-arrow"},ms=["data-theme"];const fs=Ne({mixins:[ds],inheritAttrs:!1,emits:["click"],computed:{attrs(){const e={"aria-label":this.text??this.title,"data-responsive":this.responsive,"data-size":this.size,"data-theme":this.theme,"data-variant":this.variant,id:this.id,tabindex:this.tabindex,title:this.title};this.current&&(e["aria-current"]=this.current),this.disabled&&(e["aria-disabled"]=this.disabled),this.selected&&(e["aria-selected"]=this.selected);for(const t of Object.keys(this.$attrs))t.startsWith("aria-")&&this.$attrs[t]&&(e[t]=this.$attrs[t]);return"k-link"===this.component?(e.disabled=this.disabled,e.download=this.download,e.to=this.link,e.rel=this.rel,e.target=this.target):"button"===this.component&&(e.autofocus=this.autofocus,e.role=this.role,e.type=this.type),this.dropdown&&(e["aria-haspopup"]="menu",e["data-dropdown"]=this.dropdown),e},component(){return this.element?this.element:this.link?"k-link":"button"}},methods:{focus(){this.$el.focus?.()},onClick(e){return this.disabled?(e.preventDefault(),!1):this.dialog?this.$panel.dialog.open(this.dialog):this.drawer?this.$panel.drawer.open(this.drawer):(this.click?.(e),void this.$emit("click",e))}}},[["render",function(e,i,l,c,d,u){const p=t("k-icon");return n(),s(w(u.component),o(u.attrs,{class:["k-button",e.$attrs.class],"data-has-icon":Boolean(e.icon),"data-has-text":Boolean(e.text||e.$slots.default),style:e.$attrs.style,onClick:u.onClick}),{default:a(()=>[e.icon?(n(),h("span",us,[b(p,{type:e.icon},null,8,["type"])])):g("",!0),e.text||e.$slots.default?(n(),h("span",ps,[r(e.$slots,"default",{},()=>[v($(e.text),1)])])):g("",!0),e.dropdown&&(e.text||e.$slots.default)?(n(),h("span",hs,[b(p,{type:"angle-dropdown"})])):g("",!0),e.badge?(n(),h("span",{key:3,class:"k-button-badge","data-theme":e.badge.theme??e.theme},$(e.badge.text),9,ms)):g("",!0)]),_:3},16,["class","data-has-icon","data-has-text","style","onClick"])}]]);const gs=Ne({mixins:[ds],inheritAttrs:!1,emits:["click"],methods:{focus(){this.$refs.button.focus()},tab(){this.$refs.button.tab()}}},[["render",function(e,i,l,c,d,u){const p=t("k-button");return n(),s(p,o({ref:"button"},e.$props,{class:["k-dropdown-item",e.$attrs.class],style:e.$attrs.style,onClick:i[0]||(i[0]=t=>e.$emit("click",t))}),{default:a(()=>[r(e.$slots,"default")]),_:3},16,["class","style"])}]]);const ks=Ne({props:{align:{type:String,default:"right"},disabled:{type:Boolean},icon:{type:String,default:"dots"},options:{type:[Array,Function,String],default:()=>[]},text:{type:[Boolean,String],default:!0},theme:{type:String,default:"dark"},size:String,variant:String},emits:["action","option"],computed:{hasSingleOption(){return Array.isArray(this.options)&&1===this.options.length}},methods:{onAction(e,t,i){"function"==typeof e?e.call(this):(this.$emit("action",e,t,i),this.$emit("option",e,t,i))},toggle(e=this.$el){this.$refs.options.toggle(e)}}},[["render",function(e,i,l,r,c,d){const u=t("k-button"),p=t("k-dropdown");return d.hasSingleOption?(n(),s(u,o({key:0},e.$attrs,{disabled:l.disabled,icon:l.options[0].icon??l.icon,size:l.options[0].size??l.size,title:l.options[0].title??l.options[0].tooltip??l.options[0].text,variant:l.options[0].variant??l.variant,class:"k-options-dropdown-toggle",onClick:i[0]||(i[0]=e=>d.onAction(l.options[0].option??l.options[0].click,l.options[0],0))}),{default:a(()=>[!0===l.text?(n(),h(m,{key:0},[v($(l.options[0].text),1)],64)):!1!==l.text?(n(),h(m,{key:1},[v($(l.text),1)],64)):g("",!0)]),_:1},16,["disabled","icon","size","title","variant"])):l.options.length?(n(),h("div",o({key:1},e.$attrs,{class:"k-options-dropdown"}),[b(u,{disabled:l.disabled,dropdown:!0,icon:l.icon,size:l.size,text:!0!==l.text&&!1!==l.text?l.text:null,title:e.$t("options"),variant:l.variant,class:"k-options-dropdown-toggle",onClick:i[1]||(i[1]=t=>e.$refs.options.toggle())},null,8,["disabled","icon","size","text","title","variant"]),b(p,{ref:"options","align-x":l.align,options:l.options,class:"k-options-dropdown-content",onAction:d.onAction},null,8,["align-x","options","onAction"])],16)):g("",!0)}]]),bs={mixins:[Se,Oe,Me,Le,ze]},ys={mixins:[bs],inheritAttrs:!1,emits:["input"],methods:{focus(){this.$el.focus()}}},vs={mixins:[Se,Oe,Be,ze],props:{ignore:{default:()=>[],type:Array},max:Number,min:Number,search:{default:!0,type:[Object,Boolean]}}},$s={mixins:[bs,vs],props:{create:{type:[Boolean,Object],default:!1},multiple:{type:Boolean,default:!0},value:{type:[Array,String],default:()=>[]}}},ws={key:0,class:"k-picklist-input-header"},xs={class:"k-picklist-input-search"},Ss={key:1,class:"k-picklist-input-body"},Cs=["value"],Os={key:2,class:"k-picklist-input-body"},As={class:"k-picklist-input-empty"};const Is=Ne({mixins:[ys,$s],emits:["create","escape","input"],data(){return{display:this.search.display??!0,query:""}},computed:{choices(){let e=this.filteredOptions;return!0!==this.display&&(e=e.slice(0,this.display)),e.map(e=>({...e,disabled:e.disabled||this.isFull&&!1===this.value.includes(e.value),text:this.highlight(e.text),...this.search.info&&e.info?{info:this.highlight(e.info)}:{}}))},filteredOptions(){if(!(this.query.length<(this.search.min??0))){if(this.search.info){let e=this.$helper.array.search(this.options,this.query,{field:"text"});return e=e.concat(this.$helper.array.search(this.options,this.query,{field:"info"})),e=e.filter((e,t,i)=>t===i.findIndex(t=>t===e)),e}return this.$helper.array.search(this.options,this.query,{field:"text"})}},isFull(){return this.max&&this.value.length>=this.max},placeholder(){return this.search.placeholder?this.search.placeholder:this.options.length>0?this.$t("filter")+"…":this.$t("enter")+"…"},showCreate(){if(!1===this.create)return!1;if(this.isFull)return!1;if(0===this.query.trim().length)return!1;if(!0===this.ignore.includes(this.query))return!1;if(!0===this.create.ignore?.includes(this.query))return!1;return 0===this.options.filter(e=>e.text===this.query||e.value===this.query).length},showEmpty(){return!1===this.create&&0===this.filteredOptions.length}},methods:{add(){this.showCreate&&this.$emit("create",this.query)},enter(e){e.target?.click()},escape(){0===this.query.length?this.$emit("escape"):this.query=""},focus(){this.$refs.search?this.$refs.search.focus():this.$refs.options?.focus()},highlight(e){if(e=this.$helper.string.stripHTML(e),this.query.length>0){const t=new RegExp(`(${RegExp.escape(this.query)})`,"ig");return e.replace(t,"<b>$1</b>")}return e},input(e){this.$emit("input",e)}}},[["render",function(e,i,l,r,c,d){const m=t("k-search-input"),f=t("k-button"),k=t("k-navigate");return n(),s(k,{class:p(["k-picklist-input",e.$attrs.class]),style:u(e.$attrs.style),element:"nav",axis:"y",select:"input[type=search], label, .k-picklist-input-body button",onPrev:i[2]||(i[2]=t=>e.$emit("escape"))},{default:a(()=>[e.search?(n(),h("header",ws,[x("div",xs,[b(m,{ref:"search",autofocus:e.autofocus,disabled:e.disabled,placeholder:d.placeholder,value:c.query,onInput:i[0]||(i[0]=e=>c.query=e),onKeydown:[_(S(d.escape,["prevent"]),["escape"]),_(S(d.add,["prevent"]),["enter"])]},null,8,["autofocus","disabled","placeholder","value","onKeydown"]),d.showCreate?(n(),s(f,{key:0,class:"k-picklist-input-create",icon:"add",size:"xs",onClick:d.add},null,8,["onClick"])):g("",!0)])])):g("",!0),d.filteredOptions.length?(n(),h("div",Ss,[x("k-input-validator",o({min:e.min,max:e.max,required:e.required},{value:JSON.stringify(e.value)}),[(n(),s(w(e.multiple?"k-checkboxes-input":"k-radio-input"),{ref:"options",disabled:e.disabled,options:d.choices,value:e.value,class:"k-picklist-input-options",onInput:d.input,onKeydown:_(S(d.enter,["prevent"]),["enter"])},null,40,["disabled","options","value","onInput","onKeydown"]))],16,Cs),!0!==c.display&&d.filteredOptions.length>c.display?(n(),s(f,{key:0,class:"k-picklist-input-more",icon:"angle-down",onClick:i[1]||(i[1]=e=>c.display=!0)},{default:a(()=>[v($(e.$t("options.all",{count:d.filteredOptions.length})),1)]),_:1})):g("",!0)])):d.showEmpty?(n(),h("div",Os,[x("p",As,$(e.$t("options.none")),1)])):g("",!0)]),_:1},8,["class","style"])}]]);const Ms=Ne({mixins:[$s],emits:["create","input"],methods:{close(){this.$refs.dropdown.close()},add(e){this.$emit("create",e)},input(e){this.$emit("input",e)},open(e){this.$refs.dropdown.open(e)},toggle(){this.$refs.dropdown.toggle()}}},[["render",function(e,i,l,r,c,d){const u=t("k-picklist-input"),p=t("k-dropdown");return n(),s(p,{ref:"dropdown","align-x":"start",disabled:e.disabled,navigate:!1,class:"k-picklist-dropdown",onClick:i[2]||(i[2]=S(()=>{},["stop"]))},{default:a(()=>[b(u,o(e.$props,{onClick:i[0]||(i[0]=S(()=>{},["stop"])),onCreate:d.add,onInput:d.input,onEscape:i[1]||(i[1]=t=>e.$refs.dropdown.close())}),null,16,["onCreate","onInput"])]),_:1},8,["disabled"])}]]),_s={install(e){e.component("k-dropdown",os),e.component("k-dropdown-item",gs),e.component("k-options-dropdown",ks),e.component("k-picklist-dropdown",Ms),e.component("k-dropdown-content",os)}},Ds={class:"k-error-trace"},Es={class:"k-stack"},js=["href"],Ls={key:0},Bs={style:{color:"var(--color-gray-200)"}},Ts={style:{color:"var(--color-purple-400)"}},qs={key:1},zs={key:2},Ps={style:{color:"var(--color-yellow-400)"}},Ns={style:{color:"var(--color-blue-400)"}};const Fs=Ne({props:{trace:Array}},[["render",function(e,t,i,s,o,l){return n(),h("div",Ds,[x("ol",Es,[(n(!0),h(m,null,f(i.trace,(e,i)=>(n(),h("li",{key:"trace-"+i},[x("a",{href:e.url?e.url:null},[e.file?(n(),h("p",Ls,[x("span",Bs,$(e.file),1),e.line?(n(),h(m,{key:0},[t[0]||(t[0]=x("span",null,":",-1)),x("span",Ts,$(e.line),1)],64)):g("",!0)])):(n(),h("p",qs,"Internal")),e.function?(n(),h("p",zs,[e.class?(n(),h(m,{key:0},[x("span",Ps,$(e.class),1),x("span",null,$(e.type??"::"),1)],64)):g("",!0),x("span",Ns,$(e.function),1),t[1]||(t[1]=x("span",null,"()",-1))])):g("",!0)],8,js)]))),128))])])}]]);const Rs=Ne({props:{fields:Object}},[["render",function(e,i,o,l,r,c){const d=t("k-checklist"),u=t("k-definition"),p=t("k-definitions");return n(),s(p,{class:"k-validation-issues"},{default:a(()=>[(n(!0),h(m,null,f(o.fields,(e,t)=>(n(),s(u,{key:t,term:e.label},{default:a(()=>[b(d,{theme:"negative"},{default:a(()=>[(n(!0),h(m,null,f(e.issues??e.message,(e,i)=>(n(),h("li",{key:t+"-issue-"+i},$(e),1))),128))]),_:2},1024)]),_:2},1032,["term"]))),128))]),_:1})}]]),Ys={install(e){e.component("k-error-trace",Fs),e.component("k-validation-issues",Rs)}},Hs={props:{count:Number,min:Number,max:Number,required:{type:Boolean,default:!1}},computed:{valid(){return!1===this.required&&0===this.count||(!0!==this.required||0!==this.count)&&(!(this.min&&this.count<this.min)&&!(this.max&&this.count>this.max))}}},Us=["data-invalid","data-theme"],Vs={key:0,class:"k-counter-rules"};const Ks=Ne(Hs,[["render",function(e,t,i,s,o,l){return n(),h("span",{"data-invalid":!l.valid,"data-theme":l.valid?"positive":"negative",class:"k-counter"},[x("span",null,$(i.count),1),i.min||i.max?(n(),h("span",Vs,[i.min&&i.max?(n(),h(m,{key:0},[v($(i.min)+"–"+$(i.max),1)],64)):i.min?(n(),h(m,{key:1},[v("≥ "+$(i.min),1)],64)):i.max?(n(),h(m,{key:2},[v("≤ "+$(i.max),1)],64)):g("",!0)])):g("",!0)],8,Us)}]]),Ws={mixins:[Oe,Ie,Me,_e,Le,ze],props:{counter:[Boolean,Object],endpoints:Object,hasDiff:Boolean,input:{type:[String,Number,Boolean],default:null},translate:Boolean,type:String}},Js=["data-disabled","data-translate"],Gs={key:0,class:"k-field-header"},Xs={key:0,class:"k-field-footer"};const Zs=Ne({mixins:[Ws],inheritAttrs:!1,emits:["blur","focus"]},[["render",function(e,i,l,c,d,m){const f=t("k-label"),k=t("k-counter"),b=t("k-text");return n(),h("div",{"data-disabled":e.disabled,"data-translate":e.translate,class:p(["k-field",`k-field-name-${e.name}`,`k-field-type-${e.type}`,e.$attrs.class]),style:u(e.$attrs.style),onFocusin:i[0]||(i[0]=t=>e.$emit("focus",t)),onFocusout:i[1]||(i[1]=t=>e.$emit("blur",t))},[r(e.$slots,"header",{},()=>[e.label||e.$slots.label||e.$slots.options||e.$slots.counter?(n(),h("header",Gs,[r(e.$slots,"label",{},()=>[e.label?(n(),s(f,{key:0,"has-diff":e.hasDiff,input:e.input,required:e.required,title:e.label,type:"field"},{default:a(()=>[v($(e.label),1)]),_:1},8,["has-diff","input","required","title"])):g("",!0)]),r(e.$slots,"options"),r(e.$slots,"counter",{},()=>[e.counter?(n(),s(k,o({key:0},e.counter,{required:e.required,class:"k-field-counter"}),null,16,["required"])):g("",!0)])])):g("",!0)]),r(e.$slots,"default"),r(e.$slots,"footer",{},()=>[e.help||e.$slots.help?(n(),h("footer",Xs,[r(e.$slots,"help",{},()=>[e.help?(n(),s(b,{key:0,class:"k-help k-field-help",html:e.help},null,8,["html"])):g("",!0)])])):g("",!0)])],46,Js)}]]),Qs={props:{config:Object,disabled:Boolean,fields:{type:[Array,Object],default:()=>({})},value:{type:Object,default:()=>({})}},emits:["focus","input","submit"],methods:{focus(e){if(e)return void(this.hasField(e)&&"function"==typeof this.$refs[e][0].focus&&this.$refs[e][0].focus());const t=Object.keys(this.$refs)[0];this.focus(t)},hasFieldType(e){return this.$helper.isComponent(`k-${e}-field`)},hasField(e){return this.$refs[e]?.[0]},onInput(e,t,i){const s=this.value;s[i]=e,this.$emit("input",s,t,i)}}},en={class:"k-fieldset"};const tn=Ne(Qs,[["render",function(e,i,l,r,c,d){const u=t("k-text"),p=t("k-box"),k=t("k-column"),y=t("k-grid");return n(),h("div",en,[b(y,{variant:"fields"},{default:a(()=>[(n(!0),h(m,null,f(l.fields,(t,i)=>(n(),h(m,null,[e.$helper.field.isVisible(t,l.value)?(n(),s(k,{key:i,width:t.width},{default:a(()=>[d.hasFieldType(t.type)?(n(),s(w("k-"+t.type+"-field"),o({key:0,ref_for:!0,ref:i},{ref_for:!0},t,{disabled:l.disabled||t.disabled,"form-data":l.value,name:i,value:l.value[i]??void 0,onInput:e=>d.onInput(e,t,i),onFocus:s=>e.$emit("focus",s,t,i),onSubmit:s=>e.$emit("submit",s,t,i)}),null,16,["disabled","form-data","name","value","onInput","onFocus","onSubmit"])):(n(),s(p,{key:1,theme:"negative"},{default:a(()=>[b(u,{size:"small"},{default:a(()=>[v($(e.$t("error.field.type.missing",{name:i,type:t.type})),1)]),_:2},1024)]),_:2},1024))]),_:2},1032,["width"])):g("",!0)],64))),256))]),_:1})])}]]),sn={props:{disabled:Boolean,config:Object,fields:{type:[Array,Object],default:()=>[]},novalidate:{type:Boolean,default:!1},value:{type:Object,default:()=>({})}},emits:["focus","input","submit"],data:()=>({errors:{}}),methods:{focus(e){this.$refs.fields?.focus?.(e)},onFocus(e,t,i){this.$emit("focus",e,t,i)},onInput(e,t,i){this.$emit("input",e,t,i)},onSubmit(){this.$emit("submit",this.value)},submit(){this.$refs.submitter.click()}}},nn=["novalidate"],on={ref:"submitter",class:"k-form-submitter",type:"submit"};const ln=Ne(sn,[["render",function(e,i,s,o,l,a){const c=t("k-fieldset");return n(),h("form",{ref:"form",novalidate:s.novalidate,method:"POST",autocomplete:"off",class:"k-form",onSubmit:i[0]||(i[0]=S((...e)=>a.onSubmit&&a.onSubmit(...e),["prevent"]))},[r(e.$slots,"header"),r(e.$slots,"default",{},()=>[b(c,{ref:"fields",disabled:s.disabled,fields:s.fields,value:s.value,onFocus:a.onFocus,onInput:a.onInput,onSubmit:a.onSubmit},null,8,["disabled","fields","value","onFocus","onInput","onSubmit"])]),r(e.$slots,"footer"),x("input",on,null,512)],40,nn)}]]),an={props:{editor:String,hasDiff:Boolean,isLocked:Boolean,isProcessing:Boolean,modified:[String,Date],preview:[String,Boolean],size:{type:String,default:"sm"}}},rn={key:0},cn={key:1},dn={key:0},un={key:1};const pn=Ne({mixins:[an],emits:["discard","submit"],computed:{buttons(){return!0===this.isLocked?[{theme:"negative",dropdown:!0,text:this.editor,icon:"lock",responsive:!0,click:()=>this.$refs.dropdown.toggle()}]:!0===this.hasDiff?[{theme:"notice",text:this.$t("discard"),icon:"undo",responsive:!0,click:()=>this.discard()},{theme:"notice",text:this.$t("save"),icon:this.isProcessing?"loader":"check",click:()=>this.$emit("submit")},{theme:"notice",icon:"dots",click:()=>this.$refs.dropdown.toggle()}]:[]}},methods:{discard(){this.$panel.dialog.open({component:"k-remove-dialog",props:{size:"medium",submitButton:{theme:"notice",icon:"undo",text:this.$t("form.discard")},text:this.$t("form.discard.confirm")},on:{submit:()=>{this.$emit("discard")}}})}}},[["render",function(e,i,l,r,c,d){const u=t("k-button"),p=t("k-icon"),k=t("k-dropdown-item"),y=t("k-dropdown"),w=t("k-button-group");return d.buttons.length?(n(),s(w,{key:0,layout:"collapsed",class:"k-form-controls"},{default:a(()=>[(n(!0),h(m,null,f(d.buttons,t=>(n(),s(u,o({key:t.text,class:"k-form-controls-button"},{ref_for:!0},t,{disabled:e.isProcessing,size:e.size,variant:"filled"}),null,16,["disabled","size"]))),128)),b(y,{ref:"dropdown","align-x":"end",class:"k-form-controls-dropdown"},{default:a(()=>[e.isLocked?(n(),h("p",rn,$(e.$t("form.locked")),1)):(n(),h("p",cn,$(e.$t("form.unsaved")),1)),e.editor||e.modified?(n(),h(m,{key:2},[i[0]||(i[0]=x("hr",null,null,-1)),x("dl",null,[e.editor?(n(),h("div",dn,[x("dt",null,[b(p,{type:"user"})]),x("dd",null,$(e.editor),1)])):g("",!0),e.modified?(n(),h("div",un,[x("dt",null,[b(p,{type:"clock"})]),x("dd",null,$(e.$library.dayjs(e.modified).format("YYYY-MM-DD HH:mm:ss")),1)])):g("",!0)])],64)):g("",!0),e.preview?(n(),h(m,{key:3},[i[1]||(i[1]=x("hr",null,null,-1)),b(k,{link:e.preview,icon:"window"},{default:a(()=>[v($(e.$t("form.preview")),1)]),_:1},8,["link"])],64)):g("",!0)]),_:1},512)]),_:1})):g("",!0)}]]),hn={mixins:[we,Ce,Oe],inheritAttrs:!1,props:{autofocus:Boolean,type:String,icon:[String,Boolean],value:{type:[String,Boolean,Number,Object,Array],default:null}}},mn=["data-disabled","data-type"];const fn=Ne({mixins:[hn],emits:["input","submit"],computed:{inputProps(){return{...this.$props,...this.$attrs}}},methods:{blur(e){e?.relatedTarget&&!1===this.$el.contains(e.relatedTarget)&&this.trigger(null,"blur")},focus(e){this.trigger(e,"focus")},select(e){this.trigger(e,"select")},trigger(e,t){if("INPUT"===e?.target?.tagName&&"function"==typeof e?.target?.[t])return void e.target[t]();if("function"==typeof this.$refs.input?.[t])return void this.$refs.input[t]();const i=this.$el.querySelector("input, select, textarea");"function"==typeof i?.[t]&&i[t]()}}},[["render",function(e,i,l,a,c,d){const m=t("k-icon");return n(),h("div",{class:p(["k-input",e.$attrs.class]),"data-disabled":e.disabled,"data-type":e.type,style:u(e.$attrs.style)},[e.$slots.before||e.before?(n(),h("span",{key:0,class:"k-input-description k-input-before",onClick:i[0]||(i[0]=(...e)=>d.focus&&d.focus(...e))},[r(e.$slots,"before",{},()=>[v($(e.before),1)])])):g("",!0),x("span",{class:"k-input-element",onClick:i[3]||(i[3]=S((...e)=>d.focus&&d.focus(...e),["stop"]))},[r(e.$slots,"default",{},()=>[(n(),s(w("k-"+e.type+"-input"),o({ref:"input"},d.inputProps,{value:e.value,onInput:i[1]||(i[1]=t=>e.$emit("input",t)),onSubmit:i[2]||(i[2]=t=>e.$emit("submit",t))}),null,16,["value"]))])]),e.$slots.after||e.after?(n(),h("span",{key:1,class:"k-input-description k-input-after",onClick:i[4]||(i[4]=(...e)=>d.focus&&d.focus(...e))},[r(e.$slots,"after",{},()=>[v($(e.after),1)])])):g("",!0),e.$slots.icon||e.icon?(n(),h("span",{key:2,class:"k-input-icon",onClick:i[5]||(i[5]=(...e)=>d.focus&&d.focus(...e))},[r(e.$slots,"icon",{},()=>[b(m,{type:e.icon},null,8,["type"])])])):g("",!0)],14,mn)}]]),gn={props:{content:{default:()=>({}),type:[Array,Object]},fieldset:{default:()=>({}),type:Object}}},kn={class:"k-block-title-text"},bn={key:0,class:"k-block-name"},yn={key:1,class:"k-block-label"};const vn=Ne({mixins:[gn],inheritAttrs:!1,computed:{icon(){return this.fieldset.icon??"box"},label(){if(!this.fieldset.label||0===this.fieldset.label.length)return!1;if(this.fieldset.label===this.name)return!1;let e=this.$helper.string.template(this.fieldset.label,this.content);return"…"!==e&&(e=this.$helper.string.stripHTML(e),this.$helper.string.unescapeHTML(e))},name(){return this.fieldset.name??this.fieldset.label}}},[["render",function(e,i,s,o,l,a){const r=t("k-icon");return n(),h("div",{class:p(["k-block-title",e.$attrs.class]),style:u(e.$attrs.style)},[b(r,{type:a.icon,class:"k-block-icon"},null,8,["type"]),x("span",kn,[a.name?(n(),h("span",bn,$(a.name),1)):g("",!0),a.label?(n(),h("span",yn,$(a.label),1)):g("",!0)])],6)}]]),$n={mixins:[gn,Oe],props:{endpoints:{default:()=>({}),type:[Array,Object]},id:String}};const wn=Ne({mixins:[$n],inheritAttrs:!1,emits:["open","update"],methods:{field(e,t=null){let i=null;for(const s of Object.values(this.fieldset.tabs??{}))s.fields[e]&&(i=s.fields[e]);return i??t},open(){this.$emit("open")},update(e){this.$emit("update",{...this.content,...e})}}},[["render",function(e,i,o,l,a,r){const c=t("k-block-title");return n(),s(c,{class:p(e.$attrs.class),content:e.content,fieldset:e.fieldset,style:u(e.$attrs.style),onDblclick:i[0]||(i[0]=t=>e.$emit("open"))},null,8,["class","content","fieldset","style"])}]]),xn={props:{isBatched:Boolean,isFull:Boolean,isHidden:Boolean,isMergable:Boolean}};const Sn=Ne({mixins:[xn],props:{isEditable:Boolean,isSplitable:Boolean},emits:["chooseToAppend","chooseToConvert","chooseToPrepend","copy","duplicate","hide","merge","open","paste","remove","removeSelected","show","split","sortDown","sortUp"],computed:{buttons(){return this.isBatched?[{icon:"template",title:this.$t("copy"),click:()=>this.$emit("copy")},{when:this.isMergable,icon:"merge",title:this.$t("merge"),click:()=>this.$emit("merge")},{icon:"trash",title:this.$t("remove"),click:()=>this.$emit("removeSelected")}]:[{when:this.isEditable,icon:"edit",title:this.$t("edit"),click:()=>this.$emit("open")},{icon:"add",title:this.$t("insert.after"),disabled:this.isFull,click:()=>this.$emit("chooseToAppend")},{icon:"trash",title:this.$t("delete"),click:()=>this.$emit("remove")},{icon:"sort",title:this.$t("sort.drag"),class:"k-sort-handle",key:e=>this.sort(e)},{icon:"dots",title:this.$t("more"),dropdown:[{icon:"angle-up",label:this.$t("insert.before"),disabled:this.isFull,click:()=>this.$emit("chooseToPrepend")},{icon:"angle-down",label:this.$t("insert.after"),disabled:this.isFull,click:()=>this.$emit("chooseToAppend")},"-",{when:this.isEditable,icon:"edit",label:this.$t("edit"),click:()=>this.$emit("open")},{icon:"refresh",label:this.$t("field.blocks.changeType"),click:()=>this.$emit("chooseToConvert")},{when:this.isSplitable,icon:"split",label:this.$t("split"),click:()=>this.$emit("split")},"-",{icon:"template",label:this.$t("copy"),click:()=>this.$emit("copy")},{icon:"download",label:this.$t("paste.after"),disabled:this.isFull,click:()=>this.$emit("paste")},"-",{icon:this.isHidden?"preview":"hidden",label:this.isHidden?this.$t("show"):this.$t("hide"),click:()=>this.$emit(this.isHidden?"show":"hide")},{icon:"copy",label:this.$t("duplicate"),click:()=>this.$emit("duplicate")},"-",{icon:"trash",label:this.$t("delete"),click:()=>this.$emit("remove")}]}]}},methods:{open(){this.$refs.options.open()},sort(e){switch(e.key){case"ArrowUp":e.preventDefault(),this.$emit("sortUp");break;case"ArrowDown":e.preventDefault(),this.$emit("sortDown")}}}},[["render",function(e,i,o,l,a,r){const c=t("k-toolbar");return n(),s(c,{buttons:r.buttons,"data-inline":"true",class:"k-block-options",onMousedown:i[0]||(i[0]=S(()=>{},["prevent"]))},null,8,["buttons"])}]]),Cn={mixins:[$n,xn],inheritAttrs:!1,props:{attrs:{default:()=>({}),type:[Array,Object]},isLastSelected:Boolean,isSelected:Boolean,name:String,next:Object,prev:Object,type:String},emits:["append","chooseToAppend","chooseToConvert","chooseToPrepend","close","copy","duplicate","focus","hide","merge","open","paste","prepend","remove","removeSelected","selectDown","selectUp","show","sortDown","sortUp","split","submit","update"],computed:{className(){let e=["k-block-type-"+this.type];return this.fieldset.preview&&this.fieldset.preview!==this.type&&e.push("k-block-type-"+this.fieldset.preview),!1===this.wysiwyg&&e.push("k-block-type-default"),e},containerType(){const e=this.fieldset.preview;return!1!==e&&(e&&this.$helper.isComponent("k-block-type-"+e)?e:!!this.$helper.isComponent("k-block-type-"+this.type)&&this.type)},customComponent(){return this.wysiwyg?this.wysiwygComponent:"k-block-type-default"},isDisabled(){return!0===this.disabled||!0===this.fieldset.disabled},isEditable(){return!1!==this.fieldset.editable},listeners(){return{append:e=>this.$emit("append",e),chooseToAppend:e=>this.$emit("chooseToAppend",e),chooseToConvert:e=>this.$emit("chooseToConvert",e),chooseToPrepend:e=>this.$emit("chooseToPrepend",e),close:()=>this.$emit("close"),copy:()=>this.$emit("copy"),duplicate:()=>this.$emit("duplicate"),focus:()=>this.$emit("focus"),hide:()=>this.$emit("hide"),merge:()=>this.$emit("merge"),open:e=>this.open(e),paste:()=>this.$emit("paste"),prepend:e=>this.$emit("prepend",e),remove:()=>this.remove(),removeSelected:()=>this.$emit("removeSelected"),show:()=>this.$emit("show"),sortDown:()=>this.$emit("sortDown"),sortUp:()=>this.$emit("sortUp"),split:e=>this.$emit("split",e),update:e=>this.$emit("update",e)}},listenersForOptions(){return{...this.listeners,split:()=>this.$refs.editor.split(),open:()=>{"function"==typeof this.$refs.editor.open?this.$refs.editor.open():this.open()}}},tabs(){const e=this.fieldset.tabs??{};for(const[t,i]of Object.entries(e))for(const[s]of Object.entries(i.fields??{}))e[t].fields[s].section=this.name,e[t].fields[s].endpoints={field:this.endpoints.field+"/fieldsets/"+this.type+"/fields/"+s,section:this.endpoints.section,model:this.endpoints.model};return e},wysiwyg(){return!1!==this.wysiwygComponent},wysiwygComponent(){return!!this.containerType&&"k-block-type-"+this.containerType}},methods:{backspace(e){if(e.target.matches("[contenteditable], input, textarea"))return!1;e.preventDefault(),this.remove()},close(){this.$panel.drawer.close(this.id)},collapse(){this.$refs.editor?.collapse?.()},expand(){this.$refs.editor?.expand?.()},focus(){"function"==typeof this.$refs.editor?.focus?this.$refs.editor.focus():this.$refs.container?.focus()},goTo(e){e&&(e.$refs.container?.focus(),e.open(null,!0))},isCollapsed(){return!0===(this.$refs.editor?.collapsed??!1)},isCollapsible(){return"function"==typeof this.$refs.editor?.collapse},isExpandable(){return"function"==typeof this.$refs.editor?.expand},isSplitable(){return!0!==this.isFull&&(!!this.$refs.editor&&((this.$refs.editor.isSplitable??!0)&&"function"==typeof this.$refs.editor?.split))},onClose(){this.$emit("close"),this.focus()},onFocus(e){this.disabled||this.$emit("focus",e)},onFocusIn(e){this.disabled||this.$refs.options?.$el?.contains(e.target)||this.$emit("focus",e)},onInput(e){this.$emit("update",e)},open(e,t=!1){!this.isEditable||this.isBatched||this.isDisabled||(this.$panel.drawer.open({component:"k-block-drawer",id:this.id,tab:e,on:{close:this.onClose,input:this.onInput,next:()=>this.goTo(this.next),prev:()=>this.goTo(this.prev),remove:this.remove,show:this.show,submit:this.submit},props:{hidden:this.isHidden,icon:this.fieldset.icon??"box",next:this.next,prev:this.prev,tabs:this.tabs,title:this.fieldset.name,value:this.content},replace:t}),this.$emit("open"))},remove(){if(this.isBatched)return this.$emit("removeSelected");this.$panel.dialog.open({component:"k-remove-dialog",props:{text:this.$t("field.blocks.delete.confirm")},on:{submit:()=>{this.$panel.dialog.close(),this.close(),this.$emit("remove",this.id)}}})},show(){this.$emit("show")},submit(){this.close(),this.$emit("submit")}}},On=["data-batched","data-disabled","data-hidden","data-id","data-last-selected","data-selected","data-translate","tabindex"],An=["data-disabled"];const In=Ne(Cn,[["render",function(e,i,l,a,r,c){const d=t("k-block-options");return n(),h("div",{ref:"container",class:p(["k-block-container","k-block-container-fieldset-"+l.type,c.containerType?"k-block-container-type-"+c.containerType:"",e.$attrs.class]),"data-batched":e.isBatched,"data-disabled":c.isDisabled,"data-hidden":e.isHidden,"data-id":e.id,"data-last-selected":l.isLastSelected,"data-selected":l.isSelected,"data-translate":e.fieldset.translate,style:u(e.$attrs.style),tabindex:c.isDisabled?null:0,onKeydown:[i[0]||(i[0]=_(S(t=>e.$emit("merge"),["ctrl","prevent","stop"]),["j"])),i[1]||(i[1]=_(S(t=>e.$emit("selectDown"),["ctrl","alt","prevent","stop"]),["down"])),i[2]||(i[2]=_(S(t=>e.$emit("selectUp"),["ctrl","alt","prevent","stop"]),["up"])),i[3]||(i[3]=_(S(t=>e.$emit("sortDown"),["ctrl","shift","prevent","stop"]),["down"])),i[4]||(i[4]=_(S(t=>e.$emit("sortUp"),["ctrl","shift","prevent","stop"]),["up"])),i[5]||(i[5]=_(S((...e)=>c.backspace&&c.backspace(...e),["ctrl","stop"]),["backspace"]))],onFocus:i[6]||(i[6]=S((...e)=>c.onFocus&&c.onFocus(...e),["stop"])),onFocusin:i[7]||(i[7]=S((...e)=>c.onFocusIn&&c.onFocusIn(...e),["stop"]))},[x("div",{class:p([c.className,"k-block"]),"data-disabled":c.isDisabled},[(n(),s(w(c.customComponent),o({ref:"editor"},e.$props,{tabs:c.tabs},k(c.listeners)),null,16,["tabs"]))],10,An),c.isDisabled?g("",!0):(n(),s(d,o({key:0,ref:"options"},{isBatched:e.isBatched,isEditable:c.isEditable,isFull:e.isFull,isHidden:e.isHidden,isMergable:e.isMergable,isSplitable:c.isSplitable()},k(c.listenersForOptions)),null,16))],46,On)}]]);function Mn(e,t){if("string"==typeof e&&(e=document.querySelector(e)),!e)return!1;if(!t&&e.contains(document.activeElement)&&e!==document.activeElement)return!1;const i=[":where([autofocus], [data-autofocus])",":where(input, textarea, select, [contenteditable=true], .input-focus)","[type=submit]","button"];t&&i.unshift(`[name="${t}"]`);const s=function(e,t){for(const i of t){const t=e.querySelector(i);if(!0===Dn(t))return t}return null}(e,i);return s?(s.focus(),s):!0===Dn(e)&&(e.focus(),e)}function _n(e){return e.closest?.(".k-dialog")||e.closest?.(".k-drawer")}function Dn(e){return!!e&&(!e.matches("[disabled], [aria-disabled], input[type=hidden]")&&(!e.closest("[aria-disabled]")&&!e.closest("[disabled]")&&"function"==typeof e.focus))}const En={mixins:[Se,Oe,Me],props:{empty:String,endpoints:Object,fieldsets:Object,fieldsetGroups:Object,group:String,min:{type:Number,default:null},max:{type:Number,default:null},value:{type:Array,default:()=>[]}}},jn=["data-disabled","data-empty"];const Ln=Ne({mixins:[En],inheritAttrs:!1,emits:["input"],data(){return{blocks:this.value??[],isEditing:!1,isMultiSelectKey:!1,selected:[]}},computed:{draggableOptions(){return{handle:".k-sort-handle",list:this.blocks,group:this.group,move:this.move,data:{fieldsets:this.fieldsets,isFull:this.isFull}}},hasFieldsets(){return this.$helper.object.length(this.fieldsets)>0},isEmpty(){return 0===this.blocks.length},isFull(){return null!==this.max&&this.blocks.length>=this.max},isMergable(){if(this.selected.length<2)return!1;const e=this.selected.map(e=>this.find(e));return!(new Set(e.map(e=>e.type)).size>1)&&"function"==typeof this.ref(e[0]).$refs.editor.merge}},watch:{value(){this.blocks=this.value}},mounted(){!0===this.$props.autofocus&&setTimeout(this.focus,100),this.$events.on("blur",this.onBlur),this.$events.on("click",this.onClickGlobal),this.$events.on("focus",this.onFocusGlobal),this.$events.on("copy",this.onCopy),this.$events.on("keydown",this.onKey),this.$events.on("keyup",this.onKey),this.$events.on("paste",this.onPaste)},unmounted(){this.$events.off("blur",this.onBlur),this.$events.off("click",this.onClickGlobal),this.$events.off("focus",this.onFocusGlobal),this.$events.off("copy",this.onCopy),this.$events.off("keydown",this.onKey),this.$events.off("keyup",this.onKey),this.$events.off("paste",this.onPaste)},methods:{async add(e="text",t){const i=await this.$api.get(this.endpoints.field+"/fieldsets/"+e);this.blocks.splice(t,0,i),this.save(),await this.$nextTick(),this.focusOrOpen(i)},choose(e){if(1===this.$helper.object.length(this.fieldsets))return this.add(Object.values(this.fieldsets)[0].type,e);this.$panel.dialog.open({component:"k-block-selector",props:{fieldsetGroups:this.fieldsetGroups,fieldsets:this.fieldsets},on:{submit:t=>{this.add(t,e),this.$panel.dialog.close()},paste:t=>{this.paste(t,e)}}})},chooseToConvert(e){this.$panel.dialog.open({component:"k-block-selector",props:{disabledFieldsets:[e.type],fieldsetGroups:this.fieldsetGroups,fieldsets:this.fieldsets,headline:this.$t("field.blocks.changeType")},on:{submit:t=>{this.convert(t,e),this.$panel.dialog.close()},paste:this.paste}})},collapse(e){this.ref(e)?.collapse?.()},collapseAll(){for(const e of this.blocks)this.collapse(e)},copy(e){if(0===this.blocks.length)return!1;if(0===this.selected.length)return!1;let t=[];for(const i of this.blocks)this.selected.includes(i.id)&&t.push(i);if(0===t.length)return!1;this.$helper.clipboard.write(t,e),this.selected=t.map(e=>e.id),this.$panel.notification.success({message:this.$t("copy.success.multiple",{count:t.length}),icon:"template"})},copyAll(){this.selectAll(),this.copy(),this.deselectAll()},async convert(e,t){const i=this.findIndex(t.id);if(-1===i)return!1;const s=e=>{let t={};for(const i of Object.values(e?.tabs??{}))t={...t,...i.fields};return t},n=this.blocks[i],o=await this.$api.get(this.endpoints.field+"/fieldsets/"+e),l=this.fieldsets[n.type],a=this.fieldsets[e];if(!a)return!1;let r=o.content;const c=s(a),d=s(l);for(const[u,p]of Object.entries(c)){const e=d[u];e?.type===p.type&&n?.content?.[u]&&(r[u]=n.content[u])}this.blocks[i]={...o,id:n.id,content:r},this.save()},deselect(e){const t=this.selected.findIndex(t=>t===e.id);-1!==t&&this.selected.splice(t,1)},deselectAll(){this.selected=[]},async duplicate(e,t){const i={...this.$helper.object.clone(e),id:this.$helper.uuid()};this.blocks.splice(t+1,0,i),this.save()},expand(e){this.ref(e)?.expand?.()},expandAll(){for(const e of this.blocks)this.expand(e)},fieldset(e){return this.fieldsets[e.type]??{icon:"box",name:e.type,tabs:{content:{fields:{}}},type:e.type}},find(e){return this.blocks.find(t=>t.id===e)},findIndex(e){return this.blocks.findIndex(t=>t.id===e)},focus(e){const t=this.ref(e);this.selected=[e?.id??this.blocks[0]],t?.focus(),t?.$el.scrollIntoView({block:"nearest"})},focusOrOpen(e){this.fieldsets[e.type].wysiwyg?this.focus(e):this.open(e)},hide(e){e.isHidden=!0,this.save()},isEventTarget(e){return e.target.closest(".k-blocks")===this.$el},isFullyCollapsed(){return this.blocks.every(e=>!1===(e=this.ref(e)).isCollapsible()||!0===e.isCollapsed())},isCollapsible(){return this.blocks.some(e=>this.ref(e).isCollapsible())},isFullyExpanded(){return this.blocks.every(e=>!1===(e=this.ref(e)).isCollapsible()||!1===e.isCollapsed())},isExpandable(){return this.blocks.some(e=>this.ref(e).isExpandable())},isInputEvent(){const e=document.querySelector(":focus");return e?.matches("input, textarea, [contenteditable], .k-writer-input")},isLastSelected(e){const[t]=this.selected.slice(-1);return t&&e.id===t},isOnlyInstance:()=>1===document.querySelectorAll(".k-blocks").length,isSelected(e){return this.selected.includes(e.id)},async merge(){if(this.isMergable){const e=this.selected.map(e=>this.find(e)).sort((e,t)=>this.findIndex(e.id)-this.findIndex(t.id));this.ref(e[0]).$refs.editor.merge(e);for(const t of e.slice(1))this.remove(t);await this.$nextTick(),this.focus(e[0])}},move(e){if(e.from!==e.to){const t=e.draggedData,i=e.toData;if(!1===Object.keys(i.fieldsets).includes(t.type))return!1;if(!0===i.isFull)return!1}return!0},onBlur(e){!e.relatedTarget&&this.selected.length<=1&&(this.isMultiSelectKey=!1)},onClickBlock(e,t){t&&this.isMultiSelectKey&&this.onKey(t),this.isMultiSelectKey&&(t.preventDefault(),t.stopPropagation(),this.isSelected(e)?this.deselect(e):this.select(e))},onClickGlobal(e){if(!0===_n(e.target))return;const t=document.querySelector(".k-overlay:last-of-type");!1!==this.$el.contains(e.target)||!1!==t?.contains(e.target)?t&&!1===this.$el.closest(".k-layout-column")?.contains(e.target)&&this.deselectAll():this.deselectAll()},onCopy(e){return!1!==this.$el.contains(e.target)&&!0!==this.isEditing&&!0!==this.$panel.dialog.isOpen&&!0!==this.isInputEvent(e)&&this.copy(e)},onFocus(e){!1===this.isMultiSelectKey&&(this.selected=[e.id])},onFocusGlobal(e){!0!==_n(e.target)&&!1===this.$el.contains(e.target)&&this.deselectAll()},async onKey(e){if(this.isMultiSelectKey=e.metaKey||e.ctrlKey||e.altKey,"Escape"===e.code&&this.selected.length>1){const e=this.find(this.selected[0]);await this.$nextTick(),this.focus(e)}},onPaste(e){return!0!==this.isInputEvent(e)&&(!1!==this.isEventTarget(e)&&(!0!==this.isEditing&&!0!==this.$panel.dialog.isOpen&&this.paste(e)))},open(e){this.$refs["block-"+e.id]?.[0].open()},async paste(e,t){const i=this.$helper.clipboard.read(e);let s=await this.$api.post(this.endpoints.field+"/paste",{html:i});if(void 0===t){let e=this.selected[this.selected.length-1];-1===(t=this.findIndex(e))&&(t=this.blocks.length),t++}if(this.max){const e=this.max-this.blocks.length;s=s.slice(0,e)}this.blocks.splice(t,0,...s),this.save(),this.$panel.notification.success({message:this.$t("paste.success",{count:s.length}),icon:"download"})},pasteboard(){this.$panel.dialog.open({component:"k-block-pasteboard",on:{paste:this.paste}})},prevNext(e){if(this.blocks[e])return this.$refs["block-"+this.blocks[e].id]?.[0]},ref(e){return this.$refs["block-"+(e?.id??this.blocks[0]?.id)]?.[0]},remove(e){const t=this.findIndex(e.id);-1!==t&&(this.deselect(e),this.blocks.splice(t,1),this.save())},removeAll(){this.$panel.dialog.open({component:"k-remove-dialog",props:{text:this.$t("field.blocks.delete.confirm.all"),submitButton:this.$t("delete.all")},on:{submit:()=>{this.selected=[],this.blocks=[],this.save(),this.$panel.dialog.close()}}})},removeSelected(){this.$panel.dialog.open({component:"k-remove-dialog",props:{text:this.$t("field.blocks.delete.confirm.selected")},on:{submit:()=>{for(const e of this.selected){const t=this.findIndex(e);-1!==t&&this.blocks.splice(t,1)}this.deselectAll(),this.save(),this.$panel.dialog.close()}}})},save(){this.$emit("input",this.blocks)},select(e){!1===this.isSelected(e)&&this.selected.push(e.id)},selectDown(){const e=this.selected[this.selected.length-1],t=this.findIndex(e)+1;t<this.blocks.length&&this.select(this.blocks[t])},selectUp(){const e=this.selected[0],t=this.findIndex(e)-1;t>=0&&this.select(this.blocks[t])},selectAll(){this.selected=Object.values(this.blocks).map(e=>e.id)},show(e){e.isHidden=!1,this.save()},async sort(e,t,i){if(i<0)return;let s=this.$helper.object.clone(this.blocks);s.splice(t,1),s.splice(i,0,e),this.blocks=s,this.save(),await this.$nextTick(),this.focus(e)},async split(e,t,i){const s=this.$helper.object.clone(e);s.content={...s.content,...i[0]};const n=await this.$api.get(this.endpoints.field+"/fieldsets/"+e.type);n.content={...n.content,...s.content,...i[1]},this.blocks.splice(t,1,s,n),this.save(),await this.$nextTick(),this.focus(n)},update(e,t){const i=this.findIndex(e.id);if(-1!==i)for(const s in t)this.blocks[i].content[s]=t[s];this.save()}}},[["render",function(e,i,l,r,c,d){const g=t("k-block"),y=t("k-draggable"),w=t("k-empty");return n(),h("div",{class:p(["k-blocks",e.$attrs.class]),"data-disabled":e.disabled,"data-empty":0===c.blocks.length,style:u(e.$attrs.style)},[d.hasFieldsets?(n(),h(m,{key:0},[b(y,o(d.draggableOptions,{"data-multi-select-key":c.isMultiSelectKey,class:"k-blocks-list",onSort:d.save}),{default:a(()=>[(n(!0),h(m,null,f(c.blocks,(t,l)=>(n(),s(g,o({ref_for:!0,ref:"block-"+t.id,key:t.id},{ref_for:!0},{...t,disabled:e.disabled,endpoints:e.endpoints,fieldset:d.fieldset(t),isBatched:d.isSelected(t)&&c.selected.length>1,isFull:d.isFull,isHidden:!0===t.isHidden,isLastSelected:d.isLastSelected(t),isMergable:d.isMergable,isSelected:d.isSelected(t),next:d.prevNext(l+1),prev:d.prevNext(l-1)},{onAppend:e=>d.add(e,l+1),onChooseToAppend:e=>d.choose(l+1),onChooseToConvert:e=>d.chooseToConvert(t),onChooseToPrepend:e=>d.choose(l),onClick:e=>d.onClickBlock(t,e),onClose:i[0]||(i[0]=e=>c.isEditing=!1),onCopy:i[1]||(i[1]=e=>d.copy()),onDuplicate:e=>d.duplicate(t,l),onFocus:e=>d.onFocus(t),onHide:e=>d.hide(t),onMerge:i[2]||(i[2]=e=>d.merge()),onOpen:i[3]||(i[3]=e=>c.isEditing=!0),onPaste:i[4]||(i[4]=e=>d.pasteboard()),onPrepend:e=>d.add(e,l),onRemove:e=>d.remove(t),onRemoveSelected:d.removeSelected,onShow:e=>d.show(t),onSelectDown:d.selectDown,onSelectUp:d.selectUp,onSortDown:e=>d.sort(t,l,l+1),onSortUp:e=>d.sort(t,l,l-1),onSplit:e=>d.split(t,l,e),onUpdate:e=>d.update(t,e)}),null,16,["onAppend","onChooseToAppend","onChooseToConvert","onChooseToPrepend","onClick","onDuplicate","onFocus","onHide","onPrepend","onRemove","onRemoveSelected","onShow","onSelectDown","onSelectUp","onSortDown","onSortUp","onSplit","onUpdate"]))),128))]),_:1},16,["data-multi-select-key","onSort"]),b(w,o({class:"k-blocks-empty",icon:"box"},k(e.disabled?{}:{click:()=>d.choose(c.blocks.length)})),{default:a(()=>[v($(e.empty??e.$t("field.blocks.empty")),1)]),_:1},16)],64)):(n(),s(w,{key:1,icon:"box"},{default:a(()=>[v($(e.$t("field.blocks.fieldsets.empty")),1)]),_:1}))],14,jn)}]]),Bn=["innerHTML"];const Tn=Ne({inheritAttrs:!1,emits:["cancel","close","paste","submit"],computed:{shortcut(){return this.$helper.keyboard.metaKey()+"+v"}},methods:{paste(e){this.$emit("close"),this.$emit("paste",e)}}},[["render",function(e,i,o,l,r,c){const d=t("k-dialog");return n(),s(d,{ref:"dialog",class:p(["k-block-importer",e.$attrs.class]),"cancel-button":!1,style:u(e.$attrs.style),"submit-button":!1,visible:!0,size:"large",onCancel:i[1]||(i[1]=t=>e.$emit("cancel")),onSubmit:i[2]||(i[2]=t=>e.$emit("submit"))},{default:a(()=>[x("label",{for:"pasteboard",innerHTML:e.$t("field.blocks.fieldsets.paste",{shortcut:c.shortcut})},null,8,Bn),x("textarea",{id:"pasteboard",onPaste:i[0]||(i[0]=S((...e)=>c.paste&&c.paste(...e),["prevent"]))},null,32)]),_:1},8,["class","style"])}]]),qn=["open"],zn=["innerHTML"];const Pn=Ne({inheritAttrs:!1,props:{disabledFieldsets:{default:()=>[],type:Array},fieldsets:{type:Object},fieldsetGroups:{type:Object},headline:{type:String},size:{type:String,default:"medium"},value:{default:null,type:String}},emits:["cancel","close","input","paste","submit"],data:()=>({selected:null}),computed:{groups(){const e={};let t=0;const i=this.fieldsetGroups??{blocks:{label:this.$t("field.blocks.fieldsets.label"),sets:Object.keys(this.fieldsets)}};for(const s in i){const n=i[s];n.open=!1!==n.open,n.fieldsets=n.sets.filter(e=>this.fieldsets[e]).map(e=>(t++,{...this.fieldsets[e],index:t})),0!==n.fieldsets.length&&(e[s]=n)}return e},shortcut(){return this.$helper.keyboard.metaKey()+"+v"}},mounted(){this.$events.on("paste",this.paste)},unmounted(){this.$events.off("paste",this.paste)},methods:{paste(e){this.$emit("paste",e),this.$emit("close")}}},[["render",function(e,i,o,l,r,c){const d=t("k-headline"),k=t("k-button"),y=t("k-navigate"),w=t("k-dialog");return n(),s(w,{class:p(["k-block-selector",e.$attrs.class]),"cancel-button":!1,size:o.size,"submit-button":!1,style:u(e.$attrs.style),visible:!0,onCancel:i[0]||(i[0]=t=>e.$emit("cancel")),onSubmit:i[1]||(i[1]=t=>e.$emit("submit",o.value))},{default:a(()=>[o.headline?(n(),s(d,{key:0},{default:a(()=>[v($(o.headline),1)]),_:1})):g("",!0),(n(!0),h(m,null,f(c.groups,(t,i)=>(n(),h("details",{key:i,open:t.open},[x("summary",null,$(t.label),1),b(y,{class:"k-block-types"},{default:a(()=>[(n(!0),h(m,null,f(t.fieldsets,t=>(n(),s(k,{key:t.name,disabled:o.disabledFieldsets.includes(t.type),icon:t.icon??"box",text:t.name,size:"lg",onClick:i=>e.$emit("submit",t.type),onFocus:i=>e.$emit("input",t.type)},null,8,["disabled","icon","text","onClick","onFocus"]))),128))]),_:2},1024)],8,qn))),128)),x("p",{class:"k-clipboard-hint",innerHTML:e.$t("field.blocks.fieldsets.paste",{shortcut:c.shortcut})},null,8,zn)]),_:1},8,["class","size","style"])}]]),Nn={class:"k-block-background-dropdown"};const Fn=Ne({props:{value:String},emits:["input"],computed:{valueAdapted(){return"transparent"===this.value?"var(--block-color-back)":this.value}}},[["render",function(e,i,s,o,l,r){const c=t("k-color-frame"),d=t("k-button"),u=t("k-dropdown");return n(),h("div",Nn,[b(d,{dropdown:!0,size:"xs",variant:"filled",onClick:i[0]||(i[0]=t=>e.$refs.dropdown.toggle())},{default:a(()=>[b(c,{color:r.valueAdapted,ratio:"1/1"},null,8,["color"])]),_:1}),b(u,{ref:"dropdown","align-x":"end",options:[{text:e.$t("field.blocks.figure.back.plain"),click:"var(--block-color-back)"},{text:e.$t("field.blocks.figure.back.pattern.light"),click:"var(--pattern-light)"},{text:e.$t("field.blocks.figure.back.pattern.dark"),click:"var(--pattern)"}],onAction:i[1]||(i[1]=t=>e.$emit("input",t))},null,8,["options"])])}]]),Rn={inheritAttrs:!1,props:{back:String,caption:String,captionMarks:{default:!0,type:[Boolean,Array]},disabled:Boolean,isEmpty:Boolean,emptyIcon:String,emptyText:String},emits:["open","update"]},Yn=["data-empty"],Hn=["data-disabled"];const Un=Ne(Rn,[["render",function(e,i,o,l,a,c){const d=t("k-button"),m=t("k-block-figure-caption");return n(),h("figure",{"data-empty":o.isEmpty,class:p(["k-block-figure",e.$attrs.class]),style:u({"--block-figure-back":o.back,...e.$attrs.style})},[o.isEmpty?(n(),s(d,{key:0,disabled:o.disabled,icon:o.emptyIcon,text:o.emptyText,class:"k-block-figure-empty",onClick:i[0]||(i[0]=t=>e.$emit("open"))},null,8,["disabled","icon","text"])):(n(),h("span",{key:1,"data-disabled":o.disabled,class:"k-block-figure-container",onDblclick:i[1]||(i[1]=t=>e.$emit("open"))},[r(e.$slots,"default")],40,Hn)),o.caption?(n(),s(m,{key:2,disabled:o.disabled,marks:o.captionMarks,value:o.caption,onInput:i[2]||(i[2]=t=>e.$emit("update",{caption:t}))},null,8,["disabled","marks","value"])):g("",!0)],14,Yn)}]]),Vn={props:{disabled:Boolean,marks:[Array,Boolean],value:String},emits:["input"]},Kn={class:"k-block-figure-caption"};const Wn=Ne(Vn,[["render",function(e,i,s,o,l,a){const r=t("k-writer-input");return n(),h("figcaption",Kn,[b(r,{disabled:s.disabled,inline:!0,marks:s.marks,spellcheck:!1,value:s.value,onInput:i[0]||(i[0]=t=>e.$emit("input",t))},null,8,["disabled","marks","value"])])}]]),Jn={class:"k-block-type-code-editor"},Gn={key:0,class:"k-block-type-code-editor-language"};const Xn=Ne({extends:wn,computed:{placeholder(){return this.field("code",{}).placeholder},languages(){return this.field("language",{options:[]}).options}},methods:{focus(){this.$refs.code.focus()}}},[["render",function(e,i,s,o,l,a){const r=t("k-input");return n(),h("div",Jn,[b(r,{ref:"code",buttons:!1,disabled:e.disabled,placeholder:a.placeholder,spellcheck:!1,value:e.content.code,font:"monospace",type:"textarea",onInput:i[0]||(i[0]=t=>e.update({code:t}))},null,8,["disabled","placeholder","value"]),a.languages.length?(n(),h("div",Gn,[b(r,{ref:"language",disabled:e.disabled,empty:!1,options:a.languages,value:e.content.language,icon:"code",type:"select",onInput:i[1]||(i[1]=t=>e.update({language:t}))},null,8,["disabled","options","value"])])):g("",!0)])}]]),Zn=["data-collapsed"],Qn={class:"k-block-type-fields-header"};const eo=Ne({extends:wn,props:{tabs:Object},emits:["open","update"],data(){return{collapsed:this.state(),tab:Object.keys(this.tabs)[0]}},computed:{fields(){return this.tabs[this.tab]?.fields},values(){return Object.assign({},this.content)}},methods:{open(){this.$emit("open",this.tab)},state(e){const t=`kirby.fieldsBlock.${this.endpoints.field}.${this.id}`;if(void 0===e)return JSON.parse(sessionStorage.getItem(t));sessionStorage.setItem(t,e)},toggle(){this.state(this.collapsed=!this.collapsed)},collapse(){this.state(this.collapsed=!0)},expand(){this.state(this.collapsed=!1)}}},[["render",function(e,i,o,l,a,r){const c=t("k-block-title"),d=t("k-drawer-tabs"),u=t("k-form");return n(),h("div",{"data-collapsed":a.collapsed,onDblclick:i[2]||(i[2]=t=>e.fieldset.wysiwyg?null:e.$emit("open"))},[x("header",Qn,[b(c,{content:r.values,fieldset:e.fieldset,onClick:r.toggle},null,8,["content","fieldset","onClick"]),a.collapsed?g("",!0):(n(),s(d,{key:0,tab:a.tab,tabs:e.fieldset.tabs,onOpen:i[0]||(i[0]=e=>a.tab=e)},null,8,["tab","tabs"]))]),a.collapsed?g("",!0):(n(),s(u,{key:0,ref:"form",autofocus:!0,disabled:e.disabled||!e.fieldset.wysiwyg,fields:r.fields,value:r.values,class:"k-block-type-fields-form",onInput:i[1]||(i[1]=t=>e.$emit("update",t))},null,8,["disabled","fields","value"]))],40,Zn)}]]),to=["data-empty"];const io=Ne({extends:wn,emits:["update"],data(){return{back:this.onBack()??"var(--block-color-back)"}},computed:{captionMarks(){return this.field("caption",{marks:!0}).marks},crop(){return this.content.crop},isEmpty(){return!this.content.images?.length},ratio(){return this.content.ratio?this.content.ratio:"1/1"}},methods:{onBack(e){const t=`kirby.galleryBlock.${this.endpoints.field}.${this.id}`;if(void 0===e)return sessionStorage.getItem(t);this.back=e,sessionStorage.setItem(t,e)}}},[["render",function(e,i,o,l,a,r){const c=t("k-image-frame"),d=t("k-block-background-dropdown"),p=t("k-block-figure-caption");return n(),h("figure",{"data-empty":r.isEmpty,style:u({"--block-back":a.back}),class:"k-block-type-gallery-figure"},[x("ul",{onDblclick:i[0]||(i[0]=(...t)=>e.open&&e.open(...t))},[r.isEmpty?(n(),h(m,{key:0},f(3,e=>x("li",{key:e,class:"k-block-type-gallery-placeholder"},[b(c,{ratio:r.ratio,class:"k-block-type-gallery-frame"},null,8,["ratio"])])),64)):(n(),h(m,{key:1},[(n(!0),h(m,null,f(e.content.images,e=>(n(),h("li",{key:e.id},[b(c,{cover:r.crop,file:e,ratio:r.ratio,class:"k-block-type-gallery-frame"},null,8,["cover","file","ratio"])]))),128)),b(d,{value:a.back,onInput:r.onBack},null,8,["value","onInput"])],64))],32),e.content.caption?(n(),s(p,{key:0,disabled:e.disabled,marks:r.captionMarks,value:e.content.caption,onInput:i[1]||(i[1]=t=>e.$emit("update",{caption:t}))},null,8,["disabled","marks","value"])):g("",!0)],12,to)}]]),so=["data-level"];const no=Ne({extends:wn,inheritAttrs:!1,emits:["append","open","split","update"],computed:{isSplitable(){return this.content.text.length>0&&!1===this.$refs.input.isCursorAtStart&&!1===this.$refs.input.isCursorAtEnd},keys(){return{Enter:()=>!0===this.$refs.input.isCursorAtEnd?this.$emit("append","text"):this.split(),"Mod-Enter":this.split}},levels(){return this.field("level",{options:[]}).options},textField(){return this.field("text",{marks:!0})}},methods:{focus(){this.$refs.input.focus()},merge(e){this.update({text:e.map(e=>e.content.text).join(" ")})},split(){const e=this.$refs.input.getSplitContent?.();e&&this.$emit("split",[{text:e[0]},{level:"h"+Math.min(parseInt(this.content.level.slice(1))+1,6),text:e[1]}])}}},[["render",function(e,i,l,a,r,c){const d=t("k-writer-input"),m=t("k-input");return n(),h("div",{class:p(["k-block-type-heading-input",e.$attrs.class]),"data-level":e.content.level,style:u(e.$attrs.style)},[b(d,o({ref:"input"},c.textField,{disabled:e.disabled,inline:!0,keys:c.keys,value:e.content.text,onInput:i[0]||(i[0]=t=>e.update({text:t}))}),null,16,["disabled","keys","value"]),c.levels.length>1&&!e.disabled?(n(),s(m,{key:0,ref:"level",empty:!1,options:c.levels,value:e.content.level,type:"select",class:"k-block-type-heading-level",onInput:i[1]||(i[1]=t=>e.update({level:t}))},null,8,["options","value"])):g("",!0)],14,so)}]]);const oo=Ne({extends:wn,data(){return{back:this.onBack()??"transparent"}},computed:{captionMarks(){return this.field("caption",{marks:!0}).marks},crop(){return this.content.crop??!1},file(){if(this.isInternal)return this.content.image?.[0]},isEmpty(){return this.isInternal?!this.file:!this.src},isInternal(){return"kirby"===this.content.location},src(){if(!this.isInternal)return this.content.src},ratio(){return this.content.ratio?this.content.ratio:"intrinsic"}},methods:{onBack(e){const t=`kirby.imageBlock.${this.endpoints.field}.${this.id}`;if(void 0===e)return sessionStorage.getItem(t);this.back=e,sessionStorage.setItem(t,e)}}},[["render",function(e,i,o,l,r,c){const d=t("k-image-frame"),u=t("k-block-background-dropdown"),p=t("k-block-figure");return n(),s(p,{back:r.back,caption:e.content.caption,"caption-marks":c.captionMarks,"empty-text":e.$t("field.blocks.image.placeholder")+" …",disabled:e.disabled,"is-empty":c.isEmpty,"empty-icon":"image",onOpen:e.open,onUpdate:e.update},{default:a(()=>[b(d,{alt:e.content.alt,cover:c.crop,file:c.file,ratio:c.ratio,src:c.src},null,8,["alt","cover","file","ratio","src"]),b(u,{value:r.back,onInput:c.onBack},null,8,["value","onInput"])]),_:1},8,["back","caption","caption-marks","empty-text","disabled","is-empty","onOpen","onUpdate"])}]]);const lo=Ne({},[["render",function(e,t,i,s,o,l){return n(),h("hr")}]]);const ao=Ne({extends:wn,emits:["open","split","update"],computed:{isSplitable(){return this.content.text.length>0&&!1===this.input().isCursorAtStart&&!1===this.input().isCursorAtEnd},keys(){return{"Mod-Enter":this.split}},marks(){return this.field("text",{}).marks}},methods:{focus(){this.$refs.input.focus()},input(){return this.$refs.input.$refs.input.$refs.input},merge(e){this.update({text:e.map(e=>e.content.text).join("").replaceAll("</ul><ul>","")})},split(){const e=this.input().getSplitContent?.();e&&this.$emit("split",[{text:e[0].replace(/(<li><p><\/p><\/li><\/ul>)$/,"</ul>")},{text:e[1].replace(/^(<ul><li><p><\/p><\/li>)/,"<ul>")}])}}},[["render",function(e,i,o,l,a,r){const c=t("k-input");return n(),s(c,{ref:"input",disabled:e.disabled,keys:r.keys,marks:r.marks,value:e.content.text,class:"k-block-type-list-input",type:"list",onInput:i[0]||(i[0]=t=>e.update({text:t}))},null,8,["disabled","keys","marks","value"])}]]);const ro=Ne({extends:wn,computed:{placeholder(){return this.field("text",{}).placeholder}},methods:{focus(){this.$refs.input.focus()}}},[["render",function(e,i,o,l,a,r){const c=t("k-input");return n(),s(c,{ref:"input",buttons:!1,disabled:e.disabled,placeholder:r.placeholder,spellcheck:!1,value:e.content.text,class:"k-block-type-markdown-input",font:"monospace",type:"textarea",onInput:i[0]||(i[0]=t=>e.update({text:t}))},null,8,["disabled","placeholder","value"])}]]),co={class:"k-block-type-quote-editor"};const uo=Ne({extends:wn,computed:{citationField(){return this.field("citation",{})},textField(){return this.field("text",{})}},methods:{focus(){this.$refs.text.focus()}}},[["render",function(e,i,s,o,l,a){const r=t("k-writer-input");return n(),h("div",co,[b(r,{ref:"text",disabled:e.disabled,inline:a.textField.inline??!1,marks:a.textField.marks,placeholder:a.textField.placeholder,value:e.content.text,class:"k-block-type-quote-text",onInput:i[0]||(i[0]=t=>e.update({text:t}))},null,8,["disabled","inline","marks","placeholder","value"]),b(r,{ref:"citation",disabled:e.disabled,inline:a.citationField.inline??!0,marks:a.citationField.marks,placeholder:a.citationField.placeholder,value:e.content.citation,class:"k-block-type-quote-citation",onInput:i[1]||(i[1]=t=>e.update({citation:t}))},null,8,["disabled","inline","marks","placeholder","value"])])}]]);const po=Ne({extends:wn,inheritAttrs:!1,computed:{columns(){return this.table.columns??this.fields},fields(){return this.table.fields??{}},rows(){return this.content.rows??[]},table(){let e=null;for(const t of Object.values(this.fieldset.tabs??{}))t.fields.rows&&(e=t.fields.rows);return e??{}}}},[["render",function(e,i,o,l,a,r){const c=t("k-table");return n(),s(c,{class:p(["k-block-type-table-preview",e.$attrs.class]),columns:r.columns,empty:e.$t("field.structure.empty"),rows:r.rows,style:u(e.$attrs.style),onDblclick:e.open},null,8,["class","columns","empty","rows","style","onDblclick"])}]]);const ho=Ne({extends:wn,emits:["open","split","update"],computed:{component(){const e="k-"+this.textField.type+"-input";return this.$helper.isComponent(e)?e:"k-writer-input"},isSplitable(){return this.content.text.length>0&&!1===this.$refs.input.isCursorAtStart&&!1===this.$refs.input.isCursorAtEnd},keys(){const e={"Mod-Enter":this.split};return!0===this.textField.inline&&(e.Enter=this.split),e},textField(){return this.field("text",{})}},methods:{focus(){this.$refs.input.focus()},merge(e){this.update({text:e.map(e=>e.content.text).join(this.textField.inline?" ":"")})},split(){const e=this.$refs.input.getSplitContent?.();e&&("writer"===this.textField.type&&(e[0]=e[0].replace(/(<p><\/p>)$/,""),e[1]=e[1].replace(/^(<p><\/p>)/,"")),this.$emit("split",e.map(e=>({text:e}))))}}},[["render",function(e,t,i,l,a,r){return n(),s(w(r.component),o({ref:"input"},r.textField,{disabled:e.disabled,keys:r.keys,value:e.content.text,class:"k-block-type-text-input",onInput:t[0]||(t[0]=t=>e.update({text:t}))}),null,16,["disabled","keys","value"])}]]);const mo=Ne({extends:wn,computed:{captionMarks(){return this.field("caption",{marks:!0}).marks},file(){if(this.isInternal)return this.content.video?.[0]},isEmpty(){return this.isInternal?!this.file:!this.url},isInternal(){return"kirby"===this.content.location},poster(){return this.content.poster?.[0]?.url},url(){if(!this.isInternal)return this.content.url}}},[["render",function(e,i,o,l,r,c){const d=t("k-video-frame"),u=t("k-block-figure");return n(),s(u,{caption:e.content.caption,"caption-marks":c.captionMarks,disabled:e.disabled,"empty-text":e.$t("field.blocks.video.placeholder")+" …","is-empty":c.isEmpty,"empty-icon":"video",class:"k-block-type-video-figure",onOpen:e.open,onUpdate:e.update},{default:a(()=>[b(d,{controls:e.content.controls,file:c.file,poster:c.poster,url:c.url,element:"div"},null,8,["controls","file","poster","url"])]),_:1},8,["caption","caption-marks","disabled","empty-text","is-empty","onOpen","onUpdate"])}]]),fo={install(e){e.component("k-block",In),e.component("k-blocks",Ln),e.component("k-block-options",Sn),e.component("k-block-pasteboard",Tn),e.component("k-block-selector",Pn),e.component("k-block-background-dropdown",Fn),e.component("k-block-figure",Un),e.component("k-block-figure-caption",Wn),e.component("k-block-title",vn),e.component("k-block-type-code",Xn),e.component("k-block-type-default",wn),e.component("k-block-type-fields",eo),e.component("k-block-type-gallery",io),e.component("k-block-type-heading",no),e.component("k-block-type-image",oo),e.component("k-block-type-line",lo),e.component("k-block-type-list",ao),e.component("k-block-type-markdown",ro),e.component("k-block-type-quote",uo),e.component("k-block-type-table",po),e.component("k-block-type-text",ho),e.component("k-block-type-video",mo)}},go=["value"],ko={key:0};const bo=Ne({mixins:[Ws,En],inheritAttrs:!1,emits:["input"],data:()=>({opened:[]}),computed:{hasFieldsets(){return this.$helper.object.length(this.fieldsets)>0},isEmpty(){return 0===this.value.length},isFull(){return this.max&&this.value.length>=this.max}},methods:{focus(){this.$refs.blocks.focus()},options(e){const t=[{click:()=>this.$refs.blocks.copyAll(),disabled:this.isEmpty,icon:"template",text:this.$t("copy.all")},{click:()=>this.$refs.blocks.pasteboard(),disabled:this.isFull,icon:"download",text:this.$t("paste")}];return!0!==this.$refs.blocks.isCollapsible()&&!0!==this.$refs.blocks.isExpandable()||t.push("-"),!0===this.$refs.blocks.isCollapsible()&&t.push({click:()=>this.$refs.blocks.collapseAll(),disabled:this.isEmpty||this.$refs.blocks.isFullyCollapsed(),icon:"collapse",text:this.$t("collapse.all")}),!0===this.$refs.blocks.isExpandable()&&t.push({click:()=>this.$refs.blocks.expandAll(),disabled:this.isEmpty||this.$refs.blocks.isFullyExpanded(),icon:"expand",text:this.$t("expand.all")}),t.push("-"),t.push({click:()=>this.$refs.blocks.removeAll(),disabled:this.isEmpty,icon:"trash",text:this.$t("delete.all")}),e(t)}}},[["render",function(e,i,r,c,d,u){const p=t("k-button"),m=t("k-dropdown"),f=t("k-button-group"),k=t("k-blocks"),y=t("k-field");return n(),s(y,o(e.$props,{input:e.id,class:["k-blocks-field",e.$attrs.class],style:e.$attrs.style}),l({default:a(()=>[x("k-input-validator",o({id:e.id,min:e.min,max:e.max,required:e.required},{value:JSON.stringify(e.value)}),[b(k,o({ref:"blocks"},e.$props,{onClose:i[2]||(i[2]=e=>d.opened=e),onOpen:i[3]||(i[3]=e=>d.opened=e),onInput:i[4]||(i[4]=t=>e.$emit("input",t))}),null,16)],16,go),e.disabled||u.isEmpty||u.isFull||!u.hasFieldsets?g("",!0):(n(),h("footer",ko,[b(p,{title:e.$t("add"),icon:"add",size:"xs",variant:"filled",onClick:i[5]||(i[5]=t=>e.$refs.blocks.choose(e.value.length))},null,8,["title"])]))]),_:2},[!e.disabled&&u.hasFieldsets?{name:"options",fn:a(()=>[b(f,{layout:"collapsed"},{default:a(()=>[b(p,{autofocus:e.autofocus,disabled:u.isFull,responsive:!0,text:e.$t("add"),icon:"add",variant:"filled",size:"xs",class:"input-focus",onClick:i[0]||(i[0]=t=>e.$refs.blocks.choose(e.value.length))},null,8,["autofocus","disabled","text"]),b(p,{icon:"dots",variant:"filled",size:"xs",onClick:i[1]||(i[1]=t=>e.$refs.options.toggle())}),b(m,{ref:"options",options:u.options,"align-x":"end"},null,8,["options"])]),_:1})]),key:"0"}:void 0]),1040,["input","class","style"])}]]);const yo=Ne({mixins:[Ie,Me,_e,Le],props:{buttons:{type:Array,default:()=>[]}}},[["render",function(e,i,l,r,c,d){const u=t("k-button"),p=t("k-button-group"),g=t("k-empty"),k=t("k-field");return n(),s(k,{id:e.id,help:e.help,input:!1,label:e.label,name:e.name,type:"buttons",class:"k-buttons-field"},{default:a(()=>[l.buttons.length>0?(n(),s(p,{key:0},{default:a(()=>[(n(!0),h(m,null,f(l.buttons,e=>(n(),s(u,o({key:e.link??e.dialog??e.drawer},{ref_for:!0},e,{dropdown:!0,variant:"filled"}),null,16))),128))]),_:1})):(n(),s(g,{key:1,icon:"bars"},{default:a(()=>[v($(e.$t("buttons.empty")),1)]),_:1}))]),_:1},8,["id","help","label","name"])}]]),vo={mixins:[bs,Be],props:{columns:{default:1,type:Number},max:Number,min:Number,theme:String,value:{type:Array,default:()=>[]}}},$o=["disabled"],wo={class:"sr-only"},xo=["value"];const So=Ne({mixins:[ys,vo],emits:["input"],data:()=>({selected:[]}),computed:{choices(){const e=this.options.some(e=>e.icon);return this.options.map((t,i)=>{const s=this.selected.includes(t.value);return{autofocus:this.autofocus&&0===i,checked:s,disabled:this.disabled||t.disabled||!s&&this.isFull,id:`${this.id}-${i}`,icon:t.icon??(e?"blank":null),info:t.info,label:t.text,name:this.name??this.id,type:"checkbox",value:t.value}})},isFull(){return this.max&&this.selected.length>=this.max}},watch:{value:{handler(e){this.selected=Array.isArray(e)?e:[]},immediate:!0}},methods:{deselectAll(){this.selected=[],this.$emit("input",this.selected)},focus(){this.$el.querySelector("input")?.focus()},input(e,t){if(!0===t)this.selected.push(e);else{const t=this.selected.indexOf(e);-1!==t&&this.selected.splice(t,1)}this.$emit("input",this.selected)},select(){this.focus()},selectAll(){this.selected=this.choices.map(e=>e.value),this.$emit("input",this.selected)}}},[["render",function(e,i,s,l,a,r){const c=t("k-choice-input");return n(),h("fieldset",{disabled:e.disabled,class:p(["k-checkboxes-input",e.$attrs.class]),style:u(e.$attrs.style)},[x("legend",wo,$(e.$t("options")),1),x("k-input-validator",o({min:e.min,max:e.max,required:e.required},{value:JSON.stringify(a.selected)}),[x("ul",{style:u({"--columns":e.columns}),class:"k-grid","data-variant":"choices"},[(n(!0),h(m,null,f(r.choices,(e,t)=>(n(),h("li",{key:t},[b(c,o({ref_for:!0},e,{onInput:t=>r.input(e.value,t)}),null,16,["onInput"])]))),128))],4)],16,xo)],14,$o)}]]),Co={props:{counter:{type:Boolean,default:!0}},computed:{counterOptions(){const e=this.counterValue??this.value;return!(!1===this.counter||this.disabled||!e)&&{count:Array.isArray(e)?e.length:String(e).length,min:this.$props.min??this.$props.minlength,max:this.$props.max??this.$props.maxlength}},counterValue:()=>null}};const Oo=Ne({mixins:[Ws,hn,vo,Co],inheritAttrs:!1,props:{batch:Boolean},emits:["input"],methods:{deselectAll(){this.$refs.input.deselectAll()},selectAll(){this.$refs.input.selectAll()},focus(){this.$refs.input.focus()}}},[["render",function(e,i,l,r,c,d){const u=t("k-counter"),p=t("k-button"),h=t("k-button-group"),m=t("k-empty"),f=t("k-checkboxes-input"),k=t("k-field");return n(),s(k,o(e.$props,{class:["k-checkboxes-field",e.$attrs.class],counter:e.counterOptions,input:e.id+"-0",style:e.$attrs.style}),{counter:a(()=>[e.counterOptions?(n(),s(u,o({key:0},e.counterOptions,{required:e.required,class:"k-field-counter"}),null,16,["required"])):g("",!0),l.batch?(n(),s(h,{key:1,layout:"collapsed"},{default:a(()=>[b(p,{disabled:0===e.value.length,responsive:!0,icon:"deselect-all",size:"xs",variant:"filled",onClick:d.deselectAll},{default:a(()=>[v($(e.$t("deselect.all")),1)]),_:1},8,["disabled","onClick"]),b(p,{disabled:e.value.length>=e.options.length,responsive:!0,icon:"select-all",size:"xs",variant:"filled",onClick:d.selectAll},{default:a(()=>[v($(e.$t("select.all")),1)]),_:1},8,["disabled","onClick"])]),_:1})):g("",!0)]),default:a(()=>[e.options?.length?(n(),s(f,o({key:1,ref:"input"},e.$props,{onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16)):(n(),s(m,{key:0,text:e.$t("options.none"),icon:"checklist"},null,8,["text"]))]),_:1},16,["class","counter","input","style"])}]]),Ao={mixins:[bs,xe,Se,Ae,Ee,je,Te,qe,Pe],props:{ariaLabel:String,preselect:Boolean,type:{default:"text",type:String},value:{type:String}}},Io=["aria-label","data-font"];const Mo=Ne({mixins:[ys,Ao],emits:["input"],mounted(){this.$props.autofocus&&this.focus(),this.$props.preselect&&this.select()},methods:{select(){this.$el.select()}}},[["render",function(e,t,i,s,l,a){const r=D("direction");return E((n(),h("input",o({autocomplete:e.autocomplete,autofocus:e.autofocus,disabled:e.disabled,id:e.id,maxlength:e.maxlength,minlength:e.minlength,name:e.name,pattern:e.pattern,placeholder:e.placeholder,required:e.required,spellcheck:e.spellcheck,type:e.type,value:e.value},{"aria-label":e.ariaLabel,class:["k-string-input",e.$attrs.class],"data-font":e.font,style:e.$attrs.style,onInput:t[0]||(t[0]=t=>e.$emit("input",t.target.value))}),null,16,Io)),[[r]])}]]),_o={mixins:[Ao],props:{autocomplete:null,font:null,maxlength:null,minlength:null,pattern:null,spellcheck:null,alpha:{type:Boolean,default:!0},format:{type:String,default:"hex",validator:e=>["hex","rgb","hsl"].includes(e)}}};const Do=Ne({mixins:[Mo,_o],emits:["input"],watch:{value(){this.validate()}},mounted(){this.validate()},methods:{convert(e){if(!e)return e;try{return this.$library.colors.toString(e,this.format,this.alpha)}catch{const t=document.createElement("div");return t.style.color=e,document.body.append(t),e=window.getComputedStyle(t).color,t.remove(),this.$library.colors.toString(e,this.format,this.alpha)}},convertAndEmit(e){this.emit(this.convert(e))},emit(e){this.$emit("input",e)},onBlur(){this.convertAndEmit(this.value)},onPaste(e){e instanceof ClipboardEvent&&(e=this.$helper.clipboard.read(e,!0)),this.convertAndEmit(e)},async onSave(){this.convertAndEmit(this.value),await this.$nextTick(),this.$el.form?.requestSubmit()},validate(){let e="";null===this.$library.colors.parse(this.value)&&(e=this.$t("error.validation.color",{format:this.format})),this.$el.setCustomValidity(e)}}},[["render",function(e,i,l,a,r,c){const d=t("k-string-input");return n(),s(d,o(e.$props,{spellcheck:!1,autocomplete:"off",class:"k-colorname-input",type:"text",onBlur:c.onBlur,onInput:i[0]||(i[0]=t=>e.$emit("input",t)),onPaste:c.onPaste,onKeydown:[_(S(c.onSave,["meta","stop","prevent"]),["s"]),_(c.onSave,["enter"])]}),null,16,["onBlur","onPaste","onKeydown"])}]]),Eo=["disabled"],jo=["innerHTML"];const Lo=Ne({mixins:[Ws,hn,_o],inheritAttrs:!1,props:{icon:{type:String,default:"pipette"},mode:{type:String,default:"picker",validator:e=>["picker","input","options"].includes(e)},options:{type:Array,default:()=>[]}},emits:["input"],computed:{convertedOptions(){return this.options.map(e=>({...e,value:this.convert(e.value)}))},currentOption(){return this.convertedOptions.find(e=>e.value===this.value)}},methods:{convert(e){return this.$library.colors.toString(e,this.format,this.alpha)}}},[["render",function(e,i,r,c,d,u){const p=t("k-coloroptions-input"),f=t("k-color-frame"),g=t("k-colorpicker-input"),k=t("k-dropdown"),y=t("k-colorname-input"),v=t("k-button"),$=t("k-input"),w=t("k-field");return n(),s(w,o(e.$props,{class:["k-color-field",e.$attrs.class],input:e.id,style:e.$attrs.style}),{default:a(()=>["options"===r.mode?(n(),s(p,o({key:0},e.$props,{options:u.convertedOptions,class:"k-color-field-options",onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16,["options"])):(n(),s($,o({key:1},e.$props,{type:"color"}),l({before:a(()=>["picker"===r.mode?(n(),h(m,{key:0},[x("button",{disabled:e.disabled,class:"k-color-field-picker-toggle",type:"button",onClick:i[1]||(i[1]=t=>e.$refs.picker.toggle())},[b(f,{color:e.value},null,8,["color"])],8,Eo),b(k,{ref:"picker",class:"k-color-field-picker"},{default:a(()=>[b(g,o({ref:"color"},e.$props,{options:u.convertedOptions,onInput:i[2]||(i[2]=t=>e.$emit("input",t)),onClick:i[3]||(i[3]=S(()=>{},["stop"]))}),null,16,["options"])]),_:1},512)],64)):(n(),s(f,{key:1,color:e.value},null,8,["color"]))]),default:a(()=>[b(y,o(e.$props,{onInput:i[4]||(i[4]=t=>e.$emit("input",t))}),null,16)]),_:2},[u.currentOption?.text?{name:"after",fn:a(()=>[x("span",{innerHTML:u.currentOption.text},null,8,jo)]),key:"0"}:void 0,"picker"!==r.mode||e.disabled?void 0:{name:"icon",fn:a(()=>[b(v,{icon:r.icon,class:"k-input-icon-button",onClick:i[5]||(i[5]=S(t=>e.$refs.picker.toggle(),["stop"]))},null,8,["icon"])]),key:"1"}]),1040))]),_:1},16,["class","input","style"])}]]),Bo={props:{max:String,min:String,value:String}},To={mixins:[bs,Bo],props:{display:{type:String,default:"DD.MM.YYYY"},step:{type:Object,default:()=>({size:1,unit:"day"})},type:{type:String,default:"date"}}},qo=["id","autofocus","disabled","placeholder","required","value"];const zo=Ne({mixins:[ys,To],emits:["input","focus","submit"],data:()=>({dt:null,formatted:null}),computed:{inputType:()=>"date",pattern(){return this.$library.dayjs.pattern(this.display)},rounding(){return{...this.$options.props.step.default(),...this.step}}},watch:{value:{handler(e,t){if(e!==t){const t=this.toDatetime(e);this.commit(t)}},immediate:!0}},methods:{async alter(e){let t=this.parse()??this.round(this.$library.dayjs()),i=this.rounding.unit,s=this.rounding.size;const n=this.selection();null!==n&&("meridiem"===n.unit?(e="pm"===t.format("a")?"subtract":"add",i="hour",s=12):(i=n.unit,i!==this.rounding.unit&&(s=1))),t=t[e](s,i).round(this.rounding.unit,this.rounding.size),this.commit(t),this.emit(t),await this.$nextTick(),this.select(n)},commit(e){this.dt=e,this.formatted=this.pattern.format(e),this.validate()},emit(e){this.$emit("input",this.toISO(e))},onArrowDown(){this.alter("subtract")},onArrowUp(){this.alter("add")},onBlur(){const e=this.parse();this.commit(e),this.emit(e)},async onEnter(){this.onBlur(),await this.$nextTick(),this.$emit("submit")},onInput(e){const t=this.parse(),i=this.pattern.format(t);if(!e||i==e)return this.commit(t),this.emit(t)},async onTab(e){if(""==this.$el.value)return;this.onBlur(),await this.$nextTick();const t=this.selection();if(this.$el&&t.start===this.$el.selectionStart&&t.end===this.$el.selectionEnd-1)if(e.shiftKey){if(0===t.index)return;this.selectPrev(t.index)}else{if(t.index===this.pattern.parts.length-1)return;this.selectNext(t.index)}else{if(this.$el&&this.$el.selectionStart==t.end+1&&t.index==this.pattern.parts.length-1)return;if(this.$el&&this.$el.selectionEnd-1>t.end){const e=this.pattern.at(this.$el.selectionEnd,this.$el.selectionEnd);this.select(this.pattern.parts[e.index])}else this.select(this.pattern.parts[t.index])}e.preventDefault()},parse(){const e=this.$library.dayjs.interpret(this.$el.value,this.inputType);return this.round(e)},round(e){return e?.round(this.rounding.unit,this.rounding.size)},select(e){e??=this.selection(),this.$el?.setSelectionRange(e.start,e.end+1)},selectFirst(){this.select(this.pattern.parts[0])},selectLast(){this.select(this.pattern.parts[this.pattern.parts.length-1])},selectNext(e){this.select(this.pattern.parts[e+1])},selectPrev(e){this.select(this.pattern.parts[e-1])},selection(){return this.pattern.at(this.$el.selectionStart,this.$el.selectionEnd)},toDatetime(e){return this.round(this.$library.dayjs.iso(e,this.inputType))},toISO(e){return e?.toISO(this.inputType)},validate(){const e=[];this.required&&!this.dt&&e.push(this.$t("error.validation.required")),this.min&&!1===this.dt?.validate(this.min,"min",this.rounding.unit)&&e.push(this.$t("error.validation.date.after",{date:this.min})),this.max&&!1===this.dt?.validate(this.max,"max",this.rounding.unit)&&e.push(this.$t("error.validation.date.before",{date:this.max})),this.$el?.setCustomValidity(e.join(", "))}}},[["render",function(e,t,i,s,o,l){const a=D("direction");return E((n(),h("input",{id:e.id,autofocus:e.autofocus,class:p(["k-string-input",`k-${e.type}-input`,e.$attrs.class]),disabled:e.disabled,placeholder:e.display,required:e.required,style:u(e.$attrs.style),value:o.formatted,autocomplete:"off",spellcheck:"false",type:"text",onBlur:t[0]||(t[0]=(...e)=>l.onBlur&&l.onBlur(...e)),onFocus:t[1]||(t[1]=t=>e.$emit("focus")),onInput:t[2]||(t[2]=e=>l.onInput(e.target.value)),onKeydown:[t[3]||(t[3]=_(S((...e)=>l.onArrowDown&&l.onArrowDown(...e),["stop","prevent"]),["down"])),t[4]||(t[4]=_(S((...e)=>l.onArrowUp&&l.onArrowUp(...e),["stop","prevent"]),["up"])),t[5]||(t[5]=_(S((...e)=>l.onEnter&&l.onEnter(...e),["stop","prevent"]),["enter"])),t[6]||(t[6]=_(S((...e)=>l.onEnter&&l.onEnter(...e),["meta","stop","prevent"]),["s"])),t[7]||(t[7]=_(S((...e)=>l.onEnter&&l.onEnter(...e),["ctrl","stop","prevent"]),["s"])),t[8]||(t[8]=_((...e)=>l.onTab&&l.onTab(...e),["tab"]))]},null,46,qo)),[[a]])}]]),Po={mixins:[Ws,hn,To],inheritAttrs:!1,props:{calendar:{type:Boolean,default:!0},icon:{type:String,default:"calendar"},time:{type:[Boolean,Object],default:()=>({})},times:{type:Boolean,default:!0}},emits:["input","submit"],data(){return{iso:this.toIso(this.value)}},computed:{isEmpty(){return this.time?!this.iso.date||!this.iso.time:!this.iso.date}},watch:{value(e,t){e!==t&&(this.iso=this.toIso(e))}},methods:{focus(){this.$refs.dateInput.focus()},now(){const e=this.$library.dayjs();return{date:e.toISO("date"),time:this.time?e.toISO("time"):"00:00:00"}},onInput(){if(this.isEmpty)return this.$emit("input","");const e=this.$library.dayjs.iso(this.iso.date+" "+this.iso.time);(e||null!==this.iso.date&&null!==this.iso.time)&&this.$emit("input",e?.toISO()??"")},onDateInput(e){e&&!this.iso.time&&(this.iso.time=this.now().time),this.iso.date=e,this.onInput()},onTimeInput(e){e&&!this.iso.date&&(this.iso.date=this.now().date),this.iso.time=e,this.onInput()},onTimesInput(e){this.$refs.times?.close(),this.onTimeInput(e+":00")},toIso(e){const t=this.$library.dayjs.iso(e);return{date:t?.toISO("date")??null,time:t?.toISO("time")??null}}}},No=["data-has-time"];const Fo=Ne(Po,[["render",function(e,i,r,c,d,u){const p=t("k-button"),h=t("k-calendar"),m=t("k-dropdown"),f=t("k-input"),k=t("k-timeoptions-input"),y=t("k-field");return n(),s(y,o(e.$props,{class:["k-date-field",e.$attrs.class],input:e.id,style:e.$attrs.style}),{default:a(()=>[x("div",{ref:"body","data-has-time":Boolean(r.time),class:"k-date-field-body"},[b(f,o({ref:"dateInput"},e.$props,{type:"date",onInput:u.onDateInput,onSubmit:i[1]||(i[1]=t=>e.$emit("submit"))}),l({_:2},[r.calendar&&!e.disabled?{name:"icon",fn:a(()=>[b(p,{icon:r.icon,title:e.$t("date.select"),class:"k-input-icon-button",onClick:i[0]||(i[0]=t=>e.$refs.calendar.toggle())},null,8,["icon","title"]),b(m,{ref:"calendar","align-x":"end"},{default:a(()=>[b(h,{value:d.iso.date,min:e.min,max:e.max,onInput:u.onDateInput},null,8,["value","min","max","onInput"])]),_:1},512)]),key:"0"}:void 0]),1040,["onInput"]),r.time?(n(),s(f,{key:0,ref:"timeInput",disabled:e.disabled,display:r.time.display,required:e.required,step:r.time.step,value:d.iso.time,icon:r.time.icon,type:"time",onInput:u.onTimeInput,onSubmit:i[3]||(i[3]=t=>e.$emit("submit"))},l({_:2},[r.times&&!e.disabled?{name:"icon",fn:a(()=>[b(p,{icon:r.time.icon??"clock",title:e.$t("time.select"),class:"k-input-icon-button",onClick:i[2]||(i[2]=t=>e.$refs.times.toggle())},null,8,["icon","title"]),b(m,{ref:"times","align-x":"end"},{default:a(()=>[b(k,{display:r.time.display,value:e.value,onInput:u.onTimesInput},null,8,["display","value","onInput"])]),_:1},512)]),key:"0"}:void 0]),1032,["disabled","display","required","step","value","icon","onInput"])):g("",!0)],8,No)]),_:1},16,["class","input","style"])}]]),Ro={mixins:[Ao],props:{autocomplete:{type:String,default:"email"},placeholder:{type:String,default:()=>window.panel.t("email.placeholder")}}};const Yo=Ne({mixins:[Mo,Ro],emits:["input"]},[["render",function(e,i,l,a,r,c){const d=t("k-string-input");return n(),s(d,o(e.$props,{type:"email",class:"k-email-input",onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16)}]]);const Ho=Ne({mixins:[Ws,hn,Ro],inheritAttrs:!1,props:{link:{type:Boolean,default:!0},icon:{type:String,default:"email"}},emits:["input"],computed:{mailto(){return this.value?.length>0?"mailto:"+this.value:null}},methods:{focus(){this.$refs.input.focus()}}},[["render",function(e,i,l,r,c,d){const u=t("k-button"),p=t("k-input"),h=t("k-field");return n(),s(h,o(e.$props,{class:["k-email-field",e.$attrs.class],input:e.id,style:e.$attrs.style}),{default:a(()=>[b(p,o(e.$props,{ref:"input",type:"email",onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),{icon:a(()=>[l.link&&d.mailto?(n(),s(u,{key:0,icon:l.icon,link:d.mailto,title:e.$t("open"),class:"k-input-icon-button",tabindex:"-1",target:"_blank"},null,8,["icon","link","title"])):g("",!0)]),_:1},16)]),_:1},16,["class","input","style"])}]]),Uo={mixins:[Ws,hn],inheritAttrs:!1,props:{empty:String,field:{type:Object,default:()=>({})},max:Number,min:Number,sortable:{type:Boolean,default:!0},value:{type:Array,default:()=>[]}},emits:["input","sort"],data:()=>({entries:[]}),computed:{dragOptions(){return{disabled:!1===this.isSortable,handle:!0,list:this.entries,sort:this.isSortable}},isSortable(){return!0!==this.disabled&&(!(this.entries.length<=1)&&!1!==this.sortable)},more(){return!0!==this.disabled&&!(this.max&&this.entries.length>=this.max)},options(){return[{disabled:0===this.entries.length||this.disabled,icon:"template",text:this.$t("copy.all"),click:()=>this.copyAll()},"-",{disabled:0===this.entries.length||this.disabled,icon:"trash",text:this.$t("delete.all"),click:()=>this.removeAll()}]},values(){return this.entries.map(e=>e.value)}},watch:{value:{handler(e){e??=[],JSON.stringify(e)!==JSON.stringify(this.values)&&(this.entries=e.map(e=>({id:this.$helper.uuid(),value:e})))},immediate:!0}},methods:{async add(e=null,t=null){if(!1===this.more||!0===this.disabled)return;t??=this.$helper.field.form({field:this.field})?.field;const i={id:this.$helper.uuid(),value:t??""};e??=this.entries.length,this.entries.splice(e,0,i),this.save(),await this.$nextTick(),this.focus(e)},copyAll(){const e=this.values.map(e=>"- "+e).join("\n");this.$helper.clipboard.write(e),this.$panel.notification.success(this.$t("copy.success"))},async duplicate(e){if(!1===this.more||!0===this.disabled||void 0===this.entries[e])return;const t={...this.entries[e],id:this.$helper.uuid()};this.entries.splice(e+1,0,t),this.save(),await this.$nextTick(),this.focus(e+1)},focus(e,t="input"){this.$refs["entry-"+e+"-"+t]?.[0]?.focus?.()},onInput(e,t){this.entries[e].value=t,this.save()},remove(e){!0!==this.disabled&&(this.entries.splice(e,1),this.save(),this.focus(e-1))},removeAll(){this.$panel.dialog.open({component:"k-remove-dialog",props:{text:this.$t("field.entries.delete.confirm.all")},on:{submit:()=>{this.entries=[],this.save(),this.$panel.dialog.close()}}})},save(){this.$emit("input",this.values)},async sort(e,t){if(!1===this.isSortable)return;const i=this.entries[e];this.entries.splice(e,1),this.entries.splice(e+t,0,i),this.save(),await this.$nextTick(),this.focus(e+t,"sort-handle")},sortDown(e){e>=this.entries.length-1||this.sort(e,1)},sortUp(e){e<=0||this.sort(e,-1)}}},Vo=["value"],Ko={key:0,class:"k-entries-field-footer"};const Wo=Ne(Uo,[["render",function(e,i,r,c,d,u){const p=t("k-button"),y=t("k-dropdown"),C=t("k-button-group"),O=t("k-empty"),A=t("k-draggable"),I=t("k-field");return n(),s(I,o(e.$props,{input:e.id,class:["k-entries-field",e.$attrs.class],style:e.$attrs.style,onClick:i[3]||(i[3]=S(()=>{},["stop"]))}),l({default:a(()=>[x("k-input-validator",o({id:e.id,min:r.min,max:r.max,required:e.required},{value:JSON.stringify(d.entries)}),[0===d.entries.length?(n(),s(O,o({key:0,icon:"list-bullet"},k(e.disabled?{}:{click:()=>u.add()})),{default:a(()=>[v($(r.empty??e.$t("field.entries.empty")),1)]),_:1},16)):(n(),s(A,o({key:1},u.dragOptions,{class:"k-entries-field-items",onSort:u.save}),{default:a(()=>[(n(!0),h(m,null,f(d.entries,(t,i)=>(n(),h("div",{key:t.id,class:"k-entries-field-item"},[u.isSortable?(n(),s(p,{key:0,ref_for:!0,ref:"entry-"+i+"-sort-handle",title:e.$t("sort.drag"),icon:"sort",class:"k-sort-handle k-entries-field-item-sort-handle",size:"sm",onKeydown:[_(e=>u.sortUp(i),["up"]),_(e=>u.sortDown(i),["down"])]},null,8,["title","onKeydown"])):g("",!0),(n(),s(w(`k-${r.field.type}-field`),o({ref_for:!0,ref:"entry-"+i+"-input"},{ref_for:!0},r.field,{disabled:e.disabled,value:t.value,counter:!1,label:!1,class:"k-entries-field-item-input",onInput:e=>u.onInput(i,e)}),null,16,["disabled","value","onInput"])),u.more||!e.disabled?(n(),s(C,{key:1,class:"k-entries-field-item-options",layout:"collapsed"},{default:a(()=>[u.more?(n(),s(p,{key:0,title:e.$t("add"),icon:"add",size:"sm",onClick:e=>u.add(i+1)},null,8,["title","onClick"])):g("",!0),u.more?(n(),s(p,{key:1,title:e.$t("duplicate"),icon:"copy",size:"sm",onClick:e=>u.duplicate(i)},null,8,["title","onClick"])):g("",!0),e.disabled?g("",!0):(n(),s(p,{key:2,title:e.$t("remove"),icon:"trash",size:"sm",onClick:e=>u.remove(i)},null,8,["title","onClick"]))]),_:2},1024)):g("",!0)]))),128))]),_:1},16,["onSort"]))],16,Vo),u.more?(n(),h("footer",Ko,[b(p,{title:e.$t("add"),icon:"add",size:"xs",variant:"filled",onClick:i[2]||(i[2]=e=>u.add())},null,8,["title"])])):g("",!0)]),_:2},[e.disabled?void 0:{name:"options",fn:a(()=>[b(C,{layout:"collapsed"},{default:a(()=>[u.more?(n(),s(p,{key:0,autofocus:e.autofocus,responsive:!0,text:e.$t("add"),icon:"add",variant:"filled",size:"xs",class:"input-focus",onClick:i[0]||(i[0]=e=>u.add())},null,8,["autofocus","text"])):g("",!0),b(p,{icon:"dots",variant:"filled",size:"xs",onClick:i[1]||(i[1]=t=>e.$refs.options.toggle())}),b(y,{ref:"options",options:u.options,"align-x":"end"},null,8,["options"])]),_:1})]),key:"0"}]),1040,["input","class","style"])}]]),Jo={type:"model",mixins:[Ws,Se,De],inheritAttrs:!1,props:{empty:String,info:String,link:Boolean,max:Number,min:Number,multiple:Boolean,parent:String,search:Boolean,size:String,text:String,value:{type:Array,default:()=>[]}},emits:["change","input"],data:()=>({selected:[]}),computed:{buttons(){return[{autofocus:this.autofocus,text:this.$t("select"),icon:"checklist",responsive:!0,click:()=>this.open()}]},collection(){return{empty:this.emptyProps,items:this.selected,layout:this.layout,link:this.link,size:this.size,sortable:!this.disabled&&this.selected.length>1,theme:this.disabled?"disabled":null}},hasDropzone:()=>!1,more(){return!this.max||this.max>this.selected.length}},watch:{value:{handler:"fetch",immediate:!0}},methods:{async fetch(){const e=[],t=[];for(const i of this.value){const s=this.selected.find(e=>this.isItem(e,i));s?e.push(s):(t.push(i),e.push({id:i,theme:"skeleton",image:{icon:"loader"}}))}if(this.selected=e,t.length){const e=await this.$panel.api.get(this.endpoints.field+"/items",{items:t});this.selected=this.selected.map(t=>e.find(e=>this.isItem(e,t))??t)}},drop(){},focus(){},isItem(e,t){return!!e&&(!0===this.$helper.object.isObject(t)&&(t=t.uuid??t.id),e.uuid?e.uuid===t:e.id===t)},onSort(e){this.$emit("input",e.map(e=>e.uuid??e.id))},open(){if(this.disabled)return!1;this.$panel.dialog.open(this.endpoints.field+"/picker",{query:{value:this.value},on:{drop:this.hasDropzone?this.drop:void 0,submit:({ids:e})=>{this.$emit("input",e),this.$panel.dialog.close()}}})},remove(e){this.$emit("input",this.value.toSpliced(e,1))},removeById(e){this.$emit("input",this.value.filter(t=>t!==e))}}},Go=["value"];const Xo=Ne(Jo,[["render",function(e,i,r,c,d,u){const p=t("k-button-group"),h=t("k-button"),m=t("k-collection"),f=t("k-dropzone"),g=t("k-field");return n(),s(g,o(e.$props,{class:["k-models-field",`k-${e.$options.type}-field`,e.$attrs.class],input:!1,style:e.$attrs.style}),l({default:a(()=>[b(f,{disabled:!u.hasDropzone,onDrop:u.drop},{default:a(()=>[x("k-input-validator",o({min:r.min,max:r.max,required:e.required},{value:JSON.stringify(r.value)}),[b(m,o(u.collection,k(e.disabled?{}:{empty:u.open}),{onSort:u.onSort,onSortChange:i[0]||(i[0]=t=>e.$emit("change",t))}),l({_:2},[e.disabled?void 0:{name:"options",fn:a(({index:t})=>[b(h,{title:e.$t("remove"),icon:"remove",onClick:e=>u.remove(t)},null,8,["title","onClick"])]),key:"0"}]),1040,["onSort"])],16,Go)]),_:1},8,["disabled","onDrop"])]),_:2},[e.disabled?void 0:{name:"options",fn:a(()=>[b(p,{ref:"buttons",buttons:u.buttons,layout:"collapsed",size:"xs",variant:"filled",class:"k-field-options"},null,8,["buttons"])]),key:"0"}]),1040,["class","style"])}]]),Zo={extends:Xo,type:"files",props:{uploads:[Boolean,Object,Array]},emits:["change","input"],computed:{buttons(){const e=Xo.computed.buttons.call(this);return this.hasDropzone&&e.unshift({autofocus:this.autofocus,text:this.$t("upload"),responsive:!0,icon:"upload",click:()=>this.$panel.upload.pick(this.uploadOptions)}),e},emptyProps(){return{icon:"image",text:this.empty??(this.multiple&&1!==this.max?this.$t("field.files.empty"):this.$t("field.files.empty.single"))}},hasDropzone(){return!this.disabled&&this.more&&this.uploads},uploadOptions(){return{accept:this.uploads.accept,max:this.max,multiple:this.multiple,preview:this.uploads.preview,url:this.$panel.urls.api+"/"+this.endpoints.field+"/upload",on:{done:async e=>{!1===this.multiple&&(this.selected=[]);for(const i of e)-1===this.selected.findIndex(e=>this.isItem(e,i))&&this.selected.push(i);const t=this.selected.map(e=>e.uuid??e.id);this.$emit("input",t),await this.$panel.content.update(),!0===this.$panel.dialog.isOpen&&await this.$panel.dialog.refresh({query:{...this.$panel.dialog.query,value:t}})}}}}},mounted(){this.$events.on("file.delete",this.removeById)},unmounted(){this.$events.off("file.delete",this.removeById)},methods:{drop(e){return!1!==this.uploads&&this.$panel.upload.open(e,this.uploadOptions)}}},Qo={class:"k-field k-gap-field"};const el=Ne({},[["render",function(e,t){return n(),h("div",Qo)}]]),tl={key:0,class:"k-field-footer"};const il=Ne({mixins:[Ie,_e],inheritAttrs:!1},[["render",function(e,i,s,o,l,r){const c=t("k-headline"),d=t("k-text");return n(),h("div",{class:p(["k-headline-field",e.$attrs.class]),style:u(e.$attrs.style)},[b(c,{class:"h2"},{default:a(()=>[v($(e.label),1)]),_:1}),e.help?(n(),h("footer",tl,[b(d,{class:"k-help k-field-help",html:e.help},null,8,["html"])])):g("",!0)],6)}]]),sl={class:"k-field k-info-field"},nl={key:1,class:"k-field-footer"};const ol=Ne({mixins:[Ie,_e],props:{icon:String,text:String,theme:{type:String,default:"info"}}},[["render",function(e,i,o,l,r,c){const d=t("k-headline"),u=t("k-text"),p=t("k-box");return n(),h("div",sl,[e.label?(n(),s(d,{key:0},{default:a(()=>[v($(e.label),1)]),_:1})):g("",!0),b(p,{icon:o.icon,theme:o.theme},{default:a(()=>[b(u,{html:o.text},null,8,["html"])]),_:1},8,["icon","theme"]),e.help?(n(),h("footer",nl,[b(u,{class:"k-help k-field-help",html:e.help},null,8,["html"])])):g("",!0)])}]]),ll={mixins:[Oe],props:{endpoints:Object,fieldsetGroups:Object,fieldsets:Object,id:String,isSelected:Boolean}},al=["id"];const rl=Ne({mixins:[ll],props:{blocks:Array,width:{type:String,default:"1/1"}},emits:["input"]},[["render",function(e,i,s,l,a,r){const c=t("k-blocks");return n(),h("div",{id:e.id,style:u({"--width":s.width}),tabindex:"0",class:"k-column k-layout-column",onDblclick:i[2]||(i[2]=t=>e.$refs.blocks.choose(s.blocks.length))},[b(c,o({ref:"blocks"},{disabled:e.disabled,endpoints:e.endpoints,fieldsets:e.fieldsets,fieldsetGroups:e.fieldsetGroups,group:"layout",value:s.blocks},{onInput:i[0]||(i[0]=t=>e.$emit("input",t)),onDblclick:i[1]||(i[1]=S(()=>{},["stop"]))}),null,16)],44,al)}]]),cl={mixins:[ll],props:{columns:Array,layouts:{type:Array,default:()=>[["1/1"]]},settings:Object}},dl=["data-disabled","data-selected"],ul={key:0,class:"k-layout-toolbar"};const pl=Ne({mixins:[cl],props:{attrs:[Array,Object]},emits:["append","change","copy","duplicate","paste","prepend","remove","select","updateAttrs","updateColumn"],computed:{options(){return[{click:()=>this.$emit("prepend"),icon:"angle-up",text:this.$t("insert.before")},{click:()=>this.$emit("append"),icon:"angle-down",text:this.$t("insert.after")},"-",{click:()=>this.openSettings(),icon:"settings",text:this.$t("settings"),when:!1===this.$helper.object.isEmpty(this.settings)},{click:()=>this.$emit("duplicate"),icon:"copy",text:this.$t("duplicate")},{click:()=>this.$emit("change"),disabled:1===this.layouts.length,icon:"dashboard",text:this.$t("field.layout.change")},"-",{click:()=>this.$emit("copy"),icon:"template",text:this.$t("copy")},{click:()=>this.$emit("paste"),icon:"download",text:this.$t("paste.after")},"-",{click:()=>this.remove(),icon:"trash",text:this.$t("field.layout.delete")}]},tabs(){let e=this.settings.tabs;for(const[t,i]of Object.entries(e))for(const s in i.fields)e[t].fields[s].endpoints={field:this.endpoints.field+"/fields/"+s,section:this.endpoints.section,model:this.endpoints.model};return e}},methods:{openSettings(){this.$panel.drawer.open({component:"k-form-drawer",props:{icon:"settings",tabs:this.tabs,title:this.$t("settings"),value:this.attrs},on:{input:e=>this.$emit("updateAttrs",e)}})},remove(){this.$panel.dialog.open({component:"k-remove-dialog",props:{text:this.$t("field.layout.delete.confirm")},on:{submit:()=>{this.$emit("remove"),this.$panel.dialog.close()}}})}}},[["render",function(e,i,l,r,c,d){const u=t("k-layout-column"),p=t("k-grid"),k=t("k-sort-handle"),y=t("k-button"),v=t("k-dropdown");return n(),h("section",{"data-disabled":e.disabled,"data-selected":e.isSelected,class:"k-layout",tabindex:"0",onClick:i[1]||(i[1]=t=>e.$emit("select"))},[b(p,{class:"k-layout-columns"},{default:a(()=>[(n(!0),h(m,null,f(e.columns,(t,i)=>(n(),s(u,o({key:t.id},{ref_for:!0},{...t,disabled:e.disabled,endpoints:e.endpoints,fieldsetGroups:e.fieldsetGroups,fieldsets:e.fieldsets},{onInput:s=>e.$emit("updateColumn",{column:t,columnIndex:i,blocks:s})}),null,16,["onInput"]))),128))]),_:1}),e.disabled?g("",!0):(n(),h("nav",ul,[b(k),e.settings?(n(),s(y,{key:0,title:e.$t("settings"),class:"k-layout-toolbar-button",icon:"settings",onClick:d.openSettings},null,8,["title","onClick"])):g("",!0),b(y,{class:"k-layout-toolbar-button",icon:"angle-down",onClick:i[0]||(i[0]=t=>e.$refs.options.toggle())}),b(v,{ref:"options",options:d.options,"align-x":"end"},null,8,["options"])]))],8,dl)}]]),hl={mixins:[cl,Me],props:{empty:String,min:Number,max:Number,selector:Object,value:{type:Array,default:()=>[]}}};const ml=Ne({mixins:[hl],emits:["input"],data(){return{current:null,nextIndex:null,rows:this.value,selected:null}},computed:{draggableOptions(){return{handle:!0,list:this.rows}},hasFieldsets(){return this.$helper.object.length(this.fieldsets)>0}},watch:{value(){this.rows=this.value}},methods:{copy(e,t){if(0===this.rows.length)return!1;const i=void 0!==t?this.rows[t]:this.rows;this.$helper.clipboard.write(JSON.stringify(i),e),this.$panel.notification.success({message:this.$t("copy.success.multiple",{count:i.length??1}),icon:"template"})},change(e,t){const i=t.columns.map(e=>e.width),s=this.layouts.findIndex(e=>e.toString()===i.toString());this.$panel.dialog.open({component:"k-layout-selector",props:{label:this.$t("field.layout.change"),layouts:this.layouts,selector:this.selector,value:this.layouts[s]},on:{submit:i=>{this.onChange(i,s,{rowIndex:e,layoutIndex:s,layout:t}),this.$panel.dialog.close()}}})},duplicate(e,t){const i=this.$helper.object.clone(t),s=this.updateIds(i);this.rows.splice(e+1,0,...s),this.save()},async onAdd(e){let t=await this.$api.post(this.endpoints.field+"/layout",{columns:e});this.rows.splice(this.nextIndex,0,t),this.save()},async onChange(e,t,i){if(t===this.layouts[i.layoutIndex])return;const s=i.layout,n=await this.$api.post(this.endpoints.field+"/layout",{attrs:s.attrs,columns:e}),o=s.columns.filter(e=>e?.blocks?.length>0),l=[];if(0===o.length)l.push(n);else{const e=Math.ceil(o.length/n.columns.length)*n.columns.length;for(let t=0;t<e;t+=n.columns.length){const e={...this.$helper.object.clone(n),id:this.$helper.uuid()};e.columns=e.columns.map((e,i)=>(e.blocks=o[i+t]?.blocks??[],e)),e.columns.filter(e=>e?.blocks?.length).length&&l.push(e)}}this.rows.splice(i.rowIndex,1,...l),this.save()},async paste(e,t=this.rows.length){let i=await this.$api.post(this.endpoints.field+"/layout/paste",{json:this.$helper.clipboard.read(e)});i.length&&(this.rows.splice(t,0,...i),this.save()),this.$panel.notification.success({message:this.$t("paste.success",{count:i.length}),icon:"download"})},pasteboard(e){this.$panel.dialog.open({component:"k-block-pasteboard",on:{paste:t=>this.paste(t,e)}})},remove(e){const t=this.rows.findIndex(t=>t.id===e.id);-1!==t&&this.rows.splice(t,1),this.save()},removeAll(){this.$panel.dialog.open({component:"k-remove-dialog",props:{text:this.$t("field.layout.delete.confirm.all")},on:{submit:()=>{this.rows=[],this.save(),this.$panel.dialog.close()}}})},save(){this.$emit("input",this.rows)},select(e){if(this.nextIndex=e,1===this.layouts.length)return this.onAdd(this.layouts[0]);this.$panel.dialog.open({component:"k-layout-selector",props:{layouts:this.layouts,selector:this.selector,value:null},on:{submit:e=>{this.onAdd(e),this.$panel.dialog.close()}}})},updateAttrs(e,t){this.rows[e].attrs=t,this.save()},updateColumn(e){this.rows[e.index].columns[e.columnIndex].blocks=e.blocks,this.save()},updateIds(e){return!1===Array.isArray(e)&&(e=[e]),e.map(e=>(e.id=this.$helper.uuid(),e.columns=e.columns.map(e=>(e.id=this.$helper.uuid(),e.blocks=e.blocks.map(e=>(e.id=this.$helper.uuid(),e)),e)),e))}}},[["render",function(e,i,l,r,c,d){const u=t("k-layout"),p=t("k-draggable"),g=t("k-empty");return n(),h("div",null,[d.hasFieldsets&&c.rows.length?(n(),s(p,o({key:0},d.draggableOptions,{class:"k-layouts",onSort:d.save}),{default:a(()=>[(n(!0),h(m,null,f(c.rows,(t,i)=>(n(),s(u,o({key:t.id},{ref_for:!0},{...t,disabled:e.disabled,endpoints:e.endpoints,fieldsetGroups:e.fieldsetGroups,fieldsets:e.fieldsets,isSelected:c.selected===t.id,layouts:e.layouts,settings:e.settings},{onAppend:e=>d.select(i+1),onChange:e=>d.change(i,t),onCopy:e=>d.copy(e,i),onDuplicate:e=>d.duplicate(i,t),onPaste:e=>d.pasteboard(i+1),onPrepend:e=>d.select(i),onRemove:e=>d.remove(t),onSelect:e=>c.selected=t.id,onUpdateAttrs:e=>d.updateAttrs(i,e),onUpdateColumn:e=>d.updateColumn({layout:t,index:i,...e})}),null,16,["onAppend","onChange","onCopy","onDuplicate","onPaste","onPrepend","onRemove","onSelect","onUpdateAttrs","onUpdateColumn"]))),128))]),_:1},16,["onSort"])):!1===d.hasFieldsets?(n(),s(g,{key:1,icon:"dashboard",class:"k-layout-empty"},{default:a(()=>[v($(e.$t("field.blocks.fieldsets.empty")),1)]),_:1})):(n(),s(g,o({key:2,icon:"dashboard",class:"k-layout-empty"},k(e.disabled?{}:{click:()=>d.select(0)})),{default:a(()=>[v($(e.empty??e.$t("field.layout.empty")),1)]),_:1},16))])}]]),fl=["value"],gl={key:0};const kl=Ne({mixins:[Ws,hl,Se],inheritAttrs:!1,emits:["input"],computed:{hasFieldsets(){return this.$helper.object.length(this.fieldsets)>0},isEmpty(){return 0===this.value.length},options(){return[{click:()=>this.$refs.layouts.copy(),disabled:this.isEmpty,icon:"template",text:this.$t("copy.all")},{click:()=>this.$refs.layouts.pasteboard(),icon:"download",text:this.$t("paste")},"-",{click:()=>this.$refs.layouts.removeAll(),disabled:this.isEmpty,icon:"trash",text:this.$t("delete.all")}]}}},[["render",function(e,i,r,c,d,u){const p=t("k-button"),m=t("k-dropdown"),f=t("k-button-group"),k=t("k-layouts"),y=t("k-field");return n(),s(y,o(e.$props,{input:e.id,class:["k-layout-field",e.$attrs.class],style:e.$attrs.style}),l({default:a(()=>[x("k-input-validator",o({id:e.id,min:e.min,max:e.max,required:e.required},{value:JSON.stringify(e.value)}),[b(k,o({ref:"layouts"},e.$props,{onInput:i[2]||(i[2]=t=>e.$emit("input",t))}),null,16)],16,fl),!e.disabled&&u.hasFieldsets?(n(),h("footer",gl,[b(p,{title:e.$t("add"),icon:"add",size:"xs",variant:"filled",onClick:i[3]||(i[3]=t=>e.$refs.layouts.select(e.value.length))},null,8,["title"])])):g("",!0)]),_:2},[!e.disabled&&u.hasFieldsets?{name:"options",fn:a(()=>[b(f,{layout:"collapsed"},{default:a(()=>[b(p,{autofocus:e.autofocus,text:e.$t("add"),icon:"add",variant:"filled",size:"xs",class:"input-focus",onClick:i[0]||(i[0]=t=>e.$refs.layouts.select(0))},null,8,["autofocus","text"]),b(p,{icon:"dots",variant:"filled",size:"xs",onClick:i[1]||(i[1]=t=>e.$refs.options.toggle())}),b(m,{ref:"options",options:u.options,"align-x":"end"},null,8,["options"])]),_:1})]),key:"0"}:void 0]),1040,["input","class","style"])}]]),bl={class:"k-line-field"};const yl=Ne({},[["render",function(e,t,i,s,o,l){return n(),h("hr",bl)}]]),vl={class:"k-link-input-header"},$l={key:0,"data-type":"page",class:"k-link-input-body"},wl={class:"k-page-browser"},xl={key:1,"data-type":"file",class:"k-link-input-body"};const Sl=Ne({mixins:[{mixins:[Ws,hn,bs,Be],props:{value:{default:"",type:String}}}],inheritAttrs:!1,emits:["input"],data:()=>({linkType:null,linkValue:null,expanded:!1}),computed:{activeTypes(){return this.$helper.link.types(this.options)},activeTypesOptions(){const e=[];for(const t in this.activeTypes)e.push({click:()=>this.switchType(t),current:t===this.currentType.id,icon:this.activeTypes[t].icon,label:this.activeTypes[t].label});return e},currentType(){return this.activeTypes[this.linkType]??Object.values(this.activeTypes)[0]}},watch:{value:{async handler(e,t){if(e===t||e===this.linkValue)return;const i=this.$helper.link.detect(e,this.activeTypes);i&&(this.linkType=i.type,this.linkValue=i.link)},immediate:!0}},mounted(){this.$events.on("click",this.onOutsideClick)},unmounted(){this.$events.off("click",this.onOutsideClick)},methods:{clear(){this.linkValue="",this.$emit("input","")},focus(){this.$refs.input?.focus()},onInput(e){const t=e?.trim()??"";if(this.linkType??=this.currentType.id,this.linkValue=t,!t.length)return this.clear();this.$emit("input",this.currentType.value(t))},onOutsideClick(e){!1===this.$el.contains(e.target)&&(this.expanded=!1)},removeModel(){this.clear(),this.expanded=!1},selectModel(e){e.uuid?this.onInput(e.uuid):(this.switchType("url"),this.onInput(e.url))},async switchType(e){e!==this.currentType.id&&(this.linkType=e,this.clear(),"page"===this.currentType.id||"file"===this.currentType.id?this.expanded=!0:this.expanded=!1,await this.$nextTick(),this.focus())},toggle(){this.expanded=!this.expanded}}},[["render",function(e,i,l,r,c,d){const u=t("k-button"),p=t("k-dropdown"),m=t("k-link-field-preview"),f=t("k-page-tree"),k=t("k-file-browser"),y=t("k-input"),S=t("k-field");return n(),s(S,o(e.$props,{class:["k-link-field",e.$attrs.class],input:e.id,style:e.$attrs.style}),{default:a(()=>[b(y,o(e.$props,{icon:!1}),{default:a(()=>[x("div",vl,[b(u,{class:"k-link-input-toggle",disabled:e.disabled,dropdown:!e.disabled&&d.activeTypesOptions.length>1,icon:d.currentType.icon,variant:"filled",onClick:i[0]||(i[0]=t=>d.activeTypesOptions.length>1?e.$refs.types.toggle():d.toggle())},{default:a(()=>[v($(d.currentType.label),1)]),_:1},8,["disabled","dropdown","icon"]),b(p,{ref:"types",options:d.activeTypesOptions},null,8,["options"]),"page"===d.currentType.id||"file"===d.currentType.id?(n(),h("div",{key:0,class:"k-link-input-model",onClick:i[1]||(i[1]=(...e)=>d.toggle&&d.toggle(...e))},[b(m,{removable:!0,type:d.currentType.id,value:e.value,onRemove:d.removeModel},{placeholder:a(()=>[b(u,{class:"k-link-input-model-placeholder"},{default:a(()=>[v($(d.currentType.placeholder),1)]),_:1})]),_:1},8,["type","value","onRemove"]),b(u,{class:"k-link-input-model-toggle",icon:"bars"})])):(n(),s(w("k-"+d.currentType.input+"-input"),{key:1,id:e.id,ref:"input",disabled:e.disabled,pattern:d.currentType.pattern??null,placeholder:d.currentType.placeholder,required:e.required,value:c.linkValue,onInput:d.onInput},null,40,["id","disabled","pattern","placeholder","required","value","onInput"]))]),"page"===d.currentType.id?E((n(),h("div",$l,[x("div",wl,[b(f,{current:e.$helper.link.getPageUUID(e.value),root:!1,onSelect:i[2]||(i[2]=e=>d.selectModel(e))},null,8,["current"])])],512)),[[j,c.expanded]]):"file"===d.currentType.id?E((n(),h("div",xl,[b(k,{opened:e.$panel.view.props.uuid??e.$panel.view.props.id,selected:e.$helper.link.getFileUUID(e.value),onSelect:i[3]||(i[3]=e=>d.selectModel(e))},null,8,["opened","selected"])],512)),[[j,c.expanded]]):g("",!0)]),_:1},16)]),_:1},16,["class","input","style"])}]]);const Cl=e=>({$from:t})=>((e,t)=>{for(let i=e.depth;i>0;i--){const s=e.node(i);if(t(s))return{pos:i>0?e.before(i):0,start:e.start(i),depth:i,node:s}}})(t,e),Ol=e=>t=>{if((e=>e instanceof R)(t)){const{node:i,$from:s}=t;if(((e,t)=>Array.isArray(e)&&e.indexOf(t.type)>-1||t.type===e)(e,i))return{node:i,pos:s.pos,depth:s.depth}}},Al=(e,t,i={})=>{const s=Ol(t)(e.selection)||Cl(e=>e.type===t)(e.selection);return 0!==pt(i)&&s?s.node.hasMarkup(t,{...s.node.attrs,...i}):!!s};function Il(e=null,t=null){if(!e||!t)return!1;const i=e.parent.childAfter(e.parentOffset);if(!i.node)return!1;const s=i.node.marks.find(e=>e.type===t);if(!s)return!1;let n=e.index(),o=e.start()+i.offset,l=n+1,a=o+i.node.nodeSize;for(;n>0&&s.isInSet(e.parent.child(n-1).marks);)n-=1,o-=e.parent.child(n).nodeSize;for(;l<e.parent.childCount&&s.isInSet(e.parent.child(l).marks);)a+=e.parent.child(l).nodeSize,l+=1;return{from:o,to:a}}function Ml(e,t){return e.type===t.nodes.bulletList||e.type===t.nodes.orderedList||e.type===t.nodes.todoList}const _l={chainCommands:te,exitCode:ee,lift:V,setBlockType:Y,toggleMark:Q,wrapIn:K,wrappingInputRule:Z,textblockTypeInputRule:X,addListNodes:G,wrapInList:U,splitListItem:J,liftListItem:H,sinkListItem:W,getMarkAttrs:function(e,t){const{from:i,to:s}=e.selection;let n=[];e.doc.nodesBetween(i,s,e=>{n=[...n,...e.marks]});const o=n.find(e=>e.type.name===t.name);return o?o.attrs:{}},getNodeAttrs:function(e,t){const{from:i,to:s}=e.selection;let n=[];e.doc.nodesBetween(i,s,e=>{n=[...n,e]});const o=n.reverse().find(e=>e.type.name===t.name);return o?o.attrs:{}},insertNode:function(e,t,i,s){return(n,o)=>{o(n.tr.replaceSelectionWith(e.create(t,i,s)).scrollIntoView())}},markInputRule:function(e,t,i){return new z(e,(e,s,n,o)=>{const l=i instanceof Function?i(s):i,{tr:a}=e,r=s.length-1;let c=o,d=n;if(s[r]){const i=n+s[0].indexOf(s[r-1]),l=i+s[r-1].length-1,u=i+s[r-1].lastIndexOf(s[r]),p=u+s[r].length,h=function(e,t,i){let s=[];return i.doc.nodesBetween(e,t,(e,t)=>{s=[...s,...e.marks.map(i=>({start:t,end:t+e.nodeSize,mark:i}))]}),s}(n,o,e).filter(e=>{const{excluded:i}=e.mark.type;return i.find(e=>e.name===t.name)}).filter(e=>e.end>i);if(h.length)return!1;p<l&&a.delete(p,l),u>i&&a.delete(i,u),d=i,c=d+s[r].length}return a.addMark(d,c,t.create(l)),a.removeStoredMark(t),a})},markIsActive:function(e,t){const{from:i,$from:s,to:n,empty:o}=e.selection;return o?!!t.isInSet(e.storedMarks||s.marks()):!!e.doc.rangeHasMark(i,n,t)},markPasteRule:function(e,t,i){const s=(n,o)=>{const l=[];return n.forEach(n=>{if(n.isText){const{text:s,marks:a}=n;let r,c=0;const d=!!a.filter(e=>"link"===e.type.name)[0];for(;!d&&null!==(r=e.exec(s));)if(o?.type?.allowsMarkType(t)&&r[1]){const e=r.index,s=e+r[0].length,o=e+r[0].indexOf(r[1]),a=o+r[1].length,d=i instanceof Function?i(r):i;e>0&&l.push(n.cut(c,e)),l.push(n.cut(o,a).mark(t.create(d).addToSet(n.marks))),c=s}c<s.length&&l.push(n.cut(c))}else l.push(n.copy(s(n.content,n)))}),F.fromArray(l)};return new P({props:{transformPasted:e=>new N(s(e.content),e.openStart,e.openEnd)}})},minMax:function(e=0,t=0,i=0){return Math.min(Math.max(parseInt(e,10),t),i)},nodeIsActive:Al,nodeInputRule:function(e,t,i){return new z(e,(e,s,n,o)=>{const l=i instanceof Function?i(s):i,{tr:a}=e;return s[0]&&a.replaceWith(n,o,t.create(l)),a})},pasteRule:function(e,t,i){const s=n=>{const o=[];return n.forEach(n=>{if(n.isText){const{text:s}=n;let l,a=0;do{if(l=e.exec(s),l){const e=l.index,s=e+l[0].length,r=i instanceof Function?i(l[0]):i;e>0&&o.push(n.cut(a,e)),o.push(n.cut(e,s).mark(t.create(r).addToSet(n.marks))),a=s}}while(l);a<s.length&&o.push(n.cut(a))}else o.push(n.copy(s(n.content)))}),F.fromArray(o)};return new P({props:{transformPasted:e=>new N(s(e.content),e.openStart,e.openEnd)}})},removeMark:function(e){return(t,i)=>{const{tr:s,selection:n}=t;let{from:o,to:l}=n;const{$from:a,empty:r}=n;if(r){const t=Il(a,e);o=t.from,l=t.to}return s.removeMark(o,l,e),i(s)}},toggleBlockType:function(e,t,i={}){return(s,n,o)=>Al(s,e,i)?Y(t)(s,n,o):Y(e,i)(s,n,o)},toggleList:function(e,t){return(i,s,n)=>{const{schema:o,selection:l}=i,{$from:a,$to:r}=l,c=a.blockRange(r);if(!c)return!1;const d=Cl(e=>Ml(e,o))(l);if(c.depth>=1&&d&&c.depth-d.depth<=1){if(d.node.type===e)return H(t)(i,s,n);if(Ml(d.node,o)&&e.validContent(d.node.content)){const{tr:t}=i;return t.setNodeMarkup(d.pos,e),s&&s(t),!1}}return U(e)(i,s,n)}},toggleWrap:function(e,t={}){return(i,s,n)=>Al(i,e,t)?V(i,s):K(e,t)(i,s,n)},updateMark:function(e,t){return(i,s)=>{const{tr:n,selection:o,doc:l}=i,{ranges:a,empty:r}=o;if(r){const{from:i,to:s}=Il(o.$from,e);l.rangeHasMark(i,s,e)&&n.removeMark(i,s,e),n.addMark(i,s,e.create(t))}else a.forEach(i=>{const{$to:s,$from:o}=i;l.rangeHasMark(o.pos,s.pos,e)&&n.removeMark(o.pos,s.pos,e),n.addMark(o.pos,s.pos,e.create(t))});return s(n)}}};class Dl{emit(e,...t){this._callbacks??={};const i=this._callbacks[e]??[];for(const s of i)s.apply(this,t);return this}off(e,t){if(arguments.length){const i=this._callbacks?this._callbacks[e]:null;i&&(t?this._callbacks[e]=i.filter(e=>e!==t):delete this._callbacks[e])}else this._callbacks={};return this}on(e,t){return this._callbacks??={},this._callbacks[e]??=[],this._callbacks[e].push(t),this}}class El{constructor(e=[],t){for(const i of e)i.bindEditor(t),i.init();this.extensions=e}commands({schema:e,view:t}){return this.extensions.filter(e=>e.commands).reduce((i,s)=>{const{name:n,type:o}=s,l={},a=s.commands({schema:e,utils:_l,...["node","mark"].includes(o)?{type:e[`${o}s`][n]}:{}}),r=(e,i)=>{l[e]=e=>{if("function"!=typeof i||!t.editable)return!1;t.focus();const s=i(e);return"function"==typeof s?s(t.state,t.dispatch,t):s}};if("object"==typeof a)for(const[e,t]of Object.entries(a))r(e,t);else r(n,a);return{...i,...l}},{})}buttons(e="mark"){const t={};for(const i of this.extensions)if(i.type===e&&i.button)if(Array.isArray(i.button))for(const e of i.button)t[e.id??e.name]=e;else t[i.name]={name:i.name,...i.button};return t}getAllowedExtensions(e){return e instanceof Array||!e?e instanceof Array?this.extensions.filter(t=>!e.includes(t.name)):this.extensions:[]}getFromExtensions(e,t,i=this.extensions){return i.filter(e=>["extension"].includes(e.type)).filter(t=>t[e]).map(i=>i[e]({...t,utils:_l}))}getFromNodesAndMarks(e,t,i=this.extensions){return i.filter(e=>["node","mark"].includes(e.type)).filter(t=>t[e]).map(i=>i[e]({...t,type:t.schema[`${i.type}s`][i.name],utils:_l}))}inputRules({schema:e,excludedExtensions:t}){const i=this.getAllowedExtensions(t);return[...this.getFromExtensions("inputRules",{schema:e},i),...this.getFromNodesAndMarks("inputRules",{schema:e},i)].reduce((e,t)=>[...e,...t],[])}keymaps({schema:e}){return[...this.getFromExtensions("keys",{schema:e}),...this.getFromNodesAndMarks("keys",{schema:e})].map(e=>ie(e))}get marks(){return this.extensions.filter(e=>"mark"===e.type).reduce((e,{name:t,schema:i})=>({...e,[t]:i}),{})}get markViews(){return this.extensions.filter(e=>["mark"].includes(e.type)).filter(e=>e.view).reduce((e,{name:t,view:i})=>({...e,[t]:i}),{})}get nodes(){return this.extensions.filter(e=>"node"===e.type).reduce((e,{name:t,schema:i})=>({...e,[t]:i}),{})}get nodeViews(){return this.extensions.filter(e=>["node"].includes(e.type)).filter(e=>e.view).reduce((e,{name:t,view:i})=>({...e,[t]:i}),{})}get options(){const{view:e}=this;return this.extensions.reduce((t,i)=>({...t,[i.name]:new Proxy(i.options,{set(t,i,s){const n=t[i]!==s;return Object.assign(t,{[i]:s}),n&&e.updateState(e.state),!0}})}),{})}pasteRules({schema:e,excludedExtensions:t}){const i=this.getAllowedExtensions(t);return[...this.getFromExtensions("pasteRules",{schema:e},i),...this.getFromNodesAndMarks("pasteRules",{schema:e},i)].reduce((e,t)=>[...e,...t],[])}plugins({schema:e}){return[...this.getFromExtensions("plugins",{schema:e}),...this.getFromNodesAndMarks("plugins",{schema:e})].reduce((e,t)=>[...e,...t],[]).map(e=>e instanceof P?e:new P(e))}}class jl{constructor(e={}){this.options={...this.defaults,...e}}init(){return null}bindEditor(e=null){this.editor=e}get name(){return null}get type(){return"extension"}get defaults(){return{}}plugins(){return[]}inputRules(){return[]}pasteRules(){return[]}keys(){return{}}}class Ll extends jl{constructor(e={}){super(e)}get type(){return"node"}get schema(){return{}}commands(){return{}}}class Bl extends Ll{get defaults(){return{inline:!1}}get name(){return"doc"}get schema(){return{content:this.options.inline?"inline*":"block+"}}}class Tl extends Ll{get button(){return{id:this.name,icon:"paragraph",label:window.panel.$t("toolbar.button.paragraph"),name:this.name,separator:!0}}commands({utils:e,schema:t,type:i}){return{paragraph:()=>this.editor.activeNodes.includes("bulletList")?e.toggleList(t.nodes.bulletList,t.nodes.listItem):this.editor.activeNodes.includes("orderedList")?e.toggleList(t.nodes.orderedList,t.nodes.listItem):this.editor.activeNodes.includes("quote")?e.toggleWrap(t.nodes.quote):e.setBlockType(i)}}get schema(){return{content:"inline*",group:"block",draggable:!1,parseDOM:[{tag:"p"}],toDOM:()=>["p",0]}}get name(){return"paragraph"}}let ql=class extends Ll{get name(){return"text"}get schema(){return{group:"inline"}}};class zl extends Dl{constructor(e={}){super(),this.defaults={autofocus:!1,content:"",disableInputRules:!1,disablePasteRules:!1,editable:!0,element:null,extensions:[],emptyDocument:{type:"doc",content:[]},events:{},inline:!1,parseOptions:{},topNode:"doc",useBuiltInExtensions:!0},this.init(e)}get activeMarks(){return this.active.marks}get activeNodes(){return this.active.nodes}get activeMarkAttrs(){return this.active.markAttrs}get activeNodeAttrs(){return this.active.nodeAttrs}blur(){this.view.dom.blur()}get builtInExtensions(){return!0!==this.options.useBuiltInExtensions?[]:[new Bl({inline:this.options.inline}),new ql,new Tl]}buttons(e){return this.extensions.buttons(e)}clearContent(e=!1){this.setContent(this.options.emptyDocument,e)}command(e,...t){this.commands[e]?.(...t)}createCommands(){return this.extensions.commands({schema:this.schema,view:this.view})}createDocument(e,t=this.options.parseOptions){if(null===e)return this.schema.nodeFromJSON(this.options.emptyDocument);if("object"==typeof e)try{return this.schema.nodeFromJSON(e)}catch(i){return window.console.warn("Invalid content.","Passed value:",e,"Error:",i),this.schema.nodeFromJSON(this.options.emptyDocument)}if("string"==typeof e){const i=`<div>${e}</div>`,s=(new window.DOMParser).parseFromString(i,"text/html").body.firstElementChild;return se.fromSchema(this.schema).parse(s,t)}return!1}createEvents(){const e=this.options.events??{};for(const[t,i]of Object.entries(e))this.on(t,i);return e}createExtensions(){return new El([...this.builtInExtensions,...this.options.extensions],this)}createFocusEvents(){const e=(e,t,i=!0)=>{this.focused=i,this.emit(i?"focus":"blur",{event:t,state:e.state,view:e});const s=this.state.tr.setMeta("focused",i);this.view.dispatch(s)};return new P({props:{attributes:{tabindex:0},handleDOMEvents:{focus:(t,i)=>e(t,i,!0),blur:(t,i)=>e(t,i,!1)}}})}createInputRules(){return this.extensions.inputRules({schema:this.schema,excludedExtensions:this.options.disableInputRules})}createKeymaps(){return this.extensions.keymaps({schema:this.schema})}createMarks(){return this.extensions.marks}createMarkViews(){return this.extensions.markViews}createNodes(){return this.extensions.nodes}createNodeViews(){return this.extensions.nodeViews}createPasteRules(){return this.extensions.pasteRules({schema:this.schema,excludedExtensions:this.options.disablePasteRules})}createPlugins(){return this.extensions.plugins({schema:this.schema})}createSchema(){return new ne({topNode:this.options.topNode,nodes:this.nodes,marks:this.marks})}createState(){return oe.create({schema:this.schema,doc:this.createDocument(this.options.content),plugins:[...this.plugins,le({rules:this.inputRules}),...this.pasteRules,...this.keymaps,ie({Backspace:de}),ie(ue),this.createFocusEvents()]})}createView(){return new ae(this.element,{dispatchTransaction:this.dispatchTransaction.bind(this),attributes:{class:"k-text"},editable:()=>this.options.editable,handlePaste:(e,t)=>{if("function"==typeof this.events.paste){const e=t.clipboardData.getData("text/html"),i=t.clipboardData.getData("text/plain");if(!0===this.events.paste(t,e,i))return!0}},handleDrop:(...e)=>{this.emit("drop",...e)},markViews:this.createMarkViews(),nodeViews:this.createNodeViews(),state:this.createState()})}destroy(){this.view&&this.view.destroy()}dispatchTransaction(e){const t=this.state,i=this.state.apply(e);this.view.updateState(i),this.setActiveNodesAndMarks();const s={editor:this,getHTML:this.getHTML.bind(this),getJSON:this.getJSON.bind(this),state:this.state,transaction:e};this.emit("transaction",s),e.docChanged&&!e.getMeta("preventUpdate")&&e.steps.length>0&&this.emit("update",s);const{from:n,to:o}=this.state.selection,l=!t||!t.selection.eq(i.selection);this.emit(i.selection.empty?"deselect":"select",{...s,from:n,hasChanged:l,to:o})}focus(e=null){if(this.view.focused&&null===e||!1===e)return;const{from:t,to:i}=this.selectionAtPosition(e);this.setSelection(t,i),setTimeout(()=>this.view.focus(),10)}getHTML(e=this.state.doc.content){const t=document.createElement("div"),i=re.fromSchema(this.schema).serializeFragment(e);return t.appendChild(i),this.options.inline&&t.querySelector("p")?t.querySelector("p").innerHTML:t.innerHTML}getHTMLStartToSelection(){const e=this.state.doc.slice(0,this.selection.head).content;return this.getHTML(e)}getHTMLSelectionToEnd(){const e=this.state.doc.slice(this.selection.head).content;return this.getHTML(e)}getHTMLStartToSelectionToEnd(){return[this.getHTMLStartToSelection(),this.getHTMLSelectionToEnd()]}getJSON(){return this.state.doc.toJSON()}getMarkAttrs(e=null){return this.activeMarkAttrs[e]}getSchemaJSON(){return JSON.parse(JSON.stringify({nodes:this.nodes,marks:this.marks}))}init(e={}){this.options={...this.defaults,...e},this.element=this.options.element,this.focused=!1,this.active=L({marks:[],nodes:[],markAttrs:{},nodeAttrs:{}}),this.events=this.createEvents(),this.extensions=this.createExtensions(),this.nodes=this.createNodes(),this.marks=this.createMarks(),this.schema=this.createSchema(),this.keymaps=this.createKeymaps(),this.inputRules=this.createInputRules(),this.pasteRules=this.createPasteRules(),this.plugins=this.createPlugins(),this.view=this.createView(),this.commands=this.createCommands(),this.setActiveNodesAndMarks(),!1!==this.options.autofocus&&this.focus(this.options.autofocus),this.emit("init",{view:this.view,state:this.state}),this.extensions.view=this.view,this.setContent(this.options.content)}insertText(e,t=!1){const{tr:i}=this.state,s=i.insertText(e);if(this.view.dispatch(s),t){const t=i.selection.from,s=t-e.length;this.setSelection(s,t)}}get isActive(){return Object.entries({...this.active.marks,...this.active.nodes}).reduce((e,[t,i])=>({...e,[t]:(e={})=>i(e)}),{})}isEditable(){return this.options.editable}isEmpty(){if(this.state)return 0===this.state.doc.textContent.length}removeMark(e){if(this.schema.marks[e])return _l.removeMark(this.schema.marks[e])(this.state,this.view.dispatch)}get selection(){return this.state.selection}get selectionAtEnd(){return ce.atEnd(this.state.doc)}get selectionIsAtEnd(){return this.selection.head===this.selectionAtEnd.head}get selectionAtStart(){return ce.atStart(this.state.doc)}get selectionIsAtStart(){return this.selection.head===this.selectionAtStart.head}selectionAtPosition(e=null){return null===e?this.selection:"start"===e||!0===e?this.selectionAtStart:"end"===e?this.selectionAtEnd:{from:e,to:e}}setActiveNodesAndMarks(){this.active.marks=Object.values(this.schema.marks).filter(e=>_l.markIsActive(this.state,e)).map(e=>e.name),this.active.markAttrs=Object.entries(this.schema.marks).reduce((e,[t,i])=>({...e,[t]:_l.getMarkAttrs(this.state,i)}),{}),this.active.nodes=Object.values(this.schema.nodes).filter(e=>_l.nodeIsActive(this.state,e)).map(e=>e.name),this.active.nodeAttrs=Object.entries(this.schema.nodes).reduce((e,[t,i])=>({...e,[t]:_l.getNodeAttrs(this.state,i)}),{})}setContent(e={},t=!1,i){const{doc:s,tr:n}=this.state,o=this.createDocument(e,i),l=n.replaceWith(0,s.content.size,o).setMeta("preventUpdate",!t);this.view.dispatch(l)}setSelection(e=0,t=0){const{doc:i,tr:s}=I(this.state),n=_l.minMax(e,0,i.content.size),o=_l.minMax(t,0,i.content.size),l=ce.create(i,n,o),a=s.setSelection(l);this.view.dispatch(a)}get state(){return this.view?.state}toggleMark(e){if(this.schema.marks[e])return _l.toggleMark(this.schema.marks[e])(this.state,this.view.dispatch)}updateMark(e,t){if(this.schema.marks[e])return _l.updateMark(this.schema.marks[e],t)(this.state,this.view.dispatch)}}class Pl extends jl{command(){return()=>{}}remove(){this.editor.removeMark(this.name)}get schema(){return{}}get type(){return"mark"}toggle(){return this.editor.toggleMark(this.name)}update(e){this.editor.updateMark(this.name,e)}}class Nl extends Pl{get button(){return{icon:"bold",label:window.panel.$t("toolbar.button.bold")}}commands(){return()=>this.toggle()}inputRules({type:e,utils:t}){return[t.markInputRule(/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,e),t.markInputRule(/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,e)]}keys(){return{"Mod-b":()=>this.toggle()}}get name(){return"bold"}pasteRules({type:e,utils:t}){return[t.markPasteRule(/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,e),t.markPasteRule(/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,e)]}get schema(){return{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:e=>"normal"!==e.style.fontWeight&&null},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}],toDOM:()=>["strong",0]}}}class Fl extends Pl{get button(){return{icon:"clear",label:window.panel.$t("toolbar.button.clear")}}commands(){return()=>this.clear()}clear(){const{state:e}=this.editor,{from:t,to:i}=e.tr.selection;for(const s of this.editor.activeMarks){const n=e.schema.marks[s],o=this.editor.state.tr.removeMark(t,i,n);this.editor.view.dispatch(o)}}get name(){return"clear"}}let Rl=class extends Pl{get button(){return{icon:"code",label:window.panel.$t("toolbar.button.code")}}commands(){return()=>this.toggle()}inputRules({type:e,utils:t}){return[t.markInputRule(/(?:`)([^`]+)(?:`)$/,e)]}keys(){return{"Mod-`":()=>this.toggle()}}get name(){return"code"}pasteRules({type:e,utils:t}){return[t.markPasteRule(/(?:`)([^`]+)(?:`)/g,e)]}get schema(){return{excludes:"_",parseDOM:[{tag:"code"}],toDOM:()=>["code",0]}}};class Yl extends Pl{get button(){return{icon:"email",label:window.panel.$t("toolbar.button.email")}}commands(){return{email:e=>{if(e.altKey||e.metaKey)return this.remove();this.editor.emit("email",this.editor)},insertEmail:(e={})=>{const{selection:t}=this.editor.state;if(t.empty&&this.editor.insertText(e.href,!0),e.href)return this.update(e)},removeEmail:()=>this.remove(),toggleEmail:(e={})=>{e.href?.length>0?this.editor.command("insertEmail",e):this.editor.command("removeEmail")}}}get defaults(){return{target:null}}get name(){return"email"}pasteRules({type:e,utils:t}){return[t.pasteRule(/^[\w-.]+@([\w-]+\.)+[\w-]{2,4}$/gi,e,e=>({href:e}))]}plugins(){return[{props:{handleClick:(e,t,i)=>{const s=this.editor.getMarkAttrs("email");s.href&&!0===i.altKey&&i.target instanceof HTMLAnchorElement&&(i.stopPropagation(),window.open(s.href))}}}]}get schema(){return{attrs:{href:{default:null},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href^='mailto:']",getAttrs:e=>({href:e.getAttribute("href").replace("mailto:",""),title:e.getAttribute("title")})}],toDOM:e=>["a",{...e.attrs,href:"mailto:"+e.attrs.href},0]}}}class Hl extends Pl{get button(){return{icon:"italic",label:window.panel.$t("toolbar.button.italic")}}commands(){return()=>this.toggle()}inputRules({type:e,utils:t}){return[t.markInputRule(/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,e),t.markInputRule(/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,e)]}keys(){return{"Mod-i":()=>this.toggle()}}get name(){return"italic"}pasteRules({type:e,utils:t}){return[t.markPasteRule(/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,e),t.markPasteRule(/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,e)]}get schema(){return{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:()=>["em",0]}}}class Ul extends Pl{get button(){return{icon:"url",label:window.panel.$t("toolbar.button.link")}}commands(){return{link:e=>{if(e.altKey||e.metaKey)return this.remove();this.editor.emit("link",this.editor)},insertLink:(e={})=>{const{selection:t}=this.editor.state;if(t.empty&&!1===this.editor.activeMarks.includes("link")&&this.editor.insertText(e.href,!0),e.href)return this.update(e)},removeLink:()=>this.remove(),toggleLink:(e={})=>{e.href?.length>0?this.editor.command("insertLink",e):this.editor.command("removeLink")}}}get defaults(){return{target:null}}get name(){return"link"}pasteRules({type:e,utils:t}){return[t.pasteRule(/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z]{2,}\b([-a-zA-Z0-9@:%_+.~#?&//=,]*)/gi,e,e=>({href:e}))]}plugins(){return[{props:{handleClick:(e,t,i)=>{const s=this.editor.getMarkAttrs("link");s.href&&!0===i.altKey&&i.target instanceof HTMLAnchorElement&&(i.stopPropagation(),window.open(s.href,s.target))}}}]}get schema(){return{attrs:{href:{default:null},target:{default:null},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]:not([href^='mailto:'])",getAttrs:e=>({href:e.getAttribute("href"),target:e.getAttribute("target"),title:e.getAttribute("title")})}],toDOM:e=>["a",{...e.attrs},0]}}}class Vl extends Pl{get button(){return{icon:"strikethrough",label:window.panel.$t("toolbar.button.strike")}}commands(){return()=>this.toggle()}inputRules({type:e,utils:t}){return[t.markInputRule(/~([^~]+)~$/,e)]}keys(){return{"Mod-d":()=>this.toggle()}}get name(){return"strike"}pasteRules({type:e,utils:t}){return[t.markPasteRule(/~([^~]+)~/g,e)]}get schema(){return{parseDOM:[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",getAttrs:e=>"line-through"===e}],toDOM:()=>["s",0]}}}let Kl=class extends Pl{get button(){return{icon:"superscript",label:window.panel.$t("toolbar.button.sup")}}commands(){return()=>this.toggle()}get name(){return"sup"}get schema(){return{parseDOM:[{tag:"sup"}],toDOM:()=>["sup",0]}}};class Wl extends Pl{get button(){return{icon:"subscript",label:window.panel.$t("toolbar.button.sub")}}commands(){return()=>this.toggle()}get name(){return"sub"}get schema(){return{parseDOM:[{tag:"sub"}],toDOM:()=>["sub",0]}}}class Jl extends Pl{get button(){return{icon:"underline",label:window.panel.$t("toolbar.button.underline")}}commands(){return()=>this.toggle()}keys(){return{"Mod-u":()=>this.toggle()}}get name(){return"underline"}get schema(){return{parseDOM:[{tag:"u"},{style:"text-decoration",getAttrs:e=>"underline"===e}],toDOM:()=>["u",0]}}}class Gl extends Ll{get button(){return{id:this.name,icon:"list-bullet",label:window.panel.$t("toolbar.button.ul"),name:this.name,when:["listItem","bulletList","orderedList","paragraph"]}}commands({type:e,schema:t,utils:i}){return()=>i.toggleList(e,t.nodes.listItem)}inputRules({type:e,utils:t}){return[t.wrappingInputRule(/^\s*([-+*])\s$/,e)]}keys({type:e,schema:t,utils:i}){return{"Shift-Ctrl-8":i.toggleList(e,t.nodes.listItem)}}get name(){return"bulletList"}get schema(){return{content:"listItem+",group:"block",parseDOM:[{tag:"ul"}],toDOM:()=>["ul",0]}}}class Xl extends Ll{commands({utils:e,type:t}){return()=>this.createHardBreak(e,t)}createHardBreak(e,t){return e.chainCommands(e.exitCode,e.insertNode(t))}get defaults(){return{enter:!1,text:!1}}keys({utils:e,type:t}){const i=this.createHardBreak(e,t);let s={"Mod-Enter":i,"Shift-Enter":i};return this.options.enter&&(s.Enter=i),s}get name(){return"hardBreak"}get schema(){return{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:()=>["br"]}}}class Zl extends Ll{get button(){const e=this.options.levels.map(e=>({id:`h${e}`,command:`h${e}`,icon:`h${e}`,label:window.panel.$t("toolbar.button.heading."+e),attrs:{level:e},name:this.name,when:["heading","paragraph"]}));return e[e.length-1].separator=!0,e}commands({type:e,schema:t,utils:i}){let s={toggleHeading:s=>i.toggleBlockType(e,t.nodes.paragraph,s)};for(const n of this.options.levels)s[`h${n}`]=()=>i.toggleBlockType(e,t.nodes.paragraph,{level:n});return s}get defaults(){return{levels:[1,2,3,4,5,6]}}inputRules({type:e,utils:t}){return this.options.levels.map(i=>t.textblockTypeInputRule(new RegExp(`^(#{1,${i}})\\s$`),e,()=>({level:i})))}keys({type:e,utils:t}){return this.options.levels.reduce((i,s)=>({...i,[`Shift-Ctrl-${s}`]:t.setBlockType(e,{level:s})}),{})}get name(){return"heading"}get schema(){return{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,draggable:!1,parseDOM:this.options.levels.map(e=>({tag:`h${e}`,attrs:{level:e}})),toDOM:e=>[`h${e.attrs.level}`,0]}}}class Ql extends Ll{commands({type:e,utils:t}){return()=>t.insertNode(e)}inputRules({type:e,utils:t}){const i=t.nodeInputRule(/^(?:---|___\s|\*\*\*\s)$/,e),s=i.handler;return i.handler=(e,t,i,n)=>s(e,t,i,n).replaceWith(i-1,i,""),[i]}get name(){return"horizontalRule"}get schema(){return{group:"block",parseDOM:[{tag:"hr"}],toDOM:()=>["hr"]}}}class ea extends Ll{keys({type:e,utils:t}){return{Enter:t.splitListItem(e),"Shift-Tab":t.liftListItem(e),Tab:t.sinkListItem(e)}}get name(){return"listItem"}get schema(){return{content:"paragraph block*",defining:!0,draggable:!1,parseDOM:[{tag:"li"}],toDOM:()=>["li",0]}}}class ta extends Ll{get button(){return{id:this.name,icon:"list-numbers",label:window.panel.$t("toolbar.button.ol"),name:this.name,when:["listItem","bulletList","orderedList","paragraph"],separator:!0}}commands({type:e,schema:t,utils:i}){return()=>i.toggleList(e,t.nodes.listItem)}inputRules({type:e,utils:t}){return[t.wrappingInputRule(/^(\d+)\.\s$/,e,e=>({order:+e[1]}),(e,t)=>t.childCount+t.attrs.order===+e[1])]}keys({type:e,schema:t,utils:i}){return{"Shift-Ctrl-9":i.toggleList(e,t.nodes.listItem)}}get name(){return"orderedList"}get schema(){return{attrs:{order:{default:1}},content:"listItem+",group:"block",parseDOM:[{tag:"ol",getAttrs:e=>({order:e.hasAttribute("start")?+e.getAttribute("start"):1})}],toDOM:e=>1===e.attrs.order?["ol",0]:["ol",{start:e.attrs.order},0]}}}class ia extends Ll{get button(){return{id:this.name,icon:"quote",label:window.panel.$t("field.blocks.quote.name"),name:this.name}}commands({type:e,utils:t}){return()=>t.toggleWrap(e)}inputRules({type:e,utils:t}){return[t.wrappingInputRule(/^\s*>\s$/,e)]}keys({utils:e}){return{"Shift-Tab":(t,i)=>e.lift(t,i)}}get name(){return"quote"}get schema(){return{content:"block+",group:"block",defining:!0,draggable:!1,parseDOM:[{tag:"blockquote"}],toDOM:()=>["blockquote",0]}}}let sa=class extends jl{commands(){return{undo:()=>fe,redo:()=>me,undoDepth:()=>he,redoDepth:()=>pe}}get defaults(){return{depth:"",newGroupDelay:""}}keys(){return{"Mod-z":fe,"Mod-y":me,"Shift-Mod-z":me,"Mod-я":fe,"Shift-Mod-я":me}}get name(){return"history"}plugins(){return[ge({depth:this.options.depth,newGroupDelay:this.options.newGroupDelay})]}};class na extends jl{commands(){return{insertHtml:e=>(t,i)=>{let s=document.createElement("div");s.innerHTML=e.trim();const n=se.fromSchema(t.schema).parse(s);i(t.tr.replaceSelectionWith(n).scrollIntoView())}}}}class oa extends jl{keys(){const e={};for(const t in this.options)e[t]=()=>(this.options[t](),!0);return e}}let la=class extends jl{constructor(e){super(),this.writer=e}get component(){return this.writer.$refs.toolbar}init(){this.editor.on("deselect",({event:e})=>this.component?.close(e)),this.editor.on("select",({hasChanged:e})=>{!1!==e&&this.component?.open()})}get type(){return"toolbar"}};const aa={mixins:[bs,Ee,je,qe,Pe],props:{breaks:Boolean,code:Boolean,emptyDocument:{type:Object,default:()=>({type:"doc",content:[]})},extensions:Array,headings:{default:()=>[1,2,3,4,5,6],type:[Array,Boolean]},inline:Boolean,keys:Object,marks:{type:[Array,Boolean],default:!0},nodes:{type:[Array,Boolean],default:()=>["heading","bulletList","orderedList"]},paste:{type:Function,default:()=>()=>!1},toolbar:{type:Object,default:()=>({inline:!0})},value:{type:String,default:""}}},ra=["data-disabled","data-empty","data-placeholder","spellcheck"],ca=["name","required","value"];const da=Ne({mixins:[ys,aa],emits:["input"],data(){return{editor:null,json:{},html:this.value,isEmpty:!0}},computed:{characters(){const e=this.$helper.string.stripHTML(this.value??"");return this.$helper.string.unescapeHTML(e).length},isCursorAtEnd(){return this.editor.selectionIsAtEnd},isCursorAtStart(){return this.editor.selectionIsAtStart},toolbarOptions(){return{marks:Array.isArray(this.marks)||!1===this.marks?this.marks:void 0,...this.toolbar,editor:this.editor}}},watch:{value(e,t){e!==t&&e!==this.html&&(this.html=e,this.editor.setContent(this.html),this.isEmpty=this.editor.isEmpty())}},mounted(){this.editor=new zl({autofocus:this.autofocus,content:this.value,editable:!this.disabled,element:this.$el,emptyDocument:this.emptyDocument,parseOptions:{preserveWhitespace:!0},events:{link:e=>{this.$panel.dialog.open({component:"k-link-dialog",props:{value:e.getMarkAttrs("link")},on:{cancel:()=>e.focus(),submit:t=>{this.$panel.dialog.close(),e.command("toggleLink",t)}}})},email:e=>{this.$panel.dialog.open({component:"k-email-dialog",props:{value:this.editor.getMarkAttrs("email")},on:{cancel:()=>e.focus(),submit:t=>{this.$panel.dialog.close(),e.command("toggleEmail",t)}}})},paste:this.paste,update:e=>{if(!this.editor)return;const t=JSON.stringify(this.editor.getJSON());t!==JSON.stringify(this.json)&&(this.json=t,this.isEmpty=e.editor.isEmpty(),this.html=e.editor.getHTML(),this.isEmpty&&(0===e.editor.activeNodes.length||e.editor.activeNodes.includes("paragraph"))&&(this.html=""),this.$emit("input",this.html),this.validate())}},extensions:[...this.createMarks(),...this.createNodes(),new oa(this.keys),new sa,new na,new la(this),...this.extensions||[]],inline:this.inline}),this.isEmpty=this.editor.isEmpty(),this.json=this.editor.getJSON(),this.$panel.events.on("click",this.onBlur),this.$panel.events.on("focus",this.onBlur),this.validate(),this.$props.autofocus&&this.focus()},beforeUnmount(){this.editor.destroy(),this.$panel.events.off("click",this.onBlur),this.$panel.events.off("focus",this.onBlur)},methods:{command(e,...t){this.editor.command(e,...t)},createMarks(){return this.filterExtensions({clear:new Fl,code:new Rl,underline:new Jl,strike:new Vl,link:new Ul,email:new Yl,bold:new Nl,italic:new Hl,sup:new Kl,sub:new Wl,...this.createMarksFromPanelPlugins()},this.marks)},createMarksFromPanelPlugins(){const e=window.panel.plugins.writerMarks??{},t={};for(const i in e)t[i]=Object.create(Pl.prototype,Object.getOwnPropertyDescriptors({name:i,...e[i]}));return t},createNodes(){const e=new Xl({text:!0,enter:this.inline});return this.filterExtensions({bulletList:new Gl,orderedList:new ta,heading:new Zl({levels:this.headings}),horizontalRule:new Ql,listItem:new ea,quote:new ia,...this.createNodesFromPanelPlugins()},this.nodes,(t,i)=>((t.includes("bulletList")||t.includes("orderedList"))&&i.push(new ea),!0===this.inline&&(i=i.filter(e=>!0===e.schema.inline)),i.push(e),i))},createNodesFromPanelPlugins(){const e=window.panel.plugins.writerNodes??{},t={};for(const i in e)t[i]=Object.create(Ll.prototype,Object.getOwnPropertyDescriptors({name:i,...e[i]}));return t},getHTML(){return this.editor.getHTML()},filterExtensions(e,t,i){!1===t?t=[]:!0!==t&&!1!==Array.isArray(t)||(t=Object.keys(e));let s=[];for(const n in e)t.includes(n)&&s.push(e[n]);return"function"==typeof i&&(s=i(t,s)),s},focus(){this.editor.focus()},getSplitContent(){return this.editor.getHTMLStartToSelectionToEnd()},onBlur(e){!1===this.$el.contains(e.target)&&this.$refs.toolbar?.close()},onCommand(e,...t){this.editor.command(e,...t)},async validate(){await new Promise(e=>setTimeout(()=>e(""),50));let e="";!1===this.isEmpty&&this.minlength&&this.characters<this.minlength?e=this.$t("error.validation.minlength",{min:this.minlength}):!1===this.isEmpty&&this.maxlength&&this.characters>this.maxlength&&(e=this.$t("error.validation.maxlength",{max:this.maxlength})),this.$refs.output?.setCustomValidity(e)}}},[["render",function(e,i,l,a,r,c){const d=t("k-writer-toolbar"),m=D("direction");return E((n(),h("div",{ref:"editor",class:p(["k-writer","k-writer-input",e.$attrs.class]),"data-disabled":e.disabled,"data-empty":r.isEmpty,"data-placeholder":e.placeholder,spellcheck:e.spellcheck,style:u(e.$attrs.style)},[r.editor&&!e.disabled?(n(),s(d,o({key:0,ref:"toolbar"},c.toolbarOptions,{onCommand:c.onCommand}),null,16,["onCommand"])):g("",!0),x("textarea",{ref:"output",name:e.name,required:e.required,value:e.value,class:"input-hidden",tabindex:"-1"},null,8,ca)],14,ra)),[[m]])}]]);class ua extends Bl{get schema(){return{content:this.options.nodes.join("|")}}}const pa={mixins:[aa],inheritAttrs:!1,props:{nodes:{type:Array,default:()=>["bulletList","orderedList"]}}};const ha=Ne({mixins:[ys,pa],emits:["input"],data(){return{list:this.value,html:this.value}},computed:{listExtensions(){return[new ua({inline:!0,nodes:this.nodes})]}},watch:{value(e){e!==this.html&&(this.list=e,this.html=e)}},methods:{focus(){this.$refs.input.focus()},onInput(e){let t=(new DOMParser).parseFromString(e,"text/html").querySelector("ul, ol");t&&0!==t.textContent.trim().length?(this.list=e,this.html=e.replace(/(<p>|<\/p>)/gi,""),this.$emit("input",this.html)):this.$emit("input",this.list="")}}},[["render",function(e,i,l,a,r,c){const d=t("k-writer-input");return n(),s(d,o({ref:"input"},e.$props,{class:["k-list-input",e.$attrs.class],extensions:c.listExtensions,style:e.$attrs.style,value:r.list,onInput:c.onInput}),null,16,["class","extensions","style","value","onInput"])}]]);const ma=Ne({mixins:[Ws,hn,pa],inheritAttrs:!1,emits:["input"],methods:{focus(){this.$refs.input.focus()}}},[["render",function(e,i,l,r,c,d){const u=t("k-input"),p=t("k-field");return n(),s(p,o(e.$props,{class:["k-list-field",e.$attrs.class],counter:!1,input:e.id,style:e.$attrs.style}),{default:a(()=>[b(u,o(e.$props,{ref:"input",type:"list",onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16)]),_:1},16,["class","input","style"])}]]),fa={props:{disabled:Boolean,html:{type:Boolean},removable:Boolean,theme:{type:String,default:"dark"}}},ga=["innerHTML"],ka={key:1,class:"k-tag-text"},ba={key:1,class:"k-tag-text"};const ya=Ne({mixins:[fa],props:{element:String,icon:String,image:{type:Object},link:String,text:String},emits:["remove"],computed:{isRemovable(){return this.removable&&!this.disabled}},methods:{remove(){this.isRemovable&&this.$emit("remove")},focus(){this.$el.focus()}}},[["render",function(e,i,l,c,d,u){const p=t("k-image-frame"),f=t("k-icon-frame");return n(),s(w(l.element??(l.link?"k-link":"button")),{"aria-disabled":e.disabled,"data-theme":e.theme,to:l.link,class:"k-tag",type:"button",onKeydown:_(S(u.remove,["prevent"]),["delete"])},{default:a(()=>[r(e.$slots,"image",{},()=>[l.image?.src?(n(),s(p,o({key:0},l.image,{class:"k-tag-image"}),null,16)):l.image||l.icon?(n(),s(f,o({key:1},l.image??{icon:l.icon},{class:"k-tag-icon"}),null,16)):g("",!0)]),l.text?(n(),h(m,{key:0},[e.html?(n(),h("span",{key:0,class:"k-tag-text",innerHTML:l.text},null,8,ga)):(n(),h("span",ka,$(l.text),1))],64)):e.$slots.default?(n(),h("span",ba,[r(e.$slots,"default")])):g("",!0),u.isRemovable?(n(),s(f,{key:2,class:"k-tag-toggle",icon:"cancel-small",onClick:S(u.remove,["stop"])},null,8,["onClick"])):g("",!0)]),_:3},40,["aria-disabled","data-theme","to","onKeydown"])}]]),va={mixins:[fa,Me,Be],inheritAttrs:!1,props:{element:{type:String,default:"div"},layout:String,sort:{default:!1,type:Boolean},value:{default:()=>[],type:Array}}},$a={mixins:[va],props:{draggable:{default:!0,type:Boolean}},emits:["edit","input"],data:()=>({tags:[]}),computed:{dragOptions(){return{delay:1,disabled:!this.isDraggable,draggable:".k-tag",handle:".k-tag-text"}},isDraggable(){return!0!==this.sort&&!1!==this.draggable&&0!==this.tags.length&&!0!==this.disabled}},watch:{value:{handler(){let e=this.$helper.object.clone(this.value);if(!0===this.sort){const t=[];for(const i of this.options){const s=e.indexOf(i.value);-1!==s&&(t.push(i),e.splice(s,1))}t.push(...e),e=t}this.tags=e.map(this.tag).filter(e=>e)},immediate:!0,deep:!0}},methods:{edit(e,t,i){!1===this.disabled&&this.$emit("edit",e,t,i)},focus(e="last"){this.$refs.navigate.move(e)},index(e){return this.tags.findIndex(t=>t.value===e.value)},input(){this.$emit("input",this.tags.map(e=>e.value))},navigate(e){this.focus(e)},remove(e){this.tags.length<=1?this.navigate("last"):this.navigate("prev"),this.tags.splice(e,1),this.input()},option(e){return this.options.find(t=>t.value===e.value)},select(){this.focus()},tag(e){"object"!=typeof e&&(e={value:e});const t=this.option(e);return t||{text:this.$helper.string.escapeHTML(e.text??e.value),...e}}}},wa=["innerHTML"];const xa=Ne($a,[["render",function(e,i,o,l,c,d){const g=t("k-tag"),k=t("k-draggable"),y=t("k-navigate");return n(),s(y,{ref:"navigate",axis:"list"===e.layout?"y":"x",select:":where(.k-tag, .k-tags-navigatable):not(:disabled)"},{default:a(()=>[b(k,{class:p(["k-tags",e.$attrs.class]),"data-layout":e.layout,element:e.element,list:c.tags,options:d.dragOptions,style:u(e.$attrs.style),onEnd:d.input},{footer:a(()=>[r(e.$slots,"default")]),default:a(()=>[(n(!0),h(m,null,f(c.tags,(t,o)=>(n(),s(g,{key:t.id??t.value??t.text,disabled:e.disabled,element:e.element,html:e.html,icon:t.icon,image:t.image,link:t.link,removable:e.removable&&!e.disabled,theme:e.theme,name:"tag",onClick:i[0]||(i[0]=S(()=>{},["stop"])),onKeypress:_(e=>d.edit(o,t,e),["enter"]),onDblclick:e=>d.edit(o,t,e),onRemove:e=>d.remove(o,t)},{default:a(()=>[x("span",{innerHTML:t.text},null,8,wa)]),_:2},1032,["disabled","element","html","icon","image","link","removable","theme","onKeypress","onDblclick","onRemove"]))),128))]),_:3},8,["class","data-layout","element","list","options","style","onEnd"])]),_:3},8,["axis"])}]]),Sa={mixins:[Le,ze,va,vs],props:{value:{default:()=>[],type:Array}},methods:{open(){this.$refs.dropdown.open(this.$el)}}},Ca=["data-disabled"],Oa=["value"];const Aa=Ne({mixins:[ys,Sa],emits:["input"]},[["render",function(e,i,l,r,c,d){const m=t("k-button"),f=t("k-tags"),k=t("k-picklist-dropdown");return n(),h("div",{class:p(["k-multiselect-input",e.$attrs.class]),"data-disabled":e.disabled,style:u(e.$attrs.style)},[x("k-input-validator",o({min:e.min,max:e.max,required:e.required},{value:JSON.stringify(e.value),anchor:".k-multiselect-input-toggle"}),[b(f,o({ref:"tags"},e.$props,{removable:!0,onInput:i[1]||(i[1]=t=>e.$emit("input",t)),onClick:S(e.open,["stop"])}),{default:a(()=>[!e.max||e.value.length<e.max?(n(),s(m,{key:0,id:e.id,ref:"toggle",autofocus:e.autofocus,disabled:e.disabled,class:"k-multiselect-input-toggle k-tags-navigatable",size:"xs",icon:"angle-down",onKeydown:i[0]||(i[0]=_(t=>e.$refs.tags.focus("prev"),["delete"])),onFocus:e.open},null,8,["id","autofocus","disabled","onFocus"])):g("",!0)]),_:1},16,["onClick"])],16,Oa),b(k,o({ref:"dropdown"},e.$props,{options:e.options,onInput:i[2]||(i[2]=t=>e.$emit("input",t))}),null,16,["options"])],14,Ca)}]]),Ia={mixins:[Sa],props:{accept:{type:String,default:"all"},separator:{type:String,default:","}}},Ma=["data-can-add","data-disabled"],_a=["value"];const Da=Ne({extends:Aa,mixins:[Ia],emits:["input"],data:()=>({editing:null}),computed:{canAdd(){return!this.max||this.value.length<this.max},creatableOptions(){return this.options.filter(e=>!1===this.value.includes(e.value))},picklist(){return{disabled:this.disabled,create:this.showCreate,ignore:this.ignore,min:this.min,max:this.max,search:this.showSearch}},replacableOptions(){return this.options.filter(e=>!1===this.value.includes(e.value)||e.value===this.editing?.tag.value)},showCreate(){return"options"!==this.accept&&(!this.editing||{submit:this.$t("replace.with")})},showSearch(){return!1!==this.search&&(this.editing?{placeholder:this.$t("replace.with"),...this.search}:"options"===this.accept?{placeholder:this.$t("filter"),...this.search}:this.search)}},methods:{create(e){const t=e.split(this.separator).map(e=>e.trim()),i=this.$helper.object.clone(this.value);for(let s of t)s=this.$refs.tags.tag(s,this.separator),!0===this.isAllowed(s)&&i.push(s.value);this.$emit("input",i),this.$refs.create.close()},async edit(e,t){this.editing={index:e,tag:t},this.$refs.replace.open()},focus(){this.canAdd&&this.$refs.create.open()},isAllowed(e){return"object"==typeof e&&0!==e.value.trim().length&&(!("options"===this.accept&&!this.$refs.tags.option(e))&&!0!==this.value.includes(e.value))},pick(e){this.$emit("input",e),this.$refs.create.close()},replace(e){const{index:t}=this.editing,i=this.$refs.tags.tag(e);if(this.$refs.replace.close(),this.editing=null,!1===this.isAllowed(i))return!1;const s=this.$helper.object.clone(this.value);s.splice(t,1,i.value),this.$emit("input",s),this.$refs.tags.navigate(t)},toggle(e){return!(e.metaKey||e.altKey||e.ctrlKey)&&("ArrowDown"===e.key?(this.$refs.create.open(),void e.preventDefault()):void(String.fromCharCode(e.keyCode).match(/(\w)/g)&&this.$refs.create.open()))}}},[["render",function(e,i,l,r,c,d){const u=t("k-button"),p=t("k-tags"),m=t("k-picklist-dropdown");return n(),h("div",{"data-can-add":d.canAdd,"data-disabled":e.disabled,class:"k-tags-input"},[x("k-input-validator",o({min:e.min,max:e.max,required:e.required},{value:JSON.stringify(e.value)}),[b(p,o({ref:"tags"},e.$props,{removable:!0,onEdit:d.edit,onInput:i[2]||(i[2]=t=>e.$emit("input",t)),onClick:i[3]||(i[3]=S(t=>e.$refs.toggle?.$el?.click(),["stop"]))}),{default:a(()=>[e.disabled||e.max&&!(e.value.length<e.max)?g("",!0):(n(),s(u,{key:0,id:e.id,ref:"toggle",autofocus:e.autofocus,disabled:e.disabled,class:"k-tags-input-toggle k-tags-navigatable input-focus",size:"xs",icon:"add",onClick:i[0]||(i[0]=t=>e.$refs.create.open()),onKeydown:[i[1]||(i[1]=_(t=>e.$refs.tags.focus("prev"),["delete"])),d.toggle]},null,8,["id","autofocus","disabled","onKeydown"]))]),_:1},16,["onEdit"])],16,_a),b(m,o({ref:"replace"},d.picklist,{multiple:!1,options:d.replacableOptions,value:c.editing?.tag.value??"",onCreate:d.replace,onInput:d.replace}),null,16,["options","value","onCreate","onInput"]),b(m,o({ref:"create"},d.picklist,{options:d.creatableOptions,value:e.value,onCreate:d.create,onInput:d.pick}),null,16,["options","value","onCreate","onInput"])],8,Ma)}]]);const Ea=Ne({mixins:[Ws,hn,Ia,Co],inheritAttrs:!1,emits:["input"],computed:{hasNoOptions(){return 0===this.options.length&&"options"===this.accept}},methods:{focus(){this.$refs.input.focus()}}},[["render",function(e,i,l,r,c,d){const u=t("k-empty"),p=t("k-input"),h=t("k-field");return n(),s(h,o(e.$props,{class:["k-tags-field",e.$attrs.class],counter:e.counterOptions,input:e.id,style:e.$attrs.style}),{default:a(()=>[d.hasNoOptions?(n(),s(u,{key:0,icon:e.icon,text:e.$t("options.none")},null,8,["icon","text"])):(n(),s(p,o({key:1},e.$props,{ref:"input",type:"tags",onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16))]),_:1},16,["class","counter","input","style"])}]]);const ja=Ne({extends:Ea,inheritAttrs:!1,emits:["input"]},[["render",function(e,i,l,r,c,d){const u=t("k-empty"),p=t("k-input"),h=t("k-field");return n(),s(h,o(e.$props,{class:["k-multiselect-field",e.$attrs.class],counter:e.counterOptions,input:e.id,style:e.$attrs.style}),{default:a(()=>[e.hasNoOptions?(n(),s(u,{key:0,icon:e.icon,text:e.$t("options.none")},null,8,["icon","text"])):(n(),s(p,o({key:1},e.$props,{ref:"input",type:"multiselect",onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16))]),_:1},16,["class","counter","input","style"])}]]),La={mixins:[bs,qe],props:{max:Number,min:Number,name:[Number,String],preselect:Boolean,step:[Number,String],value:{type:[Number,String],default:""}}};const Ba=Ne({mixins:[ys,La],emits:["input"],data(){return{number:this.format(this.value),timeout:null}},watch:{value(e){this.number=e}},mounted(){this.$props.autofocus&&this.focus(),this.$props.preselect&&this.select()},methods:{decimals(){const e=Number(this.step??0);return Math.floor(e)===e?0:-1!==e.toString().indexOf("e")?parseInt(e.toFixed(16).split(".")[1].split("").reverse().join("")).toString().length:e.toString().split(".")[1].length??0},format(e){if(isNaN(e)||""===e)return"";if("any"===this.step)return e;const t=this.decimals();return t?parseFloat(e).toFixed(t):Number.isInteger(this.step)?parseInt(e):parseFloat(e)},clean(){this.number=this.format(this.number)},emit(e){e=parseFloat(e),isNaN(e)&&(e=""),e!==this.value&&this.$emit("input",e)},onInput(e){this.number=e,this.emit(e)},onBlur(){this.clean(),this.emit(this.number)},select(){this.$refs.input.select()}}},[["render",function(e,t,i,s,l,a){return n(),h("input",o({ref:"input"},{autofocus:e.autofocus,disabled:e.disabled,id:e.id,max:e.max,min:e.min,name:e.name,placeholder:e.placeholder,required:e.required,step:e.step,value:l.number},{class:["k-number-input",e.$attrs.class],style:e.$attrs.style,type:"number",onBlur:t[0]||(t[0]=(...e)=>a.onBlur&&a.onBlur(...e)),onInput:t[1]||(t[1]=e=>a.onInput(e.target.value)),onKeydown:[t[2]||(t[2]=_(S((...e)=>a.clean&&a.clean(...e),["ctrl"]),["s"])),t[3]||(t[3]=_(S((...e)=>a.clean&&a.clean(...e),["meta"]),["s"]))]}),null,16)}]]);const Ta=Ne({mixins:[Ws,hn,La],inheritAttrs:!1,emits:["input"],methods:{focus(){this.$refs.input.focus()}}},[["render",function(e,i,l,r,c,d){const u=t("k-input"),p=t("k-field");return n(),s(p,o(e.$props,{class:["k-number-field",e.$attrs.class],input:e.id,style:e.$attrs.style}),{default:a(()=>[b(u,o(e.$props,{ref:"input",type:"number",onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16)]),_:1},16,["class","input","style"])}]]),qa=["aria-disabled"],za=["onClick"],Pa={"data-has-button":"","data-mobile":"true"},Na={type:"button"},Fa=["checked","required"];const Ra=Ne({mixins:[Ws,hn],props:{empty:String,fields:[Object,Array],value:[String,Object]},emits:["input"],data:()=>({object:{}}),computed:{hasFields(){return this.$helper.object.length(this.fields)>0},isEmpty(){return null===this.object||0===this.$helper.object.length(this.object)}},watch:{value:{handler(e){this.object=this.valueToObject(e)},immediate:!0}},methods:{add(){this.object=this.$helper.field.form(this.fields),this.save(),this.open()},cell(e,t){this.object[e]=t,this.save()},form(e){const t=this.$helper.field.subfields(this,this.fields);if(e)for(const i in t)t[i].autofocus=i===e;return t},remove(){this.object={},this.save()},open(e){if(this.disabled)return!1;this.$panel.drawer.open({component:"k-form-drawer",props:{breadcrumb:[],icon:"box",tab:"object",tabs:{object:{fields:this.form(e)}},title:this.label,value:this.object},on:{input:e=>{for(const t in e)this.object[t]=e[t];this.save()}}})},save(){this.$emit("input",this.object)},valueToObject:e=>"object"!=typeof e?{}:e}},[["render",function(e,i,r,c,d,u){const p=t("k-button"),y=t("k-table-cell"),w=t("k-empty"),S=t("k-field");return n(),s(S,o(e.$props,{input:e.id,class:"k-object-field"}),l({default:a(()=>[u.hasFields?(n(),h(m,{key:0},[u.isEmpty?(n(),s(w,o({key:1,icon:"box"},k(e.disabled?{}:{click:()=>u.add()})),{default:a(()=>[v($(r.empty??e.$t("field.object.empty")),1)]),_:1},16)):(n(),h("table",{key:0,"aria-disabled":e.disabled,class:"k-table k-object-field-table"},[x("tbody",null,[(n(!0),h(m,null,f(r.fields,t=>(n(),h(m,null,[t.saveable&&e.$helper.field.isVisible(t,r.value)?(n(),h("tr",{key:t.name,onClick:e=>u.open(t.name)},[x("th",Pa,[x("button",Na,$(t.label),1)]),b(y,{column:t,field:t,mobile:!0,value:d.object[t.name],onInput:e=>u.cell(t.name,e)},null,8,["column","field","value","onInput"])],8,za)):g("",!0)],64))),256))])],8,qa))],64)):(n(),s(w,{key:1,icon:"box"},{default:a(()=>[v($(e.$t("fields.empty")),1)]),_:1})),x("input",{type:"checkbox",checked:!u.isEmpty,required:e.required,class:"input-hidden"},null,8,Fa)]),_:2},[!e.disabled&&u.hasFields?{name:"options",fn:a(()=>[u.isEmpty?(n(),s(p,{key:0,id:e.id,icon:"add",size:"xs",variant:"filled",onClick:u.add},null,8,["id","onClick"])):(n(),s(p,{key:1,icon:"remove",size:"xs",variant:"filled",onClick:u.remove},null,8,["onClick"]))]),key:"0"}:void 0]),1040,["input"])}]]),Ya={extends:Xo,type:"pages",computed:{emptyProps(){return{icon:"page",text:this.empty??(this.multiple&&1!==this.max?this.$t("field.pages.empty"):this.$t("field.pages.empty.single"))}}}},Ha={mixins:[Ao],props:{autocomplete:{type:String,default:"new-password"}}};const Ua=Ne({mixins:[Mo,Ha],emits:["input"]},[["render",function(e,i,l,a,r,c){const d=t("k-string-input");return n(),s(d,o(e.$props,{type:"password",class:"k-password-input",onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16)}]]);const Va=Ne({mixins:[Ws,hn,Ha,Co],inheritAttrs:!1,props:{minlength:{type:Number,default:8},icon:{type:String,default:"key"}},emits:["input"],methods:{focus(){this.$refs.input.focus()}}},[["render",function(e,i,c,d,u,p){const h=t("k-input"),m=t("k-field");return n(),s(m,o(e.$props,{class:["k-password-field",e.$attrs.class],counter:e.counterOptions,input:e.id,style:e.$attrs.style}),l({default:a(()=>[b(h,o(e.$props,{ref:"input",type:"password",onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16)]),_:2},[e.$slots.options?{name:"options",fn:a(()=>[r(e.$slots,"options")]),key:"0"}:void 0]),1040,["class","counter","input","style"])}]]),Ka={mixins:[bs,Be],props:{columns:{default:1,type:Number},theme:String,value:[String,Number,Boolean]}},Wa=["disabled"],Ja={class:"sr-only"},Ga=["required","value"];const Xa=Ne({mixins:[ys,Ka],emits:["input"],computed:{choices(){const e=this.options.some(e=>e.icon);return this.options.map((t,i)=>({autofocus:this.autofocus&&0===i,checked:this.value===t.value,disabled:this.disabled||t.disabled,id:`${this.id}-${i}`,icon:t.icon??(e?"blank":null),info:t.info,label:t.text,name:this.name??this.id,type:"radio",value:t.value}))}},methods:{focus(){this.$el.querySelector("input")?.focus()},select(){this.focus()}}},[["render",function(e,i,s,l,a,r){const c=t("k-choice-input");return n(),h("fieldset",{class:p(["k-radio-input",e.$attrs.class]),disabled:e.disabled,style:u(e.$attrs.style)},[x("legend",Ja,$(e.$t("options")),1),x("k-input-validator",{required:e.required,value:JSON.stringify(e.value)},[x("ul",{style:u({"--columns":e.columns}),class:"k-grid","data-variant":"choices"},[(n(!0),h(m,null,f(r.choices,(t,i)=>(n(),h("li",{key:i},[b(c,o({ref_for:!0},t,{onClick:i=>e.toggle(t.value),onInput:i=>e.$emit("input",t.value)}),null,16,["onClick","onInput"])]))),128))],4)],8,Ga)],14,Wa)}]]);const Za=Ne({mixins:[Ws,hn,Ka],inheritAttrs:!1,emits:["input"],methods:{focus(){this.$refs.input.focus()}}},[["render",function(e,i,l,r,c,d){const u=t("k-empty"),p=t("k-radio-input"),h=t("k-field");return n(),s(h,o(e.$props,{class:["k-radio-field",e.$attrs.class],input:e.id+"-0",style:e.$attrs.style}),{default:a(()=>[e.options?.length?(n(),s(p,o({key:1,ref:"input"},e.$props,{onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16)):(n(),s(u,{key:0,text:e.$t("options.none"),icon:"checklist"},null,8,["text"]))]),_:1},16,["class","input","style"])}]]),Qa={mixins:[bs],props:{default:[Number,String],max:{type:Number,default:100},min:{type:Number,default:0},step:{type:[Number,String],default:1},tooltip:{type:[Boolean,Object],default:()=>({before:null,after:null})},value:[Number,String]}},er=["data-disabled"],tr=["value"],ir=["for"],sr={key:0,class:"k-range-input-tooltip-before"},nr={key:1,class:"k-range-input-tooltip-after"};const or=Ne({mixins:[ys,Qa],emits:["input"],computed:{baseline(){return this.min<0?0:this.min},isEmpty(){return""===this.value||void 0===this.value||null===this.value},label(){return this.required||this.value||0===this.value?this.format(this.position):"–"},maxLength(){return Math.max(this.format(this.min).length,this.format(this.max).length)},position(){return this.value||0===this.value?this.value:this.default??this.baseline}},watch:{value:{handler(){this.validate()},immediate:!0}},mounted(){this.$props.autofocus&&this.focus()},methods:{focus(){this.$el.querySelector("input")?.focus()},format(e){const t=document.lang?document.lang.replace("_","-"):"en",i=this.step.toString().split("."),s=i.length>1?i[1].length:0;return new Intl.NumberFormat(t,{minimumFractionDigits:s}).format(e)},onInput(e){this.$emit("input",e)},validate(){const e=[];this.required&&!0===this.isEmpty&&e.push(this.$t("error.validation.required")),!1===this.isEmpty&&this.min&&this.value<this.min&&e.push(this.$t("error.validation.min",{min:this.min})),!1===this.isEmpty&&this.max&&this.value>this.max&&e.push(this.$t("error.validation.max",{max:this.max})),this.$refs.range?.setCustomValidity(e.join(", "))}}},[["render",function(e,t,i,s,l,a){return n(),h("div",{class:p(["k-range-input",e.$attrs.class]),"data-disabled":e.disabled,style:u(e.$attrs.style)},[x("input",o({ref:"range"},{autofocus:e.autofocus,disabled:e.disabled,id:e.id,max:e.max,min:e.min,name:e.name,required:e.required,step:e.step},{value:a.position,type:"range",onInput:t[0]||(t[0]=t=>e.$emit("input",t.target.valueAsNumber))}),null,16,tr),e.tooltip?(n(),h("output",{key:0,for:e.id,class:"k-range-input-tooltip"},[e.tooltip.before?(n(),h("span",sr,$(e.tooltip.before),1)):g("",!0),x("span",{style:u(`--digits: ${a.maxLength}ch`),class:"k-range-input-tooltip-text"},$(a.label),5),e.tooltip.after?(n(),h("span",nr,$(e.tooltip.after),1)):g("",!0)],8,ir)):g("",!0)],14,er)}]]);const lr=Ne({mixins:[hn,Ws,Qa],inheritAttrs:!1,emits:["input"],methods:{focus(){this.$refs.input.focus()}}},[["render",function(e,i,l,r,c,d){const u=t("k-input"),p=t("k-field");return n(),s(p,o(e.$props,{class:["k-range-field",e.$attrs.class],input:e.id,style:e.$attrs.style}),{default:a(()=>[b(u,o(e.$props,{ref:"input",type:"range",onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16)]),_:1},16,["class","input","style"])}]]),ar={mixins:[bs,Be,qe],props:{ariaLabel:String,value:{type:[String,Number,Boolean],default:""}}},rr=["data-disabled","data-empty"],cr=["id","autofocus","aria-label","disabled","name","required","value"],dr=["disabled"],ur=["disabled","value"];const pr=Ne({mixins:[ys,ar],emits:["click","input"],computed:{empty(){return this.placeholder??"—"},hasEmptyOption(){return!this.required||this.isEmpty},isEmpty(){return null===this.value||void 0===this.value||""===this.value},label(){const e=this.text(this.value);return this.isEmpty||null===e?this.empty:e}},mounted(){this.$props.autofocus&&this.focus()},methods:{focus(){this.$refs.input.focus()},onClick(e){e.stopPropagation(),this.$emit("click",e)},select(){this.focus()},text(e){let t=null;for(const i of this.options)i.value==e&&(t=i.text);return t}}},[["render",function(e,t,i,s,o,l){return n(),h("span",{class:p(["k-select-input",e.$attrs.class]),"data-disabled":e.disabled,"data-empty":l.isEmpty,style:u(e.$attrs.style)},[x("select",{id:e.id,ref:"input",autofocus:e.autofocus,"aria-label":e.ariaLabel,disabled:e.disabled,name:e.name,required:e.required,value:e.value,class:"k-select-input-native",onChange:t[0]||(t[0]=t=>e.$emit("input",t.target.value)),onClick:t[1]||(t[1]=(...e)=>l.onClick&&l.onClick(...e))},[l.hasEmptyOption?(n(),h("option",{key:0,disabled:e.required,value:""},$(l.empty),9,dr)):g("",!0),(n(!0),h(m,null,f(e.options,e=>(n(),h("option",{key:e.value,disabled:e.disabled,value:e.value},$(e.text),9,ur))),128))],40,cr),v(" "+$(l.label),1)],14,rr)}]]);const hr=Ne({mixins:[Ws,hn,ar],inheritAttrs:!1,props:{icon:{type:String,default:"angle-down"}},emits:["input"],methods:{focus(){this.$refs.input.focus()}}},[["render",function(e,i,l,r,c,d){const u=t("k-input"),p=t("k-field");return n(),s(p,o(e.$props,{class:["k-select-field",e.$attrs.class],input:e.id,style:e.$attrs.style}),{default:a(()=>[b(u,o(e.$props,{ref:"input",type:"select",onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16)]),_:1},16,["class","input","style"])}]]),mr={mixins:[Ao],props:{autocomplete:null,spellcheck:null,allow:{type:String,default:""},formData:{type:Object,default:()=>({})},sync:{type:String}}};const fr=Ne({extends:Mo,mixins:[mr],emits:["input"],data(){return{slug:this.sluggify(this.value),slugs:this.$panel.language.rules??this.$panel.system.slugs,syncValue:null}},watch:{formData:{handler(e){return!this.disabled&&(!(!this.sync||void 0===e[this.sync])&&(e[this.sync]!=this.syncValue&&(this.syncValue=e[this.sync],void this.onInput(this.sluggify(this.syncValue)))))},deep:!0,immediate:!0},value:{handler(e){(e=this.sluggify(e))!==this.slug&&(this.slug=e,this.$emit("input",this.slug))},immediate:!0}},methods:{sluggify(e){return this.$helper.slug(e,[this.slugs,this.$panel.system.ascii],this.allow)},onInput(e){this.slug=this.sluggify(e),this.$emit("input",this.slug)}}},[["render",function(e,i,l,a,r,c){const d=t("k-string-input");return n(),s(d,o(e.$props,{spellcheck:!1,value:r.slug,autocomplete:"off",class:"k-slug-input",onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16,["value"])}]]);const gr=Ne({mixins:[Ws,hn,mr],inheritAttrs:!1,props:{icon:{type:String,default:"url"},path:{type:String},wizard:{type:[Boolean,Object],default:!1}},emits:["input"],data(){return{slug:this.value}},computed:{preview(){return void 0!==this.help?this.help:void 0!==this.path?this.path+this.value:null}},watch:{value(){this.slug=this.value}},methods:{focus(){this.$refs.input.focus()},onWizard(){let e=this.wizard?.field;if(e){const t=this.formData[e.toLowerCase()];t&&(this.slug=t)}}}},[["render",function(e,i,r,c,d,u){const p=t("k-button"),h=t("k-input"),m=t("k-field");return n(),s(m,o(e.$props,{class:["k-slug-field",e.$attrs.class],help:u.preview,input:e.id,style:e.$attrs.style}),l({default:a(()=>[b(h,o(e.$props,{ref:"input",value:d.slug,type:"slug",onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16,["value"])]),_:2},[r.wizard&&r.wizard.text?{name:"options",fn:a(()=>[b(p,{text:r.wizard.text,icon:"sparkling",size:"xs",variant:"filled",onClick:u.onWizard},null,8,["text","onClick"])]),key:"0"}:void 0]),1040,["class","help","input","style"])}]]),kr={props:{reports:{type:Array,default:()=>[]},size:{type:String,default:"large"}}},br=["data-size"];const yr=Ne({mixins:[kr]},[["render",function(e,i,l,r,c,d){const u=t("k-stat"),p=t("k-empty");return e.reports.length>0?(n(),h("dl",{key:0,class:"k-stats","data-size":e.size},[(n(!0),h(m,null,f(e.reports,(e,t)=>(n(),s(u,o({key:t},{ref_for:!0},e),null,16))),128))],8,br)):(n(),s(p,{key:1,icon:"chart"},{default:a(()=>[v($(e.$t("stats.empty")),1)]),_:1}))}]]);const vr=Ne({mixins:[Ie,Me,_e,Le,kr]},[["render",function(e,i,o,l,r,c){const d=t("k-stats"),u=t("k-field");return n(),s(u,{id:e.id,help:e.help,input:!1,label:e.label,name:e.name,type:"stats"},{default:a(()=>[b(d,{reports:e.reports,size:e.size},null,8,["reports","size"])]),_:1},8,["id","help","label","name"])}]]),$r={data:()=>({isSelecting:!1,selected:[]}),created(){this.$events.on(this.batchEditingEvent,this.stopSelectingCollision)},destroyed(){this.$events.off(this.batchEditingEvent,this.stopSelectingCollision)},computed:{batchDeleteConfirmMessage(){return this.$t(`${this.type}.delete.confirm.selected`,{count:this.selected.length})},batchEditingButtons(){const e=[];return e.push({disabled:0===this.selected.length,icon:"trash",text:this.$t("delete")+` (${this.selected.length})`,theme:"negative",click:()=>{this.$panel.dialog.open({component:"k-remove-dialog",props:{text:this.batchDeleteConfirmMessage},on:{submit:async()=>{this.$panel.dialog.close(),0!==this.selected.length&&(await this.onBatchDelete(),this.stopSelecting())}}})},responsive:!0}),e.push({icon:"cancel",text:this.$t("cancel"),click:()=>this.onSelectToggle(),responsive:!0}),e},batchEditingEvent:()=>"selecting",batchEditingToggle(){return{icon:"checklist",click:()=>this.onSelectToggle(),title:this.$t("select"),responsive:!0}},canSelect:()=>!0},methods:{onBatchDelete(){throw new Error("Not implemented")},onSelect(e){this.selected=e},onSelectToggle(){this.isSelecting?this.stopSelecting():this.startSelecting()},startSelecting(){this.isSelecting=!0,this.selected=[],this.$events.emit(this.batchEditingEvent,this.name)},stopSelecting(){this.isSelecting=!1,this.selected=[]},stopSelectingCollision(e){e!==this.name&&this.stopSelecting()}}},wr={mixins:[Ws,$r],inheritAttrs:!1,props:{autofocus:Boolean,batch:{type:Boolean,default:!1},columns:Object,duplicate:{type:Boolean,default:!0},empty:String,fields:[Array,Object],limit:Number,max:Number,min:Number,prepend:{type:Boolean,default:!1},sortable:{type:Boolean,default:!0},sortBy:String,value:{type:Array,default:()=>[]}},emits:["input"],data:()=>({items:[],page:1}),computed:{batchDeleteConfirmMessage(){return this.$t("field.structure.delete.confirm.selected",{count:this.selected.length})},batchEditingEvent:()=>"structure.selecting",canSelect(){return!0===this.batch&&this.items.length>0},index(){return this.limit?(this.page-1)*this.limit+1:1},hasFields(){return this.$helper.object.length(this.fields)>0},isSortable(){return!this.sortBy&&(!this.limit&&(!0!==this.disabled&&(!(this.items.length<=1)&&!1!==this.sortable)))},more(){return!0!==this.disabled&&!(this.max&&this.items.length>=this.max)},options(){return this.disabled?[]:[{icon:"edit",text:this.$t("edit"),click:"edit"},{disabled:!this.duplicate||!this.more,icon:"copy",text:this.$t("duplicate"),click:"duplicate"},"-",{icon:"trash",text:this.$t("delete"),click:"remove"}]},paginatedItems(){return this.limit?this.items.slice(this.pagination.offset,this.pagination.offset+this.limit):this.items},pagination(){let e=0;return this.limit&&(e=(this.page-1)*this.limit),{page:this.page,offset:e,limit:this.limit,total:this.items.length,align:"center",details:!0}}},watch:{value:{handler(e){this.stopSelecting(),e!==this.items&&(this.items=this.toItems(e))},immediate:!0}},methods:{add(e=null){if(!1===this.more)return!1;e??=this.$helper.field.form(this.fields),e._id??=this.$helper.uuid(),!0===this.prepend?this.items.unshift(e):this.items.push(e),this.save(),this.open(e)},close(){this.$panel.drawer.close(this.id)},focus(){this.$refs.add?.focus?.()},form(e){const t=this.$helper.field.subfields(this,this.fields);if(e)for(const i in t)t[i].autofocus=i===e;return t},findIndex(e){return this.items.findIndex(t=>t._id===e._id)},navigate(e,t){const i=this.findIndex(e);-1!==i&&this.open(this.items[i+t],null,!0)},open(e,t,i=!1){const s=this.findIndex(e);if(-1===s)return!1;this.stopSelecting(),this.$panel.drawer.open({component:"k-structure-drawer",id:this.id,props:{disabled:this.disabled,icon:"list-bullet",next:s<this.items.length-1,prev:s>0,tabs:{content:{fields:this.form(t)}},title:this.label,value:e},replace:i,on:{input:t=>{const i=this.findIndex(e);this.$panel.drawer.props.next=i<this.items.length-1,this.$panel.drawer.props.prev=i>0,this.items[i]=t,this.save()},next:()=>{this.navigate(e,1)},prev:()=>{this.navigate(e,-1)},remove:()=>{this.remove(e)}}})},option(e,t){switch(e){case"remove":this.remove(t);break;case"duplicate":this.add({...this.$helper.object.clone(t),_id:this.$helper.uuid()});break;case"edit":this.open(t)}},onBatchDelete(){this.removeSelected()},onTableInput(e){this.limit&&(e=this.items.toSpliced(this.pagination.offset,this.limit,...e)),this.save(e)},paginate({page:e}){this.page=e,this.stopSelecting()},remove(e){const t=this.findIndex(e);this.disabled||-1===t||this.$panel.dialog.open({component:"k-remove-dialog",props:{text:this.$t("field.structure.delete.confirm")},on:{submit:()=>{this.items.splice(t,1),this.save(),this.$panel.dialog.close(),this.close(),0===this.paginatedItems.length&&this.page>1&&this.page--}}})},removeAll(){this.$panel.dialog.open({component:"k-remove-dialog",props:{text:this.$t("field.structure.delete.confirm.all")},on:{submit:()=>{this.page=1,this.items=[],this.save(),this.$panel.dialog.close()}}})},removeSelected(){this.items=this.items.filter(e=>!1===this.selected.includes(e._id)),this.save()},save(e=this.items){this.$emit("input",e)},sort(e){return this.sortBy?this.$helper.array.sortBy(e,this.sortBy):e},toItems(e){return!1===Array.isArray(e)?[]:(e=e.map(e=>({_id:e._id??this.$helper.uuid(),...e})),this.sort(e))}}},xr=["value"],Sr={key:0};const Cr=Ne(wr,[["render",function(e,i,r,c,d,u){const p=t("k-button-group"),f=t("k-button"),y=t("k-dropdown"),w=t("k-empty"),C=t("k-table"),O=t("k-field");return n(),s(O,o(e.$props,{class:["k-structure-field",e.$attrs.class],input:e.id,style:e.$attrs.style,onClick:i[4]||(i[4]=S(()=>{},["stop"]))}),l({default:a(()=>[x("k-input-validator",o({id:e.id,min:r.min,max:r.max,required:e.required},{value:JSON.stringify(d.items)}),[u.hasFields?(n(),h(m,{key:0},[0===d.items.length?(n(),s(w,o({key:0,icon:"list-bullet"},k(e.disabled?{}:{click:()=>u.add()})),{default:a(()=>[v($(r.empty??e.$t("field.structure.empty")),1)]),_:1},16)):(n(),h(m,{key:1},[b(C,{columns:r.columns,disabled:e.disabled,fields:r.fields,empty:e.$t("field.structure.empty"),index:u.index,options:u.options,pagination:!(!r.limit||e.isSelecting)&&u.pagination,rows:u.paginatedItems,selecting:e.isSelecting,selected:e.selected,sortable:u.isSortable,class:"k-structure-field-table",onCell:i[2]||(i[2]=e=>u.open(e.row,e.columnIndex)),onInput:u.onTableInput,onOption:u.option,onPaginate:u.paginate,onSelect:e.onSelect},null,8,["columns","disabled","fields","empty","index","options","pagination","rows","selecting","selected","sortable","onInput","onOption","onPaginate","onSelect"]),u.more?(n(),h("footer",Sr,[b(f,{title:e.$t("add"),icon:"add",size:"xs",variant:"filled",onClick:i[3]||(i[3]=e=>u.add())},null,8,["title"])])):g("",!0)],64))],64)):(n(),s(w,{key:1,icon:"list-bullet"},{default:a(()=>[v($(e.$t("fields.empty")),1)]),_:1}))],16,xr)]),_:2},[u.hasFields&&!e.disabled?{name:"options",fn:a(()=>[e.isSelecting?(n(),s(p,{key:0,buttons:e.batchEditingButtons,size:"xs",variant:"filled"},null,8,["buttons"])):(n(),s(p,{key:1},{default:a(()=>[u.canSelect?(n(),s(f,o({key:0},e.batchEditingToggle,{size:"xs",variant:"filled"}),null,16)):g("",!0),b(p,{layout:"collapsed"},{default:a(()=>[b(f,{autofocus:r.autofocus,disabled:!u.more,responsive:!0,text:e.$t("add"),icon:"add",variant:"filled",size:"xs",onClick:i[0]||(i[0]=e=>u.add())},null,8,["autofocus","disabled","text"]),b(f,{icon:"dots",size:"xs",variant:"filled",onClick:i[1]||(i[1]=t=>e.$refs.options.toggle())}),b(y,{ref:"options",options:[{click:()=>u.add(),disabled:!u.more,icon:"add",text:e.$t("add")},{click:()=>u.removeAll(),disabled:0===d.items.length||e.disabled,icon:"trash",text:e.$t("delete.all")}],"align-x":"end"},null,8,["options"])]),_:1})]),_:1}))]),key:"0"}:void 0]),1040,["class","input","style"])}]]),Or={mixins:[Ao],props:{autocomplete:{default:"tel"},placeholder:{default:()=>window.panel.t("tel.placeholder")}}};const Ar=Ne({mixins:[Mo,Or],emits:["input"]},[["render",function(e,i,l,a,r,c){const d=t("k-string-input");return n(),s(d,o(e.$props,{type:"tel",class:"k-tel-input",onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16)}]]);const Ir=Ne({mixins:[Ws,hn,Or],inheritAttrs:!1,props:{icon:{type:String,default:"phone"}},emits:["input"],methods:{focus(){this.$refs.input.focus()}}},[["render",function(e,i,l,r,c,d){const u=t("k-input"),p=t("k-field");return n(),s(p,o(e.$props,{class:["k-tel-field",e.$attrs.class],input:e.id,style:e.$attrs.style}),{default:a(()=>[b(u,o(e.$props,{ref:"input",type:"tel",onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16)]),_:1},16,["class","input","style"])}]]),Mr={mixins:[Ao]};const _r=Ne({mixins:[Mo,Mr],emits:["input"]},[["render",function(e,i,l,a,r,c){const d=t("k-string-input");return n(),s(d,o(e.$props,{class:["k-text-input",e.$attrs.class],type:"text",onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16,["class"])}]]);const Dr=Ne({mixins:[Ws,hn,Mr,Co],inheritAttrs:!1,emits:["input"],computed:{inputType(){return this.$helper.isComponent(`k-${this.type}-input`)?this.type:"text"}},methods:{focus(){this.$refs.input.focus()},select(){this.$refs.input.select()}}},[["render",function(e,i,c,d,u,p){const h=t("k-input"),m=t("k-field");return n(),s(m,o(e.$props,{class:["k-text-field",e.$attrs.class],counter:e.counterOptions,input:e.id,style:e.$attrs.style}),l({default:a(()=>[b(h,o(e.$props,{ref:"input",type:p.inputType,onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16,["type"])]),_:2},[e.$slots.options?{name:"options",fn:a(()=>[r(e.$slots,"options")]),key:"0"}:void 0]),1040,["class","counter","input","style"])}]]),Er={props:{buttons:{type:[Array,Boolean],default:!0},uploads:[Boolean,Object,Array]}};const jr=Ne({mixins:[Er],emits:["command"],computed:{commands(){return{headlines:{label:this.$t("toolbar.button.headings"),icon:"title",dropdown:[{label:this.$t("toolbar.button.heading.1"),icon:"h1",click:()=>this.command("prepend","#")},{label:this.$t("toolbar.button.heading.2"),icon:"h2",click:()=>this.command("prepend","##")},{label:this.$t("toolbar.button.heading.3"),icon:"h3",click:()=>this.command("prepend","###")}]},bold:{label:this.$t("toolbar.button.bold"),icon:"bold",click:()=>this.command("toggle","**"),shortcut:"b"},italic:{label:this.$t("toolbar.button.italic"),icon:"italic",click:()=>this.command("toggle","*"),shortcut:"i"},link:{label:this.$t("toolbar.button.link"),icon:"url",click:()=>this.command("dialog","link"),shortcut:"k"},email:{label:this.$t("toolbar.button.email"),icon:"email",click:()=>this.command("dialog","email"),shortcut:"e"},file:{label:this.$t("toolbar.button.file"),icon:"attachment",click:()=>this.command("file"),dropdown:this.uploads?[{label:this.$t("toolbar.button.file.select"),icon:"check",click:()=>this.command("file")},{label:this.$t("toolbar.button.file.upload"),icon:"upload",click:()=>this.command("upload")}]:void 0},code:{label:this.$t("toolbar.button.code"),icon:"code",click:()=>this.command("toggle","`")},ul:{label:this.$t("toolbar.button.ul"),icon:"list-bullet",click:()=>this.command("insert",(e,t)=>t.split("\n").map(e=>"- "+e).join("\n"))},ol:{label:this.$t("toolbar.button.ol"),icon:"list-numbers",click:()=>this.command("insert",(e,t)=>t.split("\n").map((e,t)=>t+1+". "+e).join("\n"))}}},default:()=>["headlines","|","bold","italic","code","|","link","email","file","|","ul","ol"],layout(){if(!1===this.buttons)return[];const e=[],t=Array.isArray(this.buttons)?this.buttons:this.default,i={...this.commands,...window.panel.plugins.textareaButtons??{}};for(const s of t)if("|"===s)e.push("|");else if(i[s]){const t={...i[s],click:()=>{i[s].click?.call(this)}};e.push(t)}return e}},methods:{close(){this.$refs.toolbar.close()},command(e,...t){this.$emit("command",e,...t)},shortcut(e,t){const i=this.layout.find(t=>t.shortcut===e);i&&(t.preventDefault(),i.click?.())}}},[["render",function(e,i,o,l,a,r){const c=t("k-toolbar");return n(),s(c,{ref:"toolbar",buttons:r.layout,class:"k-textarea-toolbar"},null,8,["buttons"])}]]),Lr={mixins:[Er,bs,Ae,Ee,je,qe,Pe],props:{endpoints:Object,preselect:Boolean,size:String,value:String}},Br=["data-over","data-size"],Tr={class:"k-textarea-input-wrapper"},qr=["data-font"];const zr=Ne({mixins:[ys,Lr],emits:["focus","input","submit"],data:()=>({over:!1,selectionRange:null}),computed:{uploadOptions(){return{url:this.$panel.urls.api+"/"+this.endpoints.field+"/upload",multiple:!1,on:{cancel:async()=>await this.restoreSelection(),done:async e=>{await this.restoreSelection(),await this.insertUpload(e)}}}}},watch:{async value(){await this.$nextTick(),this.$library.autosize.update(this.$refs.input)}},async mounted(){await this.$nextTick(),this.$library.autosize(this.$refs.input),this.$props.autofocus&&this.focus(),this.$props.preselect&&this.select()},methods:{dialog(e){this.$panel.dialog.open({component:"k-toolbar-"+e+"-dialog",props:{value:this.parseSelection()},on:{cancel:async()=>await this.restoreSelection(),submit:async e=>{this.$panel.dialog.close(),await this.restoreSelection(),await this.insert(e)}}})},file(){this.$panel.dialog.open(this.endpoints.field+"/files",{on:{cancel:async()=>await this.restoreSelection(),submit:async({items:e})=>{this.$panel.dialog.close(),await this.restoreSelection(),await this.insertFile(e)}}})},focus(){this.$refs.input.focus()},async insert(e){const t=this.$refs.input,i=t.value;if("function"==typeof e&&(e=e(t,this.selection())),this.focus(),document.execCommand("insertText",!1,e),t.value===i&&this.selectionRange){const{start:i,end:s}=this.selectionRange,n=i===s?"end":"select";t.setRangeText(e,i,s,n)}return this.$emit("input",t.value),t.value},async insertFile(e){e?.length>0&&await this.insert(e.map(e=>e.dragText).join("\n\n"))},async insertUpload(e){await this.insertFile(e),await this.$panel.content.update()},onCommand(e,...t){if("function"!=typeof this[e])return console.warn(e+" is not a valid command");this[e](...t)},onDrop(e){if(this.uploads&&this.$helper.isUploadEvent(e))return this.$panel.upload.open(e.dataTransfer.files,this.uploadOptions);"text"===this.$panel.drag.type&&(this.focus(),this.insert(this.$panel.drag.data))},onFocus(e){this.$emit("focus",e)},onInput(e){this.$emit("input",e.target.value)},onOut(){this.$refs.input.blur(),this.over=!1},onOver(e){if(this.uploads&&this.$helper.isUploadEvent(e))return e.dataTransfer.dropEffect="copy",this.focus(),void(this.over=!0);"text"===this.$panel.drag.type&&(e.dataTransfer.dropEffect="copy",this.focus(),this.over=!0)},onSelectionChange(){this.selectionRange={start:this.$refs.input.selectionStart,end:this.$refs.input.selectionEnd}},onShortcut(e){!1!==this.buttons&&"Meta"!==e.key&&"Control"!==e.key&&this.$refs.toolbar?.shortcut(e.key,e)},onSubmit(e){return this.$emit("submit",e)},parseSelection(){const e=this.selection();if(0===e?.length)return{href:null,title:null};let t;t=this.$panel.config.kirbytext?/^\(link:\s*(?<url>.*?)(?:\s*text:\s*(?<text>.*?))?\)$/is:/^(\[(?<text>.*?)\]\((?<url>.*?)\))|(<(?<link>.*?)>)$/is;const i=t.exec(e);return null!==i?{href:i.groups.url??i.groups.link,title:i.groups.text??null}:{href:null,title:e}},async prepend(e){return this.insert(e+" "+this.selection())},async restoreSelection(){this.selectionRange&&this.$refs.input.setSelectionRange(this.selectionRange.start,this.selectionRange.end),await this.$nextTick()},restoreSelectionCallback(){return async e=>{await this.restoreSelection(),e&&e()}},select(){this.$refs.select()},selection(){if(!this.selectionRange)return"";const{start:e,end:t}=this.selectionRange;return this.$refs.input.value.substring(e,t)},async toggle(e,t){t??=e;const i=this.selection();return i.startsWith(e)&&i.endsWith(t)?this.insert(i.slice(e.length).slice(0,i.length-e.length-t.length)):this.wrap(e,t)},upload(){this.$panel.upload.pick(this.uploadOptions)},async wrap(e,t){t??=e,await this.insert(e+this.selection()+t)}}},[["render",function(e,i,l,a,r,c){const d=t("k-textarea-toolbar"),m=D("direction");return n(),h("div",{class:p(["k-textarea-input",e.$attrs.class]),"data-over":r.over,"data-size":e.size,style:u(e.$attrs.style)},[x("div",Tr,[e.buttons&&!e.disabled?(n(),s(d,{key:0,ref:"toolbar",buttons:e.buttons,disabled:e.disabled,uploads:e.uploads,onMousedown:i[0]||(i[0]=S(()=>{},["prevent"])),onCommand:c.onCommand},null,8,["buttons","disabled","uploads","onCommand"])):g("",!0),E(x("textarea",o({ref:"input"},{autofocus:e.autofocus,disabled:e.disabled,id:e.id,minlength:e.minlength,name:e.name,placeholder:e.placeholder,required:e.required,spellcheck:e.spellcheck,value:e.value},{"data-font":e.font,class:"k-textarea-input-native",onClick:i[1]||(i[1]=t=>e.$refs.toolbar?.close()),onFocus:i[2]||(i[2]=(...e)=>c.onFocus&&c.onFocus(...e)),onInput:i[3]||(i[3]=(...e)=>c.onInput&&c.onInput(...e)),onKeydown:[i[4]||(i[4]=_(S((...e)=>c.onSubmit&&c.onSubmit(...e),["meta"]),["enter"])),i[5]||(i[5]=_(S((...e)=>c.onSubmit&&c.onSubmit(...e),["ctrl"]),["enter"])),i[6]||(i[6]=S((...e)=>c.onShortcut&&c.onShortcut(...e),["meta","exact"])),i[7]||(i[7]=S((...e)=>c.onShortcut&&c.onShortcut(...e),["ctrl","exact"]))],onDragover:i[8]||(i[8]=(...e)=>c.onOver&&c.onOver(...e)),onDragleave:i[9]||(i[9]=(...e)=>c.onOut&&c.onOut(...e)),onDrop:i[10]||(i[10]=(...e)=>c.onDrop&&c.onDrop(...e)),onSelectionchange:i[11]||(i[11]=(...e)=>c.onSelectionChange&&c.onSelectionChange(...e))}),null,16,qr),[[m]])])],14,Br)}]]);const Pr=Ne({mixins:[Ws,hn,Lr,Co],inheritAttrs:!1,emits:["input"],methods:{focus(){this.$refs.input.focus()}}},[["render",function(e,i,l,r,c,d){const u=t("k-input"),p=t("k-field");return n(),s(p,o(e.$props,{class:["k-textarea-field",e.$attrs.class],counter:e.counterOptions,input:e.id,style:e.$attrs.style}),{default:a(()=>[b(u,o(e.$props,{ref:"input",type:"textarea",onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16)]),_:1},16,["class","counter","input","style"])}]]),Nr={props:{max:String,min:String,value:String}},Fr={mixins:[Nr],props:{display:{type:String,default:"HH:mm"},step:{type:Object,default:()=>({size:5,unit:"minute"})},type:{type:String,default:"time"}}},Rr={mixins:[zo,Fr],computed:{inputType:()=>"time"}};const Yr=Ne({mixins:[Ws,hn,Fr],inheritAttrs:!1,props:{icon:{type:String,default:"clock"},times:{type:Boolean,default:!0}},emits:["input","submit"],methods:{focus(){this.$refs.input.focus()},select(e){this.$emit("input",e),this.$refs.times?.close()}}},[["render",function(e,i,r,c,d,u){const p=t("k-button"),h=t("k-timeoptions-input"),m=t("k-dropdown"),f=t("k-input"),g=t("k-field");return n(),s(g,o(e.$props,{class:["k-time-field",e.$attrs.class],input:e.id,style:e.$attrs.style}),{default:a(()=>[b(f,o(e.$props,{ref:"input",type:"time",onInput:i[1]||(i[1]=t=>e.$emit("input",t??"")),onSubmit:i[2]||(i[2]=t=>e.$emit("submit"))}),l({_:2},[r.times?{name:"icon",fn:a(()=>[b(p,{disabled:e.disabled,icon:r.icon??"clock",title:e.$t("time.select"),class:"k-input-icon-button",onClick:i[0]||(i[0]=t=>e.$refs.times.toggle())},null,8,["disabled","icon","title"]),b(m,{ref:"times","align-x":"end"},{default:a(()=>[b(h,{display:e.display,value:e.value,onInput:u.select},null,8,["display","value","onInput"])]),_:1},512)]),key:"0"}:void 0]),1040)]),_:1},16,["class","input","style"])}]]),Hr={mixins:[bs],props:{checked:{type:Boolean},info:{type:String},icon:{type:String},label:{type:String},type:{default:"checkbox",type:String},value:{type:[Boolean,Number,String]},variant:{type:String}}},Ur=["aria-disabled"],Vr=["data-variant"],Kr={key:1,class:"k-choice-input-label"},Wr=["innerHTML"],Jr=["innerHTML"];const Gr=Ne({mixins:[ys,Hr],emits:["click","input"]},[["render",function(e,i,l,a,r,c){const d=t("k-icon");return n(),h("label",{"aria-disabled":e.disabled,class:p(["k-choice-input",e.$attrs.class]),style:u(e.$attrs.style)},[x("input",o({autofocus:e.autofocus,id:e.id,checked:e.checked,disabled:e.disabled,name:e.name,required:e.required,type:e.type,value:e.value},{class:["invisible"===e.variant?"sr-only":null,e.$attrs.class],"data-variant":e.variant,style:e.$attrs.style,onClick:i[0]||(i[0]=t=>e.$emit("click",t)),onInput:i[1]||(i[1]=t=>e.$emit("input",t.target.checked))}),null,16,Vr),e.icon?(n(),s(d,{key:0,type:e.icon,class:"k-choice-input-icon"},null,8,["type"])):g("",!0),e.label||e.info?(n(),h("span",Kr,[x("span",{class:"k-choice-input-label-text",innerHTML:e.label},null,8,Wr),e.info?(n(),h("span",{key:0,class:"k-choice-input-label-info",innerHTML:e.info},null,8,Jr)):g("",!0)])):g("",!0)],14,Ur)}]]),Xr={mixins:[Hr],props:{text:{type:[Array,String]},value:Boolean}};const Zr=Ne({mixins:[ys,Xr],emits:["input"],computed:{labelText(){const e=this.text??[this.$t("off"),this.$t("on")];return Array.isArray(e)?this.value?e[1]:e[0]:e}},mounted(){this.$props.autofocus&&this.focus()},methods:{onEnter(e){"Enter"===e.key&&this.$el.click()},onInput(e){this.$emit("input",e)},select(){this.$el.focus()}}},[["render",function(e,i,l,a,r,c){const d=t("k-choice-input");return n(),s(d,o(e.$props,{checked:e.value,class:["k-toggle-input",e.$attrs.class],disabled:e.disabled,label:c.labelText,style:e.$attrs.style,type:"checkbox",variant:"toggle",onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16,["checked","class","disabled","label","style"])}]]);const Qr=Ne({mixins:[Ws,hn,Xr],inheritAttrs:!1,emits:["input"],methods:{focus(){this.$refs.input.focus()}}},[["render",function(e,i,l,r,c,d){const u=t("k-toggle-input"),p=t("k-field");return n(),s(p,o(e.$props,{class:["k-toggle-field",e.$attrs.class],input:e.id,style:e.$attrs.style}),{default:a(()=>[b(u,o(e.$props,{ref:"input",type:"toggle",onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16)]),_:1},16,["class","input","style"])}]]),ec={mixins:[bs],props:{columns:Number,grow:Boolean,labels:Boolean,options:Array,resettable:Boolean,value:[String,Number,Boolean]}},tc=["disabled"],ic={class:"sr-only"},sc=["required","value"],nc=["data-labels"],oc=["id","aria-label","disabled","value","name","checked","onClick","onChange"],lc=["for","title"],ac=["innerHTML"];const rc=Ne({mixins:[ys,ec],emits:["input"],mounted(){this.$props.autofocus&&this.focus()},methods:{focus(){(this.$el.querySelector("input[checked]")||this.$el.querySelector("input"))?.focus()},onClick(e){e===this.value&&this.resettable&&!this.required&&this.$emit("input","")},onInput(e){this.$emit("input",e)},select(){this.focus()}}},[["render",function(e,i,o,l,a,r){const c=t("k-icon");return n(),h("fieldset",{disabled:e.disabled,class:p(["k-toggles-input",e.$attrs.class]),style:u(e.$attrs.style)},[x("legend",ic,$(e.$t("options")),1),x("k-input-validator",{required:e.required,value:JSON.stringify(e.value)},[x("ul",{"data-labels":e.labels,style:u({"--options":e.columns??e.options.length})},[(n(!0),h(m,null,f(e.options,(t,i)=>(n(),h("li",{key:i},[x("input",{id:e.id+"-"+i,"aria-label":t.text,disabled:e.disabled,value:t.value,name:e.id,checked:e.value===t.value,class:"input-hidden",type:"radio",onClick:e=>r.onClick(t.value),onChange:e=>r.onInput(t.value)},null,40,oc),x("label",{for:e.id+"-"+i,title:t.text},[t.icon?(n(),s(c,{key:0,type:t.icon},null,8,["type"])):g("",!0),e.labels||!t.icon?(n(),h("span",{key:1,class:"k-toggles-text",innerHTML:t.text},null,8,ac)):g("",!0)],8,lc)]))),128))],12,nc)],8,sc)],14,tc)}]]);const cc=Ne({mixins:[Ws,hn,ec],inheritAttrs:!1,emits:["input"],methods:{focus(){this.$refs.input.focus()},onInput(e){this.$emit("input",e)}}},[["render",function(e,i,l,r,c,d){const u=t("k-empty"),p=t("k-input"),h=t("k-field");return n(),s(h,o(e.$props,{class:["k-toggles-field",e.$attrs.class],input:e.id,style:e.$attrs.style}),{default:a(()=>[e.options?.length?(n(),s(p,o({key:1,ref:"input",class:{grow:e.grow}},e.$props,{type:"toggles",onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16,["class"])):(n(),s(u,{key:0,text:e.$t("options.none"),icon:"checklist"},null,8,["text"]))]),_:1},16,["class","input","style"])}]]),dc={mixins:[Ao],props:{autocomplete:{type:String,default:"url"},placeholder:{type:String,default:()=>window.panel.t("url.placeholder")}}};const uc=Ne({mixins:[Mo,dc],emits:["input"],watch:{value:{handler(){this.validate()},immediate:!0}},methods:{validate(){const e=[];this.value&&!1===this.$helper.url.isUrl(this.value,!0)&&e.push(this.$t("error.validation.url")),this.$el?.setCustomValidity(e.join(", "))}}},[["render",function(e,i,l,a,r,c){const d=t("k-string-input");return n(),s(d,o(e.$props,{type:"url",class:"k-url-input",onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16)}]]);const pc=Ne({mixins:[Ws,hn,dc],inheritAttrs:!1,props:{link:{type:Boolean,default:!0},icon:{type:String,default:"url"}},emits:["input"],computed:{isValidUrl(){return""!==this.value&&!0===this.$helper.url.isUrl(this.value,!0)}},methods:{focus(){this.$refs.input.focus()}}},[["render",function(e,i,l,r,c,d){const u=t("k-button"),p=t("k-input"),h=t("k-field");return n(),s(h,o(e.$props,{class:["k-url-field",e.$attrs.class],input:e.id,style:e.$attrs.style}),{default:a(()=>[b(p,o(e.$props,{ref:"input",type:"url",onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),{icon:a(()=>[l.link&&d.isValidUrl?(n(),s(u,{key:0,icon:l.icon,link:e.value,title:e.$t("open"),class:"k-input-icon-button",tabindex:"-1",target:"_blank"},null,8,["icon","link","title"])):g("",!0)]),_:1},16)]),_:1},16,["class","input","style"])}]]),hc={extends:Xo,type:"users",computed:{emptyProps(){return{icon:"users",text:this.empty??(this.multiple&&1!==this.max?this.$t("field.users.empty"):this.$t("field.users.empty.single"))}}}};const mc=Ne({mixins:[Ws,hn,aa,Co],inheritAttrs:!1,emits:["input"],computed:{counterValue(){const e=this.$helper.string.stripHTML(this.value??"");return this.$helper.string.unescapeHTML(e)}},methods:{focus(){this.$refs.input.focus()}}},[["render",function(e,i,l,r,c,d){const u=t("k-input"),p=t("k-field");return n(),s(p,o(e.$props,{counter:e.counterOptions,class:["k-writer-field",e.$attrs.class],input:e.id,style:e.$attrs.style}),{default:a(()=>[b(u,o(e.$props,{ref:"input",after:e.after,before:e.before,icon:e.icon,type:"writer",onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16,["after","before","icon"])]),_:1},16,["counter","class","input","style"])}]]),fc={type:"model",mixins:[Ws,Se,De],inheritAttrs:!1,props:{empty:String,info:String,link:Boolean,max:Number,min:Number,multiple:Boolean,parent:String,search:Boolean,size:String,text:String,value:{type:Array,default:()=>[]}},emits:["change","input"],data(){return{selected:this.value}},computed:{buttons(){return[{autofocus:this.autofocus,text:this.$t("select"),icon:"checklist",responsive:!0,click:()=>this.open()}]},collection(){return{empty:this.emptyProps,items:this.selected,layout:this.layout,link:this.link,size:this.size,sortable:!this.disabled&&this.selected.length>1,theme:this.disabled?"disabled":null}},hasDropzone:()=>!1,more(){return!this.max||this.max>this.selected.length}},watch:{value(e){this.selected=e}},methods:{drop(){},focus(){},onInput(){this.$emit("input",this.selected)},open(){if(this.disabled)return!1;this.$panel.dialog.open({component:`k-${this.$options.type}-dialog`,props:{endpoint:this.endpoints.field,hasSearch:this.search,max:this.max,multiple:this.multiple,value:this.selected.map(e=>e.id)},on:{submit:e=>{this.select(e),this.$panel.dialog.close()}}})},remove(e){this.selected.splice(e,1),this.onInput()},removeById(e){this.selected=this.selected.filter(t=>t.id!==e),this.onInput()},select(e){if(0===e.length)return this.selected=[],void this.onInput();this.selected=this.selected.filter(t=>e.find(e=>e.id===t.id));for(const t of e)this.selected.find(e=>t.id===e.id)||this.selected.push(t);this.onInput()}}},gc=["value"];const kc=Ne(fc,[["render",function(e,i,r,c,d,u){const p=t("k-button-group"),h=t("k-button"),m=t("k-collection"),f=t("k-dropzone"),g=t("k-field");return n(),s(g,o(e.$props,{class:["k-models-field",`k-${e.$options.type}-field`,e.$attrs.class],input:!1,style:e.$attrs.style}),l({default:a(()=>[b(f,{disabled:!u.hasDropzone,onDrop:u.drop},{default:a(()=>[x("k-input-validator",o({min:r.min,max:r.max,required:e.required},{value:JSON.stringify(r.value)}),[b(m,o(u.collection,k(e.disabled?{}:{empty:u.open}),{onSort:u.onInput,onSortChange:i[0]||(i[0]=t=>e.$emit("change",t))}),l({_:2},[e.disabled?void 0:{name:"options",fn:a(({index:t})=>[b(h,{title:e.$t("remove"),icon:"remove",onClick:e=>u.remove(t)},null,8,["title","onClick"])]),key:"0"}]),1040,["onSort"])],16,gc)]),_:1},8,["disabled","onDrop"])]),_:2},[e.disabled?void 0:{name:"options",fn:a(()=>[b(p,{ref:"buttons",buttons:u.buttons,layout:"collapsed",size:"xs",variant:"filled",class:"k-field-options"},null,8,["buttons"])]),key:"0"}]),1040,["class","style"])}]]),bc={extends:kc,type:"files",props:{uploads:[Boolean,Object,Array]},computed:{buttons(){const e=kc.computed.buttons.call(this);return this.hasDropzone&&e.unshift({autofocus:this.autofocus,text:this.$t("upload"),responsive:!0,icon:"upload",click:()=>this.$panel.upload.pick(this.uploadOptions)}),e},emptyProps(){return{icon:"image",text:this.empty??(this.multiple&&1!==this.max?this.$t("field.files.empty"):this.$t("field.files.empty.single"))}},hasDropzone(){return!this.disabled&&this.more&&this.uploads},uploadOptions(){return{accept:this.uploads.accept,max:this.max,multiple:this.multiple,preview:this.uploads.preview,url:this.$panel.urls.api+"/"+this.endpoints.field+"/upload",on:{done:async e=>{!1===this.multiple&&(this.selected=[]);for(const t of e)void 0===this.selected.find(e=>e.id===t.id)&&this.selected.push(t);this.onInput(),await this.$panel.content.update()}}}}},mounted(){this.$events.on("file.delete",this.removeById)},unmounted(){this.$events.off("file.delete",this.removeById)},methods:{drop(e){return!1!==this.uploads&&this.$panel.upload.open(e,this.uploadOptions)}}},yc={extends:kc,type:"pages",computed:{emptyProps(){return{icon:"page",text:this.empty??(this.multiple&&1!==this.max?this.$t("field.pages.empty"):this.$t("field.pages.empty.single"))}}}},vc={extends:kc,type:"users",computed:{emptyProps(){return{icon:"users",text:this.empty??(this.multiple&&1!==this.max?this.$t("field.users.empty"):this.$t("field.users.empty.single"))}}}},$c={install(e){e.component("k-blocks-field",bo),e.component("k-buttons-field",yo),e.component("k-checkboxes-field",Oo),e.component("k-color-field",Lo),e.component("k-date-field",Fo),e.component("k-email-field",Ho),e.component("k-entries-field",Wo),e.component("k-files-field",Zo),e.component("k-gap-field",el),e.component("k-headline-field",il),e.component("k-info-field",ol),e.component("k-layout-field",kl),e.component("k-line-field",yl),e.component("k-link-field",Sl),e.component("k-list-field",ma),e.component("k-multiselect-field",ja),e.component("k-number-field",Ta),e.component("k-object-field",Ra),e.component("k-pages-field",Ya),e.component("k-password-field",Va),e.component("k-radio-field",Za),e.component("k-range-field",lr),e.component("k-select-field",hr),e.component("k-slug-field",gr),e.component("k-stats-field",vr),e.component("k-structure-field",Cr),e.component("k-tags-field",Ea),e.component("k-text-field",Dr),e.component("k-textarea-field",Pr),e.component("k-tel-field",Ir),e.component("k-time-field",Yr),e.component("k-toggle-field",Qr),e.component("k-toggles-field",cc),e.component("k-url-field",pc),e.component("k-users-field",hc),e.component("k-writer-field",mc),e.component("k-legacy-checkboxes-field",Oo),e.component("k-legacy-color-field",Lo),e.component("k-legacy-date-field",Fo),e.component("k-legacy-email-field",Ho),e.component("k-legacy-files-field",bc),e.component("k-legacy-gap-field",el),e.component("k-legacy-headline-field",il),e.component("k-legacy-info-field",ol),e.component("k-legacy-line-field",yl),e.component("k-legacy-link-field",Sl),e.component("k-legacy-list-field",ma),e.component("k-legacy-object-field",Ra),e.component("k-legacy-models-field",kc),e.component("k-legacy-multiselect-field",ja),e.component("k-legacy-number-field",Ta),e.component("k-legacy-pages-field",yc),e.component("k-legacy-radio-field",Za),e.component("k-legacy-select-field",hr),e.component("k-legacy-slug-field",gr),e.component("k-legacy-structure-field",Cr),e.component("k-legacy-tags-field",Ea),e.component("k-legacy-tel-field",Ir),e.component("k-legacy-text-field",Dr),e.component("k-legacy-textarea-field",Pr),e.component("k-legacy-time-field",Yr),e.component("k-legacy-toggle-field",Qr),e.component("k-legacy-toggles-field",cc),e.component("k-legacy-url-field",pc),e.component("k-legacy-users-field",vc),e.component("k-legacy-writer-field",mc)}},wc={mixins:[Qa],props:{max:null,min:null,step:{default:.01,type:Number},tooltip:{default:!1,type:[Boolean,Object]}}};const xc=Ne({mixins:[or,wc],emits:["input"]},[["render",function(e,i,l,a,r,c){const d=t("k-range-input");return n(),s(d,o(e.$props,{min:0,max:1,class:"k-alpha-input",onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16)}]]),Sc=["sun","mon","tue","wed","thu","fri","sat"],Cc={class:"sr-only"},Oc={class:"k-calendar-selects"},Ac=["aria-current","aria-selected"],Ic={class:"k-calendar-today",colspan:"7"},Mc=["id","disabled","min","max","name","required","value"];const _c=Ne({mixins:[bs,Bo],emits:["input"],data(){const e=this.$library.dayjs();return{maxdate:null,mindate:null,month:e.month(),selected:null,today:e,year:e.year()}},computed:{numberOfDays(){return this.toDate().daysInMonth()},firstWeekday(){const e=Sc[this.toDate().day()];return this.weekdays.indexOf(e)},weekdays(){const e=this.$panel.translation.weekday;return[...Sc.slice(e),...Sc.slice(0,e)]},weeks(){return Math.ceil((this.numberOfDays+this.firstWeekday)/7)},monthnames(){return["january","february","march","april","may","june","july","august","september","october","november","december"].map(e=>this.$t("months."+e))},months(){var e=[];return this.monthnames.forEach((t,i)=>{e.push({value:i,text:t})}),e},years(){const e=this.year-20,t=this.year+20;return this.toOptions(e,t)}},watch:{max:{handler(e,t){e!==t&&(this.maxdate=this.$library.dayjs.interpret(e,"date"))},immediate:!0},min:{handler(e,t){e!==t&&(this.mindate=this.$library.dayjs.interpret(e,"date"))},immediate:!0},value:{handler(e,t){e!==t&&(this.selected=this.$library.dayjs.interpret(e,"date"),this.show(this.selected))},immediate:!0}},methods:{days(e){let t=[];const i=7*(e-1)+1,s=i+7;for(let n=i;n<s;n++){const e=n-this.firstWeekday,i=e<=0||e>this.numberOfDays;t.push(i?"":e)}return t},isDisabled(e){const t=this.toDate(e);return this.disabled||t.isBefore(this.mindate,"day")||t.isAfter(this.maxdate,"day")},isSelected(e){return this.toDate(e).isSame(this.selected,"day")},isToday(e){return this.toDate(e).isSame(this.today,"day")},onNext(){const e=this.toDate().add(1,"month");this.show(e)},onPrev(){const e=this.toDate().subtract(1,"month");this.show(e)},select(e){this.$emit("input",e?.toISO("date")??null)},show(e){this.month=(e??this.today).month(),this.year=(e??this.today).year()},toDate(e=1,t){return this.$library.dayjs(`${this.year}-${(t??this.month)+1}-${e}`)},toOptions(e,t){for(var i=[],s=e;s<=t;s++)i.push({value:s,text:this.$helper.pad(s)});return i}}},[["render",function(e,i,o,l,a,r){const c=t("k-button"),d=t("k-select-input");return n(),h("fieldset",{class:p(["k-calendar-input",e.$attrs.class]),style:u(e.$attrs.style),onClick:i[3]||(i[3]=S(()=>{},["stop"]))},[x("legend",Cc,$(e.$t("date.select")),1),x("nav",null,[b(c,{title:e.$t("prev"),icon:"angle-left",onClick:r.onPrev},null,8,["title","onClick"]),x("span",Oc,[b(d,{"aria-label":e.$t("month"),autofocus:e.autofocus,options:r.months,empty:!1,required:!0,value:a.month,onInput:i[0]||(i[0]=e=>a.month=Number(e))},null,8,["aria-label","autofocus","options","value"]),b(d,{"aria-label":e.$t("year"),options:r.years,empty:!1,required:!0,value:a.year,onInput:i[1]||(i[1]=e=>a.year=Number(e))},null,8,["aria-label","options","value"])]),b(c,{title:e.$t("next"),icon:"angle-right",onClick:r.onNext},null,8,["title","onClick"])]),(n(),h("table",{key:a.year+"-"+a.month,class:"k-calendar-table"},[x("thead",null,[x("tr",null,[(n(!0),h(m,null,f(r.weekdays,t=>(n(),h("th",{key:"weekday_"+t},$(e.$t("days."+t)),1))),128))])]),x("tbody",null,[(n(!0),h(m,null,f(r.weeks,e=>(n(),h("tr",{key:"week_"+e},[(n(!0),h(m,null,f(r.days(e),(e,t)=>(n(),h("td",{key:"day_"+t,"aria-current":!!r.isToday(e)&&"date","aria-selected":!!r.isSelected(e)&&"date",class:"k-calendar-day"},[e?(n(),s(c,{key:0,disabled:r.isDisabled(e),text:e,onClick:t=>r.select(r.toDate(e))},null,8,["disabled","text","onClick"])):g("",!0)],8,Ac))),128))]))),128))]),x("tfoot",null,[x("tr",null,[x("td",Ic,[b(c,{disabled:e.disabled,text:e.$t("today"),onClick:i[2]||(i[2]=e=>{r.show(a.today),r.select(a.today)})},null,8,["disabled","text"])])])])])),x("input",{id:e.id,disabled:e.disabled,min:e.min,max:e.max,name:e.name,required:e.required,value:e.value,class:"input-hidden",tabindex:"-1",type:"date"},null,8,Mc)],6)}]]),Dc={extends:Gr},Ec=["disabled"],jc={class:"sr-only"},Lc=["title"],Bc=["autofocus","checked","disabled","name","required","value","onClick","onInput"];const Tc=Ne({mixins:[Xa,{mixins:[Ka],props:{format:{type:String,default:"hex",validator:e=>["hex","rgb","hsl"].includes(e)},value:{type:String}}}],emits:["input"],computed:{choices(){return this.options.map(e=>({...e,title:e.text??e.value,value:this.colorToString(e.value)}))}},methods:{colorToString(e){try{return this.$library.colors.toString(e,this.format)}catch{return e}}}},[["render",function(e,i,s,o,l,a){const r=t("k-color-frame");return a.choices.length?(n(),h("fieldset",{key:0,disabled:e.disabled,class:"k-coloroptions-input"},[x("legend",jc,$(e.$t("options")),1),x("ul",null,[(n(!0),h(m,null,f(a.choices,(t,i)=>(n(),h("li",{key:i},[x("label",{title:t.title},[x("input",{autofocus:e.autofocus&&0===i,checked:t.value===e.value,disabled:e.disabled,name:e.name??e.id,required:e.required,value:t.value,class:"input-hidden",type:"radio",onClick:i=>e.toggle(t.value),onInput:i=>e.$emit("input",t.value)},null,40,Bc),b(r,{color:t.value},null,8,["color"])],8,Lc)]))),128))])],8,Ec)):g("",!0)}]]),qc={mixins:[bs,Be],props:{alpha:{default:!0,type:Boolean},format:{default:"hex",type:String,validator:e=>["hex","rgb","hsl"].includes(e)},value:{type:[Object,String]}}},zc={class:"sr-only"},Pc=["aria-label"],Nc=["aria-label"],Fc=["name","required","value"];const Rc=Ne({mixins:[ys,qc],emits:["input"],data:()=>({color:{h:0,s:0,v:1,a:1},formatted:null}),computed:{coords(){return this.value?{x:100*this.color.s,y:100*(1-this.color.v)}:null},hsl(){try{const e=this.$library.colors.convert(this.color,"hsl");return{h:e.h,s:(100*e.s).toFixed()+"%",l:(100*e.l).toFixed()+"%",a:e.a}}catch{return{h:0,s:"0%",l:"0%",a:1}}}},watch:{value:{handler(e,t){if(e===t||e===this.formatted)return;const i=this.$library.colors.parseAs(e??"","hsv");i?(this.formatted=this.$library.colors.toString(i,this.format),this.color=i):(this.formatted=null,this.color={h:0,s:0,v:1,a:1})},immediate:!0}},methods:{between:(e,t,i)=>Math.min(Math.max(e,t),i),emit(){return this.formatted=this.$library.colors.toString(this.color,this.format),this.$emit("input",this.formatted)},focus(){this.$refs.coords.focus()},setAlpha(e){this.color.a=this.alpha?this.between(Number(e),0,1):1,this.emit()},setCoords(e){if(!e)return this.$emit("input","");const t=Math.round(e.x),i=Math.round(e.y);this.color.s=this.between(t/100,0,1),this.color.v=this.between(1-i/100,0,1),this.emit()},setHue(e){this.color.h=this.between(Number(e),0,360),this.emit()}}},[["render",function(e,i,s,o,l,a){const r=t("k-coords-input"),c=t("k-hue-input"),d=t("k-alpha-input"),m=t("k-coloroptions-input");return n(),h("fieldset",{class:p(["k-colorpicker-input",e.$attrs.class]),style:u({"--h":a.hsl.h,"--s":a.hsl.s,"--l":a.hsl.l,"--a":a.hsl.a,...e.$attrs.style})},[x("legend",zc,$(e.$t("color")),1),b(r,{ref:"coords",autofocus:e.autofocus,disabled:e.disabled,required:e.required,value:a.coords,onInput:i[0]||(i[0]=e=>a.setCoords(e))},null,8,["autofocus","disabled","required","value"]),x("label",{"aria-label":e.$t("hue")},[b(c,{disabled:e.disabled,required:e.required,value:l.color.h,onInput:i[1]||(i[1]=e=>a.setHue(e))},null,8,["disabled","required","value"])],8,Pc),e.alpha?(n(),h("label",{key:0,"aria-label":e.$t("alpha")},[b(d,{disabled:e.disabled,required:e.required,value:l.color.a,onInput:i[2]||(i[2]=e=>a.setAlpha(e))},null,8,["disabled","required","value"])],8,Nc)):g("",!0),b(m,{disabled:e.disabled,format:e.format,options:e.options,required:e.required,value:e.value,onInput:i[3]||(i[3]=t=>e.$emit("input",t))},null,8,["disabled","format","options","required","value"]),x("input",{name:e.name,required:e.required,value:l.formatted,class:"input-hidden",tabindex:"-1",type:"text"},null,8,Fc)],6)}]]),Yc={mixins:[bs],props:{reset:{default:!0,type:Boolean},value:{default:()=>({x:0,y:0}),type:Object}}},Hc=["aria-disabled","data-empty"],Uc=["id","autofocus","disabled"],Vc=["name","required","value"];const Kc=Ne({mixins:[ys,Yc],emits:["input"],data:()=>({x:0,y:0}),watch:{value:{handler(e){const t=this.parse(e);this.x=t?.x??0,this.y=t?.y??0},immediate:!0}},methods:{focus(){this.$el.querySelector("button")?.focus()},getCoords:(e,t)=>({x:Math.min(Math.max(e.clientX-t.left,0),t.width),y:Math.min(Math.max(e.clientY-t.top,0),t.height)}),onDelete(){this.reset&&!this.required&&this.$emit("input",null)},onDrag(e){if(0!==e.button)return;const t=e=>this.onMove(e),i=()=>{window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",i)};window.addEventListener("mousemove",t),window.addEventListener("mouseup",i)},onEnter(){this.$el.form?.requestSubmit()},onInput(e,t){if(e.preventDefault(),e.stopPropagation(),this.disabled)return!1;this.x=Math.min(Math.max(parseFloat(t.x??this.x??0),0),100),this.y=Math.min(Math.max(parseFloat(t.y??this.y??0),0),100),this.$emit("input",{x:this.x,y:this.y})},onKeys(e){const t=e.shiftKey?10:1,i={ArrowUp:{y:this.y-t},ArrowDown:{y:this.y+t},ArrowLeft:{x:this.x-t},ArrowRight:{x:this.x+t}};i[e.key]&&this.onInput(e,i[e.key])},async onMove(e){const t=this.$el.getBoundingClientRect(),i=this.getCoords(e,t),s=i.x/t.width*100,n=i.y/t.height*100;this.onInput(e,{x:s,y:n}),await this.$nextTick(),this.focus()},parse(e){if("object"==typeof e)return e;const t={"top left":{x:0,y:0},"top center":{x:50,y:0},"top right":{x:100,y:0},"center left":{x:0,y:50},center:{x:50,y:50},"center center":{x:50,y:50},"center right":{x:100,y:50},"bottom left":{x:0,y:100},"bottom center":{x:50,y:100},"bottom right":{x:100,y:100}};if(t[e])return t[e];const i=e.split(",").map(e=>e.trim());return{x:i[0],y:i[1]??0}}}},[["render",function(e,t,i,s,o,l){return n(),h("div",{"aria-disabled":e.disabled,class:p(["k-coords-input",e.$attrs.class]),"data-empty":!e.value,style:u(e.$attrs.style),onMousedown:t[2]||(t[2]=(...e)=>l.onDrag&&l.onDrag(...e)),onClick:t[3]||(t[3]=(...e)=>l.onMove&&l.onMove(...e)),onKeydown:t[4]||(t[4]=(...e)=>l.onKeys&&l.onKeys(...e))},[r(e.$slots,"default"),x("button",{id:e.id,autofocus:e.autofocus,disabled:e.disabled,style:u({left:`${o.x}%`,top:`${o.y}%`}),class:"k-coords-input-thumb",onKeydown:[t[0]||(t[0]=_(S((...e)=>l.onEnter&&l.onEnter(...e),["prevent"]),["enter"])),t[1]||(t[1]=_((...e)=>l.onDelete&&l.onDelete(...e),["delete"]))]},null,44,Uc),x("input",{name:e.name,required:e.required,value:e.value?[e.value.x,e.value.y]:null,class:"input-hidden",tabindex:"-1",type:"text"},null,8,Vc)],46,Hc)}]]),Wc={mixins:[Qa],props:{max:null,min:null,step:{default:1,type:Number},tooltip:{default:!1,type:[Boolean,Object]}}};const Jc=Ne({mixins:[or,Wc],emits:["input"]},[["render",function(e,i,l,a,r,c){const d=t("k-range-input");return n(),s(d,o(e.$props,{min:0,max:360,class:"k-hue-input",onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16)}]]);const Gc=Ne({mixins:[Mo,{mixins:[Ao],props:{autocomplete:null,pattern:null,spellcheck:null,placeholder:{default:()=>window.panel.t("search")+" …",type:String}}}],emits:["input"]},[["render",function(e,i,l,a,r,c){const d=t("k-string-input");return n(),s(d,o(e.$props,{spellcheck:!1,autocomplete:"off",class:"k-search-input",type:"search",onInput:i[0]||(i[0]=t=>e.$emit("input",t))}),null,16)}]]),Xc={class:"sr-only"},Zc={key:0},Qc={class:"sr-only"},ed={key:0},td=["id","disabled","min","max","name","required","value"];const id=Ne({mixins:[ys,{mixins:[bs,Nr]}],props:{display:{type:String,default:"HH:mm"},value:String},emits:["input"],computed:{day(){return this.formatTimes([6,7,8,9,10,11,"-",12,13,14,15,16,17])},night(){return this.formatTimes([18,19,20,21,22,23,"-",0,1,2,3,4,5])}},methods:{focus(){this.$el.querySelector("button").focus()},formatTimes(e){return e.map(e=>{if("-"===e)return e;const t=this.$library.dayjs(e+":00","H:mm");return{display:t.format(this.display),select:t.toISO("time")}})},select(e){this.$emit("input",e)}}},[["render",function(e,i,o,l,r,c){const d=t("k-icon"),g=t("k-button");return n(),h("div",{class:p(["k-timeoptions-input",e.$attrs.class]),style:u(e.$attrs.style)},[x("div",null,[x("h3",null,[b(d,{type:"sun"}),i[0]||(i[0]=v()),x("span",Xc,$(e.$t("day")),1)]),x("ul",null,[(n(!0),h(m,null,f(c.day,(t,i)=>(n(),h("li",{key:t.select},["-"===t?(n(),h("hr",Zc)):(n(),s(g,{key:1,autofocus:e.autofocus&&0===i,disabled:e.disabled,selected:t.select===o.value&&"time",onClick:e=>c.select(t.select)},{default:a(()=>[v($(t.display),1)]),_:2},1032,["autofocus","disabled","selected","onClick"]))]))),128))])]),x("div",null,[x("h3",null,[b(d,{type:"moon"}),i[1]||(i[1]=v()),x("span",Qc,$(e.$t("night")),1)]),x("ul",null,[(n(!0),h(m,null,f(c.night,t=>(n(),h("li",{key:t.select},["-"===t?(n(),h("hr",ed)):(n(),s(g,{key:1,disabled:e.disabled,selected:t.select===o.value&&"time",onClick:e=>c.select(t.select)},{default:a(()=>[v($(t.display),1)]),_:2},1032,["disabled","selected","onClick"]))]))),128))])]),x("input",{id:e.id,disabled:e.disabled,min:e.min,max:e.max,name:e.name,required:e.required,value:o.value,class:"input-hidden",tabindex:"-1",type:"time"},null,8,td)],6)}]]);class sd extends HTMLElement{static formAssociated=!0;static get observedAttributes(){return["min","max","required","value"]}attributeChangedCallback(e,t,i){this[e]=i}constructor(){super(),this.internals=this.attachInternals(),this.entries=[]}connectedCallback(){this.tabIndex=0;const e=this.getAttribute("id");e&&(this.input.setAttribute("id",e),this.removeAttribute("id")),this.validate()}checkValidity(){return this.internals.checkValidity()}get form(){return this.internals.form}has(e){return this.entries.includes(e)}get input(){return this.querySelector(this.getAttribute("anchor"))??this.querySelector("input, textarea, select, button")??this.querySelector(":scope > *")}get isEmpty(){return 0===this.selected.length}get name(){return this.getAttribute("name")}reportValidity(){return this.internals.reportValidity()}get type(){return this.localName}validate(){const e=parseInt(this.max),t=parseInt(this.min);"true"===this.required&&0===this.entries.length?this.internals.setValidity({valueMissing:!0},window.panel.$t("error.validation.required"),this.input):this.hasAttribute("min")&&this.entries.length<t?this.internals.setValidity({rangeUnderflow:!0},window.panel.$t("error.validation.min",{min:t}),this.input):this.hasAttribute("max")&&this.entries.length>e?this.internals.setValidity({rangeOverflow:!0},window.panel.$t("error.validation.max",{max:e}),this.input):this.internals.setValidity({})}get validity(){return this.internals.validity}get validationMessage(){return this.internals.validationMessage}get value(){return JSON.stringify(this.entries??[])}set value(e){this.entries=("string"==typeof e?JSON.parse(e):[])??[],this.validate()}get willValidate(){return this.internals.willValidate}}const nd={extends:"k-writer-input",mounted(){window.panel.deprecated("`k-writer` will be removed in a future version. Use `k-writer-input` instead.")}},od={install(e){customElements.define("k-input-validator",sd),e.component("k-alpha-input",xc),e.component("k-calendar-input",_c),e.component("k-checkbox-input",Dc),e.component("k-checkboxes-input",So),e.component("k-choice-input",Gr),e.component("k-colorname-input",Do),e.component("k-coloroptions-input",Tc),e.component("k-colorpicker-input",Rc),e.component("k-coords-input",Kc),e.component("k-date-input",zo),e.component("k-email-input",Yo),e.component("k-hue-input",Jc),e.component("k-list-input",ha),e.component("k-multiselect-input",Aa),e.component("k-number-input",Ba),e.component("k-password-input",Ua),e.component("k-picklist-input",Is),e.component("k-radio-input",Xa),e.component("k-range-input",or),e.component("k-search-input",Gc),e.component("k-select-input",pr),e.component("k-slug-input",fr),e.component("k-string-input",Mo),e.component("k-tags-input",Da),e.component("k-tel-input",Ar),e.component("k-text-input",_r),e.component("k-textarea-input",zr),e.component("k-time-input",Rr),e.component("k-timeoptions-input",id),e.component("k-toggle-input",Zr),e.component("k-toggles-input",rc),e.component("k-url-input",uc),e.component("k-writer-input",da),e.component("k-calendar",_c),e.component("k-times",id),e.component("k-writer",nd)}},ld={class:"k-label"},ad=["aria-current","aria-label","value","onClick"];const rd=Ne({mixins:[Ot],inheritAttrs:!1,props:{cancelButton:{default:!1},label:{default:()=>window.panel.t("field.layout.select"),type:String},layouts:{type:Array},selector:Object,submitButton:{default:!1},value:{type:Array}},emits:["cancel","input","submit"]},[["render",function(e,i,l,r,c,d){const p=t("k-column"),g=t("k-grid"),k=t("k-navigate"),y=t("k-dialog");return n(),s(y,o(e.$props,{class:["k-layout-selector",e.$attrs.class],size:l.selector?.size??"medium",style:e.$attrs.style,onCancel:i[0]||(i[0]=t=>e.$emit("cancel")),onSubmit:i[1]||(i[1]=t=>e.$emit("submit",l.value))}),{default:a(()=>[x("h3",ld,$(l.label),1),b(k,{style:u({"--columns":Number(l.selector?.columns??3)}),axis:"x",class:"k-layout-selector-options"},{default:a(()=>[(n(!0),h(m,null,f(l.layouts,(t,i)=>(n(),h("button",{key:i,"aria-current":l.value===t,"aria-label":t.join(","),value:t,class:"k-layout-selector-option",onClick:i=>e.$emit("input",t)},[b(g,{"aria-hidden":""},{default:a(()=>[(n(!0),h(m,null,f(t,(e,t)=>(n(),s(p,{key:t,width:e},null,8,["width"]))),128))]),_:2},1024)],8,ad))),128))]),_:1},8,["style"])]),_:1},16,["class","size","style"])}]]),cd={install(e){e.component("k-layout",pl),e.component("k-layout-column",rl),e.component("k-layouts",ml),e.component("k-layout-selector",rd)}},dd={inheritAttrs:!1,props:{column:{default:()=>({}),type:Object},field:{default:()=>({}),type:Object},value:{}}};const ud=Ne({mixins:[dd],props:{html:{type:Boolean},removable:Boolean,value:{default:()=>[],type:[Array,String]}},emits:["remove"],computed:{tags(){let e=this.value;const t=this.column.options??this.field.options??[];return"string"==typeof e&&(e=e.split(",")),(e??[]).map(e=>{"string"==typeof e&&(e={value:e,text:e});for(const i of t)i.value===e.value&&(e.text=i.text);return e})}}},[["render",function(e,i,s,o,l,a){const r=t("k-tag");return n(),h("ul",{class:p(["k-tags-field-preview","k-tags",e.$options.class,e.$attrs.class]),style:u(e.$attrs.style)},[(n(!0),h(m,null,f(a.tags,(t,o)=>(n(),h("li",{key:t.id??t.value??t.text??o},[b(r,{element:s.removable?void 0:"div",html:s.html,image:t.image,link:s.removable?void 0:t.link,text:t.text,removable:s.removable,theme:"light",onRemove:i[0]||(i[0]=t=>e.$emit("remove",t))},null,8,["element","html","image","link","text","removable"])]))),128))],6)}]]),pd={extends:ud,inheritAttrs:!1,class:"k-array-field-preview",computed:{tags(){return[{text:1===this.value.length?`1 ${this.$t("entry")}`:`${this.value.length} ${this.$t("entries")}`}]}}};const hd=Ne({mixins:[dd],props:{value:String},computed:{text(){if(!this.value)return;const e=this.$library.colors.toString(this.value,this.field.format,this.field.alpha),t=this.field.options?.find(t=>this.$library.colors.toString(t.value,this.field.format,this.field.alpha)===e);return t?t.text:null}}},[["render",function(e,i,s,o,l,a){const r=t("k-color-frame");return n(),h("div",{class:p(["k-color-field-preview",e.$attrs.class]),style:u(e.$attrs.style)},[b(r,{color:s.value},null,8,["color"]),a.text?(n(),h(m,{key:0},[v($(a.text),1)],64)):g("",!0)],6)}]]);const md=Ne({mixins:[dd],computed:{text(){return this.value}}},[["render",function(e,t,i,s,o,l){return n(),h("p",{class:p(["k-text-field-preview",e.$options.class,e.$attrs.class]),style:u(e.$attrs.style)},[v($(e.column.before)+" ",1),r(e.$slots,"default",{},()=>[v($(l.text),1)]),v(" "+$(e.column.after),1)],6)}]]),fd={extends:md,props:{value:String},class:"k-date-field-preview",computed:{display(){return this.column.display??this.field.display},format(){let e=this.display??"YYYY-MM-DD";return this.time?.display&&(e+=" "+this.time.display),e},parsed(){return this.$library.dayjs(this.value)},text(){return!1===this.parsed.isValid()?this.value:this.parsed?.format(this.format)},time(){return this.column.time??this.field.time}}},gd=["data-link"];const kd=Ne({mixins:[dd],props:{value:[String,Object]},computed:{link(){return"object"==typeof this.value?this.value.href:this.value},text(){return"object"==typeof this.value?this.value.text:this.link}}},[["render",function(e,i,s,o,l,r){const c=t("k-link");return n(),h("p",{class:p(["k-url-field-preview",e.$options.class,e.$attrs.class]),"data-link":Boolean(r.link),style:u(e.$attrs.style)},[v($(e.column.before)+" ",1),b(c,{to:r.link,onClick:i[0]||(i[0]=S(()=>{},["stop"]))},{default:a(()=>[x("span",null,$(r.text),1)]),_:1},8,["to"]),v(" "+$(e.column.after),1)],14,gd)}]]),bd={extends:kd,class:"k-email-field-preview"};const yd=Ne({mixins:[dd],props:{html:{type:Boolean,default:!0},removable:Boolean,value:{default:()=>[],type:[Array,String]}},emits:["remove"],data:()=>({tags:[]}),watch:{value:{immediate:!0,handler(){this.collect()}}},methods:{async collect(){let e=this.$helper.clone(this.tags);const t=[];for(let i=0;i<this.value.length;i++){const s=this.value[i];if("string"!=typeof s){e.splice(i,1,this.tag(s));continue}const n=this.tags.find(e=>e.id===s);n?e.splice(i,1,n):(t.push(s),e.splice(i,1,this.skeleton(s)))}if(this.tags=e.slice(0,this.value.length),t.length>0){const e=await await this.$panel.get(this.$options.endpoint,{query:{items:t.join(",")}});for(let i=0;i<t.length;i++){const s=t[i],n=e.items[i],o=this.tags.findIndex(e=>e.id===s);this.tags[o]={...n,id:s}}}},skeleton:e=>({id:e,image:{icon:"loader",color:"var(--tag-color-disabled-text)"}}),tag:e=>e}},[["render",function(e,i,o,l,a,r){const c=t("k-tags-field-preview");return n(),s(c,{html:o.html,removable:o.removable,value:a.tags,class:"k-models-field-preview",onRemove:i[0]||(i[0]=t=>e.$emit("remove",t))},null,8,["html","removable","value"])}]]),vd={extends:yd,class:"k-files-field-preview",endpoint:"items/files",methods:{tag:e=>({text:e.filename,link:e.link,image:e.image})}};const $d=Ne({mixins:[dd],props:{value:Object},computed:{status(){return{...this.$helper.page.status(this.value?.status),...this.value}}}},[["render",function(e,i,l,a,r,c){const d=t("k-button");return l.value?(n(),s(d,o({key:0},c.status,{class:["k-flag-field-preview",e.$attrs.class],style:e.$attrs.style,size:"md"}),null,16,["class","style"])):g("",!0)}]]);const wd=Ne({mixins:[dd],props:{value:String},computed:{html(){return this.value}}},[["render",function(e,i,s,o,l,a){const r=t("k-text");return n(),h("div",{class:p(["k-html-field-preview",e.$options.class,e.$attrs.class]),style:u(e.$attrs.style)},[v($(e.column.before)+" ",1),b(r,{html:a.html},null,8,["html"]),v(" "+$(e.column.after),1)],6)}]]);const xd=Ne({mixins:[dd],props:{value:[Object]}},[["render",function(e,i,o,l,a,r){const c=t("k-item-image");return o.value?(n(),s(c,{key:0,class:p(["k-image-field-preview",e.$attrs.class]),image:o.value,style:u(e.$attrs.style)},null,8,["class","image","style"])):g("",!0)}]]),Sd={mixins:[dd],props:{removable:Boolean,type:String},emits:["remove"],computed:{currentType(){return this.type??this.detected.type},detected(){return this.$helper.link.detect(this.value)},isLink(){return["url","email","tel"].includes(this.currentType)}}},Cd={key:0,class:"k-text"},Od=["href"];const Ad=Ne(Sd,[["render",function(e,t,i,o,l,a){return"page"===a.currentType||"file"===a.currentType?(n(),h(m,{key:0},[e.value?(n(),s(w(`k-${a.currentType}s-field-preview`),{key:0,removable:i.removable,value:[e.value],onRemove:t[0]||(t[0]=t=>e.$emit("remove",t))},null,40,["removable","value"])):r(e.$slots,"placeholder",{key:1})],64)):(n(),h("div",{key:1,class:p({"k-link-field-preview":!0,"k-url-field-preview":a.isLink,[e.$attrs.class]:!0}),style:u(e.$attrs.style)},[a.isLink?(n(),h("p",Cd,[x("a",{href:e.value,target:"_blank"},[x("span",null,$(a.detected.link),1)],8,Od)])):(n(),h(m,{key:1},[v($(a.detected.link),1)],64))],6))}]]),Id={extends:ud,class:"k-object-field-preview",props:{value:[Array,Object]},computed:{tags(){return this.value?[{text:"{ ... }"}]:[]}}},Md={extends:yd,class:"k-pages-field-preview",endpoint:"items/pages"};const _d=Ne({mixins:[dd],props:{html:{type:Boolean},value:String}},[["render",function(e,i,s,o,l,a){const r=t("k-tag");return n(),h("ul",{class:p(["k-tag-field-preview","k-tags-field-preview","k-tags",e.$options.class,e.$attrs.class]),style:u(e.$attrs.style)},[x("li",null,[b(r,{html:s.html,text:s.value,theme:"light",onClick:i[0]||(i[0]=S(()=>{},["stop"]))},null,8,["html","text"])])],6)}]]),Dd={extends:fd,class:"k-time-field-preview",computed:{format(){return this.display??"HH:mm"},parsed(){return this.$library.dayjs.iso(this.value,"time")},text(){return this.parsed?.format(this.format)}}};const Ed=Ne({mixins:[dd],props:{value:Boolean},emits:["input"],computed:{isEditable(){return!0!==this.field.disabled},text(){return!1!==this.column.text?this.field.text:null}}},[["render",function(e,i,s,o,l,a){const r=t("k-toggle-input");return n(),h("div",{class:p(["k-toggle-field-preview",e.$attrs.class]),style:u(e.$attrs.style)},[b(r,{disabled:!a.isEditable,text:a.text,value:s.value,onInput:i[0]||(i[0]=t=>e.$emit("input",t)),onClick:i[1]||(i[1]=e=>a.isEditable?e.stopPropagation():null)},null,8,["disabled","text","value"])],6)}]]),jd={extends:yd,class:"k-users-field-preview",endpoint:"items/users",methods:{tag:e=>({text:e.username??e.email,link:e.link,image:e.image})}},Ld={install(e){e.component("k-array-field-preview",pd),e.component("k-color-field-preview",hd),e.component("k-date-field-preview",fd),e.component("k-email-field-preview",bd),e.component("k-files-field-preview",vd),e.component("k-flag-field-preview",$d),e.component("k-html-field-preview",wd),e.component("k-image-field-preview",xd),e.component("k-link-field-preview",Ad),e.component("k-object-field-preview",Id),e.component("k-pages-field-preview",Md),e.component("k-tag-field-preview",_d),e.component("k-tags-field-preview",ud),e.component("k-text-field-preview",md),e.component("k-toggle-field-preview",Ed),e.component("k-time-field-preview",Dd),e.component("k-url-field-preview",kd),e.component("k-users-field-preview",jd),e.component("k-list-field-preview",wd),e.component("k-writer-field-preview",wd),e.component("k-checkboxes-field-preview",ud),e.component("k-multiselect-field-preview",ud),e.component("k-radio-field-preview",ud),e.component("k-select-field-preview",ud),e.component("k-toggles-field-preview",ud)}},Bd=["data-theme"];const Td=Ne({mixins:[{props:{buttons:{type:Array,default:()=>[]},theme:{type:String,default:"light"}}}],methods:{close(){for(const e in this.$refs){const t=this.$refs[e][0];"function"==typeof t?.close&&t.close()}}}},[["render",function(e,i,o,l,a,r){const c=t("k-button"),d=t("k-dropdown");return e.buttons.length?(n(),h("nav",{key:0,class:"k-toolbar","data-theme":e.theme},[(n(!0),h(m,null,f(e.buttons,(t,i)=>(n(),h(m,null,["|"===t?(n(),h("hr",{key:"separator-"+i})):t.when??1?(n(),s(c,{key:i,current:t.current,disabled:t.disabled,icon:t.icon,title:t.label??t.title,class:p(["k-toolbar-button",t.class]),tabindex:"0",onKeydown:e=>t.key?.(e),onClick:s=>t.dropdown?.length?e.$refs[i+"-dropdown"][0].toggle():t.click?.(s)},null,8,["current","disabled","icon","title","class","onKeydown","onClick"])):g("",!0),(t.when??1)&&t.dropdown?.length?(n(),s(d,{key:i+"-dropdown",ref_for:!0,ref:i+"-dropdown",options:t.dropdown,theme:"dark"===e.theme?"light":"dark"},null,8,["options","theme"])):g("",!0)],64))),256))],8,Bd)):g("",!0)}]]);const qd=Ne({props:{editor:{required:!0,type:Object},inline:{default:!0,type:Boolean},marks:{default:()=>["bold","italic","underline","strike","code","|","link","email","|","clear"],type:[Array,Boolean]},nodes:{default:!0,type:[Array,Boolean]}},emits:["command"],data:()=>({isOpen:!1,position:{x:0,y:0}}),computed:{activeDropdownEntry(){return Object.values(this.dropdownEntries).findLast(this.isNodeActive)},buttons(){const e=[];this.hasDropdownEntries&&e.push(this.dropdownInlineButton),this.hasDropdownEntries&&this.hasInlineEntries&&e.push("|");for(const[t,i]of Object.entries(this.inlineEntries))e.push(this.inlineButton(i,t));return e},dropdown(){const e=[],t=Object.entries(this.dropdownEntries);let i=0;for(const[s,n]of t)e.push(this.dropdownButton(n,s)),!0===n.separator&&i!==t.length-1&&e.push("-"),i++;return e},dropdownInlineButton(){return{current:Boolean(this.activeDropdownEntry),dropdown:this.dropdown,icon:this.activeDropdownEntry?.icon??"title"}},dropdownEntries(){if(!1===this.nodes)return{};const e=this.nodesForBlock;return"block+"!==this.editor.nodes.doc.content&&e.paragraph&&delete e.paragraph,!0===this.nodes?e:Object.fromEntries(this.nodes.filter(t=>e[t]).map(t=>[t,e[t]]))},hasDropdownEntries(){return this.$helper.object.length(this.dropdownEntries)>1},hasInlineEntries(){return this.$helper.object.length(this.inlineEntries)>0},inlineEntries(){let e={};if(!0===this.nodes)e=this.nodesForInline;else if(!1!==this.nodes)for(const i of this.nodes)this.nodesForInline[i]&&(e[i]=this.nodesForInline[i]);this.$helper.object.length(e)>0&&(e["divider-inline-nodes"]="|");const t=this.editor.buttons("mark");if(!0===this.marks)return{...e,...t};if(!1!==this.marks)for(const[i,s]of this.marks.entries())"|"===s?e["divider"+i]="|":t[s]&&(e[s]=t[s]);return e},nodesForBlock(){return this.$helper.object.filter(this.editor.buttons("node"),e=>!0!==e.inline)},nodesForInline(){return this.$helper.object.filter(this.editor.buttons("node"),e=>!0===e.inline)},positions(){return!1===this.inline?null:{top:this.position.y+"px",left:this.position.x+"px"}},theme(){return this.inline?"dark":"light"}},methods:{close(e){e&&!1!==this.$el.contains(e.relatedTarget)||(this.isOpen=!1)},command(e,...t){this.$emit("command",e,...t)},dropdownButton(e,t){return{current:this.activeDropdownEntry?.id===e.id,disabled:!1===this.activeDropdownEntry?.when?.includes(e.name),icon:e.icon,label:e.label,click:()=>this.command(e.command??t)}},inlineButton(e,t){if("|"===e)return"|";return{current:this.editor.schema.nodes[e.name??t]?this.isNodeActive({...e,name:t}):this.isMarkActive({...e,name:t}),icon:e.icon,label:e.label,click:i=>this.command(e.command??t,i)}},isMarkActive(e){return this.editor.activeMarks.includes(e.name)},isNodeActive(e){if(!1===this.editor.activeNodes.includes(e.name))return!1;if(e.attrs){if(void 0===Object.values(this.editor.activeNodeAttrs).find(t=>JSON.stringify(t)===JSON.stringify(e.attrs)))return!1}return!0},open(){0!==this.buttons.length&&(this.isOpen=!0,this.inline&&this.$nextTick(this.setPosition))},setPosition(){const e=this.$el.getBoundingClientRect(),t=this.editor.element.getBoundingClientRect(),{from:i,to:s}=this.editor.selection,n=this.editor.view.coordsAtPos(i),o=this.editor.view.coordsAtPos(s,!0),l=new DOMRect(n.left,n.top,o.right-n.left,o.bottom-n.top);let a=l.x-t.x+l.width/2-e.width/2,r=l.y-t.y-e.height-5;if(e.width<t.width)a<0?a=0:a+e.width>t.width&&(a=t.width-e.width);else{const i=document.querySelector(".k-panel-menu")?.getBoundingClientRect(),s=t.x+a,n=s+e.width,o=i?.width+20,l=20;s<o?a+=o-s:n>window.innerWidth-l&&(a-=n-(window.innerWidth-l))}this.position={x:a,y:r}}}},[["render",function(e,i,o,l,a,r){const c=t("k-toolbar");return a.isOpen||!o.inline?(n(),s(c,{key:0,ref:"toolbar",buttons:r.buttons,"data-inline":o.inline,theme:r.theme,style:u(r.positions),class:"k-writer-toolbar"},null,8,["buttons","data-inline","theme","style"])):g("",!0)}]]),zd={extends:Lt,props:{fields:{default:()=>{const e=Lt.props.fields.default();return e.title.label=window.panel.t("link.text"),e}}},emits:["cancel","submit"],methods:{submit(){const e=this.values.href??"",t=this.values.title??"";return this.$panel.config.kirbytext?t?.length>0?this.$emit("submit",`(email: ${e} text: ${t})`):this.$emit("submit",`(email: ${e})`):t?.length>0?this.$emit("submit",`[${t}](mailto:${e})`):this.$emit("submit",`<${e}>`)}}},Pd={extends:ti,props:{fields:{default:()=>({href:{label:window.panel.t("link"),type:"link",placeholder:window.panel.t("url.placeholder"),icon:"url"},title:{label:window.panel.t("link.text"),type:"text",icon:"title"}})}},emits:["cancel","submit"],methods:{submit(){const e=this.values.href??"",t=this.values.title??"";return this.$panel.config.kirbytext?t?.length>0?this.$emit("submit",`(link: ${e} text: ${t})`):this.$emit("submit",`(link: ${e})`):t?.length>0?this.$emit("submit",`[${t}](${e})`):this.$emit("submit",`<${e}>`)}}},Nd={install(e){e.component("k-toolbar",Td),e.component("k-textarea-toolbar",jr),e.component("k-writer-toolbar",qd),e.component("k-toolbar-email-dialog",zd),e.component("k-toolbar-link-dialog",Pd)}},Fd={install(e){e.component("k-counter",Ks),e.component("k-field",Zs),e.component("k-fieldset",tn),e.component("k-form",ln),e.component("k-form-controls",pn),e.component("k-input",fn),e.use(fo),e.use(od),e.use($c),e.use(cd),e.use(Ld),e.use(Nd)}},Rd={},Yd=function(e,t,i){let s=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};const n=document.getElementsByTagName("link"),o=document.querySelector("meta[property=csp-nonce]"),l=o?.nonce||o?.getAttribute("nonce");s=e(t.map(e=>{if(e=function(e,t){return new URL(e,t).href}(e,i),e in Rd)return;Rd[e]=!0;const t=e.endsWith(".css"),s=t?'[rel="stylesheet"]':"";if(i)for(let i=n.length-1;i>=0;i--){const s=n[i];if(s.href===e&&(!t||"stylesheet"===s.rel))return}else if(document.querySelector(`link[href="${e}"]${s}`))return;const o=document.createElement("link");return o.rel=t?"stylesheet":"modulepreload",t||(o.as="script"),o.crossOrigin="",o.href=e,l&&o.setAttribute("nonce",l),document.head.appendChild(o),t?new Promise((t,i)=>{o.addEventListener("load",t),o.addEventListener("error",()=>i(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then(t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)})},Hd=B(()=>Yd(()=>import("./IndexView.min.js"),__vite__mapDeps([0,1]),import.meta.url)),Ud=B(()=>Yd(()=>import("./DocsView.min.js"),__vite__mapDeps([2,3,1]),import.meta.url)),Vd=B(()=>Yd(()=>import("./PlaygroundView.min.js"),__vite__mapDeps([4,3,1]),import.meta.url)),Kd={install(e){e.component("k-lab-index-view",Hd),e.component("k-lab-docs-view",Ud),e.component("k-lab-playground-view",Vd)}},Wd=["data-align"];const Jd=Ne({props:{align:{type:String,default:"start"}}},[["render",function(e,t,i,s,o,l){return n(),h("div",{"data-align":i.align,class:"k-bar"},[r(e.$slots,"default")],8,Wd)}]]);const Gd=Ne({props:{align:{type:String,default:"start"},button:Boolean,height:String,icon:String,theme:{type:String},text:String,html:{type:Boolean}},computed:{element(){return this.button?"button":"div"},type(){return this.button?"button":null}}},[["render",function(e,i,o,l,p,h){const m=t("k-icon"),f=t("k-text");return n(),s(w(h.element),{"data-align":o.align,"data-theme":o.theme,type:h.type,style:u(o.height?{"--box-height":o.height}:null),class:"k-box"},{default:a(()=>[o.icon?(n(),s(m,{key:0,type:o.icon},null,8,["type"])):g("",!0),r(e.$slots,"default",c(d({html:o.html,text:o.text})),()=>[o.html?(n(),s(f,{key:0,html:o.text},null,8,["html"])):(n(),s(f,{key:1},{default:a(()=>[v($(o.text),1)]),_:1}))])]),_:3},8,["data-align","data-theme","type","style"])}]]),Xd={props:{width:{type:String,default:"1/1"},sticky:Boolean}},Zd=["data-sticky"],Qd={key:0};const eu=Ne(Xd,[["render",function(e,t,i,s,o,l){return n(),h("div",{style:u({"--width":i.width}),"data-sticky":i.sticky,class:"k-column"},[i.sticky?(n(),h("div",Qd,[r(e.$slots,"default")])):r(e.$slots,"default",{key:1})],12,Zd)}]]),tu={props:{element:{type:String,default:"div"},fit:String,ratio:String,cover:Boolean,back:String,theme:String}};const iu=Ne({mixins:[tu],inheritAttrs:!1,computed:{background(){return this.$helper.color(this.back)}}},[["render",function(e,t,i,o,l,c){return n(),s(w(e.element),{class:p(["k-frame",e.$attrs.class]),"data-ratio":e.ratio,"data-theme":e.theme,style:u({"--fit":e.fit??(e.cover?"cover":"contain"),"--ratio":e.ratio,"--back":c.background,...e.$attrs.style})},{default:a(()=>[r(e.$slots,"default")]),_:3},8,["class","data-ratio","data-theme","style"])}]]);const su=Ne({mixins:[{mixins:[tu],props:{color:String}}],inheritAttrs:!1},[["render",function(e,i,l,c,d,u){const p=t("k-frame");return n(),s(p,o(e.$props,{class:["k-color-frame",e.$attrs.class],style:{"--color-frame-back":e.color,...e.$attrs.style}}),{default:a(()=>[r(e.$slots,"default")]),_:3},16,["class","style"])}]]),nu={class:"k-definition"};const ou=Ne({props:{description:String,term:String}},[["render",function(e,t,i,s,o,l){return n(),h("div",nu,[x("dt",null,[r(e.$slots,"term",{},()=>[v($(i.term),1)])]),x("dd",null,[r(e.$slots,"default",{},()=>[v($(i.description),1)])])])}]]),lu={class:"k-definitions"};const au=Ne({},[["render",function(e,t,i,s,o,l){return n(),h("dl",lu,[r(e.$slots,"default")])}]]),ru={props:{disabled:{type:Boolean}},emits:["drop"],data:()=>({files:[],dragging:!1,over:!1}),methods:{cancel(){this.reset()},reset(){this.dragging=!1,this.over=!1},onDrop(e){return!0===this.disabled||!1===this.$helper.isUploadEvent(e)?this.reset():(this.$events.emit("dropzone.drop"),this.files=e.dataTransfer.files,this.$emit("drop",this.files),void this.reset())},onEnter(e){!1===this.disabled&&this.$helper.isUploadEvent(e)&&(this.dragging=!0)},onLeave(){this.reset()},onOver(e){!1===this.disabled&&this.$helper.isUploadEvent(e)&&(e.dataTransfer.dropEffect="copy",this.over=!0)}}},cu=["data-dragging","data-over"];const du=Ne(ru,[["render",function(e,t,i,s,o,l){return n(),h("div",{"data-dragging":o.dragging,"data-over":o.over,class:"k-dropzone",onDragenter:t[0]||(t[0]=(...e)=>l.onEnter&&l.onEnter(...e)),onDragleave:t[1]||(t[1]=(...e)=>l.onLeave&&l.onLeave(...e)),onDragover:t[2]||(t[2]=(...e)=>l.onOver&&l.onOver(...e)),onDrop:t[3]||(t[3]=(...e)=>l.onDrop&&l.onDrop(...e))},[r(e.$slots,"default")],40,cu)}]]),uu=["data-variant"];const pu=Ne({props:{variant:String}},[["render",function(e,t,i,s,o,l){return n(),h("div",{"data-variant":i.variant,class:"k-grid"},[r(e.$slots,"default")],8,uu)}]]),hu={props:{editable:Boolean},emits:["edit"]},mu=["data-editable"],fu={class:"k-header-title"},gu={class:"k-header-title-text"},ku={class:"k-header-title-icon"},bu={key:1,class:"k-header-title-text"},yu={key:0,class:"k-header-buttons"};const vu=Ne(hu,[["render",function(e,i,s,o,l,a){const c=t("k-icon");return n(),h("header",{"data-editable":s.editable,class:"k-header"},[x("h1",fu,[s.editable?(n(),h("button",{key:0,class:"k-header-title-button",type:"button",onClick:i[0]||(i[0]=t=>e.$emit("edit"))},[x("span",gu,[r(e.$slots,"default")]),x("span",ku,[b(c,{type:"edit"})])])):(n(),h("span",bu,[r(e.$slots,"default")]))]),e.$slots.buttons?(n(),h("div",yu,[r(e.$slots,"buttons")])):g("",!0)],8,mu)}]]),$u={props:{alt:String,color:String,type:String}},wu={key:0,"data-type":"emoji"},xu=["aria-label","role","aria-hidden","data-type"],Su=["xlink:href"];const Cu=Ne({mixins:[$u],computed:{isEmoji(){return this.$helper.string.hasEmoji(this.type)}}},[["render",function(e,t,i,s,o,l){return l.isEmoji?(n(),h("span",wu,$(e.type),1)):(n(),h("svg",{key:1,"aria-label":e.alt,role:e.alt?"img":null,"aria-hidden":!e.alt,"data-type":e.type,class:"k-icon",style:u({color:e.$helper.color(e.color)})},[x("use",{"xlink:href":"#icon-"+e.type},null,8,Su)],12,xu))}]]);const Ou=Ne({mixins:[{mixins:[tu,$u],props:{type:null,icon:String}}],inheritAttrs:!1},[["render",function(e,i,l,r,u,p){const h=t("k-icon"),m=t("k-frame");return n(),s(m,o(e.$props,{class:["k-icon-frame",e.$attrs.class],style:e.$attrs.style,element:"figure"}),{default:a(()=>[b(h,c(d({color:e.color,type:e.icon,alt:e.alt})),null,16)]),_:1},16,["class","style"])}]]),Au=["alt","src","srcset","sizes"];const Iu=Ne({mixins:[{mixins:[tu],props:{alt:String,file:String,sizes:String,src:String,srcset:String}}],inheritAttrs:!1,data:()=>({resolvedAlt:null,resolvedSrc:null,resolvedSrcset:null}),watch:{file:{handler:"fetch",immediate:!0}},methods:{async fetch(){let e,t,i=null;if(this.file){const s=await this.$panel.get("items/files",{query:{items:this.file,layout:"auto",image:JSON.stringify({ratio:this.ratio,cover:this.cover})}});e=s.items[0]?.alt,t=s.items[0]?.image.src,i=s.items[0]?.image.srcset}this.resolvedAlt=e,this.resolvedSrc=t,this.resolvedSrcset=i}}},[["render",function(e,i,l,r,c,d){const u=t("k-frame");return n(),s(u,o(e.$props,{class:["k-image-frame","k-image",e.$attrs.class],style:e.$attrs.style,element:"figure"}),{default:a(()=>[e.src||c.resolvedSrc?(n(),h("img",{key:0,alt:e.alt??c.resolvedAlt??"",src:e.src??c.resolvedSrc,srcset:e.srcset??c.resolvedSrcset,sizes:e.sizes,onDragstart:i[0]||(i[0]=S(()=>{},["prevent"]))},null,40,Au)):g("",!0)]),_:1},16,["class","style"])}]]),Mu={props:{autofocus:{default:!0,type:Boolean},nested:{default:!1,type:Boolean},type:{default:"overlay",type:String},visible:{default:!1,type:Boolean}}},_u=["data-type"];const Du=Ne({mixins:[Mu],inheritAttrs:!0,emits:["cancel","close","open"],watch:{visible(e,t){e!==t&&this.toggle()}},mounted(){this.toggle()},methods:{cancel(){this.$emit("cancel"),this.close()},close(){if(!1!==this.$refs.overlay.open)return this.nested?this.onClose():void this.$refs.overlay.close()},focus(){this.$helper.focus(this.$refs.overlay)},onCancel(e){this.nested&&(e.preventDefault(),this.cancel())},onClick(e){e.target.matches(".k-portal")&&this.cancel()},onClose(){this.$emit("close")},open(){!0!==this.$refs.overlay.open&&this.$refs.overlay.showModal(),setTimeout(()=>{!0===this.autofocus&&this.focus(),this.$emit("open")})},toggle(){!0===this.visible?this.open():this.close()}}},[["render",function(e,t,i,s,o,l){return n(),h("dialog",{ref:"overlay","data-type":e.type,class:"k-overlay",onCancel:t[0]||(t[0]=(...e)=>l.onCancel&&l.onCancel(...e)),onMousedown:t[1]||(t[1]=(...e)=>l.onClick&&l.onClick(...e)),onTouchdown:t[2]||(t[2]=(...e)=>l.onClick&&l.onClick(...e)),onClose:t[3]||(t[3]=(...e)=>l.onClose&&l.onClose(...e))},[r(e.$slots,"default")],40,_u)}]]);const Eu=Ne({props:{align:String,direction:String,gap:String,justify:String}},[["render",function(e,t,i,s,o,l){return n(),h("div",{class:"k-stack",style:u({alignItems:i.align,flexDirection:i.direction,gap:i.gap,justifyContent:i.justify})},[r(e.$slots,"default")],4)}]]),ju={key:0,class:"k-stat-label"},Lu={key:1,class:"k-stat-value"},Bu={key:2,class:"k-stat-info"};const Tu=Ne({props:{click:Function,dialog:{type:[String,Object]},drawer:{type:[String,Object]},icon:String,info:String,label:String,link:String,theme:String,value:String},computed:{component(){return null!==this.target?"k-link":"div"},target(){return this.link?this.link:this.click?this.click:this.dialog?()=>this.$panel.dialog.open(this.dialog):this.drawer?()=>this.$panel.drawer.open(this.drawer):null}}},[["render",function(e,i,o,l,r,c){const d=t("k-icon");return n(),s(w(c.component),{"data-theme":o.theme,to:c.target,class:"k-stat"},{default:a(()=>[o.label?(n(),h("dt",ju,[o.icon?(n(),s(d,{key:0,type:o.icon},null,8,["type"])):g("",!0),v(" "+$(o.label),1)])):g("",!0),o.value?(n(),h("dd",Lu,$(o.value),1)):g("",!0),o.info?(n(),h("dd",Bu,$(o.info),1)):g("",!0)]),_:1},8,["data-theme","to"])}]]),qu={inheritAttrs:!1,props:{columns:{type:Object,default:()=>({})},disabled:Boolean,fields:{type:Object,default:()=>({})},empty:String,index:{type:[Number,Boolean],default:1},rows:Array,options:{default:()=>[],type:[Array,Function]},pagination:[Object,Boolean],responsive:{type:Boolean,default:!0},selecting:Boolean,selected:{type:Array,default:()=>[]},selectmode:{type:String,default:"multiple"},sortable:Boolean},emits:["cell","change","header","input","option","paginate","select","sort"],data(){return{values:this.rows}},computed:{colspan(){let e=this.columnsCount;return this.hasIndexColumn&&e++,this.hasOptions&&e++,e},columnsCount(){return this.$helper.object.length(this.columns)},dragOptions(){return{disabled:!this.sortable||0===this.rows.length,draggable:".k-table-sortable-row",fallbackClass:"k-table-row-fallback",ghostClass:"k-table-row-ghost"}},hasIndexColumn(){return this.sortable||!1!==this.index},hasOptions(){return!1!==this.selecting||this.$slots.options||this.options?.length>0||Object.values(this.values).filter(e=>e?.options).length>0},indexWidth(){if(!1===this.hasIndexColumn)return null;const e=Math.max(this.values?.length??0,1),t=this.index,i=t+e-1;return`${String(Math.max(t,i)).length}ch`}},watch:{rows(){this.values=this.rows}},methods:{findSelectedIndex(e){return this.selected.findIndex(t=>t===(e._id??e.id))},isColumnEmpty(e){return 0===this.rows.filter(t=>!1===this.$helper.object.isEmpty(t[e])).length},isSelected(e){return-1!==this.findSelectedIndex(e)},label(e,t){return e.label??this.$helper.string.ucfirst(t)},onChange(e){this.$emit("change",e)},onCell(e){this.$emit("cell",e)},onCellUpdate({columnIndex:e,rowIndex:t,value:i}){this.values[t][e]=i,this.$emit("input",this.values)},onHeader(e){this.$emit("header",e)},onOption(e,t,i){this.$emit("option",e,t,i)},onSelect(e){if("single"===this.selectmode)return this.$emit("select",[e._id??e.id]);const t=this.findSelectedIndex(e);return-1!==t?this.selected.toSpliced(t,1):this.$emit("select",[...this.selected,e._id??e.id])},onSort(){this.$emit("input",this.values),this.$emit("sort",this.values)},rowIsSelectable(e){return!0===this.selecting&&!1!==e.selectable},rowIsSortable(e){return!0===this.sortable&&!1===this.selecting&&!1!==e.sortable},width(e){return"string"!=typeof e?"auto":!1===e.includes("/")?e:this.$helper.ratio(e,"auto",!1)}}},zu=["aria-disabled","data-responsive"],Pu=["data-disabled","data-indexed","data-selecting"],Nu={key:0,"data-mobile":"true",class:"k-table-index-column"},Fu=["data-align","data-column-id","data-mobile","onClick"],Ru={key:1,"data-mobile":"true",class:"k-table-options-column"},Yu={key:0},Hu=["colspan"],Uu=["data-selecting","data-selectable","data-sortable"],Vu={key:0,"data-mobile":"true",class:"k-table-index-column"},Ku=["textContent"],Wu={key:1,"data-mobile":"true",class:"k-table-options-column"},Ju={key:0,class:"k-table-select-checkbox"},Gu=["disabled","type","checked","onChange"];const Xu=Ne(qu,[["render",function(e,i,l,c,d,k){const y=t("k-sort-handle"),w=t("k-table-cell"),S=t("k-options-dropdown"),C=t("k-draggable"),O=t("k-pagination");return n(),h("div",{"aria-disabled":l.disabled,class:p(["k-table",e.$attrs.class]),"data-responsive":l.responsive,style:u(e.$attrs.style)},[x("table",{"data-disabled":l.disabled,"data-indexed":k.hasIndexColumn,"data-selecting":l.selecting,style:u({"--table-index-width":k.indexWidth})},[x("thead",null,[x("tr",null,[k.hasIndexColumn?(n(),h("th",Nu," # ")):g("",!0),(n(!0),h(m,null,f(l.columns,(t,i)=>(n(),h("th",{key:i+"-header","data-align":t.align,"data-column-id":i,"data-mobile":t.mobile,style:u({width:k.width(t.width)}),class:"k-table-column",onClick:e=>k.onHeader({column:t,columnIndex:i})},[r(e.$slots,"header",o({ref_for:!0},{column:t,columnIndex:i,label:k.label(t,i)}),()=>[v($(k.label(t,i)),1)])],12,Fu))),128)),k.hasOptions?(n(),h("th",Ru)):g("",!0)])]),b(C,{list:d.values,options:k.dragOptions,handle:!0,element:"tbody",onChange:k.onChange,onEnd:k.onSort},{default:a(()=>[0===l.rows.length?(n(),h("tr",Yu,[x("td",{colspan:k.colspan,class:"k-table-empty"},$(l.empty),9,Hu)])):(n(!0),h(m,{key:1},f(d.values,(t,i)=>(n(),h("tr",{key:t.id??t._id??t.value??JSON.stringify(t),class:p({"k-table-sortable-row":k.rowIsSortable(t)}),"data-selecting":l.selecting,"data-selectable":k.rowIsSelectable(t),"data-sortable":k.rowIsSortable(t)},[k.hasIndexColumn?(n(),h("td",Vu,[r(e.$slots,"index",o({ref_for:!0},{row:t,rowIndex:i}),()=>[x("div",{class:"k-table-index",textContent:$(l.index+i)},null,8,Ku)]),k.rowIsSortable(t)?(n(),s(y,{key:0,class:"k-table-sort-handle"})):g("",!0)])):g("",!0),(n(!0),h(m,null,f(l.columns,(e,o)=>(n(),s(w,{id:o,key:o,column:e,field:l.fields[o],row:t,mobile:e.mobile,value:t[o],style:u({width:k.width(e.width)}),class:"k-table-column",onClick:s=>k.onCell({row:t,rowIndex:i,column:e,columnIndex:o}),onInput:e=>k.onCellUpdate({columnIndex:o,rowIndex:i,value:e})},null,8,["id","column","field","row","mobile","value","style","onClick","onInput"]))),128)),k.hasOptions?(n(),h("td",Wu,[l.selecting?(n(),h("label",Ju,[x("input",{disabled:!1===t.selectable,type:"single"===l.selectmode?"radio":"checkbox",checked:k.isSelected(t),onChange:e=>k.onSelect(t)},null,40,Gu)])):g("",!0),r(e.$slots,"options",o({ref_for:!0},{row:t,rowIndex:i}),()=>[l.selecting?g("",!0):(n(),s(S,{key:0,options:t.options??l.options,text:(t.options??l.options).length>1,onOption:e=>k.onOption(e,t,i)},null,8,["options","text","onOption"]))])])):g("",!0)],10,Uu))),128))]),_:3},8,["list","options","onChange","onEnd"])],12,Pu),l.pagination?(n(),s(O,o({key:0,class:"k-table-pagination"},l.pagination,{onPaginate:i[0]||(i[0]=t=>e.$emit("paginate",t))}),null,16)):g("",!0)],14,zu)}]]),Zu={inheritAttrs:!1,props:{column:Object,field:Object,id:String,mobile:{type:Boolean,default:!1},row:Object,value:{default:""}},emits:["input"],computed:{component(){return this.$helper.isComponent(`k-${this.type}-field-preview`)?`k-${this.type}-field-preview`:this.$helper.isComponent(`k-table-${this.type}-cell`)?`k-table-${this.type}-cell`:Array.isArray(this.value)?"k-array-field-preview":"object"==typeof this.value?"k-object-field-preview":"k-text-field-preview"},type(){return this.column.type??this.field?.type}}},Qu=["data-align","data-column-id","data-mobile"];const ep=Ne(Zu,[["render",function(e,t,i,o,l,a){return n(),h("td",{class:p(["k-table-cell",e.$attrs.class]),"data-align":i.column.align,"data-column-id":i.id,"data-mobile":i.mobile,style:u(e.$attrs.style)},[!1===e.$helper.object.isEmpty(i.value)?(n(),s(w(a.component),{key:0,column:i.column,field:i.field,row:i.row,value:i.value,onInput:t[0]||(t[0]=t=>e.$emit("input",t))},null,40,["column","field","row","value"])):g("",!0)],14,Qu)}]]);const tp=Ne({props:{tab:String,tabs:{type:Array,default:()=>[]},theme:{type:String,default:"passive"}},computed:{buttons(){return this.tabs.map(this.button)},current(){const e=this.tabs.find(e=>e.name===this.tab)??this.tabs[0];return e?.name}},methods:{button(e){const t={...e,current:e.name===this.current,title:e.label,text:e.label??e.text??e.name};return"string"!=typeof e.badge&&"number"!=typeof e.badge||(t.badge={text:e.badge}),t.badge&&(t.badge.theme??=this.theme),!1===e.badge&&delete t.badge,t},hasCurrent(e){return!!this.buttons.slice(e).find(e=>this.current===e.name)}}},[["render",function(e,i,l,r,c,d){const u=t("k-button"),p=t("k-dropdown"),k=t("k-collapsible");return l.tabs.length>1?(n(),s(k,{key:0,element:"nav",class:"k-tabs"},{default:a(({offset:e})=>[(n(!0),h(m,null,f(d.buttons.slice(0,e),e=>(n(),s(u,o({key:e.name,ref_for:!0,ref:"visible"},{ref_for:!0},e,{variant:"dimmed",class:"k-tabs-button"}),{default:a(()=>[v($(e.text),1)]),_:2},1040))),128))]),fallback:a(({offset:t})=>[b(u,{current:d.hasCurrent(t),title:e.$t("more"),class:"k-tabs-button k-tabs-dropdown-button",icon:"dots",variant:"dimmed",onClick:i[0]||(i[0]=S(t=>e.$refs.more.toggle(),["stop"]))},null,8,["current","title"]),b(p,{ref:"more",options:d.buttons.slice(t),"align-x":"end",class:"k-tabs-dropdown"},null,8,["options"])]),_:1})):g("",!0)}]]),ip={mixins:[tu],props:{controls:Boolean,element:{default:"figure"},file:String,poster:String,ratio:{default:"16/9"},url:String}},sp=["src"],np=["controls","poster","src"];const op=Ne({mixins:[ip],data:()=>({resolvedUrl:null}),watch:{file:{handler:"fetch",immediate:!0}},methods:{async fetch(){let e=null;if(this.file){const t=await await this.$panel.get("items/files",{query:{items:this.file}});e=t.items[0]?.url}this.resolvedUrl=e}}},[["render",function(e,i,l,r,d,u){const p=t("k-frame");return e.url||d.resolvedUrl?(n(),s(p,c(o({key:0},e.$props)),{default:a(()=>[e.url?(n(),h("iframe",{key:0,src:e.$helper.embed.video(e.url,!0),class:"k-video",referrerpolicy:"strict-origin-when-cross-origin"},null,8,sp)):(n(),h("video",{key:1,controls:e.controls,poster:e.poster,src:d.resolvedUrl,class:"k-video"},null,8,np))]),_:1},16)):g("",!0)}]]),lp={install(e){e.component("k-bar",Jd),e.component("k-box",Gd),e.component("k-color-frame",su),e.component("k-column",eu),e.component("k-definition",ou),e.component("k-definitions",au),e.component("k-dropzone",du),e.component("k-frame",iu),e.component("k-grid",pu),e.component("k-header",vu),e.component("k-icon-frame",Ou),e.component("k-image-frame",Iu),e.component("k-image",Iu),e.component("k-overlay",Du),e.component("k-stack",Eu),e.component("k-stat",Tu),e.component("k-stats",yr),e.component("k-table",Xu),e.component("k-table-cell",ep),e.component("k-tabs",tp),e.component("k-video-frame",op)}};const ap=Ne({props:{data:Object,disabled:Boolean,element:{type:String,default:"div"},group:String,handle:[String,Boolean],list:Array,move:Function,options:{type:Object,default:()=>({})}},emits:["change","end","sort","start"],data:()=>({sortable:null}),computed:{dragOptions(){return{group:this.group,disabled:this.disabled,handle:!0===this.handle?".k-sort-handle":this.handle,draggable:">*",filter:".k-draggable-footer",ghostClass:"k-sortable-ghost",fallbackClass:"k-sortable-fallback",forceFallback:!0,fallbackOnBody:!0,scroll:document.querySelector(".k-panel-main"),...this.options}}},watch:{dragOptions:{handler(e,t){for(const i in e)e[i]!==t[i]&&this.sortable.option(i,e[i])},deep:!0}},mounted(){this.disableFooter(),this.create()},methods:{async create(){const e=(await Yd(async()=>{const{default:e}=await import("./sortable.min.js");return{default:e}},[],import.meta.url)).default;this.sortable=e.create(this.$el,{...this.dragOptions,onStart:e=>{this.$panel.drag.start("data",{}),this.$emit("start",e)},onEnd:e=>{this.$panel.drag.stop(),this.$emit("end",e)},onAdd:e=>{if(this.list){const t=this.getInstance(e.from),i=e.oldDraggableIndex,s=e.newDraggableIndex,n=t.list[i];this.list.splice(s,0,n),this.$emit("change",{added:{element:n,newIndex:s}})}},onUpdate:e=>{if(this.list){const t=e.oldDraggableIndex,i=e.newDraggableIndex,s=this.list[t];this.list.splice(t,1),this.list.splice(i,0,s),this.$emit("change",{moved:{element:s,newIndex:i,oldIndex:t}})}},onRemove:e=>{if(this.list){const t=e.oldDraggableIndex,i=this.list[t];this.list.splice(t,1),this.$emit("change",{removed:{element:i,oldIndex:t}})}},onSort:e=>{this.$emit("sort",e)},onMove:e=>{if(e.dragged.classList.contains("k-draggable-footer"))return!1;if(this.move){const t=e.dragged.__vue__;e.draggedData=t.$props;const i=this.getInstance(e.from);e.fromData=i.$props.data;const s=this.getInstance(e.to);return e.toData=s.$props.data,this.move(e)}return!0}})},disableFooter(){if(this.$slots.footer){const e=[...this.$el.childNodes].slice(-1*this.$slots.footer().length);for(const t of e)t.classList?.add("k-draggable-footer")}},getInstance:e=>"list"in(e=e.__vue__)?e:1===e.$children.length&&"list"in e.$children[0]?e.$children[0]:"k-draggable"===e.$parent.$options._componentTag?e.$parent:void 0}},[["render",function(e,t,i,o,l,c){return n(),s(w(i.element),{class:p({"k-draggable":!c.dragOptions.disabled})},{default:a(()=>[r(e.$slots,"default"),e.$slots.footer?r(e.$slots,"footer",{key:0}):g("",!0)]),_:3},8,["class"])}]]),rp={data:()=>({error:null}),errorCaptured(e){return this.$panel.debug&&window.console.warn(e),this.error=e,!1},render(){return this.error?this.$slots.error?this.$slots.error()[0]:this.$slots.error?this.$slots.error({error:this.error}):e("k-box",{attrs:{theme:"negative"}},this.error.message??this.error):this.$slots.default()[0]}},cp={class:"k-fatal-box"},dp={"data-theme":"negative",class:"k-notification"},up={ref:"iframe",class:"k-fatal-iframe"};const pp=Ne({props:{html:String},mounted(){try{let e=this.$refs.iframe.contentWindow.document;e.open(),e.write(this.html),e.close()}catch(e){console.error(e)}}},[["render",function(e,i,o,l,r,c){const d=t("k-button"),u=t("k-overlay");return n(),s(u,{visible:!0,class:"k-fatal"},{default:a(()=>[x("div",cp,[x("div",dp,[i[1]||(i[1]=x("p",null,"The JSON response could not be parsed",-1)),b(d,{icon:"cancel",onClick:i[0]||(i[0]=S(t=>e.$panel.notification.close(),["stop"]))})]),x("iframe",up,null,512)])]),_:1})}]]),hp={inheritAttrs:!1,props:{direction:{type:String,default:"end"},element:{type:String,default:"div"}},data:()=>({isCollapsed:!1,isUpdating:!1,offset:1/0,total:0}),computed:{hasFallback(){return Boolean(this.$slots.fallback)}},mounted(){this.observe()},unmounted(){this.unobserve()},updated(){!1===this.isUpdating&&this.calculate()},methods:{async calculate(){if(this.isUpdating||!(this.$el instanceof Element)||!this.$slots.default)return;this.isUpdating=!0;const e=this.$el.getBoundingClientRect().width;this.isCollapsed=!1;const t=await this.fitItemsInSpace(e);if(t.overflown&&this.hasFallback){this.isCollapsed=!0;const t=await this.fitItemsInSpace(e);this.offset=t.offset,this.total=t.total}else this.offset=t.offset,this.total=t.total;await this.$nextTick(),this.isUpdating=!1},async fitItemsInSpace(e){this.offset=1/0,await this.$nextTick();const t=[...this.$el.children],i=t.filter(e=>!e.hasAttribute("data-collapsible-fallback")),s=t.filter(e=>e.hasAttribute("data-collapsible-fallback")),n=i.length,o=getComputedStyle(this.$el),l=parseFloat(o.columnGap??o.gap)??0;if(0===e)return{offset:0,total:n,overflown:n>0};if(0===n)return{offset:0,total:n,overflown:!1};const a=i.map(e=>this.measure(e));return this.isCollapsed?this.shrinkUntilFallbackFits({available:e,fallbacks:s,gap:l,total:n,widths:a}):this.growUntilFull({available:e,gap:l,total:n,widths:a})},growUntilFull({available:e,gap:t,total:i,widths:s}){let n=0;for(;n<i&&this.width(s,n+1,t)<=e;)n++;return{offset:n,total:i,overflown:n<i}},measure(e){const t=e.getBoundingClientRect(),i=getComputedStyle(e),s=parseFloat(i.marginLeft)??0,n=parseFloat(i.marginRight)??0;return Math.max(t.width,e.scrollWidth)+s+n},measureFallback(e,t){if(0===e.length)return 0;return e.map(e=>this.measure(e)).reduce((e,t)=>e+t,0)+(e.length-1)*t},observe(){this.$el instanceof Element&&(this.$panel.observers.resize.observe(this.$el),this.$el.addEventListener("resize",this.onResize),this.calculate())},onResize(){!1===this.isUpdating&&this.calculate()},async shrinkUntilFallbackFits({available:e,fallbacks:t,gap:i,total:s,widths:n}){let o=s;for(;o>=0;){this.offset=o,await this.$nextTick();const s=this.measureFallback(t,i);if(this.width(n,o,i)+(i=o>0&&s>0?i:0)+s<=e)break;o--}return{offset:Math.max(0,o),total:s,overflown:!0}},width(e,t,i){if(t<=0)return 0;return("start"===this.direction?e.slice(-t):e.slice(0,t)).reduce((e,t)=>e+t,0)+(t-1)*i},unobserve(){this.$el instanceof Element&&(this.$panel.observers.resize.unobserve(this.$el),this.$el.removeEventListener("resize",this.onResize))}},render(){const t={offset:this.offset,total:this.total},i=this.$slots.default?.(t)??[];let s=[];if(this.isCollapsed){s=(this.$slots.fallback?.(t)??[]).map(e=>T(e,{"data-collapsible-fallback":""}))}return 0===s.length?e(this.element,this.$attrs,i):"start"===this.direction?e(this.element,this.$attrs,[...s,...i]):e(this.element,this.$attrs,[...i,...s])}},mp={icons:window.panel.plugins.icons},fp={"aria-hidden":"true",class:"k-icons",xmlns:"http://www.w3.org/2000/svg",overflow:"hidden"},gp=["id","innerHTML"];const kp=Ne(mp,[["render",function(e,t,i,s,o,l){return n(),h("svg",fp,[x("defs",null,[(n(!0),h(m,null,f(e.$options.icons,(e,t)=>(n(),h("symbol",{key:t,id:"icon-"+t,viewBox:"0 0 24 24",innerHTML:e},null,8,gp))),128))])])}]]),bp=["data-theme"];const yp=Ne({},[["render",function(e,i,s,o,l,a){const r=t("k-button");return e.$panel.notification.isOpen?(n(),h("div",{key:0,"data-theme":e.$panel.notification.theme,class:"k-notification"},[x("p",null,$(e.$panel.notification.message),1),b(r,{icon:"cancel",onClick:i[0]||(i[0]=t=>e.$panel.notification.close())})],8,bp)):g("",!0)}]]),vp={key:0,class:"k-offline-warning"};const $p=Ne({},[["render",function(e,i,s,o,l,a){const r=t("k-icon");return!e.$panel.system.isLocal&&e.$panel.isOffline?(n(),h("div",vp,[x("p",null,[b(r,{type:"bolt"}),v(" "+$(e.$t("error.offline")),1)])])):g("",!0)}]]),wp=["value"];const xp=Ne({props:{value:{type:Number,default:0,validator:e=>e>=0&&e<=100}}},[["render",function(e,t,i,s,o,l){return n(),h("progress",{value:i.value,max:"100",class:"k-progress"},$(i.value)+"%",9,wp)}]]);const Sp=Ne({},[["render",function(e,i,o,l,a,r){const c=t("k-button");return n(),s(c,{title:e.$t("sort.drag"),icon:"sort",class:"k-sort-handle k-sort-button","aria-hidden":"true"},null,8,["title"])}]]),Cp={install(e){e.component("k-draggable",ap),e.component("k-error-boundary",rp),e.component("k-fatal",pp),e.component("k-collapsible",hp),e.component("k-icon",Cu),e.component("k-icons",kp),e.component("k-notification",yp),e.component("k-offline-warning",$p),e.component("k-progress",xp),e.component("k-sort-handle",Sp)}},Op=["aria-label"],Ap={key:0};const Ip=Ne({props:{crumbs:{type:Array,default:()=>[]},icon:{type:String,default:"home"},label:{type:String,default:"Breadcrumb"}},computed:{first(){return this.crumbs[0]}},methods:{button(e,t=!1){const i=e.text??e.label;return{...e,current:!!t&&"page",disabled:!(e.link||e.click||e.dialog||e.drawer),icon:e.loading?"loader":e.icon,size:"sm",text:i,title:i,variant:"dimmed"}},dropdown(e,t){const i=e>0?1:0;return this.crumbs.slice(i,t-e).map(e=>({...e,text:e.text??e.label,icon:"angle-right",variant:null}))},visible(e){return e>0?this.crumbs.slice(-e):[]}}},[["render",function(e,i,s,l,r,u){const p=t("k-button"),k=t("k-dropdown"),y=t("k-collapsible");return n(),h("nav",{"aria-label":s.label,class:"k-breadcrumb"},[b(y,{direction:"start",element:"ol"},{fallback:a(({offset:t,total:o})=>[0!==t?(n(),h("li",Ap,[b(p,c(d(u.button(u.first))),null,16)])):g("",!0),x("li",null,[b(p,{icon:0===t?u.first.icon??s.icon:"dots",size:"sm",variant:"dimmed",onClick:i[0]||(i[0]=t=>e.$refs.dropdown.toggle())},null,8,["icon"]),b(k,{ref:"dropdown",options:u.dropdown(t,o)},null,8,["options"])])]),default:a(({offset:e})=>[(n(!0),h(m,null,f(u.visible(e),(t,i)=>(n(),h("li",{key:t.link},[b(p,o({ref_for:!0},u.button(t,i===e-1)),null,16)]))),128))]),_:1})],8,Op)}]]),Mp={class:"k-browser"},_p={class:"k-browser-items"},Dp=["aria-selected"],Ep=["checked","name","type","onChange"],jp={class:"k-browser-item-info"};const Lp=Ne({props:{items:{type:Array},name:{default:"items",type:String},selected:{type:String},type:{default:"radio",type:String}},emits:["select"]},[["render",function(e,i,o,l,a,r){const c=t("k-item-image");return n(),h("nav",Mp,[x("div",_p,[(n(!0),h(m,null,f(o.items,t=>(n(),h("label",{key:t.value,"aria-selected":o.selected===t.value,class:"k-browser-item"},[x("input",{checked:o.selected===t.value,name:o.name,type:o.type,onChange:i=>e.$emit("select",t)},null,40,Ep),t.image?(n(),s(c,{key:0,image:{...t.image,cover:!0,back:"black"},class:"k-browser-item-image"},null,8,["image"])):g("",!0),x("span",jp,$(t.label),1)],8,Dp))),128))])])}]]),Bp={props:{buttons:Array,layout:String,variant:String,theme:String,size:String,responsive:Boolean}},Tp=["data-layout"];const qp=Ne(Bp,[["render",function(e,i,l,a,c,d){const u=t("k-button");return n(),h("div",{"data-layout":l.layout,class:"k-button-group"},[e.$slots.default?r(e.$slots,"default",{key:0}):(n(!0),h(m,{key:1},f(l.buttons,(e,t)=>(n(),s(u,o({key:t},{ref_for:!0},{variant:l.variant,theme:l.theme,size:l.size,responsive:l.responsive,...e}),null,16))),128))],8,Tp)}]]),zp=["data-view"],Pp={class:"k-file-browser-layout"},Np={ref:"tree",class:"k-file-browser-tree"},Fp={ref:"items",class:"k-file-browser-items"};const Rp=Ne({props:{limit:{default:50,type:Number},opened:{type:String},selected:{type:String}},emits:["select"],data(){return{files:[],page:null,pagination:null,view:this.opened?"files":"tree"}},methods:{paginate(e){this.selectPage(this.page,e.page)},selectFile(e){this.$emit("select",e)},async selectPage(e,t=1){this.page=e;const i="/"===e.id?"/site/files":"/pages/"+this.$api.pages.id(e.id)+"/files",{data:s,pagination:n}=await this.$api.get(i,{select:"filename,id,panelImage,url,uuid",limit:this.limit,page:t});this.pagination=n,this.files=s.map(e=>({label:e.filename,image:e.panelImage,id:e.id,url:e.url,uuid:e.uuid,value:e.uuid??e.url})),this.view="files"},async togglePage(){await this.$nextTick(),this.$refs.tree.scrollIntoView({behaviour:"smooth",block:"nearest",inline:"nearest"})}}},[["render",function(e,i,l,a,r,c){const d=t("k-page-tree"),u=t("k-button"),p=t("k-browser"),m=t("k-pagination");return n(),h("div",{class:"k-file-browser","data-view":r.view},[x("div",Pp,[x("aside",Np,[b(d,{current:r.page?.value??l.opened,onSelect:c.selectPage,onToggleBranch:c.togglePage},null,8,["current","onSelect","onToggleBranch"])],512),x("div",Fp,[b(u,{class:"k-file-browser-back-button",icon:"angle-left",text:r.page?.label,onClick:i[0]||(i[0]=e=>r.view="tree")},null,8,["text"]),r.files.length?(n(),s(p,{key:0,items:r.files,selected:l.selected,onSelect:c.selectFile},null,8,["items","selected","onSelect"])):g("",!0)],512),x("div",{class:"k-file-browser-pagination",onClick:i[1]||(i[1]=S(()=>{},["stop"]))},[r.pagination?(n(),s(m,o({key:0},r.pagination,{details:!0,onPaginate:c.paginate}),null,16,["onPaginate"])):g("",!0)])])],8,zp)}]]);const Yp=Ne({props:{diff:{type:Object,default:()=>({})},tab:String,tabs:{type:Array,default:()=>[]}},computed:{withBadges(){const e=Object.keys(this.diff);return this.tabs.map(t=>{const i=[];for(const e in t.columns)for(const s in t.columns[e].sections)if("fields"===t.columns[e].sections[s].type)for(const n in t.columns[e].sections[s].fields)i.push(n);const s=i.filter(t=>e.includes(t.toLowerCase())).length;return{...t,badge:s>0?{text:s}:void 0}})}}},[["render",function(e,i,o,l,a,r){const c=t("k-tabs");return n(),s(c,{tab:o.tab,tabs:r.withBadges,theme:"notice",class:"k-model-tabs"},null,8,["tab","tabs"])}]]);const Hp=Ne({props:{axis:String,disabled:Boolean,element:{type:String,default:"div"},select:{type:String,default:":where(button, a):not(:disabled)"}},emits:["next","prev"],computed:{keys(){switch(this.axis){case"x":return{ArrowLeft:this.prev,ArrowRight:this.next};case"y":return{ArrowUp:this.prev,ArrowDown:this.next};default:return{ArrowLeft:this.prev,ArrowRight:this.next,ArrowUp:this.prev,ArrowDown:this.next}}}},mounted(){this.$el.addEventListener("keydown",this.keydown)},unmounted(){this.$el.removeEventListener("keydown",this.keydown)},methods:{focus(e=0,t){this.move(e,t)},keydown(e){if(this.disabled)return!1;this.keys[e.key]?.apply(this,[e])},move(e=0,t){const i=[...this.$el.querySelectorAll(this.select)];let s=i.findIndex(e=>e===document.activeElement||e.contains(document.activeElement));switch(-1===s&&(s=0),e){case"first":e=0;break;case"next":e=s+1;break;case"last":e=i.length-1;break;case"prev":e=s-1}e<0?this.$emit("prev"):e>=i.length?this.$emit("next"):i[e]?.focus(),t?.preventDefault()},next(e){this.move("next",e)},prev(e){this.move("prev",e)}}},[["render",function(e,t,i,o,l,c){return n(),s(w(i.element),{class:"k-navigate"},{default:a(()=>[r(e.$slots,"default")]),_:3})}]]),Up=["aria-expanded","aria-current"],Vp={class:"k-tree-branch"},Kp=["disabled","onClick"],Wp=["disabled","onClick","onDblclick"],Jp={class:"k-tree-folder-label"};const Gp=Ne({name:"k-tree",inheritAttrs:!1,props:{element:{type:String,default:"k-tree"},current:{type:String},items:{type:[Array,Object]},level:{default:0,type:Number}},emits:["close","open","select","toggle"],data(){return{state:this.items}},methods:{arrow:e=>!0===e.loading?"loader":e.open?"angle-down":"angle-right",close(e){e.open=!1,this.$emit("close",e)},isItem:(e,t)=>e.value===t,open(e){e.open=!0,this.$emit("open",e)},select(e){this.$emit("select",e)},toggle(e){this.$emit("toggle",e),!0===e.open?this.close(e):this.open(e)}}},[["render",function(e,i,l,a,r,c){const d=t("k-icon"),k=t("k-icon-frame");return n(),h("ul",{class:p(["k-tree",e.$options.name,e.$attrs.class]),style:u({"--tree-level":l.level,...e.$attrs.style})},[(n(!0),h(m,null,f(r.state,t=>(n(),h("li",{key:t.value,"aria-expanded":t.open,"aria-current":c.isItem(t,l.current)},[x("p",Vp,[x("button",{disabled:!t.hasChildren,class:"k-tree-toggle",type:"button",onClick:e=>c.toggle(t)},[b(d,{type:c.arrow(t)},null,8,["type"])],8,Kp),x("button",{disabled:t.disabled,class:"k-tree-folder",type:"button",onClick:e=>c.select(t),onDblclick:e=>c.toggle(t)},[b(k,{icon:t.icon??"folder"},null,8,["icon"]),x("span",Jp,$(t.label),1)],40,Wp)]),t.hasChildren&&t.open?(n(),s(w(e.$options.name),o({key:0,ref_for:!0,ref:t.value},{ref_for:!0},e.$props,{items:t.children,level:l.level+1,onClose:i[0]||(i[0]=t=>e.$emit("close",t)),onOpen:i[1]||(i[1]=t=>e.$emit("open",t)),onSelect:i[2]||(i[2]=t=>e.$emit("select",t)),onToggle:i[3]||(i[3]=t=>e.$emit("toggle",t))}),null,16,["items","level"])):g("",!0)],8,Up))),128))],6)}]]),Xp={name:"k-page-tree",extends:Gp,inheritAttrs:!1,props:{current:{type:String},move:{type:String},root:{default:!0,type:Boolean}},emits:["select"],data:()=>({state:[]}),async mounted(){if(this.items)this.state=this.items;else{this.state=[{icon:"loader"}];const e=await this.load(null);await this.open(e[0]),this.state=this.root?e:e[0].children,this.current&&this.preselect(this.current)}},methods:{findItem(e){return this.state.find(t=>this.isItem(t,e))},isItem:(e,t)=>e.value===t||e.uuid===t||e.id===t,async load(e){return await this.$panel.get("site/tree",{query:{move:this.move??null,parent:e}})},async open(e){if(e){if(!1===e.hasChildren)return!1;e.loading=!0,"string"==typeof e.children&&(e.children=await this.load(e.children)),e.open=!0,e.loading=!1}},async preselect(e){const t=(await this.$panel.get("site/tree/parents",{query:{page:e,root:this.root}})).data;let i=this;for(let n=0;n<t.length;n++){const e=t[n],s=i.findItem(e);if(!s)return;await this.open(s),i=i.$refs[e][0]}const s=i.findItem(e);s&&this.$emit("select",s)}}},Zp={props:{details:Boolean,limit:{type:Number,default:10},page:{type:Number,default:1},total:{type:Number,default:0},validate:{type:Function,default:()=>Promise.resolve()}},emits:["paginate"],computed:{detailsText(){return 1===this.limit?this.start:this.start+"-"+this.end},end(){return Math.min(this.start-1+this.limit,this.total)},offset(){return this.start-1},pages(){return Math.ceil(this.total/this.limit)},start(){return(this.page-1)*this.limit+1}},methods:{async goTo(e){try{await this.validate(e),this.$refs.dropdown?.close();const t=((e=Math.max(1,Math.min(e,this.pages)))-1)*this.limit+1;this.$emit("paginate",{page:e,start:t,end:Math.min(t-1+this.limit,this.total),limit:this.limit,offset:t-1,total:this.total})}catch{}},prev(){this.goTo(this.page-1)},next(){this.goTo(this.page+1)}}},Qp={ref:"page",autofocus:!0},eh=["selected","value"];const th=Ne(Zp,[["render",function(e,i,o,l,r,c){const d=t("k-button"),u=t("k-dropdown"),p=t("k-button-group");return c.pages>1?(n(),s(p,{key:0,layout:"collapsed",class:"k-pagination",onKeydown:[_(c.prev,["left"]),_(c.next,["right"])]},{default:a(()=>[b(d,{disabled:c.start<=1,title:e.$t("prev"),class:"k-pagination-button",icon:"angle-left",size:"xs",variant:"filled",onClick:c.prev},null,8,["disabled","title","onClick"]),o.details?(n(),h(m,{key:0},[b(d,{disabled:o.total<=o.limit,text:o.total>1?`${c.detailsText} / ${o.total}`:o.total,size:"xs",variant:"filled",class:"k-pagination-details",onClick:i[0]||(i[0]=t=>e.$refs.dropdown.toggle())},null,8,["disabled","text"]),b(u,{ref:"dropdown","align-x":"end",class:"k-pagination-selector",onKeydown:[i[3]||(i[3]=_(S(()=>{},["stop"]),["left"])),i[4]||(i[4]=_(S(()=>{},["stop"]),["right"]))]},{default:a(()=>[x("form",{method:"dialog",onClick:i[1]||(i[1]=S(()=>{},["stop"])),onSubmit:i[2]||(i[2]=t=>c.goTo(e.$refs.page.value))},[x("label",null,[v($(e.$t("pagination.page"))+": ",1),x("select",Qp,[(n(!0),h(m,null,f(c.pages,e=>(n(),h("option",{key:e,selected:o.page===e,value:e},$(e),9,eh))),128))],512)]),b(d,{type:"submit",icon:"check"})],32)]),_:1},512)],64)):g("",!0),b(d,{disabled:c.end>=o.total,title:e.$t("next"),class:"k-pagination-button",icon:"angle-right",size:"xs",variant:"filled",onClick:c.next},null,8,["disabled","title","onClick"])]),_:1},8,["onKeydown"])):g("",!0)}]]);const ih=Ne({props:{prev:{type:[Boolean,Object],default:!1},next:{type:[Boolean,Object],default:!1}},computed:{buttons(){return[{...this.button(this.prev),icon:"angle-left"},{...this.button(this.next),icon:"angle-right"}]},isFullyDisabled(){return 0===this.buttons.filter(e=>!e.disabled).length}},methods:{button:e=>e||{disabled:!0,link:"#"}}},[["render",function(e,i,o,l,a,r){const c=t("k-button-group");return r.isFullyDisabled?g("",!0):(n(),s(c,{key:0,buttons:r.buttons,layout:"collapsed",size:"xs",class:"k-prev-next"},null,8,["buttons"]))}]]),sh={mixins:[si],props:{defaultType:String,isLoading:Boolean,pagination:{type:Object,default:()=>({})},results:Array,types:{type:Object,default:()=>({})}},emits:["close","more","navigate","search"],data(){return{selected:-1,type:this.types[this.defaultType]?this.defaultType:Object.keys(this.types)[0]}},computed:{typesDropdown(){return Object.values(this.types).map(e=>({...e,current:this.type===e.id,click:()=>{this.type=e.id,this.focus()}}))}},watch:{type(){this.search()}},methods:{focus(){this.$refs.input?.focus()},onDown(){this.select(Math.min(this.selected+1,this.results.length-1))},onEnter(){this.$emit("navigate",this.results[this.selected]??this.results[0])},onUp(){this.select(Math.max(this.selected-1,-1))},async search(){this.$refs.types?.close(),this.select?.(-1),this.$emit("search",{type:this.type,query:this.query})},select(e){this.selected=e;const t=this.$refs.results?.$el.querySelectorAll(".k-item")??[];for(const i of t)delete i.dataset.selected;e>=0&&(t[e].dataset.selected=!0)}}},nh={class:"k-search-bar"},oh={class:"k-search-bar-input"},lh={key:0,class:"k-search-bar-results"},ah={class:"k-search-bar-footer"},rh={key:0};const ch=Ne(sh,[["render",function(e,i,o,l,r,c){const d=t("k-button"),u=t("k-dropdown"),p=t("k-search-input"),f=t("k-collection");return n(),h("div",nh,[x("div",oh,[c.typesDropdown.length>1?(n(),h(m,{key:0},[b(d,{dropdown:!0,icon:o.types[r.type].icon,text:o.types[r.type].label,variant:"dimmed",class:"k-search-bar-types",onClick:i[0]||(i[0]=t=>e.$refs.types.toggle())},null,8,["icon","text"]),b(u,{ref:"types",options:c.typesDropdown},null,8,["options"])],64)):g("",!0),b(p,{ref:"input","aria-label":e.$t("search"),autofocus:!0,value:e.query,onInput:i[1]||(i[1]=t=>e.query=t),onKeydown:[_(S(c.onDown,["prevent"]),["down"]),_(S(c.onUp,["prevent"]),["up"]),_(c.onEnter,["enter"])]},null,8,["aria-label","value","onKeydown"]),b(d,{icon:o.isLoading?"loader":"cancel",title:e.$t("close"),class:"k-search-bar-close",onClick:i[2]||(i[2]=t=>e.$emit("close"))},null,8,["icon","title"])]),o.results?(n(),h("div",lh,[o.results.length?(n(),s(f,{key:0,ref:"results",items:o.results,onMouseout:i[3]||(i[3]=e=>c.select(-1))},null,8,["items"])):g("",!0),x("footer",ah,[0===o.results.length?(n(),h("p",rh,$(e.$t("search.results.none")),1)):g("",!0),o.results.length<o.pagination.total?(n(),s(d,{key:1,icon:"search",variant:"dimmed",onClick:i[4]||(i[4]=t=>e.$emit("more",{type:r.type,query:e.query}))},{default:a(()=>[v($(e.$t("search.all",{count:o.pagination.total})),1)]),_:1})):g("",!0)])])):g("",!0)])}]]),dh={install(e){e.component("k-breadcrumb",Ip),e.component("k-browser",Lp),e.component("k-button",fs),e.component("k-button-group",qp),e.component("k-file-browser",Rp),e.component("k-link",cs),e.component("k-model-tabs",Yp),e.component("k-navigate",Hp),e.component("k-page-tree",Xp),e.component("k-pagination",th),e.component("k-prev-next",ih),e.component("k-search-bar",ch),e.component("k-tag",ya),e.component("k-tags",xa),e.component("k-tree",Gp)}},uh={props:{buttons:Array,headline:String,invalid:Boolean,label:String,link:String,required:Boolean}},ph=["data-invalid"],hh={key:0,class:"k-section-header"};const mh=Ne(uh,[["render",function(e,i,o,l,c,d){const u=t("k-label"),p=t("k-button-group");return n(),h("section",{class:"k-section","data-invalid":o.invalid},[o.label||o.headline||o.buttons||e.$slots.options?(n(),h("header",hh,[b(u,{invalid:o.invalid,link:o.link,required:o.required,title:o.label??o.headline,type:"section"},{default:a(()=>[v($(o.label??o.headline),1)]),_:1},8,["invalid","link","required","title"]),r(e.$slots,"options",{},()=>[o.buttons?(n(),s(p,{key:0,buttons:o.buttons,size:"xs",variant:"filled",class:"k-section-buttons"},null,8,["buttons"])):g("",!0)])])):g("",!0),r(e.$slots,"default")],8,ph)}]]);const fh=Ne({props:{blueprint:String,content:Object,empty:String,lock:[Boolean,Object],parent:String,tab:Object},emits:["input","submit"],methods:{exists(e){return this.$helper.isComponent(`k-${e}-section`)},isVisible(e){return this.$helper.field.isVisible(e,this.content)}}},[["render",function(e,i,l,r,c,d){const u=t("k-box"),p=t("k-column"),k=t("k-grid");return 0===l.tab.columns.length&&l.empty?(n(),s(u,{key:0,html:!0,text:l.empty,theme:"info"},null,8,["text"])):(n(),s(k,{key:1,class:"k-sections",variant:"columns"},{default:a(()=>[(n(!0),h(m,null,f(l.tab.columns,(t,r)=>(n(),s(p,{key:l.parent+"-column-"+r,width:t.width,sticky:t.sticky},{default:a(()=>[(n(!0),h(m,null,f(t.sections,(a,c)=>(n(),h(m,null,[d.isVisible(a)?(n(),h(m,{key:0},[d.exists(a.type)?(n(),s(w("k-"+a.type+"-section"),o({key:l.parent+"-column-"+r+"-section-"+c+"-"+l.blueprint},{ref_for:!0},a,{column:t.width,content:l.content,lock:l.lock,name:a.name,parent:l.parent,timestamp:e.$panel.view.timestamp,class:"k-section-name-"+a.name,onInput:i[0]||(i[0]=t=>e.$emit("input",t)),onSubmit:i[1]||(i[1]=t=>e.$emit("submit",t))}),null,16,["column","content","lock","name","parent","timestamp","class"])):(n(),s(u,{key:l.parent+"-column-"+r+"-section-"+c,text:e.$t("error.section.type.invalid",{type:a.type}),icon:"alert",theme:"negative"},null,8,["text"]))],64)):g("",!0)],64))),256))]),_:2},1032,["width","sticky"]))),128))]),_:1}))}]]),gh={props:{blueprint:String,help:String,lock:[Boolean,Object],name:String,parent:String,timestamp:Number},methods:{load(){return this.$api.get(this.parent+"/sections/"+this.name)}}};const kh=Ne({mixins:[gh],inheritAttrs:!1,props:{content:Object},emits:["input","submit"],data:()=>({fields:{},isLoading:!0,issue:null}),computed:{fieldsWithAdditionalData(){const e={},t=this.$panel.content.diff();for(const i in this.fields)e[i]={...this.fields[i],endpoints:{field:this.parent+"/fields/"+i,section:this.parent+"/sections/"+this.name,model:this.parent},hasDiff:Object.hasOwn(t,i),section:this.name};return e}},watch:{timestamp(){this.fetch()}},mounted(){this.fetch()},methods:{async fetch(){try{const e=await this.load();this.fields=e.fields}catch(e){this.issue=e}finally{this.isLoading=!1,await this.$nextTick(),this.$events.emit("section.loaded",this)}}}},[["render",function(e,i,o,l,r,c){const d=t("k-box"),h=t("k-form"),m=t("k-section");return r.isLoading?g("",!0):(n(),s(m,{key:0,class:p(["k-fields-section",e.$attrs.class]),headline:r.issue?e.$t("error"):null,style:u(e.$attrs.style)},{default:a(()=>[r.issue?(n(),s(d,{key:0,text:r.issue.message,html:!1,icon:"alert",theme:"negative"},null,8,["text"])):g("",!0),b(h,{fields:c.fieldsWithAdditionalData,validate:!0,value:o.content,disabled:e.lock&&"lock"===e.lock.state,onInput:i[0]||(i[0]=t=>e.$emit("input",t)),onSubmit:i[1]||(i[1]=t=>e.$emit("submit",t))},null,8,["fields","value","disabled"])]),_:1},8,["class","headline","style"]))}]]);const bh=Ne({mixins:[gh,$r],inheritAttrs:!1,props:{column:String},data:()=>({data:[],error:null,isLoading:!1,isProcessing:!1,options:{batch:!1,columns:{},empty:null,fields:{},headline:null,help:null,layout:"list",link:null,max:null,min:null,size:null,sortable:null},pagination:{page:null},searchterm:null,searching:!1}),computed:{addIcon:()=>"add",batchDeleteConfirmMessage(){return this.$t(`${this.type}.delete.confirm.selected`,{count:this.selected.length})},batchEditingEvent:()=>"section.selecting",buttons(){let e=[];return this.isSelecting?this.batchEditingButtons:(this.canSearch&&e.push({icon:"filter",text:this.$t("filter"),click:()=>this.onSearchToggle(),responsive:!0}),this.canSelect&&e.push(this.batchEditingToggle),this.canAdd&&e.push({icon:this.addIcon,text:this.$t("add"),click:()=>this.onAdd(),responsive:!0}),e)},canAdd:()=>!0,canDrop:()=>!1,canSearch(){return this.options.search},canSelect(){return this.options.batch&&this.items.length>0},collection(){return{columns:this.options.columns,empty:this.emptyPropsWithSearch,fields:this.fields,layout:this.options.layout,help:this.options.help,items:this.items,pagination:this.pagination,selecting:!this.isProcessing&&this.isSelecting,selected:this.selected,sortable:!this.isProcessing&&this.options.sortable,size:this.options.size}},emptyProps(){return{icon:"page",text:this.$t("pages.empty")}},emptyPropsWithSearch(){return{...this.emptyProps,text:this.searching?this.$t("search.results.none"):this.options.empty??this.emptyProps.text}},fields(){const e={};for(const t in this.options.columns??{})e[t]={...this.options.fields?.[t]??this.options.columns[t],disabled:!0};return e},items(){return this.data},isInvalid(){return!(this.searchterm?.length>0)&&(!!(this.options.min&&this.data.length<this.options.min)||!!(this.options.max&&this.data.length>this.options.max))},paginationId(){return"kirby$pagination$"+this.parent+"/"+this.name},type:()=>"models"},watch:{searchterm(){this.search()},timestamp(){this.reload()}},created(){this.$events.on("model.update",this.reload)},unmounted(){this.$events.off("model.update",this.reload)},mounted(){this.search=ii(this.search,200),this.load()},methods:{async deleteSelected(){if(0!==this.selected.length){this.isProcessing=!0;try{await this.$api.delete(this.parent+"/sections/"+this.name+"/delete",{ids:this.selected})}catch(e){this.$panel.notification.error(e)}finally{this.$panel.events.emit("model.update"),this.isProcessing=!1}}},async load(e){this.isProcessing=!0,e||(this.isLoading=!0);const t=this.pagination.page??sessionStorage.getItem(this.paginationId)??null;try{const e=await this.$api.get(this.parent+"/sections/"+this.name,{page:t,searchterm:this.searchterm});this.options=e.options,this.pagination=e.pagination,this.data=e.data}catch(i){this.error=i.message}finally{this.isProcessing=!1,this.isLoading=!1,await this.$nextTick(),this.$events.emit("section.loaded",this)}},onAction(){},onAdd(){},onBatchDelete(){this.deleteSelected()},onChange(){},onDrop(){},onPaginate(e){sessionStorage.setItem(this.paginationId,e.page),this.pagination=e,this.reload()},onSearchToggle(){this.searching=!this.searching,this.searchterm=null},onSort(){},async reload(){this.stopSelecting(),await this.load(!0)},async search(){this.pagination.page=0,await this.reload()},update(){this.reload(),this.$events.emit("model.update")}}},[["render",function(e,i,l,r,c,d){const h=t("k-text"),m=t("k-box"),f=t("k-input"),y=t("k-collection"),w=t("k-dropzone"),S=t("k-section");return!1===c.isLoading?(n(),s(S,{key:0,buttons:d.buttons,class:p(["k-models-section",`k-${d.type}-section`,e.$attrs.class]),"data-processing":c.isProcessing,headline:c.options.headline??" ",invalid:d.isInvalid,link:c.options.link,required:Boolean(c.options.min),style:u(e.$attrs.style)},{default:a(()=>[c.error?(n(),s(m,{key:0,icon:"alert",theme:"negative"},{default:a(()=>[b(h,{size:"small"},{default:a(()=>[x("strong",null,$(e.$t("error.section.notLoaded",{name:e.name}))+": ",1),v(" "+$(c.error),1)]),_:1})]),_:1})):(n(),s(w,{key:1,disabled:!d.canDrop,onDrop:d.onDrop},{default:a(()=>[c.searching&&c.options.search?(n(),s(f,{key:0,autofocus:!0,placeholder:e.$t("filter")+" …",value:c.searchterm,icon:"search",type:"text",class:"k-models-section-search",onInput:i[0]||(i[0]=e=>c.searchterm=e),onKeydown:_(d.onSearchToggle,["esc"])},null,8,["placeholder","value","onKeydown"])):g("",!0),b(y,o(d.collection,k(d.canAdd?{empty:d.onAdd}:{}),{onAction:d.onAction,onChange:d.onChange,onSelect:e.onSelect,onSort:d.onSort,onPaginate:d.onPaginate}),null,16,["onAction","onChange","onSelect","onSort","onPaginate"])]),_:1},8,["disabled","onDrop"]))]),_:1},8,["buttons","class","data-processing","headline","invalid","link","required","style"])):g("",!0)}]]),yh={extends:bh,computed:{addIcon:()=>"upload",canAdd(){return this.$panel.permissions.files.create&&!1!==this.options.upload},canDrop(){return!1!==this.canAdd},emptyProps(){return{icon:"image",text:this.$t("files.empty")}},items(){return this.data.map(e=>{const t=e.permissions.sort&&this.options.sortable&&!this.isSelecting,i=e.permissions.delete&&this.data.length>this.options.min;return{...e,column:this.column,data:{"data-id":e.id,"data-template":e.template},options:this.$dropdown(e.link,{query:{delete:i,sort:t,view:"list"}}),selectable:this.isSelecting&&i,sortable:t}})},type:()=>"files",uploadOptions(){return{...this.options.upload,url:this.$panel.urls.api+"/"+this.options.upload.api}}},mounted(){this.$events.on("file.sort",this.reload)},unmounted(){this.$events.off("file.sort",this.reload)},methods:{onAction(e,t){"replace"===e&&this.replace(t)},onAdd(){this.canAdd&&this.$panel.upload.pick(this.uploadOptions)},onDrop(e){this.canAdd&&this.$panel.upload.open(e,this.uploadOptions)},async onSort(e){if(!1===this.options.sortable)return!1;this.isProcessing=!0;try{await this.$api.patch(this.options.apiUrl+"/sort",{files:e.map(e=>e.id),index:this.pagination.offset}),this.$panel.notification.success(),this.$events.emit("file.sort")}catch(t){this.$panel.error(t),this.reload()}finally{this.isProcessing=!1}},replace(e){this.$panel.upload.replace(e,this.uploadOptions)}}};const vh=Ne({mixins:[gh],inheritAttrs:!1,data:()=>({icon:null,label:null,text:null,theme:null}),async mounted(){const e=await this.load();this.icon=e.icon,this.label=e.label,this.text=e.text,this.theme=e.theme??"info"}},[["render",function(e,i,o,l,r,c){const d=t("k-box"),h=t("k-section");return n(),s(h,{headline:r.label,class:p(["k-info-section",e.$attrs.class]),style:u(e.$attrs.style)},{default:a(()=>[b(d,{html:!0,icon:r.icon,text:r.text,theme:r.theme},null,8,["icon","text","theme"])]),_:1},8,["headline","class","style"])}]]),$h={extends:bh,computed:{canAdd(){return this.options.add&&this.$panel.permissions.pages.create},items(){return this.data.map(e=>{const t=e.permissions.sort&&this.options.sortable&&!this.isSelecting,i=e.permissions.delete&&this.data.length>this.options.min,s={...this.$helper.page.status(e.status,!1===e.permissions.changeStatus),class:"k-page-status-icon-option",dialog:e.link+"/changeStatus"};return{...e,buttons:[s,...e.buttons??[]],column:this.column,data:{"data-id":e.id,"data-status":e.status,"data-template":e.template},flag:s,deletable:i,options:this.$dropdown(e.link,{query:{view:"list",delete:i,sort:t}}),selectable:this.isSelecting&&i,sortable:t}})},type:()=>"pages"},mounted(){this.$events.on("page.changeStatus",this.reload),this.$events.on("page.sort",this.reload)},unmounted(){this.$events.off("page.changeStatus",this.reload),this.$events.off("page.sort",this.reload)},methods:{onAdd(){this.canAdd&&this.$panel.dialog.open(this.parent+"/sections/"+this.name+"/create")},async onChange(e){let t=null;if(e.added&&(t="added"),e.moved&&(t="moved"),t){this.isProcessing=!0;const s=e[t].element,n=e[t].newIndex+1+this.pagination.offset;try{await this.$api.pages.changeStatus(s.id,"listed",n),this.$panel.notification.success(),this.$events.emit("page.sort",s)}catch(i){this.$panel.error({message:i.message,details:i.details}),await this.reload()}finally{this.isProcessing=!1}}}}};const wh=Ne({mixins:[gh],data:()=>({headline:null,isLoading:!0,reports:null,size:null}),async mounted(){const e=await this.load();this.isLoading=!1,this.headline=e.headline,this.reports=e.reports,this.size=e.size},methods:{}},[["render",function(e,i,o,l,r,c){const d=t("k-stats"),u=t("k-section");return!1===r.isLoading?(n(),s(u,{key:0,headline:r.headline,class:"k-stats-section"},{default:a(()=>[b(d,{reports:r.reports,size:r.size},null,8,["reports","size"])]),_:1},8,["headline"])):g("",!0)}]]),xh={install(e){e.component("k-section",mh),e.component("k-sections",fh),e.component("k-fields-section",kh),e.component("k-files-section",yh),e.component("k-info-section",vh),e.component("k-pages-section",$h),e.component("k-stats-section",wh)}},Sh=["data-theme"];const Ch=Ne({props:{theme:{type:String,default:"positive"}}},[["render",function(e,t,i,s,o,l){return n(),h("ul",{class:"k-checklist k-stack","data-theme":i.theme},[r(e.$slots,"default")],8,Sh)}]]),Oh={components:{"k-highlight":B(()=>Yd(()=>import("./Highlight.min.js"),[],import.meta.url))},props:{language:{type:String}}},Ah=["data-language"];const Ih=Ne(Oh,[["render",function(e,i,o,l,c,d){const u=t("k-highlight");return n(),s(u,null,{default:a(()=>[x("div",null,[x("pre",{class:"k-code","data-language":o.language},[(n(),h("code",{key:e.$slots.default()[0].children+"-"+o.language,class:p(o.language?`language-${o.language}`:null)},[r(e.$slots,"default")],2))],8,Ah)])]),_:3})}]]),Mh=["data-type"];const _h=Ne({props:{type:String}},[["render",function(e,t,i,s,o,l){return n(),h("code",{"data-type":(i.type??"true").toLowerCase()},[r(e.$slots,"default")],8,Mh)}]]);const Dh=Ne({props:{link:String,tag:{type:String,default:"h2"}},emits:["click"]},[["render",function(e,i,o,l,c,d){const u=t("k-link");return n(),s(w(o.tag),{class:"k-headline",onClick:i[0]||(i[0]=t=>e.$emit("click",t))},{default:a(()=>[o.link?(n(),s(u,{key:0,to:o.link},{default:a(()=>[r(e.$slots,"default")]),_:3},8,["to"])):r(e.$slots,"default",{key:1})]),_:3})}]]),Eh={props:{hasDiff:Boolean,input:{type:[String,Number,Boolean]},invalid:{type:Boolean},link:{type:String},required:{default:!1,type:Boolean},type:{default:"field",type:String}},computed:{element(){return"section"===this.type||!1===this.input?"h2":"label"}}},jh={class:"k-label-text"},Lh={key:1,class:"k-label-text"},Bh=["title"],Th=["title"];const qh=Ne(Eh,[["render",function(e,i,o,l,c,d){const u=t("k-link");return n(),s(w(d.element),{for:o.input,class:p(["k-"+o.type+"-label","k-label"]),"data-has-diff":o.hasDiff},{default:a(()=>[o.link?(n(),s(u,{key:0,to:o.link},{default:a(()=>[x("span",jh,[r(e.$slots,"default")])]),_:3},8,["to"])):(n(),h("span",Lh,[r(e.$slots,"default")])),o.required?(n(),h("abbr",{key:2,title:e.$t(o.type+".required")},"✶",8,Bh)):g("",!0),x("abbr",{title:e.$t(o.type+".invalid"),"data-theme":"negative",class:"k-label-invalid"}," × ",8,Th)]),_:3},8,["for","class","data-has-diff"])}]]),zh=["innerHTML"];const Ph=Ne({props:{align:String,html:String,size:String},computed:{attrs(){return{class:"k-text","data-align":this.align,"data-size":this.size}}}},[["render",function(e,t,i,s,l,a){return i.html?(n(),h("div",o({key:0},a.attrs,{innerHTML:i.html}),null,16,zh)):(n(),h("div",c(o({key:1},a.attrs)),[r(e.$slots,"default")],16))}]]),Nh={install(e){e.component("k-checklist",Ch),e.component("k-code",Ih),e.component("k-code-token",_h),e.component("k-headline",Dh),e.component("k-label",qh),e.component("k-text",Ph)}},Fh={props:{back:String,color:String,cover:{type:Boolean,default:!0},icon:String,type:String,url:String}},Rh=["href"];const Yh=Ne({mixins:[Fh],computed:{fallbackColor(){return this.type?.startsWith("image/")?"orange-500":this.type?.startsWith("audio/")?"aqua-500":this.type?.startsWith("video/")?"yellow-500":"white"},fallbackIcon(){return this.type?.startsWith("image/")?"image":this.type?.startsWith("audio/")?"audio":this.type?.startsWith("video/")?"video":"file"},isPreviewable(){return["image/jpeg","image/jpg","image/gif","image/png","image/webp","image/avif","image/svg+xml"].includes(this.type)}}},[["render",function(e,i,o,l,a,r){const c=t("k-image"),d=t("k-icon-frame");return n(),h("a",{href:e.url,class:"k-upload-item-preview",target:"_blank"},[r.isPreviewable?(n(),s(c,{key:0,cover:e.cover,src:e.url,back:e.back??"pattern"},null,8,["cover","src","back"])):(n(),s(d,{key:1,color:e.color??r.fallbackColor,icon:e.icon??r.fallbackIcon,back:e.back??"black",ratio:"1/1"},null,8,["color","icon","back"]))],8,Rh)}]]),Hh={mixins:[Fh],props:{completed:Boolean,editable:{type:Boolean,default:!0},error:[String,Boolean],extension:String,id:String,name:String,niceSize:String,progress:Number,removable:{type:Boolean,default:!0}},emits:["remove","rename"]},Uh=["data-completed"],Vh={class:"k-upload-item-body"},Kh={class:"k-upload-item-meta"},Wh={key:0,class:"k-upload-item-error","data-theme":"negative"},Jh={class:"k-upload-item-toggle"};const Gh=Ne(Hh,[["render",function(e,i,o,l,a,r){const c=t("k-upload-item-preview"),d=t("k-input"),u=t("k-progress"),p=t("k-button");return n(),h("li",{"data-completed":o.completed,class:"k-upload-item"},[b(c,{back:e.back,color:e.color,cover:e.cover,icon:e.icon,type:e.type,url:e.url},null,8,["back","color","cover","icon","type","url"]),b(d,{disabled:o.completed||!o.editable,after:"."+o.extension,required:!0,value:o.name,allow:"a-z0-9@._-",class:"k-upload-item-input",type:"slug",onInput:i[0]||(i[0]=t=>e.$emit("rename",t))},null,8,["disabled","after","value"]),x("div",Vh,[x("p",Kh,[v($(o.niceSize)+" ",1),o.progress?(n(),h(m,{key:0},[v(" - "+$(o.progress)+"% ",1)],64)):g("",!0)]),o.error?(n(),h("p",Wh,$(o.error),1)):o.progress?(n(),s(u,{key:1,value:o.progress,class:"k-upload-item-progress"},null,8,["value"])):g("",!0)]),x("div",Jh,[o.completed||o.progress||!o.removable?!o.completed&&o.progress?(n(),s(p,{key:1,disabled:!0,icon:"loader"})):o.completed?(n(),s(p,{key:2,icon:"check",theme:"positive",onClick:i[2]||(i[2]=t=>e.$emit("remove"))})):g("",!0):(n(),s(p,{key:0,icon:"remove",onClick:i[1]||(i[1]=t=>e.$emit("remove"))}))])],8,Uh)}]]),Xh={class:"k-upload-items"};const Zh=Ne({props:{items:Array},emits:["remove","rename"]},[["render",function(e,i,l,a,r,c){const d=t("k-upload-item");return n(),h("ul",Xh,[(n(!0),h(m,null,f(l.items,t=>(n(),s(d,o({key:t.id},{ref_for:!0},t,{onRename:i=>e.$emit("rename",t,i),onRemove:i=>e.$emit("remove",t)}),null,16,["onRename","onRemove"]))),128))])}]]),Qh={install(e){e.component("k-upload-item",Gh),e.component("k-upload-item-preview",Yh),e.component("k-upload-items",Zh)}},em={key:0,class:"k-activation"},tm={href:"https://getkirby.com/buy",target:"_blank"};const im=Ne({props:{status:{default:"missing",type:String}}},[["render",function(e,i,s,o,l,a){const r=t("k-button");return e.$panel.activation.isOpen?(n(),h("div",em,[x("p",null,[x("strong",null,$(e.$t(`license.status.${s.status}.bubble`)),1),"missing"===s.status?(n(),h(m,{key:0},[x("a",tm,$(e.$t("license.buy")),1),i[2]||(i[2]=v(" & ",-1)),x("button",{type:"button",onClick:i[0]||(i[0]=t=>e.$dialog("registration"))},$(e.$t("license.activate")),1)],64)):g("",!0)]),b(r,{class:"k-activation-toggle",icon:"cancel-small",onClick:i[1]||(i[1]=t=>e.$panel.activation.close())})])):g("",!0)}]]),sm={mixins:[ds],props:{hasDiff:Boolean,options:String},computed:{changesBadge(){return this.hasDiff?{theme:this.$panel.content.isLocked()?"red":"orange"}:null}},methods:{change(e){this.$panel.reload({query:{language:e.code}})}}},nm={class:"k-view-button k-languages-dropdown"},om=["data-lock"],lm={class:"k-languages-dropdown-item-code"};const am=Ne(sm,[["render",function(e,i,l,r,c,d){const u=t("k-button"),p=t("k-icon"),m=t("k-dropdown");return n(),h("div",nm,[b(u,o(e.$props,{badge:d.changesBadge,dropdown:!0,onClick:i[0]||(i[0]=t=>e.$refs.dropdown.toggle())}),null,16,["badge"]),b(m,{ref:"dropdown",options:e.$dropdown(l.options),"align-x":"end"},{item:a(({item:t,index:i})=>[(n(),s(u,o({key:"item-"+i},t,{class:"k-dropdown-item k-languages-dropdown-item",onClick:e=>d.change(t)}),{default:a(()=>[v($(t.text)+" ",1),x("span",{"data-lock":t.lock,class:"k-languages-dropdown-item-info"},[t.changes?(n(),s(p,{key:0,alt:e.$t("lock.unsaved"),type:t.lock?"lock":"edit-line",class:"k-languages-dropdown-item-icon"},null,8,["alt","type"])):g("",!0),x("span",lm,$(t.code.toUpperCase()),1)],8,om)]),_:2},1040,["onClick"]))]),_:1},8,["options"])])}]]);const rm=Ne({props:{size:String,text:{type:String,default:()=>window.panel.t("theme")},variant:String},computed:{current(){return this.$panel.theme.current},options(){return[{text:this.$t("theme.light"),icon:"sun",disabled:"light"===this.setting,click:()=>this.$panel.theme.set("light")},{text:this.$t("theme.dark"),icon:"moon",disabled:"dark"===this.setting,click:()=>this.$panel.theme.set("dark")},{text:this.$t("theme.automatic"),icon:"wand",disabled:"system"===this.setting,click:()=>this.$panel.theme.set("system")}]},setting(){return this.$panel.theme.setting??this.$panel.theme.config}}},[["render",function(e,i,l,a,r,c){const d=t("k-view-button");return n(),s(d,o(e.$props,{icon:"light"===c.current?"sun":"moon",options:c.options}),null,16,["icon","options"])}]]),cm={class:"k-view-button"};const dm=Ne({extends:fs,props:{options:[Array,String],size:{default:"sm"},variant:{default:"filled"}},emits:["action","click"],computed:{hasDropdown(){return!0===Array.isArray(this.options)?this.options.length>0:Boolean(this.options)}},methods:{onClick(){if(this.hasDropdown)return this.$refs.dropdown.toggle();this.$emit("click")}}},[["render",function(e,i,l,a,r,c){const d=t("k-button"),u=t("k-dropdown");return n(),h("div",cm,[b(d,o(e.$props,{dropdown:e.dropdown||c.hasDropdown,onClick:c.onClick}),null,16,["dropdown","onClick"]),c.hasDropdown?(n(),s(u,{key:0,ref:"dropdown",options:Array.isArray(l.options)?l.options:e.$dropdown(l.options),"align-x":"end",onAction:i[0]||(i[0]=t=>e.$emit("action",t))},null,8,["options"])):g("",!0)])}]]),um={key:0,class:"k-view-buttons"};const pm=Ne({props:{buttons:{type:Array,default:()=>[]}},emits:["action"],computed:{groups(){return this.$helper.array.split(this.buttons,"-")}},methods:{component(e){return this.$helper.isComponent(e.component)?e.component:"k-view-button"}}},[["render",function(e,i,l,c,d,u){const p=t("k-button-group");return l.buttons.length?(n(),h("nav",um,[r(e.$slots,"before"),(n(!0),h(m,null,f(u.groups,(t,l)=>(n(),s(p,{key:l},{default:a(()=>[(n(!0),h(m,null,f(t,t=>(n(),s(w(u.component(t)),o({key:t.key},{ref_for:!0},t.props,{onAction:i[0]||(i[0]=t=>e.$emit("action",t))}),null,16))),128))]),_:2},1024))),128)),r(e.$slots,"after")])):g("",!0)}]]),hm={install(e){e.component("k-languages-dropdown",am),e.component("k-theme-view-button",rm),e.component("k-view-button",dm),e.component("k-view-buttons",pm)}},mm={class:"k-panel-main"};const fm=Ne({},[["render",function(e,i,o,l,c,d){const u=t("k-panel-menu"),p=t("k-topbar"),h=t("k-panel-notifications"),m=t("k-panel");return n(),s(m,{class:"k-panel-inside"},{default:a(()=>[b(u,{"has-search":e.$panel.hasSearch,items:e.$panel.menu.items,"is-hovered":e.$panel.menu.hover,"is-open":e.$panel.menu.isOpen,license:e.$panel.license,onHover:i[0]||(i[0]=t=>e.$panel.menu.hover=t),onSearch:i[1]||(i[1]=t=>e.$panel.search()),onToggle:i[2]||(i[2]=t=>e.$panel.menu.toggle())},null,8,["has-search","items","is-hovered","is-open","license"]),x("main",mm,[b(p,{breadcrumb:e.$panel.view.breadcrumb,view:e.$panel.view},{default:a(()=>[r(e.$slots,"topbar")]),_:3},8,["breadcrumb","view"]),r(e.$slots,"default")]),b(h)]),_:3})}]]),gm={props:{hasSearch:Boolean,isHovered:Boolean,isOpen:Boolean,items:{type:Array,default:()=>[]},license:String},emits:["hover","search","toggle"],data:()=>({over:!1}),computed:{activationButton(){return"missing"===this.license?{dialog:"registration",text:this.$t("activate")}:"legacy"===this.license&&{dialog:"license",text:this.$t("renew")}},menus(){return this.$helper.array.split(this.items,"-")}}},km=["aria-label","data-hover"],bm={class:"k-panel-menu-body"},ym=["data-second-last"],vm={key:1};const $m=Ne(gm,[["render",function(e,i,l,a,r,c){const d=t("k-button"),u=t("k-activation");return n(),h("nav",{class:"k-panel-menu","aria-label":e.$t("menu"),"data-hover":l.isHovered,onMouseenter:i[2]||(i[2]=t=>e.$emit("hover",!0)),onMouseleave:i[3]||(i[3]=t=>e.$emit("hover",!1))},[x("div",bm,[l.hasSearch?(n(),s(d,{key:0,text:e.$t("search"),icon:"search",class:"k-panel-menu-search k-panel-menu-button",onClick:i[0]||(i[0]=t=>e.$emit("search"))},null,8,["text"])):g("",!0),(n(!0),h(m,null,f(c.menus,(e,t)=>(n(),h("menu",{key:t,"data-second-last":t===c.menus.length-2,class:"k-panel-menu-buttons"},[(n(!0),h(m,null,f(e,e=>(n(),s(w(e.component),o({key:e.key},{ref_for:!0},e.props,{class:"k-panel-menu-button"}),null,16))),128))],8,ym))),128)),c.activationButton?(n(),h("menu",vm,[b(d,o(c.activationButton,{class:"k-activation-button k-panel-menu-button",icon:"key",theme:"love",variant:"filled"}),null,16),b(u,{status:l.license},null,8,["status"])])):g("",!0)]),b(d,{icon:l.isOpen?"angle-left":"angle-right",title:l.isOpen?e.$t("collapse"):e.$t("expand"),size:"xs",class:"k-panel-menu-toggle",onClick:i[1]||(i[1]=t=>e.$emit("toggle"))},null,8,["icon","title"])],40,km)}]]);const wm=Ne({computed:{notification(){return"view"!==this.$panel.notification.context||this.$panel.notification.isFatal?null:this.$panel.notification}}},[["render",function(e,i,o,l,a,r){const c=t("k-button");return r.notification&&"error"!==r.notification.type?(n(),s(c,{key:0,icon:r.notification.icon,text:r.notification.message,theme:r.notification.theme,variant:"filled",class:"k-panel-notification",onClick:i[0]||(i[0]=e=>r.notification.close())},null,8,["icon","text","theme"])):g("",!0)}]]);const xm=Ne({},[["render",function(e,i,o,l,c,d){const u=t("k-panel");return n(),s(u,{class:"k-panel-outside",tabindex:"0"},{default:a(()=>[r(e.$slots,"default")]),_:3})}]]),Sm=["data-dragging","data-loading","data-language","data-language-default","data-menu","data-role","data-theme","data-translation","data-user","dir"];const Cm=Ne({inheritAttrs:!1},[["render",function(e,i,o,l,c,d){const u=t("k-state-dialog"),m=t("k-state-drawer"),f=t("k-fatal"),k=t("k-offline-warning"),y=t("k-icons"),v=t("k-overlay");return n(),h("div",{"data-dragging":e.$panel.drag.isDragging,"data-loading":e.$panel.isLoading,"data-language":e.$panel.language.code,"data-language-default":e.$panel.language.isDefault,"data-menu":e.$panel.menu.isOpen?"true":"false","data-role":e.$panel.user.role,"data-theme":e.$panel.theme.current,"data-translation":e.$panel.translation.code,"data-user":e.$panel.user.id,dir:e.$panel.direction,class:p(["k-panel",e.$attrs.class])},[r(e.$slots,"default"),e.$panel.dialog.isOpen&&!e.$panel.dialog.legacy?(n(),s(u,{key:0})):g("",!0),e.$panel.drawer.isOpen&&!e.$panel.drawer.legacy?(n(),s(m,{key:1})):g("",!0),e.$panel.notification.isFatal&&e.$panel.notification.isOpen?(n(),s(f,{key:2,html:e.$panel.notification.message},null,8,["html"])):g("",!0),b(k),b(y),b(v,{nested:e.$panel.drawer.history.milestones.length>1,visible:e.$panel.drawer.isOpen,type:"drawer",onClose:i[0]||(i[0]=t=>e.$panel.drawer.close())},{default:a(()=>[...i[2]||(i[2]=[x("div",{class:"k-drawer-portal k-portal",multiple:""},null,-1)])]),_:1},8,["nested","visible"]),b(v,{nested:e.$panel.dialog.history.milestones.length>1,visible:e.$panel.dialog.isOpen,type:"dialog",onClose:i[1]||(i[1]=t=>e.$panel.dialog.close())},{default:a(()=>[...i[3]||(i[3]=[x("div",{class:"k-dialog-portal k-portal",multiple:""},null,-1)])]),_:1},8,["nested","visible"])],10,Sm)}]]),Om={class:"k-topbar"},Am={class:"k-topbar-signals"};const Im=Ne({props:{breadcrumb:Array,view:Object},computed:{crumbs(){return[{link:this.view.link,label:this.view.label??this.view.breadcrumbLabel,icon:this.view.icon,loading:this.$panel.isLoading},...this.breadcrumb]}}},[["render",function(e,i,s,o,l,a){const c=t("k-button"),d=t("k-breadcrumb");return n(),h("div",Om,[b(c,{icon:"bars",class:"k-panel-menu-proxy",onClick:i[0]||(i[0]=t=>e.$panel.menu.toggle())}),b(d,{crumbs:a.crumbs,class:"k-topbar-breadcrumb"},null,8,["crumbs"]),x("div",Am,[r(e.$slots,"default")])])}]]),Mm={install(e){e.use(hm),e.component("k-activation",im),e.component("k-panel",Cm),e.component("k-panel-inside",fm),e.component("k-panel-menu",$m),e.component("k-panel-notifications",wm),e.component("k-panel-outside",xm),e.component("k-topbar",Im)}},_m={key:0};const Dm=Ne({props:{error:String,layout:String}},[["render",function(e,i,o,l,r,c){const d=t("k-box"),u=t("k-header");return n(),s(w(`k-panel-${o.layout}`),{class:"k-error-view"},{default:a(()=>["outside"===o.layout?(n(),h("div",_m,[b(d,{icon:"alert",theme:"negative"},{default:a(()=>[v($(o.error),1)]),_:1})])):(n(),h(m,{key:1},[b(u,null,{default:a(()=>[v($(e.$t("error")),1)]),_:1}),b(d,{icon:"alert",theme:"negative"},{default:a(()=>[v($(o.error),1)]),_:1})],64))]),_:1})}]]),Em={class:"k-search-view-results"};const jm=Ne({mixins:[si],props:{type:{default:"pages",type:String}},data:()=>({query:new URLSearchParams(window.location.search).get("query"),pagination:{},results:[]}),computed:{currentType(){return this.$panel.searches[this.type]??Object.values(this.$panel.searches)[0]},empty(){return this.isLoading?this.$t("searching")+"…":this.query.length<2?this.$t("search.min",{min:2}):this.$t("search.results.none")},isLoading(){return this.$panel.searcher.isLoading},tabs(){const e=[];for(const t in this.$panel.searches){const i=this.$panel.searches[t];e.push({label:i.label,link:"/search/?type="+t+"&query="+this.query,name:t})}return e}},watch:{isLoading(e){this.$panel.isLoading=e},query:{handler(){this.search(1)},immediate:!0},type(){this.search()}},methods:{focus(){this.$refs.input?.focus()},onPaginate(e){this.search(e.page)},async search(e){e||(e=new URLSearchParams(window.location.search).get("page")??1);const t=this.$panel.url(window.location,{type:this.currentType.id,query:this.query,page:e});window.history.pushState("","",t.toString());const i=await this.$panel.search(this.currentType.id,this.query,{page:e,limit:15});i&&(this.results=i.results??[],this.pagination=i.pagination)}}},[["render",function(e,i,o,l,r,c){const d=t("k-input"),u=t("k-header"),p=t("k-tabs"),h=t("k-collection"),m=t("k-panel-inside");return n(),s(m,{class:"k-search-view"},{default:a(()=>[b(u,null,{buttons:a(()=>[b(d,{ref:"input","aria-label":e.$t("search"),autofocus:!0,icon:c.isLoading?"loader":"search",placeholder:e.$t("search")+" …",spellcheck:!1,value:r.query,class:"k-search-view-input",type:"text",onInput:i[0]||(i[0]=e=>r.query=e)},null,8,["aria-label","icon","placeholder","value"])]),default:a(()=>[v($(e.$t("search"))+" ",1)]),_:1}),b(p,{tab:c.currentType.id,tabs:c.tabs},null,8,["tab","tabs"]),x("div",Em,[b(h,{items:r.results,empty:{icon:c.isLoading?"loader":"search",text:c.empty},pagination:r.pagination,onPaginate:c.onPaginate},null,8,["items","empty","pagination","onPaginate"])])]),_:1})}]]),Lm={props:{api:String,blueprint:String,buttons:Array,id:String,link:String,lock:{type:[Boolean,Object]},next:Object,prev:Object,permissions:{type:Object,default:()=>({})},tab:{type:Object,default:()=>({columns:[]})},tabs:{type:Array,default:()=>[]},uuid:String,versions:Object},data:()=>({isSaved:!0}),computed:{content(){return this.versions.changes},diff(){return this.$panel.content.diff()},editor(){return this.lock.user.email},hasDiff(){return this.$panel.content.hasDiff()},isLocked(){return this.lock.isLocked},isSaving(){return this.$panel.content.isProcessing},modified(){return this.lock.modified}},mounted(){this.$events.on("beforeunload",this.onBeforeUnload),this.$events.on("content.save",this.onContentSave),this.$events.on("keydown.left",this.toPrev),this.$events.on("keydown.right",this.toNext),this.$events.on("model.reload",this.$reload),this.$events.on("view.save",this.onViewSave)},unmounted(){this.$events.off("beforeunload",this.onBeforeUnload),this.$events.off("content.save",this.onContentSave),this.$events.off("keydown.left",this.toPrev),this.$events.off("keydown.right",this.toNext),this.$events.off("model.reload",this.$reload),this.$events.off("view.save",this.onViewSave)},methods:{onBeforeUnload(e){!0!==this.$panel.content.isProcessing&&!1!==this.isSaved||(e.preventDefault(),e.returnValue="")},onContentSave({api:e,language:t}){e===this.api&&t===this.$panel.language.code&&(this.isSaved=!0)},async onDiscard(){try{await this.$panel.content.discard({api:this.api,language:this.$panel.language.code}),this.$panel.dialog.close(),this.$panel.view.refresh()}catch(e){this.$panel.error(e)}},onInput(e){this.$panel.content.updateLazy(e,{api:this.api,language:this.$panel.language.code})},async onSubmit(){try{await this.$panel.content.publish(this.content,{api:this.api,language:this.$panel.language.code}),this.$panel.notification.success(),this.$events.emit("model.update"),await this.$panel.view.refresh()}catch(e){this.$panel.notification.error(e)}},onViewSave(e){e?.preventDefault?.(),this.onSubmit()},toNext(e){this.next&&"body"===e.target.localName&&this.$go(this.next.link)},toPrev(e){this.prev&&"body"===e.target.localName&&this.$go(this.prev.link)}}};const Bm=Ne({extends:Lm,props:{extension:String,filename:String,mime:String,preview:Object,type:String,url:String},methods:{onAction(e){if("replace"===e)return this.$panel.upload.replace({extension:this.extension,filename:this.filename,image:this.preview.image,link:this.link,mime:this.mime,url:this.url})}}},[["render",function(e,i,l,r,c,d){const u=t("k-prev-next"),p=t("k-form-controls"),h=t("k-view-buttons"),m=t("k-header"),f=t("k-file-preview"),g=t("k-model-tabs"),k=t("k-sections"),y=t("k-panel-inside");return n(),s(y,{"data-id":e.id,"data-locked":e.isLocked,"data-template":e.blueprint,class:"k-file-view"},{topbar:a(()=>[b(u,{prev:e.prev,next:e.next},null,8,["prev","next"])]),default:a(()=>[b(m,{editable:e.permissions.changeName&&!e.isLocked,class:"k-file-view-header",onEdit:i[0]||(i[0]=t=>e.$dialog(e.api+"/changeName"))},{buttons:a(()=>[b(h,{buttons:e.buttons,onAction:d.onAction},{after:a(()=>[b(p,{editor:e.editor,"has-diff":e.hasDiff,"is-locked":e.isLocked,"is-processing":e.isSaving,modified:e.modified,onDiscard:e.onDiscard,onSubmit:e.onSubmit},null,8,["editor","has-diff","is-locked","is-processing","modified","onDiscard","onSubmit"])]),_:1},8,["buttons","onAction"])]),default:a(()=>[v($(l.filename)+" ",1)]),_:1},8,["editable"]),b(f,o(l.preview,{content:e.content,"is-locked":e.isLocked,onInput:e.onInput,onSubmit:e.onSubmit}),null,16,["content","is-locked","onInput","onSubmit"]),b(g,{diff:e.diff,tab:e.tab.name,tabs:e.tabs},null,8,["diff","tab","tabs"]),b(k,{blueprint:e.blueprint,content:e.content,empty:e.$panel.config.debug?e.$t("file.blueprint",{blueprint:e.$esc(e.blueprint)}):null,lock:e.lock,parent:e.api,tab:e.tab,onInput:e.onInput,onSubmit:e.onSubmit},null,8,["blueprint","content","empty","lock","parent","tab","onInput","onSubmit"])]),_:1},8,["data-id","data-locked","data-template"])}]]);const Tm=Ne({props:{component:String,content:Object,isLocked:Boolean,props:Object},emits:["input","submit"],computed:{preview(){return this.$helper.isComponent(this.component)?this.component:"k-default-file-preview"}}},[["render",function(e,t,i,l,a,r){return n(),s(w(r.preview),o(i.props,{content:i.content,"is-locked":i.isLocked,class:"k-file-preview",onInput:t[0]||(t[0]=t=>e.$emit("input",t)),onSubmit:t[1]||(t[1]=t=>e.$emit("submit",t))}),null,16,["content","is-locked"])}]]),qm={class:"k-file-preview-details"};const zm=Ne({props:{details:{default:()=>[],type:Array}}},[["render",function(e,i,o,l,c,d){const u=t("k-link");return n(),h("div",qm,[x("dl",null,[(n(!0),h(m,null,f(o.details,e=>(n(),h("div",{key:e.title},[x("dt",null,$(e.title),1),x("dd",null,[e.link?(n(),s(u,{key:0,to:e.link,tabindex:"-1",target:"_blank"},{default:a(()=>[v($(e.text),1)]),_:2},1032,["to"])):(n(),h(m,{key:1},[v($(e.text),1)],64))])]))),128)),r(e.$slots,"default")])])}]]),Pm={class:"k-file-preview-frame-column"},Nm={class:"k-file-preview-frame"};const Fm=Ne({props:{options:{default:()=>[],type:Array}},emits:["action"]},[["render",function(e,i,s,o,l,a){const c=t("k-button"),d=t("k-dropdown");return n(),h("div",Pm,[x("div",Nm,[r(e.$slots,"default"),s.options.length?(n(),h(m,{key:0},[b(c,{icon:"dots",size:"xs",class:"k-file-preview-frame-dropdown-toggle",onClick:i[0]||(i[0]=t=>e.$refs.dropdown.toggle())}),b(d,{ref:"dropdown",options:s.options,theme:"light",onAction:i[1]||(i[1]=t=>e.$emit("action",t))},null,8,["options"])],64)):g("",!0)])])}]]),Rm={class:"k-default-file-preview"};const Ym=Ne({props:{details:Array,image:{default:()=>({}),type:Object}}},[["render",function(e,i,s,o,l,r){const c=t("k-icon"),d=t("k-file-preview-frame"),u=t("k-file-preview-details");return n(),h("div",Rm,[b(d,null,{default:a(()=>[b(c,{color:e.$helper.color(s.image.color),type:s.image.icon,class:"k-item-icon"},null,8,["color","type"])]),_:1}),b(u,{details:s.details},null,8,["details"])])}]]),Hm={class:"k-audio-file-preview"},Um=["src"];const Vm=Ne({props:{details:Array,url:String}},[["render",function(e,i,s,o,l,a){const r=t("k-file-preview-details");return n(),h("div",Hm,[x("audio",{controls:"",preload:"metadata",src:s.url},null,8,Um),b(r,{details:s.details},null,8,["details"])])}]]),Km={props:{content:{default:()=>({}),type:Object},details:Array,focusable:Boolean,image:{default:()=>({}),type:Object},isLocked:Boolean,url:String},emits:["focus","input"],computed:{focus(){const e=this.content.focus;if(!e)return;const[t,i]=e.replaceAll("%","").split(" ");return{x:parseFloat(t),y:parseFloat(i)}},hasFocus(){return Boolean(this.focus)},isFocusable(){return!0===this.focusable&&!0!==this.isLocked},options(){return[{icon:"open",text:this.$t("open"),link:this.url,target:"_blank"},{icon:"cancel",text:this.$t("file.focus.reset"),click:()=>this.setFocus(void 0),when:this.isFocusable&&this.hasFocus},{icon:"preview",text:this.$t("file.focus.placeholder"),click:()=>this.setFocus({x:50,y:50}),when:this.isFocusable&&!this.hasFocus}]}},methods:{setFocus(e){if(!1===this.isFocusable)return!1;e?!0===this.$helper.object.isObject(e)&&(e=`${e.x.toFixed(1)}% ${e.y.toFixed(1)}%`):e=null,this.$emit("input",{focus:e})}}},Wm=["data-has-focus"],Jm={key:0,class:"k-image-file-preview-focus"};const Gm=Ne(Km,[["render",function(e,i,l,r,c,d){const u=t("k-coords-input"),p=t("k-file-preview-frame"),f=t("k-button"),k=t("k-file-preview-details");return n(),h("div",{"data-has-focus":d.hasFocus,class:"k-default-file-preview k-image-file-preview"},[b(p,{options:d.options},{default:a(()=>[b(u,{disabled:!d.isFocusable,value:d.focus,onInput:i[1]||(i[1]=e=>d.setFocus(e))},{default:a(()=>[x("img",o(l.image,{onDragstart:i[0]||(i[0]=S(()=>{},["prevent"]))}),null,16)]),_:1},8,["disabled","value"])]),_:1},8,["options"]),b(k,{details:l.details},{default:a(()=>[l.image.src?(n(),h("div",Jm,[x("dt",null,$(e.$t("file.focus.title")),1),x("dd",null,[d.isFocusable?(n(),s(f,{key:0,ref:"focus",icon:d.focus?"cancel-small":"preview",title:d.focus?e.$t("file.focus.reset"):void 0,size:"xs",variant:"filled",onClick:i[2]||(i[2]=e=>d.focus?d.setFocus(void 0):d.setFocus({x:50,y:50}))},{default:a(()=>[d.hasFocus?(n(),h(m,{key:0},[v($(d.focus.x)+"% "+$(d.focus.y)+"%",1)],64)):(n(),h(m,{key:1},[v($(e.$t("file.focus.placeholder")),1)],64))]),_:1},8,["icon","title"])):d.hasFocus?(n(),h(m,{key:1},[v($(d.focus.x)+"% "+$(d.focus.y)+"% ",1)],64)):(n(),h(m,{key:2},[v("–")],64))])])):g("",!0)]),_:1},8,["details"])],8,Wm)}]]),Xm=["data-supported"],Zm=["data"],Qm=["href"];const ef=Ne({props:{details:Array,image:{default:()=>({}),type:Object},url:String},computed:{supported:()=>window.navigator.pdfViewerEnabled}},[["render",function(e,i,s,o,l,r){const c=t("k-icon"),d=t("k-file-preview-frame"),u=t("k-file-preview-details");return n(),h("div",{class:"k-default-file-preview k-pdf-file-preview","data-supported":r.supported},[x("object",{data:s.url,type:"application/pdf",class:"k-pdf-file-preview-object"},[b(d,null,{default:a(()=>[x("a",{href:s.url},[b(c,{color:e.$helper.color(s.image.color),type:s.image.icon,class:"k-item-icon"},null,8,["color","type"])],8,Qm)]),_:1})],8,Zm),b(u,{details:s.details},null,8,["details"])],8,Xm)}]]),tf={class:"k-video-file-preview"},sf=["src"];const nf=Ne({props:{details:Array,url:String},computed:{options(){return[{icon:"download",text:this.$t("download"),link:this.url,download:!0}]}}},[["render",function(e,i,s,o,l,r){const c=t("k-file-preview-frame"),d=t("k-file-preview-details");return n(),h("div",tf,[b(c,{options:r.options},{default:a(()=>[x("video",{controls:"",preload:"metadata",src:s.url},null,8,sf)]),_:1},8,["options"]),b(d,{details:s.details},null,8,["details"])])}]]),of={install(e){e.component("k-file-view",Bm),e.component("k-file-preview",Tm),e.component("k-file-preview-details",zm),e.component("k-file-preview-frame",Fm),e.component("k-default-file-preview",Ym),e.component("k-audio-file-preview",Vm),e.component("k-image-file-preview",Gm),e.component("k-pdf-file-preview",ef),e.component("k-video-file-preview",nf)}},lf={props:{isInstallable:Boolean,isInstalled:Boolean,isOk:Boolean,requirements:Object,translations:Array},data(){return{user:{name:"",email:"",language:this.$panel.translation.code,password:"",role:"admin"}}},computed:{fields(){return{email:{label:this.$t("email"),type:"email",link:!1,autofocus:!0,required:!0},password:{label:this.$t("password"),type:"password",placeholder:this.$t("password")+" …",required:!0},language:{label:this.$t("language"),type:"select",options:this.translations,icon:"translate",empty:!1,required:!0}}},isReady(){return this.isOk&&this.isInstallable},isComplete(){return this.isOk&&this.isInstalled}},methods:{async install(){try{await this.$api.system.install(this.user),await this.$panel.reload({globals:["system","translation"]}),this.$panel.notification.success({message:this.$t("welcome")+"!",icon:"smile"})}catch(e){this.$panel.error(e)}}}},af={class:"k-dialog k-installation-dialog"},rf={class:"sr-only"},cf={key:2},df={class:"k-installation-issues","data-theme":"negative"},uf={key:0},pf=["innerHTML"],hf={key:1},mf=["innerHTML"],ff=["innerHTML"],gf={key:2},kf=["innerHTML"],bf={key:3},yf=["innerHTML"],vf={key:4},$f=["innerHTML"],wf={key:5},xf=["innerHTML"];const Sf=Ne(lf,[["render",function(e,i,o,l,r,c){const d=t("k-headline"),u=t("k-link"),p=t("k-text"),k=t("k-fieldset"),y=t("k-button"),w=t("k-icon"),C=t("k-dialog-body"),O=t("k-panel-outside");return n(),s(O,{class:"k-installation-view"},{default:a(()=>[x("div",af,[b(C,null,{default:a(()=>[c.isComplete?(n(),s(p,{key:0},{default:a(()=>[b(d,null,{default:a(()=>[v($(e.$t("installation.completed")),1)]),_:1}),b(u,{to:"/login"},{default:a(()=>[v($(e.$t("login")),1)]),_:1})]),_:1})):c.isReady?(n(),h("form",{key:1,onSubmit:i[1]||(i[1]=S((...e)=>c.install&&c.install(...e),["prevent"]))},[x("h1",rf,$(e.$t("installation")),1),b(k,{fields:c.fields,value:r.user,onInput:i[0]||(i[0]=e=>r.user=e)},null,8,["fields","value"]),b(y,{text:e.$t("install"),icon:"check",size:"lg",theme:"positive",type:"submit",variant:"filled"},null,8,["text"])],32)):(n(),h("div",cf,[b(d,null,{default:a(()=>[v($(e.$t("installation.issues.headline")),1)]),_:1}),x("ul",df,[!1===o.isInstallable?(n(),h("li",uf,[b(w,{type:"alert"}),x("span",{innerHTML:e.$t("installation.disabled")},null,8,pf)])):g("",!0),!1===o.requirements.server?(n(),h("li",hf,[b(w,{type:"alert"}),x("span",{innerHTML:e.$t("installation.issues.server")},null,8,mf)])):g("",!0),(n(!0),h(m,null,f(o.requirements.extensions,(t,i)=>(n(),h(m,null,[!1===t?(n(),h("li",{key:i},[b(w,{type:"alert"}),x("span",{innerHTML:e.$t("installation.issues.extension",{extension:i})},null,8,ff)])):g("",!0)],64))),256)),!1===o.requirements.accounts?(n(),h("li",gf,[b(w,{type:"alert"}),x("span",{innerHTML:e.$t("installation.issues.accounts")},null,8,kf)])):g("",!0),!1===o.requirements.content?(n(),h("li",bf,[b(w,{type:"alert"}),x("span",{innerHTML:e.$t("installation.issues.content")},null,8,yf)])):g("",!0),!1===o.requirements.media?(n(),h("li",vf,[b(w,{type:"alert"}),x("span",{innerHTML:e.$t("installation.issues.media")},null,8,$f)])):g("",!0),!1===o.requirements.sessions?(n(),h("li",wf,[b(w,{type:"alert"}),x("span",{innerHTML:e.$t("installation.issues.sessions")},null,8,xf)])):g("",!0)]),b(y,{text:e.$t("retry"),icon:"refresh",size:"lg",theme:"positive",variant:"filled",onClick:e.$panel.reload},null,8,["text","onClick"])]))]),_:1})])]),_:1})}]]),Cf={install(e){e.component("k-installation-view",Sf)}};const Of=Ne({props:{buttons:Array,languages:{type:Array,default:()=>[]},variables:{type:Boolean,default:!0}},computed:{languagesCollection(){return this.languages.map(e=>({...e,link:this.variables?()=>this.$go(`languages/${e.id}`):null,options:[{icon:"edit",text:this.$t("edit"),disabled:!1===this.variables,click:()=>this.$go(`languages/${e.id}`)},{icon:"cog",text:this.$t("settings"),dialog:`languages/${e.id}/update`,disabled:!this.$panel.permissions.languages.update},{when:e.deletable,icon:"trash",text:this.$t("delete"),dialog:`languages/${e.id}/delete`,disabled:!this.$panel.permissions.languages.delete}]}))},primaryLanguage(){return this.languagesCollection.filter(e=>e.default)},secondaryLanguages(){return this.languagesCollection.filter(e=>!1===e.default)}}},[["render",function(e,i,o,l,r,c){const d=t("k-view-buttons"),u=t("k-header"),p=t("k-collection"),f=t("k-section"),k=t("k-empty"),y=t("k-panel-inside");return n(),s(y,{class:"k-languages-view"},{default:a(()=>[b(u,null,{buttons:a(()=>[b(d,{buttons:o.buttons},null,8,["buttons"])]),default:a(()=>[v($(e.$t("view.languages"))+" ",1)]),_:1}),o.languages.length>0?(n(),h(m,{key:0},[b(f,{headline:e.$t("languages.default")},{default:a(()=>[b(p,{items:c.primaryLanguage},null,8,["items"])]),_:1},8,["headline"]),b(f,{headline:e.$t("languages.secondary")},{default:a(()=>[c.secondaryLanguages.length?(n(),s(p,{key:0,items:c.secondaryLanguages},null,8,["items"])):(n(),s(k,{key:1,icon:"translate",disabled:!e.$panel.permissions.languages.create,onClick:i[0]||(i[0]=t=>e.$dialog("languages/create"))},{default:a(()=>[v($(e.$t("languages.secondary.empty")),1)]),_:1},8,["disabled"]))]),_:1},8,["headline"])],64)):0===o.languages.length?(n(),s(k,{key:1,icon:"translate",disabled:!e.$panel.permissions.languages.create,onClick:i[1]||(i[1]=t=>e.$dialog("languages/create"))},{default:a(()=>[v($(e.$t("languages.empty")),1)]),_:1},8,["disabled"])):g("",!0)]),_:1})}]]);const Af=Ne({props:{buttons:Array,code:String,deletable:Boolean,direction:String,id:String,info:Array,next:Object,name:String,prev:Object,translations:Array,url:String},computed:{canUpdate(){return this.$panel.permissions.languages.update}},methods:{createTranslation(){this.canUpdate&&this.$dialog(`languages/${this.id}/translations/create`)},option(e,t){this.canUpdate&&this.$dialog(`languages/${this.id}/translations/${window.btoa(encodeURIComponent(t.key))}/${e}`)},updateTranslation({row:e}){this.canUpdate&&this.$dialog(`languages/${this.id}/translations/${window.btoa(encodeURIComponent(e.key))}/update`)}}},[["render",function(e,i,o,l,r,c){const d=t("k-prev-next"),u=t("k-view-buttons"),p=t("k-header"),h=t("k-stats"),m=t("k-section"),f=t("k-table"),g=t("k-empty"),k=t("k-panel-inside");return n(),s(k,{class:"k-language-view"},{topbar:a(()=>[b(d,{prev:o.prev,next:o.next},null,8,["prev","next"])]),default:a(()=>[b(p,{editable:c.canUpdate,onEdit:i[0]||(i[0]=t=>e.$dialog(`languages/${o.id}/update`))},{buttons:a(()=>[b(u,{buttons:o.buttons},null,8,["buttons"])]),default:a(()=>[v($(o.name)+" ",1)]),_:1},8,["editable"]),b(m,{headline:e.$t("language.settings")},{default:a(()=>[b(h,{reports:o.info,size:"small"},null,8,["reports"])]),_:1},8,["headline"]),b(m,{buttons:[{click:c.createTranslation,disabled:!c.canUpdate,icon:"add",text:e.$t("add")}],headline:e.$t("language.variables")},{default:a(()=>[o.translations.length?(n(),s(f,{key:0,columns:{key:{label:e.$t("language.variable.key"),mobile:!0,width:"1/4"},value:{label:e.$t("language.variable.value"),mobile:!0}},disabled:!c.canUpdate,rows:o.translations,onCell:c.updateTranslation,onOption:c.option},null,8,["columns","disabled","rows","onCell","onOption"])):(n(),s(g,{key:1,disabled:!c.canUpdate,icon:"translate",onClick:c.createTranslation},{default:a(()=>[v($(e.$t("language.variables.empty")),1)]),_:1},8,["disabled","onClick"]))]),_:1},8,["buttons","headline"])]),_:1})}]]),If={install(e){e.component("k-languages-view",Of),e.component("k-language-view",Af)}},Mf={"data-theme":"error",class:"k-notification k-login-alert"};const _f=Ne({emits:["click"]},[["render",function(e,i,s,o,l,a){const c=t("k-button");return n(),h("div",Mf,[x("p",null,[r(e.$slots,"default")]),b(c,{icon:"cancel",onClick:i[0]||(i[0]=t=>e.$emit("click"))})])}]]);const Df=Ne({},[["render",function(e,i,o,l,a,r){const c=t("k-button");return n(),s(c,{text:e.$t("back"),icon:"angle-left",link:"/logout",size:"lg",variant:"filled",class:"k-login-button k-login-back-button"},null,8,["text"])}]]),Ef={props:{method:String,methods:{type:Array,default:()=>[]},pending:{type:Object},value:{type:Object,default:()=>({})}}},jf={components:{"k-login-plugin-form":window.panel.plugins.login},mixins:[Ef],props:{value:{type:Object,default:()=>({})}},data:()=>({issue:""}),computed:{alternativeMethods(){return this.methods.filter(e=>e!==this.method)},form(){return window.panel.plugins.login?"k-login-plugin-form":this.hasActiveChallenge?"k-login-code-form":"k-login-form"},hasActiveChallenge(){return Boolean(this.pending.email)}},methods:{async onChangeMethod(e){await this.$panel.view.refresh({query:{method:e}}),this.$refs.form.focus?.()},async onError(e){!0===e?.details.challengeDestroyed&&await this.$panel.reload({globals:["system"]}),this.issue=e?.message}}},Lf={class:"sr-only"};const Bf=Ne(jf,[["render",function(e,i,l,r,c,d){const u=t("k-login-alert"),p=t("k-button"),k=t("k-stack"),y=t("k-panel-outside");return n(),s(y,{class:"k-login-view"},{default:a(()=>[b(k,{class:"k-login k-login-stack"},{default:a(()=>[x("h1",Lf,$(e.$t("login")),1),c.issue?(n(),s(u,{key:0,onClick:i[0]||(i[0]=e=>c.issue=null)},{default:a(()=>[v($(c.issue),1)]),_:1})):g("",!0),(n(),s(w(d.form),o({ref:"form"},{method:e.method,methods:e.methods,pending:e.pending,value:l.value},{onError:d.onError}),null,16,["onError"])),d.alternativeMethods.length>0&&!d.hasActiveChallenge?(n(),h(m,{key:1},[i[1]||(i[1]=x("p",{class:"k-login-or"},[x("span",null,"or")],-1)),b(k,null,{default:a(()=>[(n(!0),h(m,null,f(d.alternativeMethods,t=>(n(),s(p,{key:t,text:e.$t(`login.method.${t}.label`),variant:"filled",size:"lg",onClick:e=>d.onChangeMethod(t)},null,8,["text","onClick"]))),128))]),_:1})],64)):g("",!0)]),_:1})]),_:1})}]]),Tf={class:"k-login-buttons"};const qf=Ne({mixins:[Ef],emits:["error"],data(){return{code:this.value.code??"",isLoading:!1}},computed:{isResetForm(){return this.methods.includes("password-reset")}},methods:{async login(){this.$emit("error",null),this.isLoading=!0;try{await this.$api.auth.verifyCode(this.code),this.$panel.notification.success({message:this.$t("welcome")+"!",icon:"smile"}),this.isResetForm?this.$go("reset-password"):this.$panel.reload()}catch(e){this.$emit("error",e)}finally{this.isLoading=!1}}}},[["render",function(e,i,o,l,a,r){const c=t("k-user-info"),d=t("k-text-field"),u=t("k-login-back-button"),p=t("k-button");return n(),h("form",{class:"k-login-form k-login-code-form",onSubmit:i[1]||(i[1]=S((...e)=>r.login&&r.login(...e),["prevent"]))},[e.pending.email?(n(),s(c,{key:0,user:e.pending.email},null,8,["user"])):g("",!0),b(d,{autofocus:!0,counter:!1,help:e.$t("login.code.text."+e.pending.challenge),label:r.isResetForm?e.$t("login.code.label.password-reset"):e.$t("login.code.label.login"),placeholder:e.$t("login.code.placeholder."+e.pending.challenge),required:!0,value:a.code,autocomplete:"one-time-code",icon:"unlock",name:"code",onInput:i[0]||(i[0]=e=>a.code=e)},null,8,["help","label","placeholder","value"]),x("footer",Tf,[b(u),b(p,{disabled:a.isLoading,icon:a.isLoading?"loader":"check",text:r.isResetForm?e.$t("login.reset"):e.$t("login"),size:"lg",type:"submit",theme:"positive",variant:"filled",class:"k-login-button"},null,8,["disabled","icon","text"])])],32)}]]),zf={class:"k-login-fields"},Pf={class:"k-login-buttons"};const Nf=Ne({mixins:[Ef],emits:["error"],data(){return{isLoading:!1,user:{email:"",password:"",remember:!1,...this.value}}},computed:{fields(){const e={email:{autofocus:!0,label:this.$t("email"),type:"email",required:!0,link:!1}};return"password"===this.method&&(e.password={label:this.$t("password"),type:"password",minLength:8,required:!0,autocomplete:"current-password",counter:!1}),e},isResetForm(){return"password-reset"===this.method}},methods:{focus(){this.$refs.fieldset.focus("email")},async login(){this.$emit("error",null),this.isLoading=!0;const e={...this.user};"password"!==this.method&&(e.password=null),!0===this.isResetForm&&(e.remember=!1);try{await this.$api.auth.login(e),this.$panel.reload({globals:["system","translation"]}),this.$panel.notification.success({message:this.$t("welcome")+"!",icon:"smile"})}catch(t){this.$emit("error",t)}finally{this.isLoading=!1}}}},[["render",function(e,i,o,l,a,r){const c=t("k-fieldset"),d=t("k-checkbox-input"),u=t("k-button");return n(),h("form",{class:"k-login-form",onSubmit:i[2]||(i[2]=S((...e)=>r.login&&r.login(...e),["prevent"]))},[x("div",zf,[b(c,{ref:"fieldset",fields:r.fields,value:a.user,onInput:i[0]||(i[0]=e=>a.user=e)},null,8,["fields","value"])]),x("footer",Pf,[!1===r.isResetForm?(n(),s(d,{key:0,label:e.$t("login.remember"),checked:a.user.remember,value:a.user.remember,onInput:i[1]||(i[1]=e=>a.user.remember=e)},null,8,["label","checked","value"])):g("",!0),b(u,{disabled:a.isLoading,icon:a.isLoading?"loader":"check",text:r.isResetForm?e.$t("login.reset"):e.$t("login"),class:"k-login-button",size:"lg",theme:"positive",type:"submit",variant:"filled"},null,8,["disabled","icon","text"])])],32)}]]),Ff={install(e){e.component("k-login-alert",_f),e.component("k-login-back-button",Df),e.component("k-login-code-form",qf),e.component("k-login-form",Nf),e.component("k-login-view",Bf),e.component("k-login",Nf),e.component("k-login-code",qf)}};const Rf=Ne({extends:Lm,props:{title:String}},[["render",function(e,i,o,l,r,c){const d=t("k-prev-next"),u=t("k-form-controls"),p=t("k-view-buttons"),h=t("k-header"),m=t("k-model-tabs"),f=t("k-sections"),g=t("k-panel-inside");return n(),s(g,{"data-id":e.id,"data-locked":e.isLocked,"data-template":e.blueprint,class:"k-page-view"},{topbar:a(()=>[b(d,{prev:e.prev,next:e.next},null,8,["prev","next"])]),default:a(()=>[b(h,{editable:e.permissions.changeTitle&&!e.isLocked,class:"k-page-view-header",onEdit:i[0]||(i[0]=t=>e.$dialog(e.api+"/changeTitle"))},{buttons:a(()=>[b(p,{buttons:e.buttons},{after:a(()=>[b(u,{editor:e.editor,"has-diff":e.hasDiff,"is-locked":e.isLocked,"is-processing":e.isSaving,modified:e.modified,preview:!!e.permissions.preview&&e.api+"/preview/changes",onDiscard:e.onDiscard,onSubmit:e.onSubmit},null,8,["editor","has-diff","is-locked","is-processing","modified","preview","onDiscard","onSubmit"])]),_:1},8,["buttons"])]),default:a(()=>[v($(o.title)+" ",1)]),_:1},8,["editable"]),b(m,{diff:e.diff,tab:e.tab.name,tabs:e.tabs},null,8,["diff","tab","tabs"]),b(f,{blueprint:e.blueprint,content:e.content,empty:e.$panel.config.debug?e.$t("page.blueprint",{blueprint:e.$esc(e.blueprint)}):null,lock:e.lock,parent:e.api,tab:e.tab,onInput:e.onInput,onSubmit:e.onSubmit},null,8,["blueprint","content","empty","lock","parent","tab","onInput","onSubmit"])]),_:1},8,["data-id","data-locked","data-template"])}]]),Yf={key:0,class:"k-header-title-placeholder"};const Hf=Ne({extends:Lm,props:{title:String}},[["render",function(e,i,o,l,r,c){const d=t("k-form-controls"),u=t("k-view-buttons"),p=t("k-header"),f=t("k-model-tabs"),g=t("k-sections"),k=t("k-panel-inside");return n(),s(k,{"data-id":e.id,"data-locked":e.isLocked,"data-template":e.blueprint,class:"k-site-view"},{default:a(()=>[b(p,{editable:e.permissions.changeTitle&&!e.isLocked,class:"k-site-view-header",onEdit:i[0]||(i[0]=t=>e.$dialog(e.api+"/changeTitle"))},{buttons:a(()=>[b(u,{buttons:e.buttons},{after:a(()=>[b(d,{editor:e.editor,"has-diff":e.hasDiff,"is-locked":e.isLocked,"is-processing":e.isSaving,modified:e.modified,preview:!!e.permissions.preview&&e.api+"/preview/changes",onDiscard:e.onDiscard,onSubmit:e.onSubmit},null,8,["editor","has-diff","is-locked","is-processing","modified","preview","onDiscard","onSubmit"])]),_:1},8,["buttons"])]),default:a(()=>[o.title&&0!==o.title.length?(n(),h(m,{key:1},[v($(o.title),1)],64)):(n(),h("span",Yf,$(e.$t("view.site"))+" … ",1))]),_:1},8,["editable"]),b(f,{diff:e.diff,tab:e.tab.name,tabs:e.tabs},null,8,["diff","tab","tabs"]),b(g,{blueprint:e.blueprint,content:e.content,empty:e.$panel.config.debug?e.$t("site.blueprint"):null,lock:e.lock,tab:e.tab,parent:"site",onInput:e.onInput,onSubmit:e.onSubmit},null,8,["blueprint","content","empty","lock","tab","onInput","onSubmit"])]),_:1},8,["data-id","data-locked","data-template"])}]]),Uf={install(e){e.component("k-page-view",Rf),e.component("k-site-view",Hf)}},Vf={mixins:[an],props:{isPinned:Boolean,label:String,src:String,mode:String,open:String},emits:["discard","navigate","open","pin","scroll","submit"],data(){return{isLoading:!1,active:0,pending:null,pendingScroll:null,srcs:[this.src,null]}},computed:{window(){return this.activeIframe()?.contentWindow}},watch:{src(e){this.loadSrc(e)}},methods:{activeIframe(){return this.getIframe(this.active)},addReloadParam(e){const t=new URL(e,window.location.origin);return t.searchParams.set("_reload",Date.now()),t.toString()},getIframe(e){return this.$refs[0===e?"browserA":"browserB"]},loadSrc(e,{force:t=!1}={}){this.pending=0===this.active?1:0;const i=this.getIframe(this.pending);this.isLoading=!0,this.srcs[this.pending]=t?this.addReloadParam(e):e,i?.src===this.srcs[this.pending]&&"complete"===i.contentDocument?.readyState&&(this.active=this.pending,this.pending=null,this.isLoading=!1)},onClick(e){const t=e.target.closest("a");if(t&&t.href&&!t.onclick){if(!1===t.href.startsWith(location.origin)||!0===t.href.startsWith(this.$panel.urls.panel))return t.target="_blank",!0;e.preventDefault(e),this.isPinned?this.$emit("navigate",{browser:t.href}):this.$emit("navigate",{view:t.href})}},async onLoad(e){const t=this.getIframe(e),i=t?.contentDocument;if(i){if(this.pending===e&&(this.pending=null,this.active=e,this.isLoading=!1,null!==this.pendingScroll)){const e=this.pendingScroll;this.pendingScroll=null,await this.$nextTick(),t.contentWindow.scrollTo(0,e)}if(e===this.active){if(this.srcs[e]!==i.URL){const e=new URL(i.URL);if(!1===e.searchParams.has("_token")||!1===e.searchParams.has("_version"))return this.$emit("navigate",{browser:e})}i.addEventListener("click",this.onClick);for(const e of i.querySelectorAll("a"))e.addEventListener("click",this.onClick);i.addEventListener("scroll",e=>this.$emit("scroll",e))}}},reload(){this.pendingScroll=this.window?.scrollY??0,this.loadSrc(this.src,{force:!0})},restore({src:e,scroll:t}){if(!this.isPinned)return;const i=0===this.active?1:0,s=this.getIframe(i);s?.addEventListener("load",()=>s.contentWindow.scrollTo(0,t),{once:!0}),this.srcs[i]=e,this.pending=i,this.isLoading=!0},scrollTo(e){this.window?.scrollTo(0,e)},store(){return{src:this.activeIframe()?.src,scroll:this.window?.scrollY}}}},Kf={class:"k-preview-browser"},Wf={key:0,class:"k-preview-browser-header"},Jf={key:0,class:"k-preview-browser-message"},Gf={class:"k-preview-browser-frame"},Xf=["src"],Zf=["src"];const Qf=Ne(Vf,[["render",function(e,i,o,l,r,c){const d=t("k-icon"),u=t("k-headline"),f=t("k-form-controls"),k=t("k-button"),y=t("k-button-group");return n(),h("div",Kf,[o.label?(n(),h("header",Wf,[b(u,{class:"k-preview-headline"},{default:a(()=>[b(d,{type:r.isLoading?"loader":"git-branch"},null,8,["type"]),v(" "+$(o.label),1)]),_:1}),b(y,null,{default:a(()=>["changes"===o.mode?(n(),h(m,{key:0},[!1===e.hasDiff?(n(),h("p",Jf,$(e.$t("lock.unsaved.empty")),1)):(n(),s(f,{key:1,editor:e.editor,"has-diff":e.hasDiff,"is-locked":e.isLocked,"is-processing":e.isProcessing,modified:e.modified,size:"xs",onDiscard:i[0]||(i[0]=t=>e.$emit("discard",t)),onSubmit:i[1]||(i[1]=t=>e.$emit("submit",t))},null,8,["editor","has-diff","is-locked","is-processing","modified"]))],64)):g("",!0),"form"===o.mode?(n(),s(k,{key:1,"aria-checked":o.isPinned,title:e.$t("preview.browser.pin"),theme:o.isPinned?"info":"passive",variant:o.isPinned?"filled":"none",icon:"pushpin",role:"switch",size:"sm",onClick:i[2]||(i[2]=t=>e.$emit("pin"))},null,8,["aria-checked","title","theme","variant"])):g("",!0),o.open?(n(),s(k,{key:2,link:o.open,icon:"open",size:"xs",target:"_blank",onClick:i[3]||(i[3]=t=>e.$emit("open"))},null,8,["link"])):g("",!0)]),_:1})])):g("",!0),x("div",Gf,[x("iframe",{ref:"browserA",class:p(["k-preview-browser-iframe",0===r.active?"is-active":null]),src:r.srcs[0],onLoad:i[4]||(i[4]=e=>c.onLoad(0))},null,42,Xf),x("iframe",{ref:"browserB",class:p(["k-preview-browser-iframe",1===r.active?"is-active":null]),src:r.srcs[1],onLoad:i[5]||(i[5]=e=>c.onLoad(1))},null,42,Zf)])])}]]),eg={mixins:[an],props:{api:String,blueprint:String,content:Object,diff:Object,tab:Object,tabs:Array,lock:Boolean},emits:["discard","input","navigate","submit"],computed:{tabsWithPreviewLinks(){const e=new URLSearchParams(window.location.search);return this.tabs.map(t=>(e.append("tab",t.name),{...t,link:this.$panel.view.path+"?"+e.toString()}))}},mounted(){this.$events.on("section.loaded",this.fixLinksInSection)},unmounted(){this.$events.off("section.loaded",this.fixLinksInSection)},methods:{fixLinksInSection(e){const t=e.$el.querySelectorAll(".k-item-title > .k-link");for(const i of t){const e=i.__vue__.to;e?.match(/^\/pages\/[^/]+$/)&&(i.__vue__.onClick=t=>{t.preventDefault(),this.$emit("navigate",e+"/preview/form")})}}}},tg={class:"k-preview-form"},ig={class:"k-preview-form-header"},sg={class:"k-preview-form-body"};const ng=Ne(eg,[["render",function(e,i,s,o,l,a){const r=t("k-model-tabs"),c=t("k-form-controls"),d=t("k-sections");return n(),h("div",tg,[x("header",ig,[b(r,{diff:s.diff,tab:s.tab.name,tabs:a.tabsWithPreviewLinks,class:"k-drawer-tabs"},null,8,["diff","tab","tabs"]),b(c,{editor:e.editor,"has-diff":e.hasDiff,"is-locked":e.isLocked,"is-processing":e.isProcessing,modified:e.modified,size:"xs",onDiscard:i[0]||(i[0]=t=>e.$emit("discard",t)),onSubmit:i[1]||(i[1]=t=>e.$emit("submit",t))},null,8,["editor","has-diff","is-locked","is-processing","modified"])]),x("div",sg,[b(d,{blueprint:s.blueprint,content:s.content,empty:e.$panel.config.debug?e.$t("page.blueprint",{blueprint:e.$esc(s.blueprint)}):null,lock:s.lock,parent:s.api,tab:s.tab,onInput:i[2]||(i[2]=t=>e.$emit("input",t)),onSubmit:i[3]||(i[3]=t=>e.$emit("submit",t))},null,8,["blueprint","content","empty","lock","parent","tab"])])])}]]);const og=Ne({props:{current:String,mode:String,sizes:Object},emits:["change"],data(){return{disabled:Object.fromEntries(Object.keys(this.sizes).map(e=>[e,!1]))}},computed:{buttons(){const e={};for(const t in this.sizes)e[t]={current:this.current===t,disabled:this.disabled[t],icon:this.sizes[t].icon,size:"sm",theme:this.current===t?"info-icon":null,variant:"filled"};return e}},watch:{mode(){this.available()}},mounted(){this.available()},methods:{available(){const e=this.$el.querySelectorAll(".k-button");for(let t=1;t<e.length;t++){const e=Object.keys(this.sizes);let i=parseInt(this.sizes[e[t-1]].width);"compare"===this.mode?i*=2:"form"===this.mode&&(i+=320);const s=matchMedia(`(min-width: ${i}px)`);this.disabled[e[t]]=!s.matches,s.addEventListener("change",()=>{this.disabled[e[t]]=!s.matches})}}}},[["render",function(e,i,l,r,c,d){const u=t("k-button"),p=t("k-button-group");return n(),s(p,{layout:"collapsed",class:"k-preview-sizes"},{default:a(()=>[(n(!0),h(m,null,f(d.buttons,(t,i)=>(n(),s(u,o({key:i},{ref_for:!0},t,{onClick:t=>e.$emit("change",i)}),null,16,["onClick"]))),128))]),_:1})}]]),lg={inheritAttrs:!1,props:{id:String,mode:String,sizes:{type:Object,default:()=>({small:{icon:"mobile",width:"390px"},medium:{icon:"tablet",width:"820px"},large:{icon:"display",width:"1440px"}})},src:Object},data(){const e=localStorage.getItem("kirby$preview$size");return{channel:null,isAnimating:!1,isPinned:!1,size:e&&this.sizes[e]?e:Object.keys(this.sizes).pop()}},computed:{gridStyles(){return{"--size":this.sizes[this.size].width,[this.isAnimating?"transition":null]:"grid-template-columns 0.12s ease"}}},mounted(){this.$events.on("keydown.esc",this.exit)},unmounted(){this.$events.off("keydown.esc",this.exit)},methods:{announce(e,t){this.channel?.postMessage({on:e,...t})},onChanges(){this.$refs.browser?.reload()},onBrowserNavigate({browser:e=null,view:t=null}){this.$panel.view.reload({query:{browser:e,view:t}})},async onSize(e){this.isAnimating=!0,this.size=e,setTimeout(()=>this.isAnimating=!1,150),localStorage.setItem("kirby$preview$size",e)},onTreeNavigate(e,t=!1){if(e.id===this.id&&!1===t)return;this.$refs.tree?.close();const i="/"===e.id?"site":e.id,s=this.$api.pages.url(i,"preview/"+this.mode);this.onViewNavigate(s)},async onViewNavigate(e){const t=this.$refs.browser?.store();await this.$panel.view.open(e),this.$refs.browser?.restore(t)},reload(){let e=this.$panel.view.path;const t=new URLSearchParams(window.location.search);!0===t.has("tab")&&(e+="?tab="+t.get("tab")),this.$panel.view.open(e)},togglePin(){this.isPinned=!this.isPinned,this.isPinned||this.reload()}}},ag={class:"k-preview-view-header"},rg=["data-mode"];const cg=Ne({extends:Lm,mixins:[lg],props:{back:String,title:String},data:()=>({isRemote:!1,isScrollSyncing:"true"===localStorage.getItem("kirby$preview$scroll","true")}),watch:{mode(){this.announce("remote:exit")}},mounted(){this.$events.on("content.save",this.onChanges),this.$events.on("content.discard",this.onChanges),this.$events.on("content.publish",this.onChanges),this.$events.on("model.update",this.onChanges),this.$events.on("page.changeTitle",this.onChanges),this.$events.on("page.sort",this.onChanges),this.$events.on("file.sort",this.onChanges)},unmounted(){this.$events.off("content.save",this.onChanges),this.$events.off("content.discard",this.onChanges),this.$events.off("content.publish",this.onChanges),this.$events.off("model.update",this.onChanges),this.$events.off("page.changeTitle",this.onChanges),this.$events.off("page.sort",this.onChanges),this.$events.off("file.sort",this.onChanges)},methods:{browserProps(e){const t="form"===e?"changes":e;return{editor:this.editor,hasDiff:this.hasDiff,isLocked:this.isLocked,isPinned:this.isPinned,isProcessing:this.isSaving,label:this.$t("version."+t),modified:this.modified,open:this.src[t],src:this.src[t],mode:e}},exit(){this.$panel.overlays().length>0||(this.announce("remote:exit"),this.$panel.view.open(this.link))},onChanges(){lg.methods.onChanges.call(this),this.announce("host:changes")},onRemote(){this.isRemote=!0,this.channel=new BroadcastChannel("preview$"+this.id),this.channel.addEventListener("message",e=>"remote:exit"===e.data.on?(this.channel.close(),this.channel=null,void(this.isRemote=!1)):"remote:browser"===e.data.on?this.onBrowserNavigate(e.data):"remote:reload"===e.data.on?this.reload():void 0),window.addEventListener("beforeunload",()=>this.announce("remote:exit"))},onScroll(e,t){if(this.isScrollSyncing){const i=this.$refs[e]?.window?.scrollY??0;this.$refs[t]?.scrollTo(i)}},onScrollSyncing(){this.isScrollSyncing=!this.isScrollSyncing,localStorage.setItem("kirby$preview$scroll",this.isScrollSyncing)},async onViewNavigate(e){lg.methods.onViewNavigate.call(this,e),this.announce("host:view",{url:e})}}},[["render",function(e,i,l,r,c,d){const p=t("k-button"),f=t("k-page-tree"),k=t("k-dropdown"),y=t("k-button-group"),w=t("k-preview-sizes"),C=t("k-view-buttons"),O=t("k-preview-browser"),A=t("k-preview-form"),I=t("k-panel-notifications"),M=t("k-panel");return n(),s(M,{class:"k-panel-inside k-preview-view"},{default:a(()=>[x("header",ag,[b(y,null,{default:a(()=>[b(p,{responsive:!0,title:e.$t("back"),icon:"angle-left",size:"sm",variant:"filled",onClick:d.exit},null,8,["title","onClick"]),b(p,{class:"k-preview-view-title",icon:e.$panel.isLoading?"loader":"title",dropdown:!0,onClick:i[0]||(i[0]=t=>e.$refs.tree.toggle())},{default:a(()=>[v($(l.title),1)]),_:1},8,["icon"]),b(k,{ref:"tree",theme:"dark",class:"k-preview-view-tree"},{default:a(()=>[b(f,{current:e.id,onClick:i[1]||(i[1]=S(()=>{},["stop"])),onSelect:e.onTreeNavigate},null,8,["current","onSelect"])]),_:1},512)]),_:1}),c.isRemote?g("",!0):(n(),s(w,{key:0,current:e.size,mode:e.mode,sizes:e.sizes,onChange:e.onSize},null,8,["current","mode","sizes","onChange"])),b(y,null,{default:a(()=>["compare"===e.mode?(n(),s(p,{key:0,"aria-checked":c.isScrollSyncing,theme:c.isScrollSyncing?"info-icon":"passive",title:e.$t("preview.browser.scroll"),icon:"scroll-to-bottom",role:"switch",size:"sm",variant:"filled",class:"k-preview-scroll-sync",onClick:d.onScrollSyncing},null,8,["aria-checked","theme","title","onClick"])):g("",!0),b(C,{buttons:e.buttons},null,8,["buttons"])]),_:1})]),x("main",{"data-mode":e.mode,style:u(e.gridStyles),class:"k-preview-view-grid"},["form"===e.mode?(n(),h(m,{key:0},[c.isRemote?g("",!0):(n(),s(O,o({key:0,ref:"browser"},d.browserProps("form"),{open:e.$panel.view.path+"/remote",onNavigate:e.onBrowserNavigate,onOpen:d.onRemote,onPin:e.togglePin}),null,16,["open","onNavigate","onOpen","onPin"])),b(A,o(d.browserProps("form"),{api:e.api,blueprint:e.blueprint,content:e.content,diff:e.diff,tabs:e.tabs,tab:e.tab,onDiscard:e.onDiscard,onInput:e.onInput,onNavigate:d.onViewNavigate,onSubmit:e.onSubmit}),null,16,["api","blueprint","content","diff","tabs","tab","onDiscard","onInput","onNavigate","onSubmit"])],64)):"compare"===e.mode?(n(),h(m,{key:1},[b(O,o({ref:"latest"},d.browserProps("latest"),{onDiscard:e.onDiscard,onNavigate:e.onBrowserNavigate,onScroll:i[2]||(i[2]=e=>d.onScroll("latest","changes")),onSubmit:e.onSubmit}),null,16,["onDiscard","onNavigate","onSubmit"]),b(O,o({ref:"changes"},d.browserProps("changes"),{onDiscard:e.onDiscard,onNavigate:e.onBrowserNavigate,onScroll:i[3]||(i[3]=e=>d.onScroll("changes","latest")),onSubmit:e.onSubmit}),null,16,["onDiscard","onNavigate","onSubmit"])],64)):(n(),s(O,o({key:2},d.browserProps(e.mode),{onDiscard:e.onDiscard,onNavigate:e.onBrowserNavigate,onSubmit:e.onSubmit}),null,16,["onDiscard","onNavigate","onSubmit"]))],12,rg),b(I)]),_:1})}]]),dg={class:"k-preview-view-header"};const ug=Ne({mixins:[lg],mounted(){this.channel=new BroadcastChannel("preview$"+this.id),this.channel.addEventListener("message",e=>"host:changes"===e.data.on?this.onChanges():"host:view"===e.data.on?this.onViewNavigate(e.data.url):"remote:exit"===e.data.on?this.exit():void 0),window.addEventListener("beforeunload",()=>{this.announce("remote:exit"),window.setTimeout(()=>window.location=this.src.changes,50)})},methods:{exit(){this.announce("remote:exit"),window.close()},onBrowserNavigate({browser:e=null,view:t=null}){lg.methods.onBrowserNavigate.call(this,{browser:e,view:t}),this.announce("remote:browser",{browser:e,view:t})},async onViewNavigate(e){lg.methods.onViewNavigate.call(this,e+"/remote")},togglePin(){lg.methods.togglePin.call(this),this.announce("remote:reload")}}},[["render",function(e,i,o,l,r,c){const d=t("k-icon"),p=t("k-headline"),h=t("k-preview-sizes"),m=t("k-button"),f=t("k-button-group"),g=t("k-preview-browser"),k=t("k-panel-notifications"),y=t("k-panel");return n(),s(y,{class:"k-preview-view k-remote-preview-view"},{default:a(()=>[x("header",dg,[b(p,{class:"k-preview-headline"},{default:a(()=>[b(d,{type:e.$panel.isLoading?"loader":"git-branch"},null,8,["type"]),v(" "+$(e.$t("version.changes")),1)]),_:1}),b(h,{current:e.size,sizes:e.sizes,onChange:e.onSize},null,8,["current","sizes","onChange"]),b(f,null,{default:a(()=>[b(m,{"aria-checked":e.isPinned,title:e.$t("preview.browser.pin"),theme:e.isPinned?"info":"passive",icon:"pushpin",role:"switch",size:"sm",variant:"filled",onClick:c.togglePin},null,8,["aria-checked","title","theme","onClick"]),b(m,{responsive:!0,title:e.$t("back"),icon:"cancel-small",size:"sm",variant:"filled",onClick:c.exit},null,8,["title","onClick"])]),_:1})]),x("main",{style:u(e.gridStyles),class:"k-preview-view-grid"},[b(g,{ref:"browser","is-pinned":e.isPinned,src:e.src.changes,onNavigate:c.onBrowserNavigate,onPin:c.togglePin},null,8,["is-pinned","src","onNavigate","onPin"])],4),b(k)]),_:1})}]]),pg={install(e){e.component("k-preview-browser",Qf),e.component("k-preview-form",ng),e.component("k-preview-sizes",og),e.component("k-preview-view",cg),e.component("k-remote-preview-view",ug)}},hg={extends:Lm,props:{avatar:String,canChangeEmail:Boolean,canChangeLanguage:Boolean,canChangeName:Boolean,canChangeRole:Boolean,email:String,language:String,name:String,role:String}},mg={key:0,class:"k-header-title-placeholder k-user-name-placeholder"};const fg=Ne(hg,[["render",function(e,i,o,l,r,c){const d=t("k-prev-next"),u=t("k-form-controls"),p=t("k-view-buttons"),f=t("k-header"),g=t("k-user-profile"),k=t("k-model-tabs"),y=t("k-sections"),w=t("k-panel-inside");return n(),s(w,{"data-id":e.id,"data-locked":e.isLocked,"data-template":e.blueprint,class:"k-user-view"},{topbar:a(()=>[b(d,{prev:e.prev,next:e.next},null,8,["prev","next"])]),default:a(()=>[b(f,{editable:o.canChangeName,class:"k-user-view-header",onEdit:i[0]||(i[0]=t=>e.$dialog(e.api+"/changeName"))},{buttons:a(()=>[b(p,{buttons:e.buttons},{after:a(()=>[b(u,{editor:e.editor,"has-diff":e.hasDiff,"is-locked":e.isLocked,"is-processing":e.isSaving,modified:e.modified,onDiscard:e.onDiscard,onSubmit:e.onSubmit},null,8,["editor","has-diff","is-locked","is-processing","modified","onDiscard","onSubmit"])]),_:1},8,["buttons"])]),default:a(()=>[o.name&&0!==o.name.length?(n(),h(m,{key:1},[v($(o.name),1)],64)):(n(),h("span",mg,$(e.$t("name"))+" … ",1))]),_:1},8,["editable"]),b(g,{id:e.id,api:e.api,avatar:o.avatar,email:o.email,"can-change-email":o.canChangeEmail,"can-change-language":o.canChangeLanguage,"can-change-name":o.canChangeName,"can-change-role":o.canChangeRole,"is-locked":e.isLocked,language:o.language,role:o.role},null,8,["id","api","avatar","email","can-change-email","can-change-language","can-change-name","can-change-role","is-locked","language","role"]),b(k,{diff:e.diff,tab:e.tab.name,tabs:e.tabs},null,8,["diff","tab","tabs"]),b(y,{blueprint:e.blueprint,content:e.content,empty:e.$panel.config.debug?e.$t("user.blueprint",{blueprint:e.$esc(e.blueprint)}):null,lock:e.lock,parent:e.api,tab:e.tab,onInput:e.onInput,onSubmit:e.onSubmit},null,8,["blueprint","content","empty","lock","parent","tab","onInput","onSubmit"])]),_:1},8,["data-id","data-locked","data-template"])}]]),gg={extends:fg,prevnext:!1};const kg=Ne({props:{requirePassword:{type:Boolean,default:!1}},data:()=>({isLoading:!1,values:{currentPassword:null,password:null,passwordConfirmation:null}}),computed:{fields(){let e={};return!0===this.requirePassword&&(e={currentPassword:{autofocus:!0,label:this.$t("user.changePassword.current"),icon:"key",type:"password",width:"1/2"},gap:{type:"gap",width:"1/2"}}),{...e,password:{autofocus:!1===this.requirePassword,label:this.$t("user.changePassword.new"),icon:"key",type:"password",width:"1/2"},passwordConfirmation:{label:this.$t("user.changePassword.new.confirm"),icon:"key",type:"password",width:"1/2"}}}},mounted(){this.$panel.title=this.$t("view.resetPassword")},methods:{async submit(){if(!this.values.password||this.values.password.length<8)return this.$panel.notification.error(this.$t("error.user.password.invalid"));if(this.values.password!==this.values.passwordConfirmation)return this.$panel.notification.error(this.$t("error.user.password.notSame"));this.isLoading=!0;try{await this.$api.users.changePassword(this.$panel.user.id,this.values.password,this.values.currentPassword),this.$panel.notification.success(),this.$go("/")}catch(e){this.$panel.notification.error(e)}finally{this.isLoading=!1}}}},[["render",function(e,i,o,l,r,c){const d=t("k-button"),u=t("k-header"),p=t("k-user-info"),f=t("k-fieldset"),k=t("k-panel-inside");return n(),s(k,{class:"k-password-reset-view"},{default:a(()=>[x("form",{onSubmit:i[0]||(i[0]=S((...e)=>c.submit&&c.submit(...e),["prevent"]))},[b(u,null,{buttons:a(()=>[b(d,{icon:"check",theme:"notice",type:"submit",variant:"filled",size:"sm"},{default:a(()=>[v($(e.$t("change"))+" ",1),r.isLoading?(n(),h(m,{key:0},[v(" … ")],64)):g("",!0)]),_:1})]),default:a(()=>[v($(e.$t("view.resetPassword"))+" ",1)]),_:1}),b(p,{user:e.$panel.user},null,8,["user"]),b(f,{fields:c.fields,value:r.values},null,8,["fields","value"])],32)]),_:1})}]]);const bg=Ne({props:{api:String,avatar:String,id:String,isLocked:Boolean},methods:{open(){this.avatar?this.$refs.dropdown.toggle():this.upload()},async remove(){await this.$api.users.deleteAvatar(this.id),this.$panel.notification.success(),this.$panel.reload()},upload(){this.$panel.upload.pick({url:this.$panel.urls.api+"/"+this.api+"/avatar",accept:"image/*",immediate:!0,multiple:!1,on:{done:()=>{this.$panel.view.reload()}}})}}},[["render",function(e,i,o,l,r,c){const d=t("k-image-frame"),u=t("k-dropdown"),p=t("k-icon-frame"),f=t("k-button");return n(),s(f,{disabled:o.isLocked,title:e.$t("avatar"),class:"k-user-view-image",onClick:c.open},{default:a(()=>[o.avatar?(n(),h(m,{key:0},[b(d,{cover:!0,src:o.avatar},null,8,["src"]),b(u,{ref:"dropdown",options:[{icon:"upload",text:e.$t("change"),click:()=>c.upload()},{icon:"trash",text:e.$t("delete"),click:()=>c.remove()}]},null,8,["options"])],64)):(n(),s(p,{key:1,icon:"user"}))]),_:1},8,["disabled","title","onClick"])}]]),yg={class:"k-user-info"};const vg=Ne({props:{user:[Object,String]}},[["render",function(e,i,o,l,a,r){const c=t("k-image-frame"),d=t("k-icon-frame");return n(),h("div",yg,[o.user.avatar?(n(),s(c,{key:0,cover:!0,src:o.user.avatar.url,ratio:"1/1"},null,8,["src"])):(n(),s(d,{key:1,color:"white",back:"black",icon:"user"})),v(" "+$(o.user.name??o.user.email??o.user),1)])}]]),$g={props:{api:String,avatar:String,canChangeEmail:Boolean,canChangeLanguage:Boolean,canChangeRole:Boolean,email:String,id:String,isLocked:Boolean,language:String,role:String}},wg={class:"k-user-profile"};const xg=Ne($g,[["render",function(e,i,s,o,l,a){const r=t("k-user-avatar"),c=t("k-button-group");return n(),h("div",wg,[b(r,{id:s.id,api:s.api,avatar:s.avatar,"is-locked":s.isLocked},null,8,["id","api","avatar","is-locked"]),b(c,{buttons:[{icon:"email",text:s.email,title:`${e.$t("email")}: ${s.email}`,disabled:!s.canChangeEmail,click:()=>e.$dialog(s.api+"/changeEmail")},{icon:"bolt",text:s.role,title:`${e.$t("role")}: ${s.role}`,disabled:!s.canChangeRole,click:()=>e.$dialog(s.api+"/changeRole")},{icon:"translate",text:s.language,title:`${e.$t("language")}: ${s.language}`,disabled:!s.canChangeLanguage,click:()=>e.$dialog(s.api+"/changeLanguage")}]},null,8,["buttons"])])}]]);const Sg=Ne({props:{buttons:Array,role:Object,roles:Array,search:String,title:String,users:Object},computed:{empty(){return{icon:"users",text:this.$t("role.empty")}},items(){return this.users.data.map(e=>(e.options=this.$dropdown(e.link),e))},tabs(){const e=[{name:"all",label:this.$t("role.all"),link:"/users"}];for(const t of this.roles)e.push({name:t.id,label:t.title,link:"/users?role="+t.id});return e}},methods:{create(){this.$dialog("users/create",{query:{role:this.role?.id}})},paginate(e){this.$panel.reload({query:{page:e.page}})}}},[["render",function(e,i,o,l,r,c){const d=t("k-view-buttons"),u=t("k-header"),p=t("k-tabs"),h=t("k-collection"),m=t("k-panel-inside");return n(),s(m,{class:"k-users-view"},{default:a(()=>[b(u,{class:"k-users-view-header"},{buttons:a(()=>[b(d,{buttons:o.buttons},null,8,["buttons"])]),default:a(()=>[v($(e.$t("view.users"))+" ",1)]),_:1}),b(p,{tab:o.role?.id??"all",tabs:c.tabs},null,8,["tab","tabs"]),b(h,{empty:c.empty,items:c.items,pagination:o.users.pagination,onPaginate:c.paginate},null,8,["empty","items","pagination","onPaginate"])]),_:1})}]]),Cg={install(e){e.component("k-account-view",gg),e.component("k-reset-password-view",kg),e.component("k-user-avatar",bg),e.component("k-user-info",vg),e.component("k-user-profile",xg),e.component("k-user-view",fg),e.component("k-users-view",Sg)}};const Og=Ne({components:{Plugins:Ne({props:{plugins:Array}},[["render",function(e,i,o,l,r,c){const d=t("k-table"),u=t("k-section");return o.plugins.length?(n(),s(u,{key:0,headline:e.$t("plugins"),link:"https://getkirby.com/plugins"},{default:a(()=>[b(d,{index:!1,columns:{name:{label:e.$t("name"),type:"url",mobile:!0},author:{label:e.$t("author")},license:{label:e.$t("license"),type:"license"},status:{label:e.$t("license.status"),type:"license-status"},version:{label:e.$t("version"),type:"update-status",mobile:!0,width:"10rem"}},rows:o.plugins},null,8,["columns","rows"])]),_:1},8,["headline"])):g("",!0)}]]),Security:Ne({props:{exceptions:{type:Array,default:()=>[]},security:{type:Array,default:()=>[]},urls:{type:[Object,Array],default:()=>({})}},data(){return{issues:this.$helper.object.clone(this.security)}},async mounted(){console.info("Running system health checks for the Panel system view; failed requests in the following console output are expected behavior.");const e=(Promise.allSettled??Promise.all).bind(Promise),t=Object.entries(this.urls??{}).map(this.check);await e(t),console.info(`System health checks ended. ${this.issues.length-this.security.length} issues with accessible files/folders found (see the security list in the system view).`)},methods:{async check([e,t]){if(!t)return;const{status:i}=await fetch(t,{cache:"no-store"});i<400&&this.issues.push({id:e,text:this.$t("system.issues."+e),link:"https://getkirby.com/security/"+e,icon:"folder"})},retry(){this.$go(window.location.href)}}},[["render",function(e,i,o,l,r,c){const d=t("k-items"),u=t("k-section");return r.issues.length?(n(),s(u,{key:0,headline:e.$t("security"),buttons:[{title:e.$t("retry"),icon:"refresh",click:()=>c.retry()}]},{default:a(()=>[b(d,{items:r.issues.map(e=>({theme:"negative",image:{back:"light-dark(var(--theme-color-200), var(--theme-color-900))",icon:e.icon??"alert",color:"var(--theme-color-icon)"},target:"_blank",...e}))},null,8,["items"])]),_:1},8,["headline","buttons"])):g("",!0)}]])},props:{buttons:Array,environment:Array,exceptions:Array,info:Object,plugins:Array,security:Array,urls:[Object,Array]},mounted(){this.exceptions.length>0&&(console.info("The following errors occurred during the update check of Kirby and/or plugins:"),this.exceptions.map(e=>console.warn(e)),console.info("End of errors from the update check."))},methods:{copy(){const e=JSON.stringify({info:this.info,security:this.security.map(e=>e.text),plugins:this.plugins.map(e=>({name:e.name.text,version:e.version.currentVersion}))},null,2);this.$helper.clipboard.write(e),this.$panel.notification.success({message:this.$t("system.info.copied")})}}},[["render",function(e,i,o,l,r,c){const d=t("k-view-buttons"),u=t("k-header"),p=t("k-stats"),h=t("k-section"),m=t("security"),f=t("plugins"),g=t("k-panel-inside");return n(),s(g,{class:"k-system-view"},{default:a(()=>[b(u,null,{buttons:a(()=>[b(d,{buttons:o.buttons},null,8,["buttons"])]),default:a(()=>[v($(e.$t("view.system"))+" ",1)]),_:1}),b(h,{headline:e.$t("environment"),buttons:[{text:e.$t("system.info.copy"),icon:"copy",responsive:!0,click:()=>c.copy()}]},{default:a(()=>[b(p,{reports:o.environment,size:"medium",class:"k-system-info"},null,8,["reports"])]),_:1},8,["headline","buttons"]),b(m,{security:o.security,urls:o.urls},null,8,["security","urls"]),b(f,{plugins:o.plugins},null,8,["plugins"])]),_:1})}]]);const Ag=Ne({inheritAttrs:!1,props:{value:Object}},[["render",function(e,i,o,l,a,r){const c=t("k-url-field-preview"),d=t("k-text-field-preview");return o.value.link?(n(),s(c,{key:0,value:{href:o.value.link,text:o.value.name}},null,8,["value"])):(n(),s(d,{key:1,value:o.value.name},null,8,["value"]))}]]),Ig={class:"k-table-license-status-cell"};const Mg=Ne({inheritAttrs:!1,props:{value:Object},computed:{element(){return this.value.dialog||this.value.drawer||this.value.link?null:"span"}}},[["render",function(e,i,s,o,l,r){const c=t("k-button");return n(),h("div",Ig,[b(c,{dialog:s.value.dialog,drawer:s.value.drawer,element:r.element,icon:s.value.icon,link:s.value.link,theme:s.value.theme,size:"xs",target:"_blank"},{default:a(()=>[v($(s.value.label),1)]),_:1},8,["dialog","drawer","element","icon","link","theme"])])}]]),_g={class:"k-table-update-status-cell"},Dg={key:0,class:"k-table-update-status-cell-version"},Eg={class:"k-plugin-info"},jg=["data-theme"];const Lg=Ne({props:{value:[String,Object]}},[["render",function(e,i,s,o,l,r){const c=t("k-button"),d=t("k-dropdown");return n(),h("div",_g,["string"==typeof s.value?(n(),h("span",Dg,$(s.value),1)):(n(),h(m,{key:1},[b(c,{class:"k-table-update-status-cell-button",dropdown:!0,icon:s.value.icon,href:s.value.url,text:s.value.currentVersion,theme:s.value.theme,size:"xs",variant:"filled",onClick:i[0]||(i[0]=S(t=>e.$refs.dropdown.toggle(),["stop"]))},null,8,["icon","href","text","theme"]),b(d,{ref:"dropdown","align-x":"end"},{default:a(()=>[x("dl",Eg,[x("dt",null,$(e.$t("plugin")),1),x("dd",null,$(s.value.pluginName),1),x("dt",null,$(e.$t("version.current")),1),x("dd",null,$(s.value.currentVersion),1),x("dt",null,$(e.$t("version.latest")),1),x("dd",null,$(s.value.latestVersion),1),x("dt",null,$(e.$t("system.updateStatus")),1),x("dd",{"data-theme":s.value.theme},$(s.value.label),9,jg)]),s.value.url?(n(),h(m,{key:0},[i[1]||(i[1]=x("hr",null,null,-1)),b(c,{icon:"open",link:s.value.url},{default:a(()=>[v($(e.$t("versionInformation")),1)]),_:1},8,["link"])],64)):g("",!0)]),_:1},512)],64))])}]]),Bg={install(e){e.component("k-system-view",Og),e.component("k-table-license-cell",Ag),e.component("k-table-license-status-cell",Mg),e.component("k-table-update-status-cell",Lg)}},Tg={install(e){e.component("k-error-view",Dm),e.component("k-search-view",jm),e.use(of),e.use(Cf),e.use(If),e.use(Ff),e.use(Uf),e.use(pg),e.use(Bg),e.use(Cg)}},qg={install(e){e.use(at),e.use(Di),e.use(ts),e.use(_s),e.use(Ys),e.use(Fd),e.use(Kd),e.use(lp),e.use(Cp),e.use(dh),e.use(xh),e.use(Nh),e.use(Qh),e.use(Mm),e.use(Tg)}},zg={install(e){window.onunhandledrejection=e=>{e.preventDefault(),window.panel.error(e.reason)},e.config.errorHandler=window.panel.error.bind(window.panel)}},Pg=(e={})=>{var t=e.desc?-1:1,i=-t,s=/^0/,n=/\s+/g,o=/^\s+|\s+$/g,l=/[^\x00-\x80]/,a=/^0x[0-9a-f]+$/i,r=/(0x[\da-fA-F]+|(^[\+\-]?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?(?=\D|\s|$))|\d+)/g,c=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,d=e.insensitive?function(e){return function(e){if(e.toLocaleLowerCase)return e.toLocaleLowerCase();return e.toLowerCase()}(""+e).replace(o,"")}:function(e){return(""+e).replace(o,"")};function u(e){return e.replace(r,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0")}function p(e,t){return(!e.match(s)||1===t)&&parseFloat(e)||e.replace(n," ").replace(o,"")||0}return function(e,s){var n=d(e),o=d(s);if(!n&&!o)return 0;if(!n&&o)return i;if(n&&!o)return t;var r=u(n),h=u(o),m=parseInt(n.match(a),16)||1!==r.length&&Date.parse(n),f=parseInt(o.match(a),16)||m&&o.match(c)&&Date.parse(o)||null;if(f){if(m<f)return i;if(m>f)return t}for(var g=r.length,k=h.length,b=0,y=Math.max(g,k);b<y;b++){var v=p(r[b]||"",g),$=p(h[b]||"",k);if(isNaN(v)!==isNaN($))return isNaN(v)?t:i;if(l.test(v+$)&&v.localeCompare){var w=v.localeCompare($);if(w>0)return t;if(w<0)return i;if(b===y-1)return 0}else{if(v<$)return i;if(v>$)return t}}return 0}};RegExp.escape=function(e){return e.replace(new RegExp("[-/\\\\^$*+?.()[\\]{}]","gu"),"\\$&")};function Ng(e){return Array.isArray(e)?e:[e]}const Fg={fromObject:function(e){return Array.isArray(e)?e:Object.values(e??{})},search:(e,t,i={})=>{if((t??"").length<=(i.min??0))return e;const s=new RegExp(RegExp.escape(t),"ig"),n=i.field??"text",o=e.filter(e=>!!e[n]&&null!==e[n].match(s));return i.limit?o.slice(0,i.limit):o},sortBy:function(e,t){const i=t.split(" "),s=i[0],n=i[1]??"asc",o=Pg({desc:"desc"===n,insensitive:!0});return e.sort((e,t)=>{const i=String(e[s]??""),n=String(t[s]??"");return o(i,n)})},split:function(e,t){return e.reduce((e,i)=>(i===t?e.push([]):e[e.length-1].push(i),e),[[]])},wrap:Ng};const Rg={read:function(e,t=!1){if(!e)return null;if("string"==typeof e)return e;if(e instanceof ClipboardEvent){if(e.preventDefault(),!0===t)return e.clipboardData.getData("text/plain");const i=e.clipboardData.getData("text/html")||e.clipboardData.getData("text/plain")||null;if(i)return i.replace(/\u00a0/g," ")}return null},write:function(e,t){if("string"!=typeof e&&(e=JSON.stringify(e,null,2)),t&&t instanceof ClipboardEvent)return t.preventDefault(),t.clipboardData.setData("text/plain",e),!0;const i=document.createElement("textarea");if(i.value=e,document.body.append(i),navigator.userAgent.match(/ipad|ipod|iphone/i)){i.contentEditable=!0,i.readOnly=!0;const e=document.createRange();e.selectNodeContents(i);const t=window.getSelection();t.removeAllRanges(),t.addRange(e),i.setSelectionRange(0,999999)}else i.select();return document.execCommand("copy"),i.remove(),!0}};function Yg(e){if("string"==typeof e){if("pattern"===(e=e.toLowerCase()))return"var(--pattern)";if(!1===e.startsWith("#")&&!1===e.startsWith("var(")){const t="--color-"+e;if(window.getComputedStyle(document.documentElement).getPropertyValue(t))return`var(${t})`}return e}}function Hg(e,t=!1){if(!e.match("youtu"))return!1;let i=null;try{i=new URL(e)}catch{return!1}const s=i.pathname.split("/").filter(e=>""!==e),n=s[0],o=s[1],l="https://"+(!0===t?"www.youtube-nocookie.com":i.host)+"/embed",a=e=>!!e&&null!==e.match(/^[a-zA-Z0-9_-]+$/);let r=i.searchParams,c=null;switch(s.join("/")){case"embed/videoseries":case"playlist":a(r.get("list"))&&(c=l+"/videoseries");break;case"watch":a(r.get("v"))&&(c=l+"/"+r.get("v"),r.has("t")&&r.set("start",r.get("t")),r.delete("v"),r.delete("t"));break;default:i.host.includes("youtu.be")&&a(n)?(c=!0===t?"https://www.youtube-nocookie.com/embed/"+n:"https://www.youtube.com/embed/"+n,r.has("t")&&r.set("start",r.get("t")),r.delete("t")):["embed","shorts"].includes(n)&&a(o)&&(c=l+"/"+o)}if(!c)return!1;const d=r.toString();return d.length&&(c+="?"+d),c}function Ug(e,t=!1){let i=null;try{i=new URL(e)}catch{return!1}const s=i.pathname.split("/").filter(e=>""!==e);let n=i.searchParams,o=null;switch(!0===t&&n.append("dnt",1),i.host){case"vimeo.com":case"www.vimeo.com":o=s[0];break;case"player.vimeo.com":o=s[1]}if(!o||!o.match(/^[0-9]*$/))return!1;let l="https://player.vimeo.com/video/"+o;const a=n.toString();return a.length&&(l+="?"+a),l}const Vg={youtube:Hg,vimeo:Ug,video:function(e,t=!1){return!0===e.includes("youtu")?Hg(e,t):!0===e.includes("vimeo")&&Ug(e,t)}};function Kg(e){if(void 0!==e.default)return dt(e.default);const t=window.panel.app.component(`k-${e.type}-field`),i=t?.props?.value;if(void 0===i)return;const s=i?.default;return"function"==typeof s?s():void 0!==s?s:null}const Wg={defaultValue:Kg,form:function(e){const t={};for(const i in e){const s=Kg(e[i]);void 0!==s&&(t[i]=s)}return t},isVisible:function(e,t){if("hidden"===e.type||!0===e.hidden)return!1;if(!e.when)return!0;for(const i in e.when){const s=t[i.toLowerCase()],n=e.when[i];if((void 0!==s||!(""===n||Array.isArray(n)&&0===n.length))&&s!==n)return!1}return!0},subfields:function(e,t){let i={};for(const s in t){const n=t[s];n.section=e.name,e.endpoints&&(n.endpoints={field:e.endpoints.field+"+"+s,section:e.endpoints.section,model:e.endpoints.model}),i[s]=n}return i}},Jg=e=>e.split(".").slice(-1).join(""),Gg=e=>e.split(".").slice(0,-1).join("."),Xg=e=>Intl.NumberFormat("en",{notation:"compact",style:"unit",unit:"byte",unitDisplay:"narrow"}).format(e),Zg={extension:Jg,name:Gg,niceSize:Xg},Qg=(e,t)=>{t??=window.panel?.app;const i=t?._context.components??{};return Object.hasOwn(i,e)},ek=e=>!!e.dataTransfer&&(!!e.dataTransfer.types&&(!0===e.dataTransfer.types.includes("Files")&&!1===e.dataTransfer.types.includes("text/plain")));const tk={metaKey:function(){return window.navigator.userAgent.indexOf("Mac")>-1?"cmd":"ctrl"}};function ik(e){return!0===e.startsWith("file://")||!0===e.startsWith("/@/file/")}function sk(e){return"site://"===e||!0===e.startsWith("page://")||null!==e.match(/^\/(.*\/)?@\/page\//)}function nk(e=[]){const t={url:{detect:e=>/^(http|https):\/\//.test(e),icon:"url",id:"url",label:window.panel.$t("url"),link:e=>e,placeholder:window.panel.$t("url.placeholder"),input:"url",value:e=>e},page:{detect:e=>!0===sk(e),icon:"page",id:"page",label:window.panel.$t("page"),link:e=>e,placeholder:window.panel.$t("select")+" …",input:"text",value:e=>e},file:{detect:e=>!0===ik(e),icon:"file",id:"file",label:window.panel.$t("file"),link:e=>e,placeholder:window.panel.$t("select")+" …",value:e=>e},email:{detect:e=>e.startsWith("mailto:"),icon:"email",id:"email",label:window.panel.$t("email"),link:e=>e.replace(/^mailto:/,""),placeholder:window.panel.$t("email.placeholder"),input:"email",value:e=>"mailto:"+e},tel:{detect:e=>e.startsWith("tel:"),icon:"phone",id:"tel",label:window.panel.$t("tel"),link:e=>e.replace(/^tel:/,""),pattern:"[+]{0,1}[0-9]+",placeholder:window.panel.$t("tel.placeholder"),input:"tel",value:e=>"tel:"+e},anchor:{detect:e=>e.startsWith("#"),icon:"anchor",id:"anchor",label:"Anchor",link:e=>e,pattern:"^#.+",placeholder:"#element",input:"text",value:e=>e},custom:{detect:()=>!0,icon:"title",id:"custom",label:window.panel.$t("custom"),link:e=>e,input:"text",value:e=>e}};if(!e.length)return t;const i={};for(const s of e)t[s]&&(i[s]=t[s]);return i}const ok={detect:function(e,t){if(e??="",t??=nk(),0===e.length)return{type:Object.keys(t)[0]??"url",link:""};for(const i in t)if(!0===t[i].detect(e))return{type:i,link:t[i].link(e)}},getFileUUID:function(e){return e.replace("/@/file/","file://")},getPageUUID:function(e){return e.replace(/^\/(.*\/)?@\/page\//,"page://")},isFileUUID:ik,isPageUUID:sk,types:nk};const lk={status:function(e,t=!1){const i={icon:"status-"+e,title:window.panel.$t("page.status")+": "+window.panel.$t("page.status."+e),disabled:t,size:"xs",style:"--icon-size: 15px"};return t&&(i.title+=` (${window.panel.$t("disabled")})`),i.theme="draft"===e?"negative-icon":"unlisted"===e?"info-icon":"positive-icon",i}},ak=(e="3/2",t="100%",i=!0)=>{const s=String(e).split("/");if(2!==s.length)return t;const n=Number(s[0]),o=Number(s[1]);let l=100;return 0!==n&&0!==o&&(l=i?l/n*o:l/o*n,l=parseFloat(String(l)).toFixed(2)),l+"%"},rk={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function ck(e){return String(e).replace(/[&<>"'`=/]/g,e=>rk[e])}function dk(e){return!e||0===String(e).length}function uk(e){const t=String(e);return t.charAt(0).toLowerCase()+t.slice(1)}function pk(e="",t=""){const i=new RegExp(`^(${RegExp.escape(t)})+`,"g");return e.replace(i,"")}function hk(e){let t="";const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var s=0;s<e;s++)t+=i.charAt(Math.floor(62*Math.random()));return t}function mk(e="",t=""){const i=new RegExp(`(${RegExp.escape(t)})+$`,"g");return e.replace(i,"")}function fk(e,t={}){const i=(e,t={})=>{const s=t[ck(e.shift())]??"…";return"…"===s||0===e.length?s:i(e,s)},s="[{]{1,2}[\\s]?",n="[\\s]?[}]{1,2}";return(e=e.replace(new RegExp(`${s}(.*?)${n}`,"gi"),(e,s)=>i(s.split("."),t))).replace(new RegExp(`${s}.*${n}`,"gi"),"…")}function gk(e){const t=String(e);return t.charAt(0).toUpperCase()+t.slice(1)}function kk(){let e,t,i="";for(e=0;e<32;e++)t=16*Math.random()|0,8!=e&&12!=e&&16!=e&&20!=e||(i+="-"),i+=(12==e?4:16==e?3&t|8:t).toString(16);return i}const bk={camelToKebab:function(e){return e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()},escapeHTML:ck,hasEmoji:function(e){if("string"!=typeof e)return!1;if(!0===/^[a-z0-9_-]+$/.test(e))return!1;const t=e.match(/(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|[\ud83c\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|[\ud83c\ude32-\ude3a]|[\ud83c\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/i);return null!==t&&null!==t.length},isEmpty:dk,lcfirst:uk,ltrim:pk,pad:function(e,t=2){e=String(e);let i="";for(;i.length<t-e.length;)i+="0";return i+e},random:hk,rtrim:mk,slug:function(e,t=[],i="",s="-"){if(!e)return"";i&&0!==i.length||(i="a-z0-9"),e=e.trim().toLowerCase();for(const n of t)for(const t in n){const i="/"!==t.slice(0,1),s=t.slice(1,t.length-1),o=i?t:s;e=e.replace(new RegExp(RegExp.escape(o),"g"),n[t])}return e=(e=(e=(e=(e=(e=e.replace("/[^\t\n\r -~]/","")).replace(new RegExp("[^"+i+"]","ig"),s)).replace(new RegExp("["+RegExp.escape(s)+"]{2,}","g"),s)).replace("/",s)).replace(new RegExp("^[^a-z0-9]+","g"),"")).replace(new RegExp("[^a-z0-9]+$","g"),"")},stripHTML:function(e){return String(e).replace(/(<([^>]+)>)/gi,"")},template:fk,ucfirst:gk,ucwords:function(e){return String(e).split(/ /g).map(e=>gk(e)).join(" ")},unescapeHTML:function(e){for(const t in rk)e=String(e).replaceAll(rk[t],t);return e},uuid:kk},yk=(e,t,i={leading:!0,trailing:!1})=>{let s=null,n=null,o=null;function l(...l){if(s)return n=this,void(o=l);i.leading?e.call(this,...l):(n=this,o=l);const a=()=>{i.trailing&&o?(e.call(n,...o),n=null,o=null,s=setTimeout(a,t)):s=null};s=setTimeout(a,t)}return l.cancel=()=>{s&&(clearTimeout(s),s=null,n=null,o=null)},l};async function vk(e,t){return new Promise((i,s)=>{const n={url:"/",field:"file",method:"POST",filename:e.name,headers:{},attributes:{},complete:()=>{},error:()=>{},success:()=>{},progress:()=>{}},o=Object.assign(n,t),l=new XMLHttpRequest,a=new FormData;a.append(o.field,e,o.filename);for(const e in o.attributes){const t=o.attributes[e];null!=t&&a.append(e,t)}const r=t=>{if(t.lengthComputable&&o.progress){const i=Math.max(0,Math.min(100,Math.ceil(t.loaded/t.total*100)));o.progress(l,e,i)}};l.upload.addEventListener("loadstart",r),l.upload.addEventListener("progress",r),l.addEventListener("load",t=>{let n=null;try{n=JSON.parse(t.target.response)}catch{n={status:"error",message:"The file could not be uploaded"}}"error"===n.status?(o.error(l,e,n),s(n)):(o.progress(l,e,100),o.success(l,e,n),i(n))}),l.addEventListener("error",t=>{const i=JSON.parse(t.target.response);o.progress(l,e,100),o.error(l,e,i),s(i)}),l.open(o.method,o.url,!0);for(const e in o.headers)l.setRequestHeader(e,o.headers[e]);o.abort?.addEventListener("abort",()=>{l.abort()}),l.send(a)})}function $k(){return new URL(document.querySelector("base")?.href??window.location.origin)}function wk(e={},t={}){t instanceof URL&&(t=t.search);const i=new URLSearchParams(t);for(const[s,n]of Object.entries(e))null!==n&&i.set(s,n);return i}function xk(e="",t={},i){return(e=Ik(e,i)).search=wk(t,e.search),e}function Sk(e){return null!==String(e).match(/^https?:\/\//)}function Ck(e){return Ik(e).origin===window.location.origin}function Ok(e,t){if((e instanceof URL||e instanceof Location)&&(e=e.toString()),"string"!=typeof e)return!1;try{new URL(e,window.location)}catch{return!1}if(!0===t){return/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:localhost)|(?:(?:[a-z0-9\u00a1-\uffff][a-z0-9\u00a1-\uffff_-]{0,62})?[a-z0-9\u00a1-\uffff]\.)+(?:[a-z\u00a1-\uffff]{2,}\.?))(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(e)}return!0}function Ak(e,t){return!0===Sk(e)?e:(t??=$k(),(t=String(t).replaceAll(/\/$/g,""))+"/"+(e=String(e).replaceAll(/^\//g,"")))}function Ik(e,t){return e instanceof URL?e:new URL(Ak(e,t))}const Mk={base:$k,buildQuery:wk,buildUrl:xk,isAbsolute:Sk,isSameOrigin:Ck,isUrl:Ok,makeAbsolute:Ak,toObject:Ik},_k={install(e){e.config.globalProperties.$helper={array:Fg,clipboard:Rg,clone:mt.clone,color:Yg,embed:Vg,focus:Mn,isComponent:Qg,isUploadEvent:ek,debounce:ii,field:Wg,file:Zg,keyboard:tk,link:ok,object:mt,page:lk,pad:bk.pad,ratio:ak,slug:bk.slug,sort:Pg,string:bk,throttle:yk,upload:vk,url:Mk,uuid:bk.uuid},e.config.globalProperties.$esc=bk.escapeHTML}},Dk={install(e){const t=(e,t,i)=>{!0!==i.context.disabled?e.dir=window.panel.language.direction:e.dir=null};e.directive("direction",{bind:t,update:t})}},Ek={install(e){const t=window.panel;e.config.globalProperties.$api=t.api,e.config.globalProperties.$dialog=t.dialog.open.bind(t.dialog),e.config.globalProperties.$drawer=t.drawer.open.bind(t.drawer),e.config.globalProperties.$dropdown=t.dropdown.openAsync.bind(t.dropdown),e.config.globalProperties.$events=t.events,e.config.globalProperties.$go=t.view.open.bind(t.view),e.config.globalProperties.$reload=t.reload,e.config.globalProperties.$t=t.$t=t.t,e.config.globalProperties.$url=t.url}},jk=/^#?([\da-f]{3}){1,2}$/i,Lk=/^#?([\da-f]{4}){1,2}$/i,Bk=/^rgba?\(\s*(\d{1,3})(%?)(?:,|\s)+(\d{1,3})(%?)(?:,|\s)+(\d{1,3})(%?)(?:,|\s|\/)*(\d*(?:\.\d+)?)(%?)\s*\)?$/i,Tk=/^hsla?\(\s*(\d{1,3}\.?\d*)(deg|rad|grad|turn)?(?:,|\s)+(\d{1,3})%(?:,|\s)+(\d{1,3})%(?:,|\s|\/)*(\d*(?:\.\d+)?)(%?)\s*\)?$/i;function qk(e){return"string"==typeof e&&(jk.test(e)||Lk.test(e))}function zk(e){return ut(e)&&"r"in e&&"g"in e&&"b"in e}function Pk(e){return ut(e)&&"h"in e&&"s"in e&&"l"in e}function Nk({h:e,s:t,v:i,a:s}){if(0===i)return{h:e,s:0,l:0,a:s};if(0===t&&1===i)return{h:e,s:1,l:1,a:s};const n=i*(2-t)/2;return{h:e,s:t=i*t/(1-Math.abs(2*n-1)),l:n,a:s}}function Fk({h:e,s:t,l:i,a:s}){const n=t*(i<.5?i:1-i);return{h:e,s:t=0===n?0:2*n/(i+n),v:i+n,a:s}}function Rk(e){if(!0===jk.test(e)||!0===Lk.test(e)){"#"===e[0]&&(e=e.slice(1)),3===e.length&&(e=e.split("").reduce((e,t)=>e+t+t,""));const t=parseInt(e,16);return!0===jk.test(e)?{r:t>>16,g:t>>8&255,b:255&t,a:1}:{r:t>>24&255,g:t>>16&255,b:t>>8&255,a:Math.round((255&t)/255*100)/100}}throw new Error(`unknown hex color: ${e}`)}function Yk({r:e,g:t,b:i,a:s=1}){let n="#"+(1<<24|e<<16|t<<8|i).toString(16).slice(1);return s<1&&(n+=(256|Math.round(255*s)).toString(16).slice(1)),n}function Hk({h:e,s:t,l:i,a:s}){const n=t*Math.min(i,1-i),o=(t,s=(t+e/30)%12)=>i-n*Math.max(Math.min(s-3,9-s,1),-1);return{r:255*o(0),g:255*o(8),b:255*o(4),a:s}}function Uk({r:e,g:t,b:i,a:s}){e/=255,t/=255,i/=255;const n=Math.max(e,t,i),o=n-Math.min(e,t,i),l=1-Math.abs(n+n-o-1);let a=o&&(n==e?(t-i)/o:n==t?2+(i-e)/o:4+(e-t)/o);return a=60*(a<0?a+6:a),{h:a,s:l?o/l:0,l:(n+n-o)/2,a:s}}function Vk(e){return Yk(Hk(e))}function Kk(e){return Uk(Rk(e))}function Wk(e,t){return e=Number(e),"grad"===t?e*=.9:"rad"===t?e*=180/Math.PI:"turn"===t&&(e*=360),parseInt(e%360)}function Jk(e,t){if(!0===qk(e))switch("#"!==e[0]&&(e="#"+e),t){case"hex":return e;case"rgb":return Rk(e);case"hsl":return Kk(e);case"hsv":return Fk(Kk(e))}if(!0===zk(e))switch(t){case"hex":return Yk(e);case"rgb":return e;case"hsl":return Uk(e);case"hsv":return function({r:e,g:t,b:i,a:s}){e/=255,t/=255,i/=255;const n=Math.max(e,t,i),o=n-Math.min(e,t,i);let l=o&&(n==e?(t-i)/o:n==t?2+(i-e)/o:4+(e-t)/o);return l=60*(l<0?l+6:l),{h:l,s:n&&o/n,v:n,a:s}}(e)}if(!0===Pk(e))switch(t){case"hex":return Vk(e);case"rgb":return Hk(e);case"hsl":return e;case"hsv":return Fk(e)}if(!0===function(e){return ut(e)&&"h"in e&&"s"in e&&"v"in e}(e))switch(t){case"hex":return Vk(Nk(e));case"rgb":return function({h:e,s:t,v:i,a:s}){const n=(s,n=(s+e/60)%6)=>i-i*t*Math.max(Math.min(n,4-n,1),0);return{r:255*n(5),g:255*n(3),b:255*n(1),a:s}}(e);case"hsl":return Nk(e);case"hsv":return e}throw new Error(`Invalid color conversion: ${JSON.stringify(e)} -> ${t}`)}function Gk(e){let t;if(!e||"string"!=typeof e)return!1;if(!0===qk(e))return"#"!==e[0]&&(e="#"+e),e;if(t=e.match(Bk)){const e={r:Number(t[1]),g:Number(t[3]),b:Number(t[5]),a:Number(t[7]||1)};return"%"===t[2]&&(e.r=Math.ceil(2.55*e.r)),"%"===t[4]&&(e.g=Math.ceil(2.55*e.g)),"%"===t[6]&&(e.b=Math.ceil(2.55*e.b)),"%"===t[8]&&(e.a=e.a/100),e}if(t=e.match(Tk)){let[e,i,s,n,o]=t.slice(1);const l={h:Wk(e,i),s:Number(s)/100,l:Number(n)/100,a:Number(o||1)};return"%"===t[6]&&(l.a=l.a/100),l}return null}const Xk={convert:Jk,parse:Gk,parseAs:function(e,t){const i=Gk(e);return i&&t?Jk(i,t):i},toString:function(e,t,i=!0){let s=e;if("string"==typeof s&&(s=Gk(e)),s&&t&&(s=Jk(s,t)),!0===qk(s))return!0!==i&&(5===s.length?s=s.slice(0,4):s.length>7&&(s=s.slice(0,7))),s.toLowerCase();if(!0===zk(s)){const e=s.r.toFixed(),t=s.g.toFixed(),n=s.b.toFixed(),o=s.a?.toFixed(2);return i&&o&&o<1?`rgb(${e} ${t} ${n} / ${o})`:`rgb(${e} ${t} ${n})`}if(!0===Pk(s)){const e=s.h.toFixed(),t=(100*s.s).toFixed(),n=(100*s.l).toFixed(),o=s.a?.toFixed(2);return i&&o&&o<1?`hsl(${e} ${t}% ${n}% / ${o})`:`hsl(${e} ${t}% ${n}%)`}throw new Error(`Unsupported color: ${JSON.stringify(e)}`)}};ke.extend(be),ke.extend((e,t,i)=>{i.interpret=(e,t="date")=>{const s={date:{"YYYY-MM-DD":!0,"YYYY-MM-D":!0,"YYYY-MM-":!0,"YYYY-MM":!0,"YYYY-M-DD":!0,"YYYY-M-D":!0,"YYYY-M-":!0,"YYYY-M":!0,"YYYY-":!0,YYYYMMDD:!0,"MMM DD YYYY":!1,"MMM D YYYY":!1,"MMM DD YY":!1,"MMM D YY":!1,"MMM YYYY":!0,"MMM DD":!1,"MMM D":!1,"MM YYYY":!0,"M YYYY":!0,"MMMM DD YYYY":!0,"MMMM D YYYY":!0,"MMMM DD YY":!0,"MMMM D YY":!0,"MMMM DD, YYYY":!0,"MMMM D, YYYY":!0,"MMMM DD, YY":!0,"MMMM D, YY":!0,"MMMM DD. YYYY":!0,"MMMM D. YYYY":!0,"MMMM DD. YY":!0,"MMMM D. YY":!0,DDMMYYYY:!0,DDMMYY:!0,"DD MMMM YYYY":!1,"DD MMMM YY":!1,"DD MMMM":!1,"D MMMM YYYY":!1,"D MMMM YY":!1,"D MMMM":!1,"DD MMM YYYY":!1,"D MMM YYYY":!1,"DD MMM YY":!1,"D MMM YY":!1,"DD MMM":!1,"D MMM":!1,"DD MM YYYY":!1,"DD M YYYY":!1,"D MM YYYY":!1,"D M YYYY":!1,"DD MM YY":!1,"D MM YY":!1,"DD M YY":!1,"D M YY":!1,YYYY:!0,MMMM:!0,MMM:!0,"DD MM":!1,"DD M":!1,"D MM":!1,"D M":!1,DD:!1,D:!1},time:{"HHmmss a":!1,"HHmm a":!1,"HH a":!1,HHmmss:!1,HHmm:!1,"HH:mm:ss a":!1,"HH:mm:ss":!1,"HH:mm a":!1,"HH:mm":!1,HH:!1}};if("string"==typeof e&&""!==e)for(const n in s[t]){const o=i(e,n,s[t][n]);if(!0===o.isValid())return o}return null}}),ke.extend((e,t,i)=>{const s=e=>"date"===e?"YYYY-MM-DD":"time"===e?"HH:mm:ss":"YYYY-MM-DD HH:mm:ss";t.prototype.toISO=function(e="datetime"){return this.format(s(e))},i.iso=function(e,t){t&&(t=s(t)),t??=[s("datetime"),s("date"),s("time")];const n=i(e,t);return n&&n.isValid()?n:null}}),ke.extend((e,t)=>{t.prototype.merge=function(e,t="date"){let i=this.clone();if(!e||!e.isValid())return this;if("string"==typeof t){const e={date:["year","month","date"],time:["hour","minute","second"]};if(!1===Object.hasOwn(e,t))throw new Error("Invalid merge unit alias");t=e[t]}for(const s of t)i=i.set(s,e.get(s));return i}}),ke.extend((e,t,i)=>{i.pattern=e=>new class{constructor(e,t){this.dayjs=e,this.pattern=t;const i={year:["YY","YYYY"],month:["M","MM","MMM","MMMM"],day:["D","DD"],hour:["h","hh","H","HH"],minute:["m","mm"],second:["s","ss"],meridiem:["a"]};this.parts=this.pattern.split(/\W/).map((e,t)=>{const s=this.pattern.indexOf(e);return{index:t,unit:Object.keys(i)[Object.values(i).findIndex(t=>t.includes(e))],start:s,end:s+(e.length-1)}})}at(e,t=e){const i=this.parts.filter(i=>i.start<=e&&i.end>=t-1);return i[0]?i[0]:this.parts.filter(t=>t.start<=e).pop()}format(e){return e&&e.isValid()?e.format(this.pattern):null}}(i,e)}),ke.extend((e,t)=>{t.prototype.round=function(e="date",t=1){const i=["second","minute","hour","date","month","year"];if("day"===e&&(e="date"),!1===i.includes(e))throw new Error("Invalid rounding unit");if(["date","month","year"].includes(e)&&1!==t||"hour"===e&&24%t!=0||["second","minute"].includes(e)&&60%t!=0)throw"Invalid rounding size for "+e;let s=this.clone();const n=i.indexOf(e),o=i.slice(0,n),l=o.pop();for(const a of o)s=s.startOf(a);if(l){const t={month:12,date:s.daysInMonth(),hour:24,minute:60,second:60}[l];Math.round(s.get(l)/t)*t===t&&(s=s.add(1,"date"===e?"day":e)),s=s.startOf(e)}return s=s.set(e,Math.round(s.get(e)/t)*t),s}}),ke.extend((e,t,i)=>{t.prototype.validate=function(e,t,s="day"){if(!this.isValid())return!1;if(!e)return!0;e=i.iso(e);const n={min:"isAfter",max:"isBefore"}[t];return this.isSame(e,s)||this[n](e,s)}});const Zk={install(e){e.config.globalProperties.$library={autosize:ye,colors:Xk,dayjs:ke}}},Qk=(e,t={})=>L({...t,key:()=>e,defaults:()=>t,reset(){return this.set(this.defaults())},set(e){this.validateState(e);for(const t in this.defaults())this[t]=e[t]??this.defaults()[t];return this.state()},state(){const e={};for(const t in this.defaults())e[t]=this[t]??this.defaults()[t];return e},validateState(e){if(!1===ut(e))throw new Error(`Invalid ${this.key()} state`);return!0}}),eb=()=>{const e=Qk("activation",{isOpen:"true"!==sessionStorage.getItem("kirby$activation$card")});return L({...e,close(){sessionStorage.setItem("kirby$activation$card","true"),this.isOpen=!1},open(){sessionStorage.removeItem("kirby$activation$card"),this.isOpen=!0}})},tb=e=>({async changeName(t,i,s){return e.patch(this.url(t,i,"name"),{name:s})},async delete(t,i){return e.delete(this.url(t,i))},async get(t,i,s){let n=await e.get(this.url(t,i),s);return!0===Array.isArray(n.content)&&(n.content={}),n},id:e=>!0===e.startsWith("/@/file/")?e.replace("/@/file/","@"):!0===e.startsWith("file://")?e.replace("file://","@"):e,link(e,t,i){return"/"+this.url(e,t,i)},async update(t,i,s){return e.patch(this.url(t,i),s)},url(e,t,i){let s="files/"+this.id(t);return e&&(s=e+"/"+s),i&&(s+="/"+i),s}}),ib=e=>({async blueprint(t){return e.get("pages/"+this.id(t)+"/blueprint")},async blueprints(t,i){return e.get("pages/"+this.id(t)+"/blueprints",{section:i})},async changeSlug(t,i){return e.patch("pages/"+this.id(t)+"/slug",{slug:i})},async changeStatus(t,i,s){return e.patch("pages/"+this.id(t)+"/status",{status:i,position:s})},async changeTemplate(t,i){return e.patch("pages/"+this.id(t)+"/template",{template:i})},async changeTitle(t,i){return e.patch("pages/"+this.id(t)+"/title",{title:i})},async children(t,i){return e.post("pages/"+this.id(t)+"/children/search",i)},async create(t,i){return null===t||"/"===t?e.post("site/children",i):e.post("pages/"+this.id(t)+"/children",i)},async delete(t,i){return e.delete("pages/"+this.id(t),i)},async duplicate(t,i,s){return e.post("pages/"+this.id(t)+"/duplicate",{slug:i,children:s.children??!1,files:s.files??!1})},async get(t,i){let s=await e.get("pages/"+this.id(t),i);return!0===Array.isArray(s.content)&&(s.content={}),s},id:e=>!0===e.match(/^\/(.*\/)?@\/page\//)?e.replace(/^\/(.*\/)?@\/page\//,"@"):!0===e.startsWith("page://")?e.replace("page://","@"):e.replace(/\//g,"+"),async files(t,i){return e.post("pages/"+this.id(t)+"/files/search",i)},link(e){return"/"+this.url(e)},async preview(e){return(await this.get(this.id(e),{select:"previewUrl"})).previewUrl},async search(t,i){return t?e.post("pages/"+this.id(t)+"/children/search?select=id,title,hasChildren",i):e.post("site/children/search?select=id,title,hasChildren",i)},async update(t,i){return e.patch("pages/"+this.id(t),i)},url(e,t){let i=null===e?"pages":"pages/"+String(e).replace(/\//g,"+");return t&&(i+="/"+t),i}});class sb extends Error{constructor(e,{request:t,response:i,cause:s}){super(i.json.message??i.json.error??e,{cause:s}),this.request=t,this.response=i,this.details=i.json.details}dialog(){const e=this.state();return"Kirby\\Exception\\FormValidationException"===e.exception?{component:"k-validation-error-dialog",props:{message:this.message,fields:e.details}}:{component:"k-request-error-dialog",props:{message:this.message,request:{url:this.request.url,method:this.request.method},response:{status:this.response.status},exception:{file:e.file,line:e.line,type:e.exception,url:e.editor},details:e.details,trace:e.trace}}}state(){return this.response.json}}class nb extends sb{}class ob extends sb{state(){return{message:this.message,text:this.response.text}}}class lb extends Error{constructor(e,{request:t,cause:i}={}){super(e,{cause:i}),this.request=t}}const ab=e=>(window.location.href=Ak(e),!1),rb=async(e,t={})=>{var i;(t={cache:"no-store",credentials:"same-origin",mode:"same-origin",...t}).body=((i=t.body)instanceof HTMLFormElement&&(i=new FormData(i)),i instanceof FormData&&(i=Object.fromEntries(i)),"object"==typeof i?JSON.stringify(i):i),t.headers=((e={},t={})=>{return{"content-type":"application/json","x-csrf":t.csrf??!1,"x-panel":!0,"x-panel-globals":(i=t.globals,!!i&&(!1===Array.isArray(i)?String(i):i.join(","))),"x-panel-referrer":t.referrer??!1,...ht(e)};var i})(t.headers,t),t.url=xk(e,t.query);const s=new Request(t.url,t);return!1===Ck(s.url)?ab(s.url):await cb(s,await db(s))},cb=async(e,t)=>{if(!1===t.headers.get("Content-Type").includes("application/json"))return ab(t.url);try{t.text=await t.text(),t.json=JSON.parse(t.text)}catch(i){throw new ob("Invalid JSON response",{cause:i,request:e,response:t})}if(401===t.status)throw new nb("Unauthenticated",{request:e,response:t});if(!1===t.ok)throw new sb(`The request to ${t.url} failed`,{request:e,response:t});return{request:e,response:t}},db=async e=>{try{return await fetch(e)}catch(t){if("AbortError"===t?.name)throw t;throw window?.panel?.events?.emit("offline",t),new lb("Panel is offline",{cause:t,request:e})}},ub=e=>({blueprint:async t=>e.get("users/"+t+"/blueprint"),blueprints:async(t,i)=>e.get("users/"+t+"/blueprints",{section:i}),changeEmail:async(t,i)=>e.patch("users/"+t+"/email",{email:i}),changeLanguage:async(t,i)=>e.patch("users/"+t+"/language",{language:i}),changeName:async(t,i)=>e.patch("users/"+t+"/name",{name:i}),changePassword:async(t,i,s)=>e.patch("users/"+t+"/password",{password:i,currentPassword:s}),changeRole:async(t,i)=>e.patch("users/"+t+"/role",{role:i}),create:async t=>e.post("users",t),delete:async t=>e.delete("users/"+t),deleteAvatar:async t=>e.delete("users/"+t+"/avatar"),link(e,t){return"/"+this.url(e,t)},async list(t){return e.post(this.url(null,"search"),t)},get:async(t,i)=>e.get("users/"+t,i),async roles(t){return(await e.get(this.url(t,"roles"))).data.map(e=>({info:e.description??`(${window.panel.$t("role.description.placeholder")})`,text:e.title,value:e.name}))},search:async t=>e.post("users/search",t),update:async(t,i)=>e.patch("users/"+t,i),url(e,t){let i=e?"users/"+e:"users";return t&&(i+="/"+t),i}}),pb=e=>{const t={csrf:e.system.csrf,endpoint:mk(e.urls.api,"/"),methodOverride:e.config.api?.methodOverride??!1,ping:null,requests:[],running:0},i=()=>{clearInterval(t.ping),t.ping=setInterval(()=>{!1===e.isOffline&&t.auth.ping()},3e5)};return t.request=async(s,n={},o=!1)=>{const l=s+"/"+JSON.stringify(n);t.requests.push(l),!1===o&&!0!==n.silent&&(e.isLoading=!0),t.language=e.language.code;try{return await(e=>async(t,i={})=>{(i={cache:"no-store",credentials:"same-origin",mode:"same-origin",...i}).headers={"content-type":"application/json","x-csrf":e.csrf,"x-language":e.language,...ht(i.headers??{})},e.methodOverride&&"GET"!==i.method&&"POST"!==i.method&&(i.headers["x-http-method-override"]=i.method,i.method="POST");for(const e in i.headers)null===i.headers[e]&&delete i.headers[e];i.url=mk(e.endpoint,"/")+"/"+pk(t,"/");const s=new Request(i.url,i),{response:n}=await cb(s,await db(s));let o=n.json;return o.data&&"model"===o.type&&(o=o.data),o})(t)(s,n)}finally{i(),t.requests=t.requests.filter(e=>e!==l),0===t.requests.length&&(e.isLoading=!1)}},t.auth=(e=>({async login(t){const i={long:t.remember??!1,email:t.email,password:t.password};return e.post("auth/login",i)},logout:async()=>e.post("auth/logout"),ping:async()=>e.post("auth/ping"),user:async t=>e.get("auth",t),verifyCode:async t=>e.post("auth/code",{code:t})}))(t),t.delete=(e=>async(t,i,s,n=!1)=>e.post(t,i,s,"DELETE",n))(t),t.files=tb(t),t.get=(e=>async(t,i,s,n=!1)=>(i&&(t+="?"+Object.keys(i).filter(e=>void 0!==i[e]&&null!==i[e]).map(e=>e+"="+i[e]).join("&")),e.request(t,Object.assign(s??{},{method:"GET"}),n)))(t),t.languages=(e=>({create:async t=>e.post("languages",t),delete:async t=>e.delete("languages/"+t),get:async t=>e.get("languages/"+t),list:async()=>e.get("languages"),update:async(t,i)=>e.patch("languages/"+t,i)}))(t),t.pages=ib(t),t.patch=(e=>async(t,i,s,n=!1)=>e.post(t,i,s,"PATCH",n))(t),t.post=(e=>async(t,i,s,n="POST",o=!1)=>e.request(t,Object.assign(s??{},{method:n,body:JSON.stringify(i)}),o))(t),t.roles=(e=>({list:async t=>e.get("roles",t),get:async t=>e.get("roles/"+t)}))(t),t.system=(e=>({get:async(t={view:"panel"})=>e.get("system",t),install:async t=>(await e.post("system/install",t)).user,register:async t=>e.post("system/register",t)}))(t),t.site=(e=>({blueprint:async()=>e.get("site/blueprint"),blueprints:async()=>e.get("site/blueprints"),changeTitle:async t=>e.patch("site/title",{title:t}),children:async t=>e.post("site/children/search",t),get:async(t={view:"panel"})=>e.get("site",t),update:async t=>e.post("site",t)}))(t),t.translations=(e=>({list:async()=>e.get("translations"),get:async t=>e.get("translations/"+t)}))(t),t.users=ub(t),i(),t},hb=e=>{const t=L({cancelSaving(){this.saveLazy.cancel(),this.saveAbortController?.abort()},dialog:null,diff(e={}){if(!1===this.isCurrent(e))throw new Error("Cannot get changes for another view");const t=this.versions(),i={};for(const s in t.changes){JSON.stringify(t.changes[s])!==JSON.stringify(t.latest[s])&&(i[s]=t.changes[s])}for(const s in t.latest)void 0===t.changes[s]&&(i[s]=null);return i},async discard(t={}){if(!0!==this.isProcessing){if(!1===this.isCurrent(t))throw new Error("Cannot discard content from another view");if(!0===this.isLocked(t))throw new Error("Cannot discard locked changes");this.cancelSaving(),this.isProcessing=!0;try{await this.request("discard",{},t),e.view.props.versions.changes=this.version("latest"),this.emit("discard",{},t)}catch(i){if(i.key?.startsWith("error.content.lock"))return this.lockDialog(i.details);throw i}finally{this.isProcessing=!1}}},emit(t,i={},s={}){e.events.emit("content."+t,{...i,...this.env(s)})},env:(t={})=>({api:e.view.props.api,language:e.language.code,...t}),hasDiff(e={}){return pt(this.diff(e))>0},isCurrent(e={}){const t=this.env(e),i=this.env();return i.api===t.api&&i.language===t.language},isLocked(e={}){return this.lock(e)?.isLocked??!1},isProcessing:!1,lock(t={}){if(!1===this.isCurrent(t))throw new Error("The lock state cannot be detected for content from another view");return e.view.props.lock},lockDialog(t){this.dialog=e.dialog,this.dialog.open({component:"k-lock-alert-dialog",props:{lock:t},on:{close:()=>{this.dialog=null,e.view.reload()}}})},merge(t={},i={}){if(!1===this.isCurrent(i))throw new Error("The content in another view cannot be merged");return!1===ut(t)&&(t={}),e.view.props.versions.changes={...this.version("changes"),...t},e.view.props.versions.changes},async publish(t={},i={}){if(!0!==this.isProcessing){if(!1===this.isCurrent(i))throw new Error("Cannot publish content from another view");this.cancelSaving(),this.isProcessing=!0;try{await this.request("publish",this.merge(t,i),i),this.dialog?.close(),e.view.props.versions.latest=this.version("changes"),this.emit("publish",{values:t},i)}catch(s){if(s.key?.startsWith("error.content.lock"))return this.lockDialog(s.details);throw s}finally{this.isProcessing=!1}}},async request(t="save",i={},s={}){const{api:n,language:o}=this.env(s),l={headers:{"x-language":o}};return"save"===t&&(l.signal=this.saveAbortController.signal,l.silent=!0),e.api.post(n+"/changes/"+t,i,l)},async save(e={},t={}){this.cancelSaving(),this.saveAbortController=new AbortController;try{await this.request("save",e,t),this.dialog?.close(),!0===this.isCurrent(t)&&(this.lock(t).modified=new Date),this.emit("save",{values:e},t)}catch(i){if("AbortError"===i.name)return;if(this.isProcessing=!1,i.key?.startsWith("error.content.lock"))return this.lockDialog(i.details);throw i}},saveAbortController:null,async update(e={},t={}){return await this.save(this.merge(e,t),t)},updateLazy(e={},t={}){this.saveLazy(this.merge(e,t),t)},version(e){return this.versions()[e]},versions:()=>e.view.props.versions});return t.saveLazy=yk(t.save,500,{leading:!0,trailing:!0,timer:t.timer}),t},mb=()=>({addEventListener(e,t){"function"==typeof t&&(this.on[e]=t)},addEventListeners(e){if(!1!==ut(e))for(const t in e)this.addEventListener(t,e[t])},emit(e,...t){return this.hasEventListener(e)?this.on[e](...t):()=>{}},hasEventListener(e){return"function"==typeof this.on[e]},listeners(){return this.on},on:{}}),fb=(e,t,i)=>{const s=Qk(t,i);return L({...s,...mb(),async get(t,i={}){this.isLoading=!0;try{return await e.get(t,i)}catch(s){e.error(s)}finally{this.isLoading=!1}return!1},async load(t,i={}){return!0!==i.silent&&(this.isLoading=!0),this.abortController=new AbortController,i.signal=this.abortController.signal,await e.open(t,i),this.isLoading=!1,this.addEventListeners(i.on),this.state()},async open(e,t={}){return"function"==typeof t&&(t={on:{submit:t}}),!0===Ok(e)?this.load(e,t):(this.set(e),this.addEventListeners(t.on),this.emit("open",e,t),this.state())},async post(t,i={}){if(!this.path)throw new Error(`The ${this.key()} cannot be posted`);this.isLoading=!0,t??=this.props?.value??{};try{return await e.post(this.path,t,i)}catch(s){e.error(s)}finally{this.isLoading=!1}return!1},async refresh(e={}){if(e.url??=this.url(),!e.url)return;const t=(await this.get(e.url,e))[this.key()];return t&&t.component===this.component?(this.props=t.props,this.state()):void 0},async reload(e={}){if(!this.path)return!1;this.open(this.url(),e)},set(e){return s.set.call(this,e),this.on={},this.addEventListeners(e.on??{}),this.state()},url(){return e.url(this.path,this.query)}})},gb=()=>L({add(e,t=!1){if(!e.id)throw new Error("The state needs an ID");if(!0===t)return this.replace(-1,e);!0!==this.has(e.id)&&this.milestones.push(e)},at(e){return this.milestones.at(e)},clear(){this.milestones=[]},get(e=null){return null===e?this.milestones:this.milestones.find(t=>t.id===e)},goto(e){const t=this.index(e);if(-1!==t)return this.milestones=this.milestones.slice(0,t+1),this.milestones[t]},has(e){return void 0!==this.get(e)},index(e){return this.milestones.findIndex(t=>t.id===e)},isEmpty(){return 0===this.milestones.length},last(){return this.milestones.at(-1)},milestones:[],remove(e=null){return null===e?this.removeLast():this.milestones=this.milestones.filter(t=>t.id!==e)},removeLast(){return this.milestones=this.milestones.slice(0,-1)},replace(e,t){-1===e&&(e=this.milestones.length-1),this.milestones[e]=t}}),kb=(e,t,i)=>{const s=fb(e,t,i);return L({...s,async cancel(){this.isOpen&&this.emit("cancel"),this.close()},async close(t){if(!1===this.isOpen)return;if(void 0!==t&&!0!==t&&t!==this.id)return;!0===t?this.history.clear():this.history.removeLast();const i=this.on.closed??(()=>{});if(!1===this.history.isEmpty()){const e=this.open(this.history.last());return i(),e}this.isOpen=!1,this.emit("close"),this.reset(),i(),0===e.overlays().length&&(document.documentElement.removeAttribute("data-overlay"),document.documentElement.style.removeProperty("--scroll-top"))},focus(e){Mn(`.k-${this.key()}-portal`,e)},goTo(e){const t=this.history.goto(e);void 0!==t&&this.open(t)},history:gb(),input(e){!1!==this.isOpen&&(this.props.value=e,this.emit("input",e))},isOpen:!1,listeners(){return{...this.on,cancel:this.cancel.bind(this),close:this.close.bind(this),input:this.input.bind(this),submit:this.submit.bind(this),success:this.success.bind(this)}},async open(t,i){return!1===this.isOpen&&e.notification.close(),await s.open.call(this,t,i),this.component&&(document.documentElement.setAttribute("data-overlay","true"),document.documentElement.style.setProperty("--scroll-top",window.scrollY+"px"),this.isOpen=!0),this.state()},async reload(e={}){if(!this.path)return!1;const t=this.url();await this.close(),this.open(t,e)},set(e){return s.set.call(this,e),this.id??=kk(),this.state()},async submit(e,t={}){if(!0===this.isLoading)return;if(e??=this.props.value,this.hasEventListener("submit"))return this.emit("submit",e,t);if(!this.path)return this.close();const i=await this.post(e,t);return!1===ut(i)?i:this.success(i[this.key()]??{})},success(t){return this.hasEventListener("success")?this.emit("success",t):("string"==typeof t&&e.notification.success(t),this.close(),this.successNotification(t),this.successEvents(t),t.route||t.redirect?this.successRedirect(t):(!0===e.dialog.isOpen&&e.dialog.refresh(),!0===e.drawer.isOpen&&e.drawer.refresh(),e.view.refresh(t.reload)),t)},successEvents(t){if(t.event){const i=Ng(t.event);for(const s of i)"string"==typeof s&&e.events.emit(s,t)}!1!==t.emit&&e.events.emit("success",t)},successNotification(t){t.message&&e.notification.success(t.message)},successRedirect(t){const i=t.route??t.redirect;return!!i&&("string"==typeof i?e.open(i):e.open(i.url,i.options))},get value(){return this.props?.value}})},bb=e=>{e.events.on("dialog.save",t=>{t?.preventDefault?.(),e.dialog.submit()});const t=kb(e,"dialog",{abortController:null,component:null,isLoading:!1,on:{},path:null,props:{},query:{},referrer:null,timestamp:null,id:null});return L({...t,async open(e,i={}){ut(e)&&e.url&&(i=e,e=e.url,delete i.url),"string"==typeof e&&(e=`/dialogs/${e}`);const s=await t.open.call(this,e,i);return s?.id&&this.history.add(s,e.replace),s}})},yb=()=>{const e=Qk("drag",{type:null,data:{}});return L({...e,get isDragging(){return null!==this.type},start(e,t){this.type=e,this.data=t},stop(){this.type=null,this.data={}}})},vb=e=>{const t=kb(e,"drawer",{abortController:null,component:null,isLoading:!1,on:{},path:null,props:{},query:{},referrer:null,timestamp:null,id:null});return e.events.on("drawer.save",t=>{t.preventDefault(),e.drawer.submit()}),L({...t,get breadcrumb(){return this.history.milestones},get icon(){return this.props.icon??"box"},listeners(){return{...t.listeners.call(this),crumb:this.goTo.bind(this),tab:this.tab.bind(this)}},async open(e,i={}){ut(e)&&e.url&&(i=e,e=e.url,delete i.url),"string"==typeof e&&(e=`/drawers/${e}`),await t.open.call(this,e,i),this.tab(e.tab);const s=this.state();return s?.id&&this.history.add(s,e.replace),this.focus(),s},tab(e){const t=this.props.tabs??{};if(e??=Object.keys(t??{})[0],!e)return!1;this.props.fields=t[e].fields,this.props.tab=e,this.emit("tab",e),setTimeout(()=>{this.focus()})}})},$b=e=>{const t=fb(e,"dropdown",{abortController:null,component:null,isLoading:!1,on:{},path:null,props:{},query:{},referrer:null,timestamp:null});return L({...t,close(){this.emit("close"),this.reset()},open(e,i={}){return"string"==typeof e&&(e=`/dropdowns/${e}`),t.open.call(this,e,i)},openAsync(e,t={}){return async i=>{await this.open(e,t);const s=this.options();if(0===s.length)throw Error("The dropdown is empty");i(s)}},options(){return!1===Array.isArray(this.props.options)?[]:this.props.options},set(e){return e.options&&(e.props={options:e.options}),t.set.call(this,e)}})},wb=e=>{const t=ve();t.on("online",()=>{e.isOffline=!1}),t.on("offline",()=>{e.isOffline=!0}),t.on("keydown.cmd.s",i=>{t.emit(e.context+".save",i)}),t.on("keydown.cmd.shift.f",()=>e.search()),t.on("keydown.cmd./",()=>e.search()),t.on("clipboard.write",async t=>{Rg.write(t),e.notification.success(e.t("copy.success")+"!")});const i={document:{blur:!0,click:!1,copy:!0,focus:!0,paste:!0},window:{beforeunload:!1,dragenter:!1,dragexit:!1,dragleave:!1,dragover:!1,drop:!1,keydown:!1,keyup:!1,offline:!1,online:!1,popstate:!1}};return{beforeunload(e){this.emit("beforeunload",e)},blur(e){this.emit("blur",e)},click(e){this.emit("click",e)},copy(e){this.emit("copy",e)},dragenter(e){this.entered=e.target,this.prevent(e),this.emit("dragenter",e)},dragexit(e){this.prevent(e),this.entered=null,this.emit("dragexit",e)},dragleave(e){this.prevent(e),this.entered===e.target&&(this.entered=null,this.emit("dragleave",e))},dragover(e){this.prevent(e),this.emit("dragover",e)},drop(e){this.prevent(e),this.entered=null,this.emit("drop",e)},emit:t.emit,entered:null,focus(e){this.emit("focus",e)},keychain(e,t){let i=[e];(t.metaKey||t.ctrlKey)&&i.push("cmd"),!0===t.altKey&&i.push("alt"),!0===t.shiftKey&&i.push("shift");let s=t.key?uk(t.key):null;const n={escape:"esc",arrowUp:"up",arrowDown:"down",arrowLeft:"left",arrowRight:"right"};return n[s]&&(s=n[s]),s&&!1===["alt","control","shift","meta"].includes(s)&&i.push(s),i.join(".")},keydown(e){this.emit(this.keychain("keydown",e),e),this.emit("keydown",e)},keyup(e){this.emit(this.keychain("keyup",e),e),this.emit("keyup",e)},off:t.off,offline(e){this.emit("offline",e)},on:t.on,online(e){this.emit("online",e)},paste(e){this.emit("paste",e)},popstate(e){this.emit("popstate",e)},prevent(e){e.stopPropagation(),e.preventDefault()},subscribe(){for(const e in i.document)document.addEventListener(e,this[e].bind(this),i.document[e]);for(const e in i.window)window.addEventListener(e,this[e].bind(this),i.window[e])},unsubscribe(){for(const e in i.document)document.removeEventListener(e,this[e]);for(const e in i.window)window.removeEventListener(e,this[e])}}},xb={interval:null,start(e,t){this.stop(),e&&(this.interval=setInterval(t,e))},stop(){clearInterval(this.interval),this.interval=null}},Sb=(e={})=>{const t=Qk("notification",{context:null,details:null,icon:null,isOpen:!1,message:null,theme:null,timeout:null,type:null});return L({...t,close(){return this.timer.stop(),this.reset(),this.state()},deprecated(e){console.warn("Deprecated: "+e)},error(t){if(t instanceof nb&&e.user.id)return e.redirect("logout");if(t instanceof ob)return this.fatal(t);if("string"==typeof t&&(t=new Error(t)),t instanceof Error==!1){const e=t.message??"Something went wrong",i=t.details??{};(t=new Error(e)).details=i}return"view"===e.context&&(t instanceof sb?e.dialog.open(t.dialog()):e.dialog.open({component:"k-error-dialog",props:t})),this.open({message:t.message,icon:"alert",theme:"negative",type:"error"})},info(e={}){return"string"==typeof e&&(e={message:e}),this.open({icon:"info",theme:"info",...e})},get isFatal(){return"fatal"===this.type},fatal(e){return"string"==typeof e?this.open({message:e,type:"fatal"}):e instanceof ob?this.open({message:e.response.text,type:"fatal"}):this.open({message:e.message??"Something went wrong",type:"fatal"})},open(t){return this.timer.stop(),"string"==typeof t?this.success(t):("error"!==t.type&&"fatal"!==t.type&&(t.timeout??=4e3),this.set({context:e.context,...t}),this.isOpen=!0,this.timer.start(this.timeout,()=>this.close()),this.state())},success(e={}){return"string"==typeof e&&(e={message:e}),this.open({icon:"check",theme:"positive",...e})},timer:xb})},Cb=()=>{const e=Qk("language",{code:null,default:!1,direction:"ltr",hasCustomDomain:!1,name:null,rules:null});return L({...e,get isDefault(){return this.default}})},Ob=(e,t,i)=>{if(!(i.template||i.render||i.setup||i.extends))throw new Error(`Plugin component "${t}" is not providing any template, render or setup method, neither is it extending a component. The component has not been registered.`);return i=Ab(e,t,i),i=Mb(i),i=Ib(i),!0===Qg(t,e)&&window.console.warn(`Plugin is replacing "${t}"`),e.component(t,i),i},Ab=(e,t,i)=>"string"!=typeof i?.extends?i:!1===Qg(i.extends,e)?(window.console.warn(`Problem with plugin trying to register component "${t}": cannot extend non-existent component "${i.extends}"`),i.extends=null,i):(i.extends=e.component(i.extends),i),Ib=e=>{if(!1===Array.isArray(e.mixins))return e;const t={dialog:Ot,drawer:Ui,section:gh};return e.mixins=e.mixins.map(i=>{if("string"!=typeof i)return i;if(void 0!==t[i]){if(e.extends){if(!0===(e.extends.mixins??[]).includes(t[i]))return}return t[i]}window.console.warn(`Plugin trying to register component "${e.name}": cannot extend non-existent mixin "${i}"`)}).filter(e=>void 0!==e),e},Mb=e=>(e.template&&delete e.render,e),_b=(e,t={})=>((t={resolveComponentExtension:Ab,resolveComponentMixins:Ib,resolveComponentRender:Mb,components:{},created:[],icons:{},login:null,textareaButtons:{},thirdParty:{},use:[],viewButtons:{},writerMarks:{},writerNodes:{},...t}).use=((e,t)=>{if(!1===Array.isArray(t))return[];for(const i of t)e.use(i);return t})(e,t.use),t.components=((e,t)=>{if(!1===ut(t))return;const i={};for(const[n,o]of Object.entries(t))try{i[n]=Ob(e,n,o)}catch(s){window.console.warn(s.message)}return i})(e,t.components),t),Db=e=>{const t=Qk("menu",{items:[],hover:!1,isOpen:!1}),i=window.matchMedia?.("(max-width: 60rem)"),s=L({...t,blur(e){const t=document.querySelector(".k-panel-menu");if(!t||!1===i.matches)return!1;!1===document.querySelector(".k-panel-menu-proxy").contains(e.target)&&!1===t.contains(e.target)&&this.close()},close(){this.isOpen=!1,!1===i.matches&&localStorage.setItem("kirby$menu",!0)},escape(){if(!1===i.matches)return!1;this.close()},open(){this.isOpen=!0,!1===i.matches&&localStorage.removeItem("kirby$menu")},resize(){if(i.matches)return this.close();null!==localStorage.getItem("kirby$menu")?this.isOpen=!1:this.isOpen=!0},set(e){return this.items=e,this.resize(),this.state()},toggle(){this.isOpen?this.close():this.open()}});return e.events.on("keydown.esc",s.escape.bind(s)),e.events.on("click",s.blur.bind(s)),i?.addEventListener("change",s.resize.bind(s)),s},Eb=e=>({controller:null,requests:0,get isLoading(){return this.requests>0},open(t){e.menu.escape(),e.dialog.open({component:"k-search-dialog",props:{type:t}})},async query(t,i,s){if(this.controller?.abort(),this.controller=new AbortController,i.length<2)return{results:null,pagination:{}};this.requests++;try{const{search:n}=await e.get(`/search/${t}`,{query:{query:i,...s},signal:this.controller.signal});return n}catch(n){if("AbortError"!==n.name)return{results:[],pagination:{}}}finally{this.requests--}}}),jb=window.matchMedia?.("(prefers-color-scheme: dark)"),Lb=e=>{const t=Qk("theme",{setting:localStorage.getItem("kirby$theme"),system:jb?.matches?"dark":"light"}),i=L({...t,get config(){return e.config.theme},get current(){const e=this.setting??this.config;return"system"===e?this.system:e??this.system},reset(){this.setting=null,localStorage.removeItem("kirby$theme")},set(e){this.setting=e,localStorage.setItem("kirby$theme",e)}});return jb?.addEventListener("change",e=>{i.system=e.matches?"dark":"light"}),i},Bb=()=>{const e=Qk("translation",{code:null,data:{},direction:"ltr",name:null,weekday:1});return L({...e,set(t){return e.set.call(this,t),document.documentElement.lang=this.code,document.body.dir=this.direction,this.state()},translate(e,t,i=null){if("string"!=typeof e)return;const s=this.data[e]??i;return"string"!=typeof s?s:fk(s,t)}})};const Tb=e=>{const t=Qk("upload",{abort:null,accept:"*",attributes:{},files:[],max:null,multiple:!0,preview:{},replacing:null,url:null});return L({...t,...mb(),input:null,announce(){e.notification.success({context:"view"}),e.events.emit("model.update")},async cancel(){await this.emit("cancel"),this.abort?.abort(),this.completed.length>0&&(await this.emit("complete",this.completed),this.announce()),this.reset()},get completed(){return this.files.filter(e=>e.completed).map(e=>e.model)},async done(){e.dialog.close(),this.completed.length>0&&(await this.emit("complete",this.completed),await this.emit("done",this.completed),this.announce()),this.reset()},findDuplicate(e){return this.files.findLastIndex(t=>t.src.name===e.src.name&&t.src.type===e.src.type&&t.src.size===e.src.size&&t.src.lastModified===e.src.lastModified)},hasUniqueName(e){return this.files.filter(t=>t.name===e.name&&t.extension===e.extension).length<2},file(e){const t=URL.createObjectURL(e);return{...this.preview,completed:!1,error:null,extension:Jg(e.name),filename:e.name,id:kk(),model:null,name:Gg(e.name),niceSize:Xg(e.size),progress:0,size:e.size,src:e,type:e.type,url:t}},open(t,i){t instanceof FileList?(this.set(i),this.select(t)):this.set(t);const s={component:"k-upload-dialog",props:{preview:this.preview},on:{open:e=>this.emit("open",e),cancel:()=>this.cancel(),submit:async()=>{e.dialog.isLoading=!0,await this.submit(),e.dialog.isLoading=!1}}};this.replacing&&(s.component="k-upload-replace-dialog",s.props.original=this.replacing),e.dialog.open(s)},pick(e){this.set(e),this.input=document.createElement("input"),this.input.type="file",this.input.classList.add("sr-only"),this.input.value=null,this.input.accept=this.accept,this.input.multiple=this.multiple,this.input.click(),this.input.addEventListener("change",t=>{!0===e?.immediate?(this.set(e),this.select(t.target.files),this.submit()):this.open(t.target.files,e),this.input.remove()})},remove(e){this.files=this.files.filter(t=>t.id!==e)},replace(t,i){this.pick({...i,url:e.urls.api+"/"+t.link,accept:"."+t.extension+","+t.mime,multiple:!1,replacing:t})},reset(){t.reset.call(this),this.files.splice(0)},select(e,t){if(this.set(t),e instanceof Event&&(e=e.target.files),e instanceof FileList==!1)throw new Error("Please provide a FileList");e=(e=[...e]).map(e=>this.file(e)),this.files=[...this.files,...e],this.files=this.files.filter((e,t)=>this.findDuplicate(e)===t),null!==this.max&&(this.files=this.files.slice(-1*this.max)),this.emit("select",this.files)},set(e){if(e)return t.set.call(this,e),this.on={},this.addEventListeners(e.on??{}),1===this.max&&(this.multiple=!1),!1===this.multiple&&(this.max=1),this.state()},async submit(){if(!this.url)throw new Error("The upload URL is missing");this.abort=new AbortController;const t=[];for(const i of this.files){if(!0===i.completed)continue;if(!1===this.hasUniqueName(i)){i.error=e.t("error.file.name.unique");continue}i.error=null,i.progress=0;const s={...this.attributes};t.push(async()=>await this.upload(i,s));const n=this.attributes?.sort;null!=n&&this.attributes.sort++}if(await async function(e,t=20){let i=0,s=0;return new Promise(n=>{const o=t=>s=>{e[t]=s,i--,l()},l=()=>{if(i<t&&s<e.length)return e[s]().then(o(s)).catch(o(s)),s++,i++,l();0===i&&s===e.length&&n(e)};l()})}(t),this.files.length===this.completed.length)return this.done()},async upload(t,i){try{const s=await async function(e,t,i=5242880){const s=Math.ceil(e.size/i),n=hk(4).toLowerCase();let o;for(let l=0;l<s&&!t.abort?.aborted;l++){const a=l*i,r=Math.min(a+i,e.size),c=s>1?e.slice(a,r,e.type):e;s>1&&(t.headers={...t.headers,"Upload-Length":e.size,"Upload-Offset":a,"Upload-Id":n}),o=await vk(c,{...t,progress:(i,s,n)=>{const o=s.size*(n/100),l=(a+o)/e.size;t.progress(i,e,Math.round(100*l))}})}return o}(t.src,{abort:this.abort.signal,attributes:i,filename:t.name+"."+t.extension,headers:{"x-csrf":e.system.csrf},url:this.url,progress:(e,i,s)=>{t.progress=s}},e.config.upload);t.completed=!0,t.model=s.data,e.events.emit("file.upload",t)}catch(s){e.error(s,!1),t.error=s.message,t.progress=0,e.events.emit("file.upload.error",t)}}})},qb=e=>{const t=fb(e,"view",{abortController:null,component:null,isLoading:!1,on:{},path:null,props:{},query:{},referrer:null,timestamp:null,breadcrumb:[],breadcrumbLabel:null,icon:null,id:null,link:null,search:"pages",title:null});return L({...t,async load(e,i={}){return this.abortController?.abort(),t.load.call(this,e,i)},set(i){t.set.call(this,i),e.title=this.title;const s=this.url().toString();window.location.toString()!==s&&(window.history.pushState(null,null,s),window.scrollTo(0,0))},async submit(){throw new Error("Not yet implemented")}})},zb={config:{},languages:[],license:"missing",multilang:!1,permissions:{},searches:{},urls:{}},Pb=["dialog","drawer"],Nb=["dropdown","language","menu","notification","system","translation","user"],Fb={create(e,t={}){this.app=e,this.isLoading=!1,this.isOffline=!1,this.activation=eb(),this.drag=yb(),this.events=wb(this),this.observers=L({resize:new ResizeObserver(e=>{for(const t in e){const i=e[t];i.target.dispatchEvent(new CustomEvent("resize",{detail:{width:i.contentRect.width,height:i.contentRect.height}}))}})}),this.searcher=Eb(this),this.theme=Lb(this),this.upload=Tb(this),this.language=Cb(),this.menu=Db(this),this.notification=Sb(this),this.system=Qk("system",{ascii:{},csrf:null,isLocal:null,locales:{},slugs:[],title:null}),this.translation=Bb(),this.user=Qk("user",{email:null,id:null,language:null,role:null,username:null}),this.dropdown=$b(this),this.view=qb(this),this.content=hb(this),this.drawer=vb(this),this.dialog=bb(this),this.redirect=ab,this.reload=this.view.reload.bind(this.view),this.t=this.translation.translate.bind(this.translation),this.plugins=_b(this.app,t),this.set(window.panelState),this.api=pb(this);const i=L(this);window.panel=this.app.config.globalProperties.$panel=i;for(const s in this)"function"==typeof this[s]&&(this[s]=this[s].bind(i));return i},get context(){return this.dialog.isOpen?"dialog":this.drawer.isOpen?"drawer":"view"},get debug(){return!0===this.config.debug},deprecated(e){this.notification.deprecated(e)},get direction(){return this.translation.direction},error(e,t=!0){if("AbortError"!==e.name){if(!(e instanceof lb))return!0===this.debug&&console.error(e),!0===t?this.notification.error(e):void 0;this.isOffline=!0}},async get(e,t={}){const{response:i}=await this.request(e,{method:"GET",...t});return i?.json??{}},get hasSearch(){return pt(this.searches)>0},async open(e,t={}){try{if(!1===Ok(e))this.set(e);else{this.isLoading=!0;const i=await this.get(e,t);if(!0===ut(t?.on))for(const e of Pb)ut(i?.[e])&&(i[e].on=t.on);this.set(i)}return this.state()}catch(i){return this.error(i)}finally{this.isLoading=!1}},overlays(){const e=[];return!0===this.drawer.isOpen&&e.push("drawer"),!0===this.dialog.isOpen&&e.push("dialog"),e},async post(e,t={},i={}){const{response:s}=await this.request(e,{method:"POST",body:t,...i});return s.json},async request(e,t={}){return rb(e,{referrer:this.view.path,csrf:this.system.csrf,...t})},async search(e,t,i){return void 0===t?this.searcher.open(e):this.searcher.query(e,t,i)},set(e={}){for(const t in zb){const i=e[t]??this[t]??zb[t];typeof i==typeof zb[t]&&(this[t]=i)}for(const t of Nb)(ut(e[t])||Array.isArray(e[t]))&&this[t].set(e[t]);for(const t of Pb)if(!0===ut(e[t])){if(e[t].redirect)return this.open(e[t].redirect);this[t].open(e[t])}else void 0!==e[t]&&this[t].close(!0);!0===ut(e.dropdown)?this.dropdown.open(e.dropdown):void 0!==e.dropdown&&this.dropdown.close(),!0===ut(e.view)&&this.view.open(e.view)},state(){const e={};for(const t in zb)e[t]=this[t]??zb[t];for(const t of Nb)e[t]=this[t].state();for(const t of Pb)e[t]=this[t].state();return e.dropdown=this.dropdown.state(),e.view=this.view.state(),e},get title(){return document.title},set title(e){!1===dk(this.system.title)&&(e+=" | "+this.system.title),document.title=e},url:(e="",t={},i)=>xk(e,t,i)},Rb={mounted(){if(!1===this.$options.inheritAttrs)for(const e in this.$attrs)!0===e.startsWith("data-")&&this.$el.setAttribute(e,this.$attrs[e])}},Yb={data:()=>({__listenersController:new AbortController}),mounted(){if(!1===this.$options.inheritAttrs)for(const e in this.$attrs)if(!0===e.startsWith("on")){const t=e.slice(2).toLowerCase(),i=Ng(this.$attrs[e]);for(const e of i)this.$el.addEventListener(t,e,{signal:this.__listenersController.signal})}},unmounted(){this.__listenersController.abort()}},Hb=q($e);Hb.use(_k),Hb.use(Zk),Hb.use(qg),Hb.mixin(Rb),Hb.mixin(Yb),Fb.create(Hb,window.panel.plugins),Hb.use(Dk),Hb.use(zg),Hb.use(Ek),Hb.mixin({mounted(){this.$el.__vue__=this}}),Hb.mount("#app");export{Ne as _};
