const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./IndexView.min.js","./vendor.min.js","./DocsView.min.js","./Docs.min.js","./PlaygroundView.min.js","./Highlight.min.js"])))=>i.map(i=>d[i]);
var t,e=Object.defineProperty;import s,{del as i,set as n,h as o,reactive as r}from"vue";import{I as a,P as l,S as c,F as u,N as p,s as d,l as h,w as m,a as f,b as g,c as k,d as b,e as y,t as v,f as $,g as w,h as x,i as _,k as S,D as C,j as O,E as A,m as M,n as D,o as E,T as j,u as I,p as B,r as L,q as T,v as P,x as q,y as N,z as F,A as z,B as Y,C as R,G as H}from"./vendor.min.js";const U={created(){this.$panel.events.subscribe();for(const t of this.$panel.plugins.created)t(this);this.$panel.events.on("popstate",()=>{this.$panel.open(window.location.href)}),this.$panel.events.on("drop",()=>{this.$panel.drag.stop()})},destroyed(){this.$panel.events.unsubscribe()},render(t){if(this.$panel.view.component)return t(this.$panel.view.component,{key:this.$panel.view.component,props:this.$panel.view.props})}},V={props:{after:String}},K={props:{autocomplete:String}},W={props:{autofocus:Boolean}},J={props:{before:String}},G={props:{disabled:Boolean}},X={props:{font:String}},Z={props:{help:String}},Q={props:{id:{type:[Number,String],default(){return this._uid}}}},tt={props:{label:[String,Boolean]}},et={props:{layout:{type:String,default:"list"}}},st={props:{maxlength:Number}},it={props:{minlength:Number}},nt={props:{name:[Number,String]}},ot={props:{options:{default:()=>[],type:Array}}},rt={props:{pattern:String}},at={props:{placeholder:[Number,String]}},lt={props:{required:Boolean}},ct={props:{spellcheck:{type:Boolean,default:!0}}};function ut(t,e,s,i,n,o,r,a){var l="function"==typeof t?t.options:t;return e&&(l.render=e,l.staticRenderFns=s,l._compiled=!0),{exports:t,options:l}}const pt={mixins:[et],inheritAttrs:!1,props:{columns:{type:[Object,Array],default:()=>({})},fields:{type:Object,default:()=>({})},items:{type:Array,default:()=>[]},link:{type:Boolean,default:!0},selecting:Boolean,sortable:Boolean,size:{type:String,default:"medium"},theme:String}};const dt=ut({mixins:[pt],props:{image:{type:[Object,Boolean],default:()=>({})}},emits:["change","hover","item","option","sort"],computed:{dragOptions(){return{sort:this.sortable,disabled:!1===this.sortable,draggable:".k-draggable-item"}},itemsWithIds(){return this.items.map(t=>({...t,id:t.id??t.uuid??this.$helper.uuid()}))},table(){return{columns:this.columns,fields:this.fields,rows:this.items,selecting:this.selecting,sortable:this.sortable}}},methods:{onDragStart(t,e){this.$panel.drag.start("text",e)},onOption(t,e,s){this.$emit("option",t,e,s)},onSelect(t,e,s){this.$emit("select",t,e,s)},imageOptions(t){let e=this.image,s=t.image;return!1!==e&&!1!==s&&("object"!=typeof e&&(e={}),"object"!=typeof s&&(s={}),{...s,...e})}}},function(){var t=this,e=t._self._c;return"table"===t.layout?e("k-table",t._b({class:t.$attrs.class,style:t.$attrs.style,on:{change:function(e){return t.$emit("change",e)},select:t.onSelect,sort:function(e){return t.$emit("sort",e)},option:t.onOption},scopedSlots:t._u([t.$scopedSlots.options?{key:"options",fn:function({row:e,rowIndex:s}){return[t._t("options",null,null,{item:e,index:s})]}}:null],null,!0)},"k-table",t.table,!1)):e("k-draggable",{class:["k-items","k-"+t.layout+"-items",t.$attrs.class],style:t.$attrs.style,attrs:{"data-layout":t.layout,"data-size":t.size,handle:!0,list:t.items,options:t.dragOptions},on:{change:function(e){return t.$emit("change",e)},end:function(e){return t.$emit("sort",t.items,e)}}},[t._l(t.itemsWithIds,function(s,i){return[t._t("default",function(){return[e("k-item",t._b({key:s.id,class:{"k-draggable-item":t.sortable&&!1!==s.sortable},attrs:{image:t.imageOptions(s),layout:t.layout,link:!!t.link&&s.link,selecting:t.selecting,selectable:s.selectable,sortable:t.sortable&&!1!==s.sortable,theme:s.theme??t.theme,width:s.column},on:{click:function(e){return t.$emit("item",s,i)},drag:function(e){return t.onDragStart(e,s.dragText)},option:function(e){return t.onOption(e,s,i)},select:function(e){return t.onSelect(s,i)}},nativeOn:{mouseover:function(e){return t.$emit("hover",e,s,i)}},scopedSlots:t._u([{key:"options",fn:function(){return[t._t("options",null,null,{item:s,index:i})]},proxy:!0}],null,!0)},"k-item",s,!1))]},null,{item:s,itemIndex:i})]})],2)},[]).exports;const ht=ut({mixins:[pt],props:{empty:{type:Object,default:()=>({})},help:String,pagination:{type:[Boolean,Object],default:!1}},emits:["action","change","empty","item","option","paginate","sort"],computed:{hasPagination(){return!1!==this.pagination&&(!0!==this.paginationOptions.hide&&!(this.pagination.total<=this.pagination.limit))},listeners(){return this.$listeners.empty?{click:this.onEmpty}:{}},paginationOptions(){return{limit:10,details:!0,keys:!1,total:0,hide:!1,..."object"!=typeof this.pagination?{}:this.pagination}}},watch:{$props(){this.$forceUpdate()}},methods:{onEmpty(t){t.stopPropagation(),this.$emit("empty")},onOption(...t){this.$emit("action",...t),this.$emit("option",...t)},onSelect(...t){this.$emit("select",...t)}}},function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-collection"},[0===t.items.length?e("k-empty",t._g(t._b({attrs:{layout:t.layout}},"k-empty",t.empty,!1),t.listeners)):e("k-items",t._b({on:{change:function(e){return t.$emit("change",e)},item:function(e){return t.$emit("item",e)},option:t.onOption,select:t.onSelect,sort:function(e){return t.$emit("sort",e)}},scopedSlots:t._u([{key:"options",fn:function({item:e,index:s}){return[t._t("options",null,null,{item:e,index:s})]}}],null,!0)},"k-items",{columns:t.columns,fields:t.fields,items:t.items,layout:t.layout,link:t.link,selecting:t.selecting,size:t.size,sortable:t.sortable,theme:t.theme},!1)),t.help||t.hasPagination?e("footer",{staticClass:"k-collection-footer"},[e("k-text",{staticClass:"k-help k-collection-help",attrs:{html:t.help}}),t.hasPagination?e("k-pagination",t._b({on:{paginate:function(e){return t.$emit("paginate",e)}}},"k-pagination",t.paginationOptions,!1)):t._e()],1):t._e()],1)},[]).exports;const mt=ut({mixins:[et],props:{text:String,icon:String},emits:["click"],computed:{attrs(){const t={button:void 0!==this.$listeners.click,icon:this.icon,theme:"empty"};return"cardlets"!==this.layout&&"cards"!==this.layout||(t.align="center",t.height="var(--item-height-cardlet)"),t}}},function(){var t=this;return(0,t._self._c)("k-box",t._b({staticClass:"k-empty",nativeOn:{click:function(e){return t.$emit("click",e)}}},"k-box",t.attrs,!1),[t._t("default",function(){return[t._v(" "+t._s(t.text)+" ")]})],2)},[]).exports,ft={mixins:[et],props:{image:[Object,Boolean],width:{type:String,default:"1/1"}}};const gt=ut({mixins:[ft],inheritAttrs:!1,computed:{attrs(){return{back:this.image.back,cover:!0,...this.image,ratio:"list"===this.layout?"auto":this.image.ratio,size:this.sizes}},component(){return this.image.src?"k-image-frame":"k-icon-frame"},sizes(){switch(this.width){case"1/2":case"2/4":return"(min-width: 30em) and (max-width: 65em) 59em, (min-width: 65em) 44em, 27em";case"1/3":return"(min-width: 30em) and (max-width: 65em) 59em, (min-width: 65em) 29.333em, 27em";case"1/4":return"(min-width: 30em) and (max-width: 65em) 59em, (min-width: 65em) 22em, 27em";case"2/3":return"(min-width: 30em) and (max-width: 65em) 59em, (min-width: 65em) 27em, 27em";case"3/4":return"(min-width: 30em) and (max-width: 65em) 59em, (min-width: 65em) 66em, 27em";default:return"(min-width: 30em) and (max-width: 65em) 59em, (min-width: 65em) 88em, 27em"}}}},function(){var t=this;return(0,t._self._c)(t.component,t._b({tag:"component",class:["k-item-image",t.$attrs.class],style:t.$attrs.style},"component",t.attrs,!1))},[]).exports;const kt=ut({mixins:[ft,et],inheritAttrs:!1,props:{buttons:{type:Array,default:()=>[]},data:Object,info:String,link:{type:[Boolean,String,Function]},options:{type:[Array,Function,String]},selecting:Boolean,selectable:Boolean,sortable:Boolean,target:String,text:String,theme:String},emits:["action","click","drag","option"],computed:{hasFigure(){return!1!==this.image&&this.$helper.object.length(this.image)>0}},methods:{onClick(t){if(this.selecting&&this.selectable)return this.$refs.selector.click();this.$emit("click",t)},onOption(t){this.$emit("action",t),this.$emit("option",t)},title(t){return this.$helper.string.stripHTML(this.$helper.string.unescapeHTML(t)).trim()}}},function(){var t,e=this,s=e._self._c;return s("div",e._b({class:["k-item",`k-${e.layout}-item`,e.$attrs.class],style:e.$attrs.style,attrs:{"data-has-image":e.hasFigure,"data-layout":e.layout,"data-selecting":e.selecting,"data-selectable":e.selectable,"data-theme":e.theme},on:{click:e.onClick,dragstart:function(t){return e.$emit("drag",t)}}},"div",e.data,!1),[e._t("image",function(){return[e.hasFigure?s("k-item-image",{attrs:{image:e.image,layout:e.layout,width:e.width}}):e._e()]}),e.sortable?s("k-sort-handle",{staticClass:"k-item-sort-handle",attrs:{tabindex:"-1"}}):e._e(),s("div",{staticClass:"k-item-content"},[s("h3",{staticClass:"k-item-title",attrs:{title:e.title(e.text)}},[!1!==e.link&&!0!==e.selecting?s("k-link",{attrs:{target:e.target,to:e.link}},[s("span",{domProps:{innerHTML:e._s(e.text??"&nbsp;")}})]):s("span",{domProps:{innerHTML:e._s(e.text??"&nbsp;")}})],1),e.info?s("p",{staticClass:"k-item-info",attrs:{title:e.title(e.info)},domProps:{innerHTML:e._s(e.info)}}):e._e()]),(null==(t=e.buttons)?void 0:t.length)||e.options||e.$slots.options||e.selecting?s("div",{staticClass:"k-item-options"},[e._l(e.buttons,function(t,i){return s("k-button",e._b({key:"button-"+i},"k-button",t,!1))}),e.selecting?s("label",{staticClass:"k-item-options-checkbox",on:{click:function(t){t.stopPropagation()}}},[s("input",{ref:"selector",attrs:{type:"checkbox",disabled:!e.selectable},on:{change:function(t){return e.$emit("select",t)}}})]):e._t("options",function(){return[e.options?s("k-options-dropdown",{staticClass:"k-item-options-dropdown",attrs:{options:e.options},on:{option:e.onOption}}):e._e()]})],2):e._e()],2)},[]).exports,bt={install(t){t.component("k-collection",ht),t.component("k-empty",mt),t.component("k-item",kt),t.component("k-item-image",gt),t.component("k-items",dt)}};const yt=ut({},function(){return(0,this._self._c)("div",{staticClass:"k-dialog-body"},[this._t("default")],2)},[]).exports;function vt(t){if(void 0!==t)return structuredClone(t)}function $t(t){return"object"==typeof t&&(null==t?void 0:t.constructor)===Object}function wt(t){return Object.keys(t??{}).length}function xt(t){return Object.keys(t).reduce((e,s)=>(e[s.toLowerCase()]=t[s],e),{})}const _t={clone:vt,filter:function(t,e){return Object.fromEntries(Object.entries(t).filter(([t,s])=>e(s,t)))},isEmpty:function(t){return null==t||""===t||(!(!$t(t)||0!==wt(t))||0===t.length)},isObject:$t,length:wt,merge:function t(e,s={}){for(const i in s)s[i]instanceof Object&&Object.assign(s[i],t(e[i]??{},s[i]));return Object.assign(e??{},s),e},same:function(t,e){return JSON.stringify(t)===JSON.stringify(e)},toLowerKeys:xt},St={props:{cancelButton:{default:!0,type:[Boolean,String,Object]},disabled:{default:!1,type:Boolean},icon:{default:"check",type:String},submitButton:{type:[Boolean,String,Object],default:!0},theme:{default:"positive",type:String}}};const Ct=ut({mixins:[St],emits:["cancel"],computed:{cancel(){return this.button(this.cancelButton,{click:()=>this.$emit("cancel"),class:"k-dialog-button-cancel",icon:"cancel",text:this.$t("cancel"),variant:"filled"})},submit(){return this.button(this.submitButton,{class:"k-dialog-button-submit",disabled:this.disabled||this.$panel.dialog.isLoading,icon:this.$panel.dialog.isLoading?"loader":this.icon,text:this.$t("confirm"),theme:this.theme,type:"submit",variant:"filled"})}},methods:{button:(t,e)=>"string"==typeof t?{...e,text:t}:!1!==t&&(!1===$t(t)?e:{...e,...t})}},function(){var t=this,e=t._self._c;return e("k-button-group",{staticClass:"k-dialog-buttons"},[t.cancel?e("k-button",t._b({},"k-button",t.cancel,!1)):t._e(),t.submit?e("k-button",t._b({},"k-button",t.submit,!1)):t._e()],1)},[]).exports,Ot={props:{empty:{default:()=>window.panel.t("dialog.fields.empty"),type:String},fields:{default:()=>[],type:[Array,Object]},value:{default:()=>({}),type:Object}}};const At=ut({mixins:[Ot],emits:["input","submit"],computed:{hasFields(){return this.$helper.object.length(this.fields)>0}}},function(){var t=this,e=t._self._c;return t.hasFields?e("k-fieldset",{staticClass:"k-dialog-fields",attrs:{fields:t.fields,value:t.value},on:{input:function(e){return t.$emit("input",e)},submit:function(e){return t.$emit("submit",e)}}}):e("k-box",{attrs:{theme:"info"}},[t._v(t._s(t.empty))])},[]).exports;const Mt=ut({},function(){return(0,this._self._c)("footer",{staticClass:"k-dialog-footer"},[this._t("default")],2)},[]).exports;const Dt=ut({},function(){var t=this,e=t._self._c;return"dialog"===t.$panel.notification.context?e("k-notification",{staticClass:"k-dialog-notification"}):t._e()},[]).exports;const Et=ut({props:{autofocus:{default:!0,type:Boolean},placeholder:{type:String},value:{type:String}},emits:["search"],computed:{icon(){return this.value?"cancel-small":"search"}},methods:{onIconClick(){this.value?this.$emit("search",null):this.$refs.input.focus()}}},function(){var t=this,e=t._self._c;return e("k-input",{ref:"input",staticClass:"k-dialog-search",attrs:{autofocus:t.autofocus,placeholder:t.placeholder,value:t.value,type:"search"},on:{input:function(e){return t.$emit("search",e)}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("k-button",{attrs:{icon:t.icon,tabindex:"-1"},on:{click:t.onIconClick}})]},proxy:!0}])})},[]).exports,jt={props:{empty:{type:String,default:()=>window.panel.t("dialog.text.empty")},text:{type:String}}};const It=ut({mixins:[jt]},function(){var t=this,e=t._self._c;return t.text?e("k-text",{attrs:{html:t.text}}):e("k-box",{attrs:{theme:"info"}},[t._v(t._s(t.empty))])},[]).exports,Bt={install(t){t.component("k-dialog-body",yt),t.component("k-dialog-buttons",Ct),t.component("k-dialog-fields",At),t.component("k-dialog-footer",Mt),t.component("k-dialog-notification",Dt),t.component("k-dialog-search",Et),t.component("k-dialog-text",It)}},Lt={mixins:[St],props:{size:{default:"default",type:String},visible:{default:!1,type:Boolean}},emits:["cancel","close","input","submit","success"],methods:{cancel(){this.$emit("cancel")},close(){this.$emit("close")},error(t){this.$panel.notification.error(t)},focus(t){this.$panel.dialog.focus(t)},input(t){this.$emit("input",t)},open(){this.$panel.dialog.open(this)},submit(){this.$emit("submit",this.value)},success(t){this.$emit("success",t)}}};const Tt=ut({mixins:[Lt]},function(){var t=this,e=t._self._c;return t.visible?e("portal",{attrs:{to:"dialog"}},[e("form",{class:["k-dialog",t.$vnode.data.class,t.$vnode.data.staticClass,t.$attrs.class],attrs:{"data-size":t.size,method:"dialog"},on:{click:function(t){t.stopPropagation()},submit:function(e){return e.preventDefault(),t.$emit("submit")}}},[t._t("header",function(){return[e("k-dialog-notification")]}),t.$slots.default?e("k-dialog-body",[t._t("default")],2):t._e(),t._t("footer",function(){return[t.cancelButton||t.submitButton?e("k-dialog-footer",[e("k-dialog-buttons",{attrs:{"cancel-button":t.cancelButton,disabled:t.disabled,icon:t.icon,"submit-button":t.submitButton,theme:t.theme},on:{cancel:function(e){return t.$emit("cancel")}}})],1):t._e()]})],2)]):t._e()},[]).exports;const Pt=ut({mixins:[Lt],props:{cancelButton:{default:!1},files:{type:Array,default:()=>[]},pages:{type:Array,default:()=>[]},size:{default:"medium"},submitButton:{default:!1},users:{type:Array,default:()=>[]}}},function(){var t=this,e=t._self._c;return e("k-dialog",t._b({staticClass:"k-changes-dialog"},"k-dialog",t.$props,!1),[t.pages.length?e("section",[e("k-headline",[t._v(t._s(t.$t("lock.unsaved.pages")))]),e("k-items",{attrs:{items:t.pages,layout:"list"}})],1):t._e(),t.files.length?e("section",[e("k-headline",[t._v(t._s(t.$t("lock.unsaved.files")))]),e("k-items",{attrs:{items:t.files,layout:"list"}})],1):t._e(),t.users.length?e("section",[e("k-headline",[t._v(t._s(t.$t("lock.unsaved.users")))]),e("k-items",{attrs:{items:t.users,layout:"list"}})],1):t._e(),t.pages.length||t.files.length||t.users.length?t._e():e("section",[e("k-headline",[t._v(t._s(t.$t("lock.unsaved")))]),e("k-empty",{attrs:{icon:"edit-line"}},[t._v(t._s(t.$t("lock.unsaved.empty")))])],1)])},[]).exports;const qt=ut({mixins:[Lt,Ot],props:{fields:{default:()=>({href:{label:window.panel.t("email"),type:"email",icon:"email"},title:{label:window.panel.t("title"),type:"text",icon:"title"}})},size:{default:"medium"},submitButton:{default:()=>window.panel.t("insert")}},data(){return{values:{href:"",title:null,...this.value}}},methods:{submit(){this.$emit("submit",this.values)}}},function(){var t=this;return(0,t._self._c)("k-form-dialog",t._b({attrs:{value:t.values},on:{cancel:function(e){return t.$emit("cancel")},input:function(e){t.values=e},submit:t.submit}},"k-form-dialog",t.$props,!1))},[]).exports;const Nt=ut({mixins:[Lt],props:{details:[Object,Array],message:String,size:{default:"medium",type:String}},emits:["cancel"],computed:{detailsList(){return this.$helper.array.fromObject(this.details)}}},function(){var t=this,e=t._self._c;return e("k-dialog",{ref:"dialog",staticClass:"k-error-dialog",attrs:{"cancel-button":!1,"submit-button":!1,size:t.size,visible:t.visible},on:{cancel:function(e){return t.$emit("cancel")}}},[e("k-text",[t._v(t._s(t.message))]),t.detailsList.length?e("dl",{staticClass:"k-error-details"},[t._l(t.detailsList,function(s,i){return[e("dt",{key:"detail-label-"+i},[t._v(" "+t._s(s.label)+" ")]),e("dd",{key:"detail-message-"+i},["object"==typeof s.message?[e("ul",t._l(s.message,function(s,i){return e("li",{key:i},[t._v(" "+t._s(s)+" ")])}),0)]:[t._v(" "+t._s(s.message)+" ")]],2)]})],2):t._e()],1)},[]).exports;const Ft=ut({},function(){var t=this;return(0,t._self._c)(t.$panel.dialog.component,t._g(t._b({key:t.$panel.dialog.timestamp,tag:"component",attrs:{visible:!0}},"component",t.$panel.dialog.props,!1),t.$panel.dialog.listeners()))},[]).exports,zt=(t,e,s={leading:!1,trailing:!0})=>{let i=null,n=null;return!1===s.leading&&!1===s.trailing?()=>null:function(...o){!i&&s.leading?t.apply(this,o):n=o,clearTimeout(i),i=setTimeout(()=>{s.trailing&&n&&t.apply(this,n),i=null,n=null},e)}},Yt={props:{delay:{default:200,type:Number},hasSearch:{default:!0,type:Boolean}},data:()=>({query:""}),watch:{query(){!1!==this.hasSearch&&this.search()}},created(){this.search=zt(this.search,this.delay)},methods:{async search(){console.warn("Search mixin: Please implement a `search` method.")}}},Rt={props:{endpoint:String,empty:Object,fetchParams:Object,item:{type:Function,default:t=>t},max:Number,multiple:{type:Boolean,default:!0},size:{type:String,default:"medium"},value:{type:Array,default:()=>[]}}};const Ht=ut({mixins:[Lt,Yt,Rt],emits:["cancel","fetched","submit"],data(){return{models:[],selected:this.value.reduce((t,e)=>({...t,[e]:{id:e}}),{}),pagination:{limit:20,page:1,total:0}}},computed:{items(){return this.models.map(this.item)}},watch:{fetchParams(t,e){!1===this.$helper.object.same(t,e)&&(this.pagination.page=1,this.fetch())}},mounted(){this.fetch()},methods:{async fetch(){const t={page:this.pagination.page,search:this.query,...this.fetchParams};try{this.$panel.dialog.isLoading=!0;const e=await this.$api.get(this.endpoint,t);this.models=e.data,this.pagination=e.pagination,this.$emit("fetched",e)}catch(e){this.$panel.error(e),this.models=[]}finally{this.$panel.dialog.isLoading=!1}},isSelected(t){return void 0!==this.selected[t.id]},paginate(t){this.pagination.page=t.page,this.pagination.limit=t.limit,this.fetch()},submit(){this.$emit("submit",Object.values(this.selected))},async search(){this.pagination.page=0,await this.fetch()},toggle(t){if(!1!==this.multiple&&1!==this.max||(this.selected={}),this.isSelected(t))return i(this.selected,t.id);this.max&&this.max<=this.$helper.object.length(this.selected)||n(this.selected,t.id,t)}}},function(){var t=this,e=t._self._c;return e("k-dialog",t._b({staticClass:"k-models-dialog",on:{cancel:function(e){return t.$emit("cancel")},submit:t.submit}},"k-dialog",t.$props,!1),[t._t("header"),t.hasSearch?e("k-dialog-search",{attrs:{value:t.query},on:{search:function(e){t.query=e}}}):t._e(),e("k-collection",{attrs:{empty:{...t.empty,text:t.$panel.dialog.isLoading?t.$t("loading"):t.empty.text},items:t.items,link:!1,pagination:{details:!0,dropdown:!1,align:"center",...t.pagination},sortable:!1,layout:"list"},on:{item:t.toggle,paginate:t.paginate},scopedSlots:t._u([{key:"options",fn:function({item:s}){return[e("k-choice-input",{attrs:{checked:t.isSelected(s),type:t.multiple&&1!==t.max?"checkbox":"radio",title:t.isSelected(s)?t.$t("remove"):t.$t("select")},on:{click:function(e){return e.stopPropagation(),t.toggle(s)}}}),t._t("options",null,null,{item:s})]}}],null,!0)})],2)},[]).exports;const Ut=ut({mixins:[Lt,Rt],props:{empty:{type:Object,default:()=>({icon:"image",text:window.panel.t("dialog.files.empty")})}}},function(){var t=this;return(0,t._self._c)("k-models-dialog",t._b({on:{cancel:function(e){return t.$emit("cancel")},submit:function(e){return t.$emit("submit",e)}}},"k-models-dialog",t.$props,!1))},[]).exports;const Vt=ut({mixins:[Lt,Ot],props:{size:{default:"medium"},submitButton:{default:()=>window.panel.t("save")},text:{type:String}},emits:["cancel","input","submit"]},function(){var t=this,e=t._self._c;return e("k-dialog",t._b({ref:"dialog",on:{cancel:function(e){return t.$emit("cancel")},submit:function(e){return t.$emit("submit",t.value)}}},"k-dialog",t.$props,!1),[t._t("default",function(){return[t.text?e("k-dialog-text",{attrs:{text:t.text}}):t._e(),e("k-dialog-fields",{attrs:{fields:t.fields,value:t.value},on:{input:function(e){return t.$emit("input",e)},submit:function(e){return t.$emit("submit",e)}}})]})],2)},[]).exports;const Kt=ut({extends:Vt,watch:{"value.name"(t){this.fields.code.disabled||this.onNameChanges(t)},"value.code"(t){this.fields.code.disabled||(this.value.code=this.$helper.slug(t,[this.$panel.system.ascii]),this.onCodeChanges(this.value.code))}},methods:{onCodeChanges(t){if(!t)return this.value.locale=null;if(t.length>=2)if(-1!==t.indexOf("-")){let e=t.split("-"),s=[e[0],e[1].toUpperCase()];this.value.locale=s.join("_")}else{let e=this.$panel.system.locales??[];this.value.locale=null==e?void 0:e[t]}},onNameChanges(t){this.value.code=this.$helper.slug(t,[this.value.rules,this.$panel.system.ascii]).substr(0,2)}}},null,null).exports;const Wt=ut({mixins:[{mixins:[Lt],props:{license:Object,size:{default:"large"}}}]},function(){var t=this,e=t._self._c;return e("k-dialog",t._b({ref:"dialog",staticClass:"k-license-dialog",on:{cancel:function(e){return t.$emit("cancel")},submit:function(e){return t.$emit("submit")}}},"k-dialog",t.$props,!1),[e("k-bar",{staticStyle:{"margin-bottom":"var(--spacing-2)"}},[e("h2",{staticClass:"k-headline"},[t._v(" "+t._s(t.$t("license"))+" ")]),e("k-button",{attrs:{text:t.$t("remove"),icon:"trash",size:"xs",variant:"filled",dialog:"license/remove"}})],1),e("div",{staticClass:"k-table"},[e("table",{staticStyle:{"table-layout":"auto"}},[e("tbody",[e("tr",[e("th",{attrs:{"data-mobile":"true"}},[t._v(t._s(t.$t("type")))]),e("td",{attrs:{"data-mobile":"true"}},[t._v(t._s(t.license.type))])]),t.license.code?e("tr",[e("th",{attrs:{"data-mobile":"true"}},[t._v(t._s(t.$t("license.code")))]),e("td",{staticClass:"k-text",attrs:{"data-mobile":"true"}},[e("code",[t._v(t._s(t.license.code))])])]):t._e(),t.license.info?e("tr",[e("th",{attrs:{"data-mobile":"true"}},[t._v(t._s(t.$t("status")))]),e("td",{attrs:{"data-mobile":"true","data-theme":t.license.theme}},[e("p",{staticClass:"k-license-dialog-status"},[e("k-icon",{attrs:{type:t.license.icon}}),t._v(" "+t._s(t.license.info)+" ")],1)])]):t._e()])])])],1)},[]).exports;const Jt=ut({mixins:[{mixins:[Lt],props:{cancelButton:null,submitButton:null,lock:Object,preview:String}}]},function(){var t=this,e=t._self._c;return e("k-dialog",t._b({ref:"dialog",staticClass:"k-lock-alert-dialog",attrs:{"cancel-button":!1,"submit-button":{theme:"passive"}},on:{cancel:function(e){return t.$emit("cancel")},submit:function(e){return t.$emit("submit")}}},"k-dialog",t.$props,!1),[e("k-dialog-text",{attrs:{text:t.$t("form.locked")}}),e("dl",[e("div",[e("dt",[e("k-icon",{attrs:{type:"user"}})],1),e("dd",[t._v(t._s(t.lock.user.email))])]),e("div",[e("dt",[e("k-icon",{attrs:{type:"clock"}})],1),e("dd",[t._v(" "+t._s(t.$library.dayjs(t.lock.modified).format("YYYY-MM-DD HH:mm:ss"))+" ")])])])],1)},[]).exports;const Gt=ut({mixins:[Lt,Ot],props:{fields:{default:()=>({href:{label:window.panel.t("link"),type:"link",placeholder:window.panel.t("url.placeholder"),icon:"url"},title:{label:window.panel.t("title"),type:"text",icon:"title"},target:{label:window.panel.t("open.newWindow"),type:"toggle",text:[window.panel.t("no"),window.panel.t("yes")]}})},size:{default:"medium"},submitButton:{default:()=>window.panel.t("insert")}},data(){return{values:{href:"",title:null,...this.value,target:Boolean(this.value.target??!1)}}},methods:{submit(){let t="/@/$1/";this.values.href.startsWith("page://")&&window.panel.language.code&&!1===window.panel.language.default&&(t="/"+window.panel.language.code+t);const e=this.values.href.replace(/(file|page):\/\//,t);this.$emit("submit",{...this.values,href:e,target:this.values.target?"_blank":null})}}},function(){var t=this;return(0,t._self._c)("k-form-dialog",t._b({attrs:{value:t.values},on:{cancel:function(e){return t.$emit("cancel")},input:function(e){t.values=e},submit:t.submit}},"k-form-dialog",t.$props,!1))},[]).exports;const Xt=ut({mixins:[Vt],props:{blueprints:{type:Array},size:{default:"medium",type:String},submitButton:{type:[String,Boolean],default:()=>window.panel.t("save")},template:{type:String}},computed:{templates(){return this.blueprints.map(t=>({text:t.title,value:t.name}))}},methods:{pick(t){this.$panel.dialog.reload({query:{...this.$panel.dialog.query,slug:this.value.slug,template:t,title:this.value.title}})}}},function(){var t=this,e=t._self._c;return e("k-form-dialog",t._b({ref:"dialog",staticClass:"k-page-create-dialog",on:{cancel:function(e){return t.$emit("cancel")},submit:function(e){return t.$emit("submit",t.value)}}},"k-form-dialog",t.$props,!1),[t.templates.length>1?e("k-select-field",{staticClass:"k-page-template-switch",attrs:{empty:!1,label:t.$t("template"),options:t.templates,required:!0,value:t.template},on:{input:function(e){return t.pick(e)}}}):t._e(),e("k-dialog-fields",{attrs:{fields:t.fields,value:t.value},on:{input:function(e){return t.$emit("input",e)},submit:function(e){return t.$emit("submit",e)}}})],1)},[]).exports;const Zt=ut({mixins:[Lt],props:{value:{default:()=>({}),type:Object}},emits:["cancel","input","submit"],methods:{select(t){this.$emit("input",{...this.value,parent:t.value})}}},function(){var t=this,e=t._self._c;return e("k-dialog",t._b({ref:"dialog",staticClass:"k-page-move-dialog",attrs:{"submit-button":{icon:"parent",text:t.$t("move")},size:"medium"},on:{cancel:function(e){return t.$emit("cancel")},submit:function(e){return t.$emit("submit",t.value)}}},"k-dialog",t.$props,!1),[e("k-headline",[t._v(t._s(t.$t("page.move")))]),e("div",{staticClass:"k-page-move-parent",attrs:{tabindex:"0","data-autofocus":""}},[e("k-page-tree",{attrs:{current:t.value.parent,move:t.value.move,identifier:"id"},on:{select:t.select}})],1)],1)},[]).exports;const Qt=ut({mixins:[Lt,Rt],props:{empty:{type:Object,default:()=>({icon:"page",text:window.panel.t("dialog.pages.empty")})}},data:()=>({model:null,parent:null})},function(){var t=this,e=t._self._c;return e("k-models-dialog",t._b({attrs:{"fetch-params":{parent:t.parent}},on:{cancel:function(e){return t.$emit("cancel")},fetched:function(e){t.model=e.model},submit:function(e){return t.$emit("submit",e)}},scopedSlots:t._u([t.model?{key:"header",fn:function(){return[e("header",{staticClass:"k-pages-dialog-navbar"},[e("k-button",{attrs:{disabled:!t.model.id,title:t.$t("back"),icon:"angle-left"},on:{click:function(e){t.parent=t.model.parent}}}),e("k-headline",[t._v(t._s(t.model.title))])],1)]},proxy:!0}:null,t.model?{key:"options",fn:function({item:s}){return[e("k-button",{staticClass:"k-pages-dialog-option",attrs:{disabled:!s.hasChildren,title:t.$t("open"),icon:"angle-right"},on:{click:function(e){e.stopPropagation(),t.parent=s.id}}})]}}:null],null,!0)},"k-models-dialog",t.$props,!1))},[]).exports;const te=ut({mixins:[{mixins:[Lt,jt]}]},function(){var t=this,e=t._self._c;return e("k-dialog",t._b({ref:"dialog",on:{cancel:function(e){return t.$emit("cancel")},submit:function(e){return t.$emit("submit")}}},"k-dialog",t.$props,!1),[t._t("default",function(){return[e("k-dialog-text",{attrs:{text:t.text}})]})],2)},[]).exports;const ee=ut({mixins:[te],props:{icon:{default:"trash"},submitButton:{default:()=>window.panel.t("delete")},theme:{default:"negative"}}},function(){var t=this;return(0,t._self._c)("k-text-dialog",t._b({ref:"dialog",on:{cancel:function(e){return t.$emit("cancel")},submit:function(e){return t.$emit("submit")}}},"k-text-dialog",t.$props,!1),[t._t("default")],2)},[]).exports;const se=ut({mixins:[Lt],props:{type:String},emits:["cancel"],data:()=>({results:null,pagination:{}}),methods:{focus(){var t;null==(t=this.$refs.search)||t.focus()},navigate(t){t&&(this.$go(t.link),this.close())},async search({type:t,query:e}){const s=await this.$panel.search(t,e);s&&(this.results=s.results,this.pagination=s.pagination)}}},function(){var t=this,e=t._self._c;return e("k-dialog",{staticClass:"k-search-dialog",attrs:{"cancel-button":!1,"submit-button":!1,visible:!0,role:"search",size:"medium"},on:{cancel:function(e){return t.$emit("cancel")},submit:t.submit}},[e("k-search-bar",{ref:"search",attrs:{"default-type":t.type??t.$panel.view.search,"is-loading":t.$panel.searcher.isLoading,pagination:t.pagination,results:t.results,types:t.$panel.searches},on:{close:t.close,more:function(e){return t.$go("search",{query:e})},navigate:t.navigate,search:t.search}})],1)},[]).exports;const ie=ut({mixins:[{mixins:[Lt,Ot]}],props:{fields:null,qr:{type:String,required:!0},size:{default:"large"},submitButton:{default:()=>({text:window.panel.t("activate"),icon:"lock",theme:"notice"})}},emits:["cancel","input","submit"]},function(){var t=this,e=t._self._c;return e("k-dialog",t._b({ref:"dialog",on:{cancel:function(e){return t.$emit("cancel")},submit:function(e){return t.$emit("submit")}}},"k-dialog",t.$props,!1),[e("k-dialog-text",{staticClass:"k-totp-dialog-intro",attrs:{text:t.$t("login.totp.enable.intro")}}),e("div",{staticClass:"k-totp-dialog-grid"},[e("div",{staticClass:"k-totp-qrcode"},[e("k-info-field",{attrs:{label:t.$t("login.totp.enable.qr.label"),text:t.qr,help:t.$t("login.totp.enable.qr.help",{secret:t.value.secret}),theme:"passive"}})],1),e("k-dialog-fields",{staticClass:"k-totp-dialog-fields",attrs:{fields:{info:{label:t.$t("login.totp.enable.confirm.headline"),type:"info",text:t.$t("login.totp.enable.confirm.text"),theme:"none"},confirm:{label:t.$t("login.totp.enable.confirm.label"),type:"text",counter:!1,font:"monospace",required:!0,placeholder:t.$t("login.code.placeholder.totp"),help:t.$t("login.totp.enable.confirm.help")},secret:{type:"hidden"}},value:t.value},on:{input:function(e){return t.$emit("input",e)},submit:function(e){return t.$emit("submit",e)}}})],1)],1)},[]).exports;const ne=ut({mixins:[Lt],props:{submitButton:{type:[String,Boolean,Object],default:()=>({icon:"upload",text:window.panel.t("upload")})}}},function(){var t=this,e=t._self._c;return e("k-dialog",t._b({ref:"dialog",staticClass:"k-upload-dialog",attrs:{disabled:t.disabled||0===t.$panel.upload.files.length},on:{cancel:function(e){return t.$emit("cancel")},submit:function(e){return t.$emit("submit")}}},"k-dialog",t.$props,!1),[e("k-dropzone",{on:{drop:function(e){return t.$panel.upload.select(e)}}},[0===t.$panel.upload.files.length?e("k-empty",{attrs:{icon:"upload",layout:"cards"},on:{click:function(e){return t.$panel.upload.pick()}}},[t._v(" "+t._s(t.$t("files.empty"))+" ")]):e("k-upload-items",{attrs:{items:t.$panel.upload.files},on:{remove:e=>{t.$panel.upload.remove(e.id)},rename:(t,e)=>{t.name=e}}})],1)],1)},[]).exports;const oe=ut({extends:ne,props:{original:Object,submitButton:{type:[String,Boolean,Object],default:()=>({icon:"upload",text:window.panel.t("replace")})}},computed:{file(){return this.$panel.upload.files[0]}}},function(){var t,e,s,i,n=this,o=n._self._c;return o("k-dialog",n._b({ref:"dialog",staticClass:"k-upload-dialog k-upload-replace-dialog",on:{cancel:function(t){return n.$emit("cancel")},submit:function(t){return n.$emit("submit")}}},"k-dialog",n.$props,!1),[o("ul",{staticClass:"k-upload-items"},[o("li",{staticClass:"k-upload-original"},[o("k-upload-item-preview",{attrs:{color:null==(t=n.original.image)?void 0:t.color,icon:null==(e=n.original.image)?void 0:e.icon,url:n.original.url,type:n.original.mime}})],1),o("li",[n._v("←")]),o("k-upload-item",n._b({attrs:{color:null==(s=n.original.image)?void 0:s.color,editable:!1,icon:null==(i=n.original.image)?void 0:i.icon,name:n.$helper.file.name(n.original.filename),removable:!1}},"k-upload-item",n.file,!1))],1)])},[]).exports;const re=ut({mixins:[Lt,Rt],props:{empty:{type:Object,default:()=>({icon:"users",text:window.panel.t("dialog.users.empty")})},item:{type:Function,default:t=>({...t,key:t.email,info:t.info!==t.text?t.info:null})}}},function(){var t=this;return(0,t._self._c)("k-models-dialog",t._b({on:{cancel:function(e){return t.$emit("cancel")},submit:function(e){return t.$emit("submit",e)}}},"k-models-dialog",t.$props,!1))},[]).exports,ae={install(t){t.use(Bt),t.component("k-dialog",Tt),t.component("k-changes-dialog",Pt),t.component("k-email-dialog",qt),t.component("k-error-dialog",Nt),t.component("k-fiber-dialog",Ft),t.component("k-files-dialog",Ut),t.component("k-form-dialog",Vt),t.component("k-license-dialog",Wt),t.component("k-link-dialog",Gt),t.component("k-lock-alert-dialog",Jt),t.component("k-language-dialog",Kt),t.component("k-models-dialog",Ht),t.component("k-page-create-dialog",Xt),t.component("k-page-move-dialog",Zt),t.component("k-pages-dialog",Qt),t.component("k-remove-dialog",ee),t.component("k-search-dialog",se),t.component("k-text-dialog",te),t.component("k-totp-dialog",ie),t.component("k-upload-dialog",ne),t.component("k-upload-replace-dialog",oe),t.component("k-users-dialog",re)}};const le=ut({},function(){return(0,this._self._c)("div",{staticClass:"k-drawer-body scroll-y-auto"},[this._t("default")],2)},[]).exports,ce={props:{disabled:Boolean,empty:{type:String,default:()=>window.panel.t("drawer.fields.empty")},fields:Object,value:Object}};const ue=ut({mixins:[ce],emits:["input","submit"],computed:{hasFields(){return this.$helper.object.length(this.fields)>0}}},function(){var t=this,e=t._self._c;return t.hasFields?e("k-fieldset",{staticClass:"k-drawer-fields",attrs:{disabled:t.disabled,fields:t.fields,value:t.value},on:{input:function(e){return t.$emit("input",e)},submit:function(e){return t.$emit("submit",e)}}}):e("k-box",{attrs:{theme:"info"}},[t._v(t._s(t.empty))])},[]).exports,pe={props:{breadcrumb:{default:()=>[],type:Array},tab:{type:String},tabs:{default:()=>({}),type:Object}}};const de=ut({mixins:[pe],emits:["crumb","tab"]},function(){var t=this,e=t._self._c;return e("header",{staticClass:"k-drawer-header"},[e("nav",{staticClass:"k-breadcrumb k-drawer-breadcrumb"},[e("ol",t._l(t.breadcrumb,function(s,i){return e("li",{key:s.id},[e("k-button",{staticClass:"k-breadcrumb-link",attrs:{icon:s.props.icon,text:s.props.title,current:i===t.breadcrumb.length-1,variant:"dimmed"},on:{click:function(e){return t.$emit("crumb",s.id)}}})],1)}),0)]),e("k-drawer-tabs",{attrs:{tab:t.tab,tabs:t.tabs},on:{open:function(e){return t.$emit("tab",e)}}}),e("nav",{staticClass:"k-drawer-options"},[t._t("default"),e("k-button",{staticClass:"k-drawer-option",attrs:{icon:"check",type:"submit"}})],2)],1)},[]).exports;const he=ut({},function(){var t=this,e=t._self._c;return"drawer"===t.$panel.notification.context?e("k-notification",{staticClass:"k-drawer-notification"}):t._e()},[]).exports;const me=ut({mixins:[{props:{tab:{type:String},tabs:{default:()=>({}),type:[Array,Object]}}}],emits:["open"],computed:{hasTabs(){return this.$helper.object.length(this.tabs)>1},tabsWithClickHandler(){let t=this.tabs;return!1===Array.isArray(t)&&(t=Object.values(t)),t.map(t=>({...t,click:()=>this.$emit("open",t.name)}))}}},function(){var t=this,e=t._self._c;return t.hasTabs?e("k-tabs",{staticClass:"k-drawer-tabs",attrs:{tab:t.tab,tabs:t.tabsWithClickHandler}}):t._e()},[]).exports,fe={props:{empty:{type:String,default:()=>window.panel.t("drawer.text.empty")},text:{type:String}}};const ge=ut({mixins:[fe]},function(){var t=this,e=t._self._c;return t.text?e("k-text",{attrs:{html:t.text}}):e("k-box",{attrs:{theme:"info"}},[t._v(t._s(t.empty))])},[]).exports,ke={install(t){t.component("k-drawer-body",le),t.component("k-drawer-fields",ue),t.component("k-drawer-header",de),t.component("k-drawer-notification",he),t.component("k-drawer-tabs",me),t.component("k-drawer-text",ge)}},be={mixins:[pe],props:{current:{default:!0,type:Boolean},icon:String,id:String,options:{type:Array},title:String,visible:{default:!1,type:Boolean}}};const ye=ut({mixins:[be],emits:["cancel","crumb","submit","tab"]},function(){var t=this,e=t._self._c;return t.visible?e("portal",{attrs:{to:"drawer"}},[e("form",{staticClass:"k-drawer",class:t.$vnode.data.staticClass,attrs:{"aria-current":t.current,method:"dialog"},on:{submit:function(e){return e.preventDefault(),t.$emit("submit")}}},[e("k-drawer-notification"),e("k-drawer-header",{attrs:{breadcrumb:t.breadcrumb,tab:t.tab,tabs:t.tabs},on:{crumb:function(e){return t.$emit("crumb",e)},tab:function(e){return t.$emit("tab",e)}}},[t._t("options",function(){return[t._l(t.options,function(s,i){return[s.dropdown?[e("k-button",t._b({key:"btn-"+i,staticClass:"k-drawer-option",on:{click:function(e){t.$refs["dropdown-"+i][0].toggle()}}},"k-button",s,!1)),e("k-dropdown-content",{key:"dropdown-"+i,ref:"dropdown-"+i,refInFor:!0,attrs:{options:s.dropdown,"align-x":"end",theme:"light"}})]:e("k-button",t._b({key:i,staticClass:"k-drawer-option"},"k-button",s,!1))]})]})],2),e("k-drawer-body",[t._t("default")],2)],1)]):t._e()},[]).exports,ve={props:{hidden:{type:Boolean},next:{type:Object},prev:{type:Object}}};const $e=ut({mixins:[be,ce,ve],emits:["cancel","crumb","input","next","prev","remove","show","submit","tab"]},function(){var t=this,e=t._self._c;return e("k-form-drawer",t._b({ref:"drawer",staticClass:"k-block-drawer",on:{cancel:function(e){return t.$emit("cancel",e)},crumb:function(e){return t.$emit("crumb",e)},input:function(e){return t.$emit("input",e)},submit:function(e){return t.$emit("submit",e)},tab:function(e){return t.$emit("tab",e)}},scopedSlots:t._u([{key:"options",fn:function(){return[t.hidden?e("k-button",{staticClass:"k-drawer-option",attrs:{icon:"hidden"},on:{click:function(e){return t.$emit("show")}}}):t._e(),e("k-button",{staticClass:"k-drawer-option",attrs:{disabled:!t.prev,icon:"angle-left"},on:{click:function(e){return t.$emit("prev")}}}),e("k-button",{staticClass:"k-drawer-option",attrs:{disabled:!t.next,icon:"angle-right"},on:{click:function(e){return t.$emit("next")}}}),e("k-button",{staticClass:"k-drawer-option",attrs:{icon:"trash"},on:{click:function(e){return t.$emit("remove")}}})]},proxy:!0}])},"k-form-drawer",t.$props,!1))},[]).exports;const we=ut({methods:{isCurrent(t){return this.$panel.drawer.id===t}}},function(){var t=this,e=t._self._c;return e("div",t._l(t.$panel.drawer.history.milestones,function(s){return e(s.component,t._g(t._b({key:s.id,tag:"component",attrs:{breadcrumb:t.$panel.drawer.breadcrumb,current:!0===t.isCurrent(s.id),visible:!0}},"component",t.isCurrent(s.id)?t.$panel.drawer.props:s.props,!1),t.isCurrent(s.id)?t.$panel.drawer.listeners():s.on))}),1)},[]).exports;const xe=ut({mixins:[be,ce],emits:["cancel","crumb","input","submit","tab"]},function(){var t=this,e=t._self._c;return e("k-drawer",t._b({ref:"drawer",staticClass:"k-form-drawer",on:{cancel:function(e){return t.$emit("cancel")},crumb:function(e){return t.$emit("crumb",e)},submit:function(e){return t.$emit("submit",t.value)},tab:function(e){return t.$emit("tab",e)}},scopedSlots:t._u([{key:"options",fn:function(){return[t._t("options")]},proxy:!0}],null,!0)},"k-drawer",t.$props,!1),[e("k-drawer-fields",{attrs:{disabled:t.disabled,fields:t.fields,value:t.value},on:{input:function(e){return t.$emit("input",e)},submit:function(e){return t.$emit("submit",e)}}})],1)},[]).exports;const _e=ut({mixins:[be,ce,{props:{next:{type:Object},prev:{type:Object}}}],emits:["cancel","crumb","input","next","prev","remove","submit","tab"]},function(){var t=this,e=t._self._c;return e("k-form-drawer",t._b({ref:"drawer",staticClass:"k-structure-drawer",on:{cancel:function(e){return t.$emit("cancel",e)},crumb:function(e){return t.$emit("crumb",e)},input:function(e){return t.$emit("input",e)},submit:function(e){return t.$emit("submit",e)},tab:function(e){return t.$emit("tab",e)}},scopedSlots:t._u([t.disabled?null:{key:"options",fn:function(){return[e("k-button",{staticClass:"k-drawer-option",attrs:{disabled:!t.prev,icon:"angle-left"},on:{click:function(e){return t.$emit("prev")}}}),e("k-button",{staticClass:"k-drawer-option",attrs:{disabled:!t.next,icon:"angle-right"},on:{click:function(e){return t.$emit("next")}}}),e("k-button",{staticClass:"k-drawer-option",attrs:{icon:"trash"},on:{click:function(e){return t.$emit("remove")}}})]},proxy:!0}],null,!0)},"k-form-drawer",t.$props,!1))},[]).exports;const Se=ut({mixins:[be,fe],emits:["cancel","crumb","input","submit","tab"]},function(){var t=this,e=t._self._c;return e("k-drawer",t._b({ref:"drawer",staticClass:"k-text-drawer",on:{cancel:function(e){return t.$emit("cancel")},crumb:function(e){return t.$emit("crumb",e)},submit:function(e){return t.$emit("submit",t.value)},tab:function(e){return t.$emit("tab",e)}},scopedSlots:t._u([{key:"options",fn:function(){return[t._t("options")]},proxy:!0}],null,!0)},"k-drawer",t.$props,!1),[e("k-dialog-text",{attrs:{text:t.text}})],1)},[]).exports,Ce={install(t){t.use(ke),t.component("k-drawer",ye),t.component("k-block-drawer",$e),t.component("k-fiber-drawer",we),t.component("k-form-drawer",xe),t.component("k-structure-drawer",_e),t.component("k-text-drawer",Se)}};let Oe=null;const Ae=ut({props:{align:{type:String},alignX:{type:String,default:"start"},alignY:{type:String,default:"bottom"},disabled:{type:Boolean,default:!1},navigate:{default:!0,type:Boolean},options:[Array,Function,String],theme:{type:String,default:"dark"}},emits:["action","close","open"],data(){return{axis:{x:this.alignX,y:this.alignY},position:{x:0,y:0},isOpen:!1,items:[],opener:null}},mounted(){this.align&&window.panel.deprecated("<k-dropdown-content>: `align` prop will be removed in a future version. Use the `alignX` prop instead.")},methods:{close(){var t;null==(t=this.$refs.dropdown)||t.close()},async fetchOptions(t){return this.options?"string"==typeof this.options?this.$dropdown(this.options)(t):"function"==typeof this.options?this.options(t):Array.isArray(this.options)?t(this.options):void 0:t(this.items)},focus(t=0){this.$refs.navigate.focus(t)},onClick(){this.close()},onClose(){this.resetPosition(),this.isOpen=Oe=!1,this.$emit("close"),window.removeEventListener("resize",this.setPosition)},async onOpen(){this.isOpen=!0;const t=window.scrollY;Oe=this,await this.$nextTick(),this.$el&&this.opener&&(window.addEventListener("resize",this.setPosition),await this.setPosition(),window.scrollTo(0,t),this.$emit("open"))},onOptionClick(t){return this.close(),"function"==typeof t.click?t.click.call(this):"string"==typeof t.click?this.$emit("action",t.click):void(t.click&&(t.click.name&&this.$emit(t.click.name,t.click.payload),t.click.global&&this.$events.emit(t.click.global,t.click.payload)))},open(t){var e,s;if(!0===this.disabled)return!1;Oe&&Oe!==this&&Oe.close(),this.opener=t??(null==(e=window.event)?void 0:e.target.closest("button"))??(null==(s=window.event)?void 0:s.target),this.fetchOptions(t=>{this.items=t,this.onOpen()})},async setPosition(){this.axis={x:this.alignX??this.align,y:this.alignY},"right"===this.axis.x?this.axis.x="end":"left"===this.axis.x&&(this.axis.x="start"),"rtl"===this.$panel.direction&&("start"===this.axis.x?this.axis.x="end":"end"===this.axis.x&&(this.axis.x="start")),this.opener.$el&&(this.opener=this.opener.$el);const t=this.opener.getBoundingClientRect();this.position.x=t.left+window.scrollX+t.width,this.position.y=t.top+window.scrollY+t.height,!0!==this.$el.open&&this.$el.showModal(),await this.$nextTick();const e=this.$el.getBoundingClientRect(),s=10;"end"===this.axis.x?t.left-e.width<s&&(this.axis.x="start"):t.left+e.width>window.innerWidth-s&&e.width+s<e.left&&(this.axis.x="end"),"start"===this.axis.x&&(this.position.x=this.position.x-t.width),"top"===this.axis.y?e.height+s>e.top&&(this.axis.y="bottom"):t.top+e.height>window.innerHeight-s&&e.height+s<e.top&&(this.axis.y="top"),"top"===this.axis.y&&(this.position.y=this.position.y-t.height)},resetPosition(){this.position={x:0,y:0}},toggle(t){this.isOpen?this.close():this.open(t)}}},function(){var t=this,e=t._self._c;return t.isOpen?e("dialog",{ref:"dropdown",staticClass:"k-dropdown-content",style:{top:t.position.y+"px",left:t.position.x+"px"},attrs:{"data-align-x":t.axis.x,"data-align-y":t.axis.y,"data-theme":t.theme},on:{close:t.onClose,click:t.onClick}},[e("k-navigate",{ref:"navigate",attrs:{disabled:!1===t.navigate,axis:"y"}},[t._t("default",function(){return[t._l(t.items,function(s,i){return["-"===s?e("hr",{key:"separator-"+i}):s.when??1?t._t("item",function(){return[e("k-dropdown-item",t._b({key:"item-"+i,on:{click:function(e){return t.onOptionClick(s)}}},"k-dropdown-item",s,!1),[t._v(" "+t._s(s.label??s.text)+" ")])]},null,{item:s,index:i}):t._e()]})]},null,{items:t.items})],2)],1):t._e()},[]).exports;const Me=ut({inheritAttrs:!1,props:{current:[Boolean,String],disabled:Boolean,download:Boolean,icon:String,link:String,target:String},emit:["click"],methods:{focus(){this.$refs.button.focus()},onClick(t){this.$emit("click",t)},tab(){this.$refs.button.tab()}}},function(){var t=this;return(0,t._self._c)("k-button",t._b({ref:"button",class:["k-dropdown-item",t.$attrs.class],style:t.$attrs.style,on:{click:t.onClick}},"k-button",t.$props,!1),[t._t("default")],2)},[]).exports;const De=ut({props:{align:{type:String,default:"right"},disabled:{type:Boolean},icon:{type:String,default:"dots"},options:{type:[Array,Function,String],default:()=>[]},text:{type:[Boolean,String],default:!0},theme:{type:String,default:"dark"},size:String,variant:String},emits:["action","option"],computed:{hasSingleOption(){return Array.isArray(this.options)&&1===this.options.length}},methods:{onAction(t,e,s){"function"==typeof t?t.call(this):(this.$emit("action",t,e,s),this.$emit("option",t,e,s))},toggle(t=this.$el){this.$refs.options.toggle(t)}}},function(){var t=this,e=t._self._c;return t.hasSingleOption?e("k-button",{staticClass:"k-options-dropdown-toggle",attrs:{disabled:t.disabled,icon:t.options[0].icon??t.icon,size:t.options[0].size??t.size,title:t.options[0].title??t.options[0].tooltip??t.options[0].text,variant:t.options[0].variant??t.variant},on:{click:function(e){return t.onAction(t.options[0].option??t.options[0].click,t.options[0],0)}}},[!0===t.text?[t._v(" "+t._s(t.options[0].text)+" ")]:!1!==t.text?[t._v(" "+t._s(t.text)+" ")]:t._e()],2):t.options.length?e("div",{staticClass:"k-options-dropdown"},[e("k-button",{staticClass:"k-options-dropdown-toggle",attrs:{disabled:t.disabled,dropdown:!0,icon:t.icon,size:t.size,text:!0!==t.text&&!1!==t.text?t.text:null,title:t.$t("options"),variant:t.variant},on:{click:function(e){return t.$refs.options.toggle()}}}),e("k-dropdown-content",{ref:"options",staticClass:"k-options-dropdown-content",attrs:{"align-x":t.align,options:t.options},on:{action:t.onAction}})],1):t._e()},[]).exports,Ee={mixins:[W,G,Q,nt,lt]},je={mixins:[Ee],inheritAttrs:!1,emits:["input"],methods:{focus(){this.$el.focus()}}},Ie={mixins:[W,G,ot,lt],props:{ignore:{default:()=>[],type:Array},max:Number,min:Number,search:{default:!0,type:[Object,Boolean]}}},Be={mixins:[Ee,Ie],props:{create:{type:[Boolean,Object],default:!1},multiple:{type:Boolean,default:!0},value:{type:[Array,String],default:()=>[]}},emits:["create","escape","input"]};const Le=ut({mixins:[je,Be],data(){return{display:this.search.display??!0,query:""}},computed:{choices(){let t=this.filteredOptions;return!0!==this.display&&(t=t.slice(0,this.display)),t.map(t=>({...t,disabled:t.disabled||this.isFull&&!1===this.value.includes(t.value),text:this.highlight(t.text),...this.search.info&&t.info?{info:this.highlight(t.info)}:{}}))},filteredOptions(){if(!(this.query.length<(this.search.min??0))){if(this.search.info){let t=this.$helper.array.search(this.options,this.query,{field:"text"});return t=t.concat(this.$helper.array.search(this.options,this.query,{field:"info"})),t=t.filter((t,e,s)=>e===s.findIndex(e=>e===t)),t}return this.$helper.array.search(this.options,this.query,{field:"text"})}},isFull(){return this.max&&this.value.length>=this.max},placeholder(){return this.search.placeholder?this.search.placeholder:this.options.length>0?this.$t("filter")+"…":this.$t("enter")+"…"},showCreate(){var t;if(!1===this.create)return!1;if(this.isFull)return!1;if(0===this.query.trim().length)return!1;if(!0===this.ignore.includes(this.query))return!1;if(!0===(null==(t=this.create.ignore)?void 0:t.includes(this.query)))return!1;return 0===this.options.filter(t=>t.text===this.query||t.value===this.query).length},showEmpty(){return!1===this.create&&0===this.filteredOptions.length}},methods:{add(){this.showCreate&&this.$emit("create",this.query)},enter(t){var e;null==(e=t.target)||e.click()},escape(){0===this.query.length?this.$emit("escape"):this.query=""},focus(){var t;this.$refs.search?this.$refs.search.focus():null==(t=this.$refs.options)||t.focus()},highlight(t){if(t=this.$helper.string.stripHTML(t),this.query.length>0){const e=new RegExp(`(${RegExp.escape(this.query)})`,"ig");return t.replace(e,"<b>$1</b>")}return t},input(t){this.$emit("input",t)}}},function(){var t=this,e=t._self._c;return e("k-navigate",{class:["k-picklist-input",t.$attrs.class],style:t.$attrs.style,attrs:{element:"nav",axis:"y",select:"input[type=search], label, .k-picklist-input-body button"},on:{prev:function(e){return t.$emit("escape")}}},[t.search?e("header",{staticClass:"k-picklist-input-header"},[e("div",{staticClass:"k-picklist-input-search"},[e("k-search-input",{ref:"search",attrs:{autofocus:t.autofocus,disabled:t.disabled,placeholder:t.placeholder,value:t.query},on:{input:function(e){t.query=e}},nativeOn:{keydown:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"escape",void 0,e.key,void 0)?null:(e.preventDefault(),t.escape.apply(null,arguments))},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.add.apply(null,arguments))}]}}),t.showCreate?e("k-button",{staticClass:"k-picklist-input-create",attrs:{icon:"add",size:"xs"},on:{click:t.add}}):t._e()],1)]):t._e(),t.filteredOptions.length?[e("div",{staticClass:"k-picklist-input-body"},[e("k-input-validator",t._b({attrs:{value:JSON.stringify(t.value)}},"k-input-validator",{min:t.min,max:t.max,required:t.required},!1),[e(t.multiple?"k-checkboxes-input":"k-radio-input",{ref:"options",tag:"component",staticClass:"k-picklist-input-options",attrs:{disabled:t.disabled,options:t.choices,value:t.value},on:{input:t.input},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.enter.apply(null,arguments))}}})],1),!0!==t.display&&t.filteredOptions.length>t.display?e("k-button",{staticClass:"k-picklist-input-more",attrs:{icon:"angle-down"},on:{click:function(e){t.display=!0}}},[t._v(" "+t._s(t.$t("options.all",{count:t.filteredOptions.length}))+" ")]):t._e()],1)]:t.showEmpty?[e("div",{staticClass:"k-picklist-input-body"},[e("p",{staticClass:"k-picklist-input-empty"},[t._v(" "+t._s(t.$t("options.none"))+" ")])])]:t._e()],2)},[]).exports;const Te=ut({mixins:[Be],emits:["create","input"],methods:{close(){this.$refs.dropdown.close()},add(t){this.$emit("create",t)},input(t){this.$emit("input",t)},open(t){this.$refs.dropdown.open(t)},toggle(){this.$refs.dropdown.toggle()}}},function(){var t=this,e=t._self._c;return e("k-dropdown-content",{ref:"dropdown",staticClass:"k-picklist-dropdown",attrs:{"align-x":"start",disabled:t.disabled,navigate:!1},nativeOn:{click:function(t){t.stopPropagation()}}},[e("k-picklist-input",t._b({on:{create:t.add,input:t.input,escape:function(e){return t.$refs.dropdown.close()}},nativeOn:{click:function(t){t.stopPropagation()}}},"k-picklist-input",t.$props,!1))],1)},[]).exports,Pe={install(t){t.component("k-dropdown-content",Ae),t.component("k-dropdown-item",Me),t.component("k-options-dropdown",De),t.component("k-picklist-dropdown",Te)}};const qe=ut({props:{count:Number,min:Number,max:Number,required:{type:Boolean,default:!1}},computed:{valid(){return!1===this.required&&0===this.count||(!0!==this.required||0!==this.count)&&(!(this.min&&this.count<this.min)&&!(this.max&&this.count>this.max))}}},function(){var t=this,e=t._self._c;return e("span",{staticClass:"k-counter",attrs:{"data-invalid":!t.valid,"data-theme":t.valid?"positive":"negative"}},[e("span",[t._v(t._s(t.count))]),t.min||t.max?e("span",{staticClass:"k-counter-rules"},[t.min&&t.max?[t._v(t._s(t.min)+"–"+t._s(t.max))]:t.min?[t._v("≥ "+t._s(t.min))]:t.max?[t._v("≤ "+t._s(t.max))]:t._e()],2):t._e()])},[]).exports,Ne={mixins:[G,Z,Q,tt,nt,lt],props:{counter:[Boolean,Object],endpoints:Object,input:{type:[String,Number,Boolean],default:null},translate:Boolean,type:String}};const Fe=ut({mixins:[Ne],inheritAttrs:!1,emits:["blur","focus"]},function(){var t=this,e=t._self._c;return e("div",{class:["k-field",`k-field-name-${t.name}`,`k-field-type-${t.type}`,t.$attrs.class],style:t.$attrs.style,attrs:{"data-disabled":t.disabled,"data-translate":t.translate},on:{focusin:function(e){return t.$emit("focus",e)},focusout:function(e){return t.$emit("blur",e)}}},[t._t("header",function(){return[t.label||t.$slots.label||t.$slots.options||t.$slots.counter?e("header",{staticClass:"k-field-header"},[t._t("label",function(){return[e("k-label",{attrs:{input:t.input,required:t.required,title:t.label,type:"field"}},[t._v(" "+t._s(t.label)+" ")])]}),t._t("options"),t._t("counter",function(){return[t.counter?e("k-counter",t._b({staticClass:"k-field-counter",attrs:{required:t.required}},"k-counter",t.counter,!1)):t._e()]})],2):t._e()]}),t._t("default"),t._t("footer",function(){return[t.help||t.$slots.help?e("footer",{staticClass:"k-field-footer"},[t._t("help",function(){return[t.help?e("k-text",{staticClass:"k-help k-field-help",attrs:{html:t.help}}):t._e()]})],2):t._e()]})],2)},[]).exports,ze={props:{config:Object,disabled:Boolean,fields:{type:[Array,Object],default:()=>({})},value:{type:Object,default:()=>({})}},emits:["focus","input","submit"],methods:{focus(t){if(t)return void(this.hasField(t)&&"function"==typeof this.$refs[t][0].focus&&this.$refs[t][0].focus());const e=Object.keys(this.$refs)[0];this.focus(e)},hasFieldType(t){return this.$helper.isComponent(`k-${t}-field`)},hasField(t){var e;return null==(e=this.$refs[t])?void 0:e[0]},onInput(t,e,s){const i=this.value;this.$set(i,s,t),this.$emit("input",i,e,s)}}};const Ye=ut(ze,function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-fieldset"},[e("k-grid",{attrs:{variant:"fields"}},[t._l(t.fields,function(s,i){return[t.$helper.field.isVisible(s,t.value)?e("k-column",{key:i,attrs:{width:s.width}},[t.hasFieldType(s.type)?e("k-"+s.type+"-field",t._b({ref:i,refInFor:!0,tag:"component",attrs:{disabled:t.disabled||s.disabled,"form-data":t.value,name:i,value:t.value[i]},on:{input:function(e){return t.onInput(e,s,i)},focus:function(e){return t.$emit("focus",e,s,i)},submit:function(e){return t.$emit("submit",e,s,i)}}},"component",s,!1)):e("k-box",{attrs:{theme:"negative"}},[e("k-text",{attrs:{size:"small"}},[t._v(" "+t._s(t.$t("error.field.type.missing",{name:i,type:s.type}))+" ")])],1)],1):t._e()]})],2)],1)},[]).exports;const Re=ut({props:{disabled:Boolean,config:Object,fields:{type:[Array,Object],default:()=>[]},novalidate:{type:Boolean,default:!1},value:{type:Object,default:()=>({})}},emits:["focus","input","submit"],data:()=>({errors:{}}),methods:{focus(t){var e,s;null==(s=null==(e=this.$refs.fields)?void 0:e.focus)||s.call(e,t)},onFocus(t,e,s){this.$emit("focus",t,e,s)},onInput(t,e,s){this.$emit("input",t,e,s)},onSubmit(){this.$emit("submit",this.value)},submit(){this.$refs.submitter.click()}}},function(){var t=this,e=t._self._c;return e("form",{ref:"form",staticClass:"k-form",attrs:{novalidate:t.novalidate,method:"POST",autocomplete:"off"},on:{submit:function(e){return e.preventDefault(),t.onSubmit.apply(null,arguments)}}},[t._t("header"),t._t("default",function(){return[e("k-fieldset",{ref:"fields",attrs:{disabled:t.disabled,fields:t.fields,value:t.value},on:{focus:t.onFocus,input:t.onInput,submit:t.onSubmit}})]}),t._t("footer"),e("input",{ref:"submitter",staticClass:"k-form-submitter",attrs:{type:"submit"}})],2)},[]).exports,He={props:{editor:String,hasDiff:Boolean,isLocked:Boolean,isProcessing:Boolean,modified:[String,Date],preview:[String,Boolean],size:{type:String,default:"sm"}}};const Ue=ut({mixins:[He],emits:["discard","submit"],computed:{buttons(){return!0===this.isLocked?[{theme:"negative",dropdown:!0,text:this.editor,icon:"lock",responsive:!0,click:()=>this.$refs.dropdown.toggle()}]:!0===this.hasDiff?[{theme:"notice",text:this.$t("discard"),icon:"undo",responsive:!0,click:()=>this.discard()},{theme:"notice",text:this.$t("save"),icon:this.isProcessing?"loader":"check",click:()=>this.$emit("submit")},{theme:"notice",icon:"dots",click:()=>this.$refs.dropdown.toggle()}]:[]}},methods:{discard(){this.$panel.dialog.open({component:"k-remove-dialog",props:{size:"medium",submitButton:{theme:"notice",icon:"undo",text:this.$t("form.discard")},text:this.$t("form.discard.confirm")},on:{submit:()=>{this.$panel.dialog.close(),this.$emit("discard")}}})}}},function(){var t=this,e=t._self._c;return t.buttons.length?e("div",{staticClass:"k-form-controls"},[e("k-button-group",{attrs:{layout:"collapsed"}},t._l(t.buttons,function(s){return e("k-button",t._b({key:s.text,staticClass:"k-form-controls-button",attrs:{disabled:t.isProcessing,variant:"filled",size:t.size}},"k-button",s,!1))}),1),e("k-dropdown-content",{ref:"dropdown",staticClass:"k-form-controls-dropdown",attrs:{"align-x":"end"}},[t.isLocked?[e("p",[t._v(" "+t._s(t.$t("form.locked"))+" ")])]:[e("p",[t._v(" "+t._s(t.$t("form.unsaved"))+" ")])],t.editor||t.modified?[e("hr"),e("dl",[t.editor?e("div",[e("dt",[e("k-icon",{attrs:{type:"user"}})],1),e("dd",[t._v(t._s(t.editor))])]):t._e(),t.modified?e("div",[e("dt",[e("k-icon",{attrs:{type:"clock"}})],1),e("dd",[t._v(" "+t._s(t.$library.dayjs(t.modified).format("YYYY-MM-DD HH:mm:ss"))+" ")])]):t._e()])]:t._e(),t.preview?[e("hr"),e("k-dropdown-item",{attrs:{link:t.preview,icon:"window"}},[t._v(" "+t._s(t.$t("form.preview"))+" ")])]:t._e()],2)],1):t._e()},[]).exports,Ve={mixins:[V,J,G],inheritAttrs:!1,props:{autofocus:Boolean,type:String,icon:[String,Boolean],value:{type:[String,Boolean,Number,Object,Array],default:null}},emits:["input","submit"]};const Ke=ut({mixins:[Ve],computed:{inputProps(){return{...this.$props,...this.$attrs}}},methods:{blur(t){(null==t?void 0:t.relatedTarget)&&!1===this.$el.contains(t.relatedTarget)&&this.trigger(null,"blur")},focus(t){this.trigger(t,"focus")},select(t){this.trigger(t,"select")},trigger(t,e){var s,i,n;if("INPUT"===(null==(s=null==t?void 0:t.target)?void 0:s.tagName)&&"function"==typeof(null==(i=null==t?void 0:t.target)?void 0:i[e]))return void t.target[e]();if("function"==typeof(null==(n=this.$refs.input)?void 0:n[e]))return void this.$refs.input[e]();const o=this.$el.querySelector("input, select, textarea");"function"==typeof(null==o?void 0:o[e])&&o[e]()}}},function(){var t=this,e=t._self._c;return e("div",{class:["k-input",t.$attrs.class],style:t.$attrs.style,attrs:{"data-disabled":t.disabled,"data-type":t.type}},[t.$slots.before||t.before?e("span",{staticClass:"k-input-description k-input-before",on:{click:t.focus}},[t._t("before",function(){return[t._v(t._s(t.before))]})],2):t._e(),e("span",{staticClass:"k-input-element",on:{click:function(e){return e.stopPropagation(),t.focus.apply(null,arguments)}}},[t._t("default",function(){return[e("k-"+t.type+"-input",t._b({ref:"input",tag:"component",attrs:{value:t.value},on:{input:function(e){return t.$emit("input",e)},submit:function(e){return t.$emit("submit",e)}}},"component",t.inputProps,!1))]})],2),t.$slots.after||t.after?e("span",{staticClass:"k-input-description k-input-after",on:{click:t.focus}},[t._t("after",function(){return[t._v(t._s(t.after))]})],2):t._e(),t.$slots.icon||t.icon?e("span",{staticClass:"k-input-icon",on:{click:t.focus}},[t._t("icon",function(){return[e("k-icon",{attrs:{type:t.icon}})]})],2):t._e()])},[]).exports,We={props:{content:{default:()=>({}),type:[Array,Object]},fieldset:{default:()=>({}),type:Object}}};const Je=ut({mixins:[We],inheritAttrs:!1,computed:{icon(){return this.fieldset.icon??"box"},label(){if(!this.fieldset.label||0===this.fieldset.label.length)return!1;if(this.fieldset.label===this.name)return!1;let t=this.$helper.string.template(this.fieldset.label,this.content);return"…"!==t&&(t=this.$helper.string.stripHTML(t),this.$helper.string.unescapeHTML(t))},name(){return this.fieldset.name??this.fieldset.label}}},function(){var t=this,e=t._self._c;return e("div",{class:["k-block-title",t.$attrs.class],style:t.$attrs.style},[e("k-icon",{staticClass:"k-block-icon",attrs:{type:t.icon}}),e("span",{staticClass:"k-block-title-text"},[t.name?e("span",{staticClass:"k-block-name"},[t._v(" "+t._s(t.name)+" ")]):t._e(),t.label?e("span",{staticClass:"k-block-label"},[t._v(" "+t._s(t.label)+" ")]):t._e()])],1)},[]).exports,Ge={mixins:[We,G],props:{endpoints:{default:()=>({}),type:[Array,Object]},id:String}};const Xe=ut({mixins:[Ge],inheritAttrs:!1,methods:{field(t,e=null){let s=null;for(const i of Object.values(this.fieldset.tabs??{}))i.fields[t]&&(s=i.fields[t]);return s??e},open(){this.$emit("open")},update(t){this.$emit("update",{...this.content,...t})}}},function(){var t=this;return(0,t._self._c)("k-block-title",{class:t.$attrs.class,style:t.$attrs.style,attrs:{content:t.content,fieldset:t.fieldset},nativeOn:{dblclick:function(e){return t.$emit("open")}}})},[]).exports,Ze={props:{isBatched:Boolean,isFull:Boolean,isHidden:Boolean,isMergable:Boolean}};const Qe=ut({mixins:[Ze],props:{isEditable:Boolean,isSplitable:Boolean},emits:["chooseToAppend","chooseToConvert","chooseToPrepend","copy","duplicate","hide","merge","open","paste","remove","removeSelected","show","split","sortDown","sortUp"],computed:{buttons(){return this.isBatched?[{icon:"template",title:this.$t("copy"),click:()=>this.$emit("copy")},{when:this.isMergable,icon:"merge",title:this.$t("merge"),click:()=>this.$emit("merge")},{icon:"trash",title:this.$t("remove"),click:()=>this.$emit("removeSelected")}]:[{when:this.isEditable,icon:"edit",title:this.$t("edit"),click:()=>this.$emit("open")},{icon:"add",title:this.$t("insert.after"),disabled:this.isFull,click:()=>this.$emit("chooseToAppend")},{icon:"trash",title:this.$t("delete"),click:()=>this.$emit("remove")},{icon:"sort",title:this.$t("sort.drag"),class:"k-sort-handle",key:t=>this.sort(t)},{icon:"dots",title:this.$t("more"),dropdown:[{icon:"angle-up",label:this.$t("insert.before"),disabled:this.isFull,click:()=>this.$emit("chooseToPrepend")},{icon:"angle-down",label:this.$t("insert.after"),disabled:this.isFull,click:()=>this.$emit("chooseToAppend")},"-",{when:this.isEditable,icon:"edit",label:this.$t("edit"),click:()=>this.$emit("open")},{icon:"refresh",label:this.$t("field.blocks.changeType"),click:()=>this.$emit("chooseToConvert")},{when:this.isSplitable,icon:"split",label:this.$t("split"),click:()=>this.$emit("split")},"-",{icon:"template",label:this.$t("copy"),click:()=>this.$emit("copy")},{icon:"download",label:this.$t("paste.after"),disabled:this.isFull,click:()=>this.$emit("paste")},"-",{icon:this.isHidden?"preview":"hidden",label:this.isHidden?this.$t("show"):this.$t("hide"),click:()=>this.$emit(this.isHidden?"show":"hide")},{icon:"copy",label:this.$t("duplicate"),click:()=>this.$emit("duplicate")},"-",{icon:"trash",label:this.$t("delete"),click:()=>this.$emit("remove")}]}]}},methods:{open(){this.$refs.options.open()},sort(t){switch(t.key){case"ArrowUp":t.preventDefault(),this.$emit("sortUp");break;case"ArrowDown":t.preventDefault(),this.$emit("sortDown")}}}},function(){return(0,this._self._c)("k-toolbar",{staticClass:"k-block-options",attrs:{buttons:this.buttons},nativeOn:{mousedown:function(t){t.preventDefault()}}})},[]).exports,ts={mixins:[Ge,Ze],inheritAttrs:!1,props:{attrs:{default:()=>({}),type:[Array,Object]},isLastSelected:Boolean,isSelected:Boolean,name:String,next:Object,prev:Object,type:String},emits:["append","chooseToAppend","chooseToConvert","chooseToPrepend","close","copy","duplicate","focus","hide","merge","open","paste","prepend","remove","removeSelected","selectDown","selectUp","show","sortDown","sortUp","split","submit","update"],computed:{className(){let t=["k-block-type-"+this.type];return this.fieldset.preview&&this.fieldset.preview!==this.type&&t.push("k-block-type-"+this.fieldset.preview),!1===this.wysiwyg&&t.push("k-block-type-default"),t},containerType(){const t=this.fieldset.preview;return!1!==t&&(t&&this.$helper.isComponent("k-block-type-"+t)?t:!!this.$helper.isComponent("k-block-type-"+this.type)&&this.type)},customComponent(){return this.wysiwyg?this.wysiwygComponent:"k-block-type-default"},isDisabled(){return!0===this.disabled||!0===this.fieldset.disabled},isEditable(){return!1!==this.fieldset.editable},listeners(){return{append:t=>this.$emit("append",t),chooseToAppend:t=>this.$emit("chooseToAppend",t),chooseToConvert:t=>this.$emit("chooseToConvert",t),chooseToPrepend:t=>this.$emit("chooseToPrepend",t),close:()=>this.$emit("close"),copy:()=>this.$emit("copy"),duplicate:()=>this.$emit("duplicate"),focus:()=>this.$emit("focus"),hide:()=>this.$emit("hide"),merge:()=>this.$emit("merge"),open:t=>this.open(t),paste:()=>this.$emit("paste"),prepend:t=>this.$emit("prepend",t),remove:()=>this.remove(),removeSelected:()=>this.$emit("removeSelected"),show:()=>this.$emit("show"),sortDown:()=>this.$emit("sortDown"),sortUp:()=>this.$emit("sortUp"),split:t=>this.$emit("split",t),update:t=>this.$emit("update",t)}},listenersForOptions(){return{...this.listeners,split:()=>this.$refs.editor.split(),open:()=>{"function"==typeof this.$refs.editor.open?this.$refs.editor.open():this.open()}}},tabs(){const t=this.fieldset.tabs??{};for(const[e,s]of Object.entries(t))for(const[i]of Object.entries(s.fields??{}))t[e].fields[i].section=this.name,t[e].fields[i].endpoints={field:this.endpoints.field+"/fieldsets/"+this.type+"/fields/"+i,section:this.endpoints.section,model:this.endpoints.model};return t},wysiwyg(){return!1!==this.wysiwygComponent},wysiwygComponent(){return!!this.containerType&&"k-block-type-"+this.containerType}},methods:{backspace(t){if(t.target.matches("[contenteditable], input, textarea"))return!1;t.preventDefault(),this.remove()},close(){this.$panel.drawer.close(this.id)},focus(){var t,e;"function"==typeof(null==(t=this.$refs.editor)?void 0:t.focus)?this.$refs.editor.focus():null==(e=this.$refs.container)||e.focus()},goTo(t){var e;t&&(null==(e=t.$refs.container)||e.focus(),t.open(null,!0))},isSplitable(){var t;return!0!==this.isFull&&(!!this.$refs.editor&&((this.$refs.editor.isSplitable??!0)&&"function"==typeof(null==(t=this.$refs.editor)?void 0:t.split)))},onClose(){this.$emit("close"),this.focus()},onFocus(t){this.disabled||this.$emit("focus",t)},onFocusIn(t){var e,s;this.disabled||(null==(s=null==(e=this.$refs.options)?void 0:e.$el)?void 0:s.contains(t.target))||this.$emit("focus",t)},onInput(t){this.$emit("update",t)},open(t,e=!1){!this.isEditable||this.isBatched||this.isDisabled||(this.$panel.drawer.open({component:"k-block-drawer",id:this.id,tab:t,on:{close:this.onClose,input:this.onInput,next:()=>this.goTo(this.next),prev:()=>this.goTo(this.prev),remove:this.remove,show:this.show,submit:this.submit},props:{hidden:this.isHidden,icon:this.fieldset.icon??"box",next:this.next,prev:this.prev,tabs:this.tabs,title:this.fieldset.name,value:this.content},replace:e}),this.$emit("open"))},remove(){if(this.isBatched)return this.$emit("removeSelected");this.$panel.dialog.open({component:"k-remove-dialog",props:{text:this.$t("field.blocks.delete.confirm")},on:{submit:()=>{this.$panel.dialog.close(),this.close(),this.$emit("remove",this.id)}}})},show(){this.$emit("show")},submit(){this.close(),this.$emit("submit")}}};const es=ut(ts,function(){var t=this,e=t._self._c;return e("div",{ref:"container",class:["k-block-container","k-block-container-fieldset-"+t.type,t.containerType?"k-block-container-type-"+t.containerType:"",t.$attrs.class],style:t.$attrs.style,attrs:{"data-batched":t.isBatched,"data-disabled":t.isDisabled,"data-hidden":t.isHidden,"data-id":t.id,"data-last-selected":t.isLastSelected,"data-selected":t.isSelected,"data-translate":t.fieldset.translate,tabindex:t.isDisabled?null:0},on:{keydown:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"j",void 0,e.key,void 0)?null:e.ctrlKey?(e.preventDefault(),e.stopPropagation(),t.$emit("merge")):null},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"down",40,e.key,["Down","ArrowDown"])?null:e.ctrlKey&&e.altKey?(e.preventDefault(),e.stopPropagation(),t.$emit("selectDown")):null},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"up",38,e.key,["Up","ArrowUp"])?null:e.ctrlKey&&e.altKey?(e.preventDefault(),e.stopPropagation(),t.$emit("selectUp")):null},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"down",40,e.key,["Down","ArrowDown"])?null:e.ctrlKey&&e.shiftKey?(e.preventDefault(),e.stopPropagation(),t.$emit("sortDown")):null},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"up",38,e.key,["Up","ArrowUp"])?null:e.ctrlKey&&e.shiftKey?(e.preventDefault(),e.stopPropagation(),t.$emit("sortUp")):null},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"backspace",void 0,e.key,void 0)?null:e.ctrlKey?(e.stopPropagation(),t.backspace.apply(null,arguments)):null}],focus:function(e){return e.stopPropagation(),t.onFocus.apply(null,arguments)},focusin:function(e){return e.stopPropagation(),t.onFocusIn.apply(null,arguments)}}},[e("div",{staticClass:"k-block",class:t.className,attrs:{"data-disabled":t.isDisabled}},[e(t.customComponent,t._g(t._b({ref:"editor",tag:"component",attrs:{tabs:t.tabs}},"component",t.$props,!1),t.listeners))],1),t.isDisabled?t._e():e("k-block-options",t._g(t._b({ref:"options"},"k-block-options",{isBatched:t.isBatched,isEditable:t.isEditable,isFull:t.isFull,isHidden:t.isHidden,isMergable:t.isMergable,isSplitable:t.isSplitable()},!1),t.listenersForOptions))],1)},[]).exports,ss={mixins:[W,G,Q],props:{empty:String,endpoints:Object,fieldsets:Object,fieldsetGroups:Object,group:String,min:{type:Number,default:null},max:{type:Number,default:null},value:{type:Array,default:()=>[]}},emits:["input"]},is={mixins:[ss],inheritAttrs:!1,data(){return{blocks:this.value??[],isEditing:!1,isMultiSelectKey:!1,selected:[]}},computed:{draggableOptions(){return{handle:".k-sort-handle",list:this.blocks,group:this.group,move:this.move,data:{fieldsets:this.fieldsets,isFull:this.isFull}}},hasFieldsets(){return this.$helper.object.length(this.fieldsets)>0},isEmpty(){return 0===this.blocks.length},isFull(){return null!==this.max&&this.blocks.length>=this.max},isMergable(){if(this.selected.length<2)return!1;const t=this.selected.map(t=>this.find(t));return!(new Set(t.map(t=>t.type)).size>1)&&"function"==typeof this.ref(t[0]).$refs.editor.merge}},watch:{value(){this.blocks=this.value}},mounted(){!0===this.$props.autofocus&&setTimeout(this.focus,100),this.$events.on("blur",this.onBlur),this.$events.on("click",this.onClickGlobal),this.$events.on("copy",this.onCopy),this.$events.on("keydown",this.onKey),this.$events.on("keyup",this.onKey),this.$events.on("paste",this.onPaste)},destroyed(){this.$events.off("blur",this.onBlur),this.$events.off("click",this.onClickGlobal),this.$events.off("copy",this.onCopy),this.$events.off("keydown",this.onKey),this.$events.off("keyup",this.onKey),this.$events.off("paste",this.onPaste)},methods:{async add(t="text",e){const s=await this.$api.get(this.endpoints.field+"/fieldsets/"+t);this.blocks.splice(e,0,s),this.save(),await this.$nextTick(),this.focusOrOpen(s)},choose(t){if(1===this.$helper.object.length(this.fieldsets))return this.add(Object.values(this.fieldsets)[0].type,t);this.$panel.dialog.open({component:"k-block-selector",props:{fieldsetGroups:this.fieldsetGroups,fieldsets:this.fieldsets},on:{submit:e=>{this.add(e,t),this.$panel.dialog.close()},paste:e=>{this.paste(e,t)}}})},chooseToConvert(t){this.$panel.dialog.open({component:"k-block-selector",props:{disabledFieldsets:[t.type],fieldsetGroups:this.fieldsetGroups,fieldsets:this.fieldsets,headline:this.$t("field.blocks.changeType")},on:{submit:e=>{this.convert(e,t),this.$panel.dialog.close()},paste:this.paste}})},copy(t){if(0===this.blocks.length)return!1;if(0===this.selected.length)return!1;let e=[];for(const s of this.blocks)this.selected.includes(s.id)&&e.push(s);if(0===e.length)return!1;this.$helper.clipboard.write(e,t),this.selected=e.map(t=>t.id),this.$panel.notification.success({message:this.$t("copy.success.multiple",{count:e.length}),icon:"template"})},copyAll(){this.selectAll(),this.copy(),this.deselectAll()},async convert(t,e){var s;const i=this.findIndex(e.id);if(-1===i)return!1;const n=t=>{let e={};for(const s of Object.values((null==t?void 0:t.tabs)??{}))e={...e,...s.fields};return e},o=this.blocks[i],r=await this.$api.get(this.endpoints.field+"/fieldsets/"+t),a=this.fieldsets[o.type],l=this.fieldsets[t];if(!l)return!1;let c=r.content;const u=n(l),p=n(a);for(const[d,h]of Object.entries(u)){const t=p[d];(null==t?void 0:t.type)===h.type&&(null==(s=null==o?void 0:o.content)?void 0:s[d])&&(c[d]=o.content[d])}this.blocks[i]={...r,id:o.id,content:c},this.save()},deselect(t){const e=this.selected.findIndex(e=>e===t.id);-1!==e&&this.selected.splice(e,1)},deselectAll(){this.selected=[]},async duplicate(t,e){const s={...this.$helper.object.clone(t),id:this.$helper.uuid()};this.blocks.splice(e+1,0,s),this.save()},fieldset(t){return this.fieldsets[t.type]??{icon:"box",name:t.type,tabs:{content:{fields:{}}},type:t.type}},find(t){return this.blocks.find(e=>e.id===t)},findIndex(t){return this.blocks.findIndex(e=>e.id===t)},focus(t){const e=this.ref(t);this.selected=[(null==t?void 0:t.id)??this.blocks[0]],null==e||e.focus(),null==e||e.$el.scrollIntoView({block:"nearest"})},focusOrOpen(t){this.fieldsets[t.type].wysiwyg?this.focus(t):this.open(t)},hide(t){n(t,"isHidden",!0),this.save()},isInputEvent(){const t=document.querySelector(":focus");return null==t?void 0:t.matches("input, textarea, [contenteditable], .k-writer-input")},isLastSelected(t){const[e]=this.selected.slice(-1);return e&&t.id===e},isOnlyInstance:()=>1===document.querySelectorAll(".k-blocks").length,isSelected(t){return this.selected.includes(t.id)},async merge(){if(this.isMergable){const t=this.selected.map(t=>this.find(t));this.ref(t[0]).$refs.editor.merge(t);for(const e of t.slice(1))this.remove(e);await this.$nextTick(),this.focus(t[0])}},move(t){if(t.from!==t.to){const e=t.draggedData,s=t.toData;if(!1===Object.keys(s.fieldsets).includes(e.type))return!1;if(!0===s.isFull)return!1}return!0},onBlur(){0===this.selected.length&&(this.isMultiSelectKey=!1)},onClickBlock(t,e){e&&this.isMultiSelectKey&&this.onKey(e),this.isMultiSelectKey&&(e.preventDefault(),e.stopPropagation(),this.isSelected(t)?this.deselect(t):this.select(t))},onClickGlobal(t){var e;if("function"==typeof t.target.closest&&(t.target.closest(".k-dialog")||t.target.closest(".k-drawer")))return;const s=document.querySelector(".k-overlay:last-of-type");!1!==this.$el.contains(t.target)||!1!==(null==s?void 0:s.contains(t.target))?s&&!1===(null==(e=this.$el.closest(".k-layout-column"))?void 0:e.contains(t.target))&&this.deselectAll():this.deselectAll()},onCopy(t){return!1!==this.$el.contains(t.target)&&!0!==this.isEditing&&!0!==this.$panel.dialog.isOpen&&!0!==this.isInputEvent(t)&&this.copy(t)},onFocus(t){!1===this.isMultiSelectKey&&(this.selected=[t.id])},async onKey(t){if(this.isMultiSelectKey=t.metaKey||t.ctrlKey||t.altKey,"Escape"===t.code&&this.selected.length>1){const t=this.find(this.selected[0]);await this.$nextTick(),this.focus(t)}},onPaste(t){return!0!==this.isInputEvent(t)&&(!0!==this.isEditing&&!0!==this.$panel.dialog.isOpen&&((0!==this.selected.length||!1!==this.$el.contains(t.target))&&this.paste(t)))},open(t){var e;null==(e=this.$refs["block-"+t.id])||e[0].open()},async paste(t,e){const s=this.$helper.clipboard.read(t);let i=await this.$api.post(this.endpoints.field+"/paste",{html:s});if(void 0===e){let t=this.selected[this.selected.length-1];-1===(e=this.findIndex(t))&&(e=this.blocks.length),e++}if(this.max){const t=this.max-this.blocks.length;i=i.slice(0,t)}this.blocks.splice(e,0,...i),this.save(),this.$panel.notification.success({message:this.$t("paste.success",{count:i.length}),icon:"download"})},pasteboard(){this.$panel.dialog.open({component:"k-block-pasteboard",on:{paste:this.paste}})},prevNext(t){var e;if(this.blocks[t])return null==(e=this.$refs["block-"+this.blocks[t].id])?void 0:e[0]},ref(t){var e,s;return null==(s=this.$refs["block-"+((null==t?void 0:t.id)??(null==(e=this.blocks[0])?void 0:e.id))])?void 0:s[0]},remove(t){const e=this.findIndex(t.id);-1!==e&&(this.deselect(t),this.$delete(this.blocks,e),this.save())},removeAll(){this.$panel.dialog.open({component:"k-remove-dialog",props:{text:this.$t("field.blocks.delete.confirm.all"),submitButton:this.$t("delete.all")},on:{submit:()=>{this.selected=[],this.blocks=[],this.save(),this.$panel.dialog.close()}}})},removeSelected(){this.$panel.dialog.open({component:"k-remove-dialog",props:{text:this.$t("field.blocks.delete.confirm.selected")},on:{submit:()=>{for(const t of this.selected){const e=this.findIndex(t);-1!==e&&this.$delete(this.blocks,e)}this.deselectAll(),this.save(),this.$panel.dialog.close()}}})},save(){this.$emit("input",this.blocks)},select(t){!1===this.isSelected(t)&&this.selected.push(t.id)},selectDown(){const t=this.selected[this.selected.length-1],e=this.findIndex(t)+1;e<this.blocks.length&&this.select(this.blocks[e])},selectUp(){const t=this.selected[0],e=this.findIndex(t)-1;e>=0&&this.select(this.blocks[e])},selectAll(){this.selected=Object.values(this.blocks).map(t=>t.id)},show(t){n(t,"isHidden",!1),this.save()},async sort(t,e,s){if(s<0)return;let i=this.$helper.object.clone(this.blocks);i.splice(e,1),i.splice(s,0,t),this.blocks=i,this.save(),await this.$nextTick(),this.focus(t)},async split(t,e,s){const i=this.$helper.object.clone(t);i.content={...i.content,...s[0]};const n=await this.$api.get(this.endpoints.field+"/fieldsets/"+t.type);n.content={...n.content,...i.content,...s[1]},this.blocks.splice(e,1,i,n),this.save(),await this.$nextTick(),this.focus(n)},update(t,e){const s=this.findIndex(t.id);if(-1!==s)for(const i in e)n(this.blocks[s].content,i,e[i]);this.save()}}};const ns=ut(is,function(){var t=this,e=t._self._c;return e("div",{class:["k-blocks",t.$attrs.class],style:t.$attrs.style,attrs:{"data-disabled":t.disabled,"data-empty":0===t.blocks.length}},[t.hasFieldsets?[e("k-draggable",t._b({staticClass:"k-blocks-list",attrs:{"data-multi-select-key":t.isMultiSelectKey},on:{sort:t.save}},"k-draggable",t.draggableOptions,!1),t._l(t.blocks,function(s,i){return e("k-block",t._b({key:s.id,ref:"block-"+s.id,refInFor:!0,on:{append:function(e){return t.add(e,i+1)},chooseToAppend:function(e){return t.choose(i+1)},chooseToConvert:function(e){return t.chooseToConvert(s)},chooseToPrepend:function(e){return t.choose(i)},close:function(e){t.isEditing=!1},copy:function(e){return t.copy()},duplicate:function(e){return t.duplicate(s,i)},focus:function(e){return t.onFocus(s)},hide:function(e){return t.hide(s)},merge:function(e){return t.merge()},open:function(e){t.isEditing=!0},paste:function(e){return t.pasteboard()},prepend:function(e){return t.add(e,i)},remove:function(e){return t.remove(s)},removeSelected:t.removeSelected,show:function(e){return t.show(s)},selectDown:t.selectDown,selectUp:t.selectUp,sortDown:function(e){return t.sort(s,i,i+1)},sortUp:function(e){return t.sort(s,i,i-1)},split:function(e){return t.split(s,i,e)},update:function(e){return t.update(s,e)}},nativeOn:{click:function(e){return t.onClickBlock(s,e)}}},"k-block",{...s,disabled:t.disabled,endpoints:t.endpoints,fieldset:t.fieldset(s),isBatched:t.isSelected(s)&&t.selected.length>1,isFull:t.isFull,isHidden:!0===s.isHidden,isLastSelected:t.isLastSelected(s),isMergable:t.isMergable,isSelected:t.isSelected(s),next:t.prevNext(i+1),prev:t.prevNext(i-1)},!1))}),1),e("k-empty",{staticClass:"k-blocks-empty",attrs:{icon:"box"},on:{click:function(e){return t.choose(t.blocks.length)}}},[t._v(" "+t._s(t.empty??t.$t("field.blocks.empty"))+" ")])]:e("k-empty",{attrs:{icon:"box"}},[t._v(" "+t._s(t.$t("field.blocks.fieldsets.empty"))+" ")])],2)},[]).exports;const os=ut({inheritAttrs:!1,emits:["close","paste","submit"],computed:{shortcut(){return this.$helper.keyboard.metaKey()+"+v"}},methods:{paste(t){this.$emit("close"),this.$emit("paste",t)}}},function(){var t=this,e=t._self._c;return e("k-dialog",{ref:"dialog",class:["k-block-importer",t.$attrs.class],style:t.$attrs.style,attrs:{"cancel-button":!1,"submit-button":!1,visible:!0,size:"large"},on:{cancel:function(e){return t.$emit("cancel")},submit:function(e){return t.$emit("submit")}}},[e("label",{attrs:{for:"pasteboard"},domProps:{innerHTML:t._s(t.$t("field.blocks.fieldsets.paste",{shortcut:t.shortcut}))}}),e("textarea",{attrs:{id:"pasteboard"},on:{paste:function(e){return e.preventDefault(),t.paste.apply(null,arguments)}}})])},[]).exports,rs={inheritAttrs:!1,props:{disabledFieldsets:{default:()=>[],type:Array},fieldsets:{type:Object},fieldsetGroups:{type:Object},headline:{type:String},size:{type:String,default:"medium"},value:{default:null,type:String}},emits:["cancel","close","input","paste","submit"],data:()=>({selected:null}),computed:{groups(){const t={};let e=0;const s=this.fieldsetGroups??{blocks:{label:this.$t("field.blocks.fieldsets.label"),sets:Object.keys(this.fieldsets)}};for(const i in s){const n=s[i];n.open=!1!==n.open,n.fieldsets=n.sets.filter(t=>this.fieldsets[t]).map(t=>(e++,{...this.fieldsets[t],index:e})),0!==n.fieldsets.length&&(t[i]=n)}return t},shortcut(){return this.$helper.keyboard.metaKey()+"+v"}},mounted(){this.$events.on("paste",this.paste)},destroyed(){this.$events.off("paste",this.paste)},methods:{paste(t){this.$emit("paste",t),this.$emit("close")}}};const as=ut(rs,function(){var t=this,e=t._self._c;return e("k-dialog",{class:["k-block-selector",t.$attrs.class],style:t.$attrs.style,attrs:{"cancel-button":!1,size:t.size,"submit-button":!1,visible:!0},on:{cancel:function(e){return t.$emit("cancel")},submit:function(e){return t.$emit("submit",t.value)}}},[t.headline?e("k-headline",[t._v(" "+t._s(t.headline)+" ")]):t._e(),t._l(t.groups,function(s,i){return e("details",{key:i,attrs:{open:s.open}},[e("summary",[t._v(t._s(s.label))]),e("k-navigate",{staticClass:"k-block-types"},t._l(s.fieldsets,function(s){return e("k-button",{key:s.name,attrs:{disabled:t.disabledFieldsets.includes(s.type),icon:s.icon??"box",text:s.name,size:"lg"},on:{click:function(e){return t.$emit("submit",s.type)}},nativeOn:{focus:function(e){return t.$emit("input",s.type)}}})}),1)],1)}),e("p",{staticClass:"k-clipboard-hint",domProps:{innerHTML:t._s(t.$t("field.blocks.fieldsets.paste",{shortcut:t.shortcut}))}})],2)},[]).exports;const ls=ut({props:{value:String},computed:{valueAdapted(){return"transparent"===this.value?"var(--block-color-back)":this.value}}},function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-block-background-dropdown"},[e("k-button",{attrs:{dropdown:!0,size:"xs",variant:"filled"},on:{click:function(e){return t.$refs.dropdown.toggle()}}},[e("k-color-frame",{attrs:{color:t.valueAdapted,ratio:"1/1"}})],1),e("k-dropdown-content",{ref:"dropdown",attrs:{"align-x":"end",options:[{text:t.$t("field.blocks.figure.back.plain"),click:"var(--block-color-back)"},{text:t.$t("field.blocks.figure.back.pattern.light"),click:"var(--pattern-light)"},{text:t.$t("field.blocks.figure.back.pattern.dark"),click:"var(--pattern)"}]},on:{action:function(e){return t.$emit("input",e)}}})],1)},[]).exports;const cs=ut({inheritAttrs:!1,props:{back:String,caption:String,captionMarks:{default:!0,type:[Boolean,Array]},disabled:Boolean,isEmpty:Boolean,emptyIcon:String,emptyText:String},emits:["open","update"]},function(){var t=this,e=t._self._c;return e("figure",{class:["k-block-figure",t.$attrs.class],style:{"--block-figure-back":t.back,...t.$attrs.style},attrs:{"data-empty":t.isEmpty}},[t.isEmpty?e("k-button",{staticClass:"k-block-figure-empty",attrs:{disabled:t.disabled,icon:t.emptyIcon,text:t.emptyText},on:{click:function(e){return t.$emit("open")}}}):e("span",{staticClass:"k-block-figure-container",attrs:{"data-disabled":t.disabled},on:{dblclick:function(e){return t.$emit("open")}}},[t._t("default")],2),t.caption?e("k-block-figure-caption",{attrs:{disabled:t.disabled,marks:t.captionMarks,value:t.caption},on:{input:function(e){return t.$emit("update",{caption:e})}}}):t._e()],1)},[]).exports;const us=ut({props:{disabled:Boolean,marks:[Array,Boolean],value:String}},function(){var t=this,e=t._self._c;return e("figcaption",{staticClass:"k-block-figure-caption"},[e("k-writer-input",{attrs:{disabled:t.disabled,inline:!0,marks:t.marks,spellcheck:!1,value:t.value},on:{input:function(e){return t.$emit("input",e)}}})],1)},[]).exports;const ps=ut({extends:Xe,computed:{placeholder(){return this.field("code",{}).placeholder},languages(){return this.field("language",{options:[]}).options}},methods:{focus(){this.$refs.code.focus()}}},function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-block-type-code-editor"},[e("k-input",{ref:"code",attrs:{buttons:!1,disabled:t.disabled,placeholder:t.placeholder,spellcheck:!1,value:t.content.code,font:"monospace",type:"textarea"},on:{input:function(e){return t.update({code:e})}}}),t.languages.length?e("div",{staticClass:"k-block-type-code-editor-language"},[e("k-input",{ref:"language",attrs:{disabled:t.disabled,empty:!1,options:t.languages,value:t.content.language,icon:"code",type:"select"},on:{input:function(e){return t.update({language:e})}}})],1):t._e()],1)},[]).exports;const ds=ut({extends:Xe,props:{tabs:Object},data(){return{collapsed:this.state(),tab:Object.keys(this.tabs)[0]}},computed:{fields(){var t;return null==(t=this.tabs[this.tab])?void 0:t.fields},values(){return Object.assign({},this.content)}},methods:{open(){this.$emit("open",this.tab)},state(t){const e=`kirby.fieldsBlock.${this.endpoints.field}.${this.id}`;if(void 0===t)return JSON.parse(sessionStorage.getItem(e));sessionStorage.setItem(e,t)},toggle(){this.collapsed=!this.collapsed,this.state(this.collapsed)}}},function(){var t=this,e=t._self._c;return e("div",{attrs:{"data-collapsed":t.collapsed},on:{dblclick:function(e){!t.fieldset.wysiwyg&&t.$emit("open")}}},[e("header",{staticClass:"k-block-type-fields-header"},[e("k-block-title",{attrs:{content:t.values,fieldset:t.fieldset},nativeOn:{click:function(e){return t.toggle.apply(null,arguments)}}}),t.collapsed?t._e():e("k-drawer-tabs",{attrs:{tab:t.tab,tabs:t.fieldset.tabs},on:{open:function(e){t.tab=e}}})],1),t.collapsed?t._e():e("k-form",{ref:"form",staticClass:"k-block-type-fields-form",attrs:{autofocus:!0,disabled:t.disabled||!t.fieldset.wysiwyg,fields:t.fields,value:t.values},on:{input:function(e){return t.$emit("update",e)}}})],1)},[]).exports,hs={extends:Xe,data(){return{back:this.onBack()??"var(--block-color-back)"}},computed:{captionMarks(){return this.field("caption",{marks:!0}).marks},crop(){return this.content.crop},isEmpty(){var t;return!(null==(t=this.content.images)?void 0:t.length)},ratio(){return this.content.ratio}},methods:{onBack(t){const e=`kirby.galleryBlock.${this.endpoints.field}.${this.id}`;if(void 0===t)return sessionStorage.getItem(e);this.back=t,sessionStorage.setItem(e,t)}}};const ms=ut(hs,function(){var t=this,e=t._self._c;return e("figure",{staticClass:"k-block-type-gallery-figure",style:{"--block-back":t.back},attrs:{"data-empty":t.isEmpty}},[e("ul",{on:{dblclick:t.open}},[t.isEmpty?t._l(3,function(s){return e("li",{key:s,staticClass:"k-block-type-gallery-placeholder"},[e("k-image-frame",{staticClass:"k-block-type-gallery-frame",attrs:{ratio:t.ratio}})],1)}):[t._l(t.content.images,function(s){return e("li",{key:s.id},[e("k-image-frame",{staticClass:"k-block-type-gallery-frame",attrs:{ratio:t.ratio,cover:t.crop,src:s.url,srcset:s.image.srcset,alt:s.alt}})],1)}),e("k-block-background-dropdown",{attrs:{value:t.back},on:{input:t.onBack}})]],2),t.content.caption?e("k-block-figure-caption",{attrs:{disabled:t.disabled,marks:t.captionMarks,value:t.content.caption},on:{input:function(e){return t.$emit("update",{caption:e})}}}):t._e()],1)},[]).exports;const fs=ut({extends:Xe,inheritAttrs:!1,emits:["append","open","split","update"],computed:{isSplitable(){return this.content.text.length>0&&!1===this.$refs.input.isCursorAtStart&&!1===this.$refs.input.isCursorAtEnd},keys(){return{Enter:()=>!0===this.$refs.input.isCursorAtEnd?this.$emit("append","text"):this.split(),"Mod-Enter":this.split}},levels(){return this.field("level",{options:[]}).options},textField(){return this.field("text",{marks:!0})}},methods:{focus(){this.$refs.input.focus()},merge(t){this.update({text:t.map(t=>t.content.text).join(" ")})},split(){var t,e;const s=null==(e=(t=this.$refs.input).getSplitContent)?void 0:e.call(t);s&&this.$emit("split",[{text:s[0]},{level:"h"+Math.min(parseInt(this.content.level.slice(1))+1,6),text:s[1]}])}}},function(){var t=this,e=t._self._c;return e("div",{class:["k-block-type-heading-input",t.$attrs.class],style:t.$attrs.style,attrs:{"data-level":t.content.level}},[e("k-writer-input",t._b({ref:"input",attrs:{disabled:t.disabled,inline:!0,keys:t.keys,value:t.content.text},on:{input:function(e){return t.update({text:e})}}},"k-writer-input",t.textField,!1)),t.levels.length>1?e("k-input",{ref:"level",staticClass:"k-block-type-heading-level",attrs:{disabled:t.disabled,empty:!1,options:t.levels,value:t.content.level,type:"select"},on:{input:function(e){return t.update({level:e})}}}):t._e()],1)},[]).exports,gs={extends:Xe,data(){return{back:this.onBack()??"transparent"}},computed:{captionMarks(){return this.field("caption",{marks:!0}).marks},crop(){return this.content.crop??!1},src(){var t,e;return"web"===this.content.location?this.content.src:!!(null==(e=null==(t=this.content.image)?void 0:t[0])?void 0:e.url)&&this.content.image[0].url},ratio(){return this.content.ratio??!1}},methods:{onBack(t){const e=`kirby.imageBlock.${this.endpoints.field}.${this.id}`;if(void 0===t)return sessionStorage.getItem(e);this.back=t,sessionStorage.setItem(e,t)}}};const ks=ut(gs,function(){var t=this,e=t._self._c;return e("k-block-figure",{attrs:{back:t.back,caption:t.content.caption,"caption-marks":t.captionMarks,"empty-text":t.$t("field.blocks.image.placeholder")+" …",disabled:t.disabled,"is-empty":!t.src,"empty-icon":"image"},on:{open:t.open,update:t.update}},[t.src?[t.ratio?e("k-image-frame",{attrs:{ratio:t.ratio,cover:t.crop,alt:t.content.alt,src:t.src}}):e("img",{staticClass:"k-block-type-image-auto",attrs:{alt:t.content.alt,src:t.src}}),e("k-block-background-dropdown",{attrs:{value:t.back},on:{input:t.onBack}})]:t._e()],2)},[]).exports;const bs=ut({},function(){return this._self._c,this._m(0)},[function(){var t=this._self._c;return t("div",[t("hr")])}]).exports;const ys=ut({extends:Xe,emits:["open","split","update"],computed:{isSplitable(){return this.content.text.length>0&&!1===this.input().isCursorAtStart&&!1===this.input().isCursorAtEnd},keys(){return{"Mod-Enter":this.split}},marks(){return this.field("text",{}).marks}},methods:{focus(){this.$refs.input.focus()},input(){return this.$refs.input.$refs.input.$refs.input},merge(t){this.update({text:t.map(t=>t.content.text).join("").replaceAll("</ul><ul>","")})},split(){var t,e;const s=null==(e=(t=this.input()).getSplitContent)?void 0:e.call(t);s&&this.$emit("split",[{text:s[0].replace(/(<li><p><\/p><\/li><\/ul>)$/,"</ul>")},{text:s[1].replace(/^(<ul><li><p><\/p><\/li>)/,"<ul>")}])}}},function(){var t=this;return(0,t._self._c)("k-input",{ref:"input",staticClass:"k-block-type-list-input",attrs:{disabled:t.disabled,keys:t.keys,marks:t.marks,value:t.content.text,type:"list"},on:{input:function(e){return t.update({text:e})}}})},[]).exports;const vs=ut({extends:Xe,computed:{placeholder(){return this.field("text",{}).placeholder}},methods:{focus(){this.$refs.input.focus()}}},function(){var t=this;return(0,t._self._c)("k-input",{ref:"input",staticClass:"k-block-type-markdown-input",attrs:{buttons:!1,disabled:t.disabled,placeholder:t.placeholder,spellcheck:!1,value:t.content.text,font:"monospace",type:"textarea"},on:{input:function(e){return t.update({text:e})}}})},[]).exports;const $s=ut({extends:Xe,computed:{citationField(){return this.field("citation",{})},textField(){return this.field("text",{})}},methods:{focus(){this.$refs.text.focus()}}},function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-block-type-quote-editor"},[e("k-writer-input",{ref:"text",staticClass:"k-block-type-quote-text",attrs:{disabled:t.disabled,inline:t.textField.inline??!1,marks:t.textField.marks,placeholder:t.textField.placeholder,value:t.content.text},on:{input:function(e){return t.update({text:e})}}}),e("k-writer-input",{ref:"citation",staticClass:"k-block-type-quote-citation",attrs:{disabled:t.disabled,inline:t.citationField.inline??!0,marks:t.citationField.marks,placeholder:t.citationField.placeholder,value:t.content.citation},on:{input:function(e){return t.update({citation:e})}}})],1)},[]).exports;const ws=ut({extends:Xe,inheritAttrs:!1,computed:{columns(){return this.table.columns??this.fields},fields(){return this.table.fields??{}},rows(){return this.content.rows??[]},table(){let t=null;for(const e of Object.values(this.fieldset.tabs??{}))e.fields.rows&&(t=e.fields.rows);return t??{}}}},function(){var t=this;return(0,t._self._c)("k-table",{class:["k-block-type-table-preview",t.$attrs.class],style:t.$attrs.style,attrs:{columns:t.columns,empty:t.$t("field.structure.empty"),rows:t.rows},nativeOn:{dblclick:function(e){return t.open.apply(null,arguments)}}})},[]).exports;const xs=ut({extends:Xe,emits:["open","split","update"],computed:{component(){const t="k-"+this.textField.type+"-input";return this.$helper.isComponent(t)?t:"k-writer-input"},isSplitable(){return this.content.text.length>0&&!1===this.$refs.input.isCursorAtStart&&!1===this.$refs.input.isCursorAtEnd},keys(){const t={"Mod-Enter":this.split};return!0===this.textField.inline&&(t.Enter=this.split),t},textField(){return this.field("text",{})}},methods:{focus(){this.$refs.input.focus()},merge(t){this.update({text:t.map(t=>t.content.text).join(this.textField.inline?" ":"")})},split(){var t,e;const s=null==(e=(t=this.$refs.input).getSplitContent)?void 0:e.call(t);s&&("writer"===this.textField.type&&(s[0]=s[0].replace(/(<p><\/p>)$/,""),s[1]=s[1].replace(/^(<p><\/p>)/,"")),this.$emit("split",s.map(t=>({text:t}))))}}},function(){var t=this;return(0,t._self._c)(t.component,t._b({ref:"input",tag:"component",staticClass:"k-block-type-text-input",attrs:{disabled:t.disabled,keys:t.keys,value:t.content.text},on:{input:function(e){return t.update({text:e})}}},"component",t.textField,!1))},[]).exports;const _s=ut({extends:Xe,computed:{captionMarks(){return this.field("caption",{marks:!0}).marks},location(){return this.content.location},poster(){var t,e;return null==(e=null==(t=this.content.poster)?void 0:t[0])?void 0:e.url},video(){var t,e;return"kirby"===this.content.location?null==(e=null==(t=this.content.video)?void 0:t[0])?void 0:e.url:this.$helper.embed.video(this.content.url??"",!0)}}},function(){var t=this,e=t._self._c;return e("k-block-figure",{staticClass:"k-block-type-video-figure",attrs:{caption:t.content.caption,"caption-marks":t.captionMarks,disabled:t.disabled,"empty-text":t.$t("field.blocks.video.placeholder")+" …","is-empty":!t.video,"empty-icon":"video"},on:{open:t.open,update:t.update}},[e("k-frame",{attrs:{ratio:"16/9"}},[t.video?["kirby"==t.location?e("video",{attrs:{src:t.video,poster:t.poster,controls:""}}):e("iframe",{attrs:{src:t.video,referrerpolicy:"strict-origin-when-cross-origin"}})]:t._e()],2)],1)},[]).exports,Ss={install(t){t.component("k-block",es),t.component("k-blocks",ns),t.component("k-block-options",Qe),t.component("k-block-pasteboard",os),t.component("k-block-selector",as),t.component("k-block-background-dropdown",ls),t.component("k-block-figure",cs),t.component("k-block-figure-caption",us),t.component("k-block-title",Je),t.component("k-block-type-code",ps),t.component("k-block-type-default",Xe),t.component("k-block-type-fields",ds),t.component("k-block-type-gallery",ms),t.component("k-block-type-heading",fs),t.component("k-block-type-image",ks),t.component("k-block-type-line",bs),t.component("k-block-type-list",ys),t.component("k-block-type-markdown",vs),t.component("k-block-type-quote",$s),t.component("k-block-type-table",ws),t.component("k-block-type-text",xs),t.component("k-block-type-video",_s)}};const Cs=ut({mixins:[Ne,ss],inheritAttrs:!1,data:()=>({opened:[]}),computed:{hasFieldsets(){return this.$helper.object.length(this.fieldsets)>0},isEmpty(){return 0===this.value.length},isFull(){return this.max&&this.value.length>=this.max},options(){return[{click:()=>this.$refs.blocks.copyAll(),disabled:this.isEmpty,icon:"template",text:this.$t("copy.all")},{click:()=>this.$refs.blocks.pasteboard(),disabled:this.isFull,icon:"download",text:this.$t("paste")},"-",{click:()=>this.$refs.blocks.removeAll(),disabled:this.isEmpty,icon:"trash",text:this.$t("delete.all")}]}},methods:{focus(){this.$refs.blocks.focus()}}},function(){var t=this,e=t._self._c;return e("k-field",t._b({class:["k-blocks-field",t.$attrs.class],style:t.$attrs.style,attrs:{input:t.id},scopedSlots:t._u([!t.disabled&&t.hasFieldsets?{key:"options",fn:function(){return[e("k-button-group",{attrs:{layout:"collapsed"}},[e("k-button",{staticClass:"input-focus",attrs:{autofocus:t.autofocus,disabled:t.isFull,responsive:!0,text:t.$t("add"),icon:"add",variant:"filled",size:"xs"},on:{click:function(e){return t.$refs.blocks.choose(t.value.length)}}}),e("k-button",{attrs:{icon:"dots",variant:"filled",size:"xs"},on:{click:function(e){return t.$refs.options.toggle()}}}),e("k-dropdown-content",{ref:"options",attrs:{options:t.options,"align-x":"end"}})],1)]},proxy:!0}:null],null,!0)},"k-field",t.$props,!1),[e("k-input-validator",t._b({attrs:{value:JSON.stringify(t.value)}},"k-input-validator",{id:t.id,min:t.min,max:t.max,required:t.required},!1),[e("k-blocks",t._b({ref:"blocks",on:{close:function(e){t.opened=e},open:function(e){t.opened=e},input:function(e){return t.$emit("input",e)}}},"k-blocks",t.$props,!1))],1),t.disabled||t.isEmpty||t.isFull||!t.hasFieldsets?t._e():e("footer",[e("k-button",{attrs:{title:t.$t("add"),icon:"add",size:"xs",variant:"filled"},on:{click:function(e){return t.$refs.blocks.choose(t.value.length)}}})],1)],1)},[]).exports,Os={mixins:[Ee,ot],props:{columns:{default:1,type:Number},max:Number,min:Number,theme:String,value:{type:Array,default:()=>[]}}},As={mixins:[je,Os],data:()=>({selected:[]}),computed:{choices(){return this.options.map((t,e)=>{const s=this.selected.includes(t.value);return{autofocus:this.autofocus&&0===e,checked:s,disabled:this.disabled||t.disabled||!s&&this.isFull,id:`${this.id}-${e}`,info:t.info,label:t.text,name:this.name??this.id,type:"checkbox",value:t.value}})},isFull(){return this.max&&this.selected.length>=this.max}},watch:{value:{handler(t){this.selected=Array.isArray(t)?t:[]},immediate:!0}},methods:{focus(){var t;null==(t=this.$el.querySelector("input"))||t.focus()},input(t,e){if(!0===e)this.selected.push(t);else{const e=this.selected.indexOf(t);-1!==e&&this.selected.splice(e,1)}this.$emit("input",this.selected)},select(){this.focus()}}};const Ms=ut(As,function(){var t=this,e=t._self._c;return e("fieldset",{class:["k-checkboxes-input",t.$attrs.class],style:t.$attrs.style,attrs:{disabled:t.disabled}},[e("legend",{staticClass:"sr-only"},[t._v(t._s(t.$t("options")))]),e("k-input-validator",t._b({attrs:{value:JSON.stringify(t.selected)}},"k-input-validator",{min:t.min,max:t.max,required:t.required},!1),[e("ul",{staticClass:"k-grid",style:{"--columns":t.columns},attrs:{"data-variant":"choices"}},t._l(t.choices,function(s,i){return e("li",{key:i},[e("k-choice-input",t._b({on:{input:function(e){return t.input(s.value,e)}}},"k-choice-input",s,!1))],1)}),0)])],1)},[]).exports,Ds={props:{counter:{type:Boolean,default:!0}},computed:{counterOptions(){const t=this.counterValue??this.value;return!(!1===this.counter||this.disabled||!t)&&{count:Array.isArray(t)?t.length:String(t).length,min:this.$props.min??this.$props.minlength,max:this.$props.max??this.$props.maxlength}},counterValue:()=>null}};const Es=ut({mixins:[Ne,Ve,Os,Ds],inheritAttrs:!1,methods:{focus(){this.$refs.input.focus()}}},function(){var t,e=this,s=e._self._c;return s("k-field",e._b({class:["k-checkboxes-field",e.$attrs.class],style:e.$attrs.style,attrs:{counter:e.counterOptions,input:e.id+"-0"}},"k-field",e.$props,!1),[(null==(t=e.options)?void 0:t.length)?s("k-checkboxes-input",e._b({ref:"input",on:{input:function(t){return e.$emit("input",t)}}},"k-checkboxes-input",e.$props,!1)):s("k-empty",{attrs:{text:e.$t("options.none"),icon:"checklist"}})],1)},[]).exports,js={mixins:[Ee,K,W,X,st,it,rt,at,ct],props:{ariaLabel:String,preselect:Boolean,type:{default:"text",type:String},value:{type:String}}};const Is=ut({mixins:[je,js],mounted(){this.$props.autofocus&&this.focus(),this.$props.preselect&&this.select()},methods:{select(){this.$el.select()}}},function(){var t=this;return(0,t._self._c)("input",t._b({directives:[{name:"direction",rawName:"v-direction"}],class:["k-string-input",t.$attrs.class],style:t.$attrs.style,attrs:{"aria-label":t.ariaLabel,"data-font":t.font},on:{input:function(e){return t.$emit("input",e.target.value)}}},"input",{autocomplete:t.autocomplete,autofocus:t.autofocus,disabled:t.disabled,id:t.id,maxlength:t.maxlength,minlength:t.minlength,name:t.name,pattern:t.pattern,placeholder:t.placeholder,required:t.required,spellcheck:t.spellcheck,type:t.type,value:t.value},!1))},[]).exports,Bs={mixins:[js],props:{autocomplete:null,font:null,maxlength:null,minlength:null,pattern:null,spellcheck:null,alpha:{type:Boolean,default:!0},format:{type:String,default:"hex",validator:t=>["hex","rgb","hsl"].includes(t)}}},Ls={mixins:[Is,Bs],watch:{value(){this.validate()}},mounted(){this.validate()},methods:{convert(t){if(!t)return t;try{return this.$library.colors.toString(t,this.format,this.alpha)}catch{const e=document.createElement("div");return e.style.color=t,document.body.append(e),t=window.getComputedStyle(e).color,e.remove(),this.$library.colors.toString(t,this.format,this.alpha)}},convertAndEmit(t){this.emit(this.convert(t))},emit(t){this.$emit("input",t)},onBlur(){this.convertAndEmit(this.value)},onPaste(t){t instanceof ClipboardEvent&&(t=this.$helper.clipboard.read(t,!0)),this.convertAndEmit(t)},async onSave(){var t;this.convertAndEmit(this.value),await this.$nextTick(),null==(t=this.$el.form)||t.requestSubmit()},validate(){let t="";null===this.$library.colors.parse(this.value)&&(t=this.$t("error.validation.color",{format:this.format})),this.$el.setCustomValidity(t)}}};const Ts=ut(Ls,function(){var t=this;return(0,t._self._c)("k-string-input",t._b({staticClass:"k-colorname-input",attrs:{spellcheck:!1,autocomplete:"off",type:"text"},on:{input:function(e){return t.$emit("input",e)}},nativeOn:{blur:function(e){return t.onBlur.apply(null,arguments)},paste:function(e){return t.onPaste.apply(null,arguments)},keydown:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"s",void 0,e.key,void 0)?null:e.metaKey?(e.stopPropagation(),e.preventDefault(),t.onSave.apply(null,arguments)):null},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onSave.apply(null,arguments)}]}},"k-string-input",t.$props,!1))},[]).exports,Ps={mixins:[Ne,Ve,Bs],inheritAttrs:!1,props:{icon:{type:String,default:"pipette"},mode:{type:String,default:"picker",validator:t=>["picker","input","options"].includes(t)},options:{type:Array,default:()=>[]}},computed:{convertedOptions(){return this.options.map(t=>({...t,value:this.convert(t.value)}))},currentOption(){return this.convertedOptions.find(t=>t.value===this.value)}},methods:{convert(t){return this.$library.colors.toString(t,this.format,this.alpha)}}};const qs=ut(Ps,function(){var t,e=this,s=e._self._c;return s("k-field",e._b({class:["k-color-field",e.$attrs.class],style:e.$attrs.style,attrs:{input:e.id}},"k-field",e.$props,!1),["options"===e.mode?s("k-coloroptions-input",e._b({staticClass:"k-color-field-options",attrs:{options:e.convertedOptions},on:{input:function(t){return e.$emit("input",t)}}},"k-coloroptions-input",e.$props,!1)):s("k-input",e._b({attrs:{type:"color"},scopedSlots:e._u([{key:"before",fn:function(){return["picker"===e.mode?[s("button",{staticClass:"k-color-field-picker-toggle",attrs:{disabled:e.disabled,type:"button"},on:{click:function(t){return e.$refs.picker.toggle()}}},[s("k-color-frame",{attrs:{color:e.value}})],1),s("k-dropdown-content",{ref:"picker",staticClass:"k-color-field-picker"},[s("k-colorpicker-input",e._b({ref:"color",attrs:{options:e.convertedOptions},on:{input:function(t){return e.$emit("input",t)}},nativeOn:{click:function(t){t.stopPropagation()}}},"k-colorpicker-input",e.$props,!1))],1)]:s("k-color-frame",{attrs:{color:e.value}})]},proxy:!0},{key:"default",fn:function(){return[s("k-colorname-input",e._b({on:{input:function(t){return e.$emit("input",t)}}},"k-colorname-input",e.$props,!1))]},proxy:!0},(null==(t=e.currentOption)?void 0:t.text)?{key:"after",fn:function(){return[s("span",{domProps:{innerHTML:e._s(e.currentOption.text)}})]},proxy:!0}:null,"picker"===e.mode?{key:"icon",fn:function(){return[s("k-button",{staticClass:"k-input-icon-button",attrs:{icon:e.icon},on:{click:function(t){return t.stopPropagation(),e.$refs.picker.toggle()}}})]},proxy:!0}:null],null,!0)},"k-input",e.$props,!1))],1)},[]).exports,Ns={props:{max:String,min:String,value:String}},Fs={mixins:[Ee,Ns],props:{display:{type:String,default:"DD.MM.YYYY"},step:{type:Object,default:()=>({size:1,unit:"day"})},type:{type:String,default:"date"}}},zs={mixins:[je,Fs],emits:["input","focus","submit"],data:()=>({dt:null,formatted:null}),computed:{inputType:()=>"date",pattern(){return this.$library.dayjs.pattern(this.display)},rounding(){return{...this.$options.props.step.default(),...this.step}}},watch:{value:{handler(t,e){if(t!==e){const e=this.toDatetime(t);this.commit(e)}},immediate:!0}},methods:{async alter(t){let e=this.parse()??this.round(this.$library.dayjs()),s=this.rounding.unit,i=this.rounding.size;const n=this.selection();null!==n&&("meridiem"===n.unit?(t="pm"===e.format("a")?"subtract":"add",s="hour",i=12):(s=n.unit,s!==this.rounding.unit&&(i=1))),e=e[t](i,s).round(this.rounding.unit,this.rounding.size),this.commit(e),this.emit(e),await this.$nextTick(),this.select(n)},commit(t){this.dt=t,this.formatted=this.pattern.format(t),this.validate()},emit(t){this.$emit("input",this.toISO(t))},onArrowDown(){this.alter("subtract")},onArrowUp(){this.alter("add")},onBlur(){const t=this.parse();this.commit(t),this.emit(t)},async onEnter(){this.onBlur(),await this.$nextTick(),this.$emit("submit")},onInput(t){const e=this.parse(),s=this.pattern.format(e);if(!t||s==t)return this.commit(e),this.emit(e)},async onTab(t){if(""==this.$el.value)return;this.onBlur(),await this.$nextTick();const e=this.selection();if(this.$el&&e.start===this.$el.selectionStart&&e.end===this.$el.selectionEnd-1)if(t.shiftKey){if(0===e.index)return;this.selectPrev(e.index)}else{if(e.index===this.pattern.parts.length-1)return;this.selectNext(e.index)}else{if(this.$el&&this.$el.selectionStart==e.end+1&&e.index==this.pattern.parts.length-1)return;if(this.$el&&this.$el.selectionEnd-1>e.end){const t=this.pattern.at(this.$el.selectionEnd,this.$el.selectionEnd);this.select(this.pattern.parts[t.index])}else this.select(this.pattern.parts[e.index])}t.preventDefault()},parse(){const t=this.$library.dayjs.interpret(this.$el.value,this.inputType);return this.round(t)},round(t){return null==t?void 0:t.round(this.rounding.unit,this.rounding.size)},select(t){var e;t??(t=this.selection()),null==(e=this.$el)||e.setSelectionRange(t.start,t.end+1)},selectFirst(){this.select(this.pattern.parts[0])},selectLast(){this.select(this.pattern.parts[this.pattern.parts.length-1])},selectNext(t){this.select(this.pattern.parts[t+1])},selectPrev(t){this.select(this.pattern.parts[t-1])},selection(){return this.pattern.at(this.$el.selectionStart,this.$el.selectionEnd)},toDatetime(t){return this.round(this.$library.dayjs.iso(t,this.inputType))},toISO(t){return null==t?void 0:t.toISO(this.inputType)},validate(){var t,e,s;const i=[];this.required&&!this.dt&&i.push(this.$t("error.validation.required")),this.min&&!1===(null==(t=this.dt)?void 0:t.validate(this.min,"min",this.rounding.unit))&&i.push(this.$t("error.validation.date.after",{date:this.min})),this.max&&!1===(null==(e=this.dt)?void 0:e.validate(this.max,"max",this.rounding.unit))&&i.push(this.$t("error.validation.date.before",{date:this.max})),null==(s=this.$el)||s.setCustomValidity(i.join(", "))}}};const Ys=ut(zs,function(){var t=this;return(0,t._self._c)("input",{directives:[{name:"direction",rawName:"v-direction"}],class:["k-string-input",`k-${t.type}-input`,t.$attrs.class],style:t.$attrs.style,attrs:{id:t.id,autofocus:t.autofocus,disabled:t.disabled,placeholder:t.display,required:t.required,autocomplete:"off",spellcheck:"false",type:"text"},domProps:{value:t.formatted},on:{blur:t.onBlur,focus:function(e){return t.$emit("focus")},input:function(e){return t.onInput(e.target.value)},keydown:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"down",40,e.key,["Down","ArrowDown"])?null:(e.stopPropagation(),e.preventDefault(),t.onArrowDown.apply(null,arguments))},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"up",38,e.key,["Up","ArrowUp"])?null:(e.stopPropagation(),e.preventDefault(),t.onArrowUp.apply(null,arguments))},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.stopPropagation(),e.preventDefault(),t.onEnter.apply(null,arguments))},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"s",void 0,e.key,void 0)?null:e.metaKey?(e.stopPropagation(),e.preventDefault(),t.onEnter.apply(null,arguments)):null},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"s",void 0,e.key,void 0)?null:e.ctrlKey?(e.stopPropagation(),e.preventDefault(),t.onEnter.apply(null,arguments)):null},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"tab",9,e.key,"Tab")?null:t.onTab.apply(null,arguments)}]}})},[]).exports,Rs={mixins:[Ne,Ve,Fs],inheritAttrs:!1,props:{calendar:{type:Boolean,default:!0},icon:{type:String,default:"calendar"},time:{type:[Boolean,Object],default:()=>({})},times:{type:Boolean,default:!0}},emits:["input","submit"],data(){return{iso:this.toIso(this.value)}},computed:{isEmpty(){return this.time?!this.iso.date||!this.iso.time:!this.iso.date}},watch:{value(t,e){t!==e&&(this.iso=this.toIso(t))}},methods:{focus(){this.$refs.dateInput.focus()},now(){const t=this.$library.dayjs();return{date:t.toISO("date"),time:this.time?t.toISO("time"):"00:00:00"}},onInput(){if(this.isEmpty)return this.$emit("input","");const t=this.$library.dayjs.iso(this.iso.date+" "+this.iso.time);(t||null!==this.iso.date&&null!==this.iso.time)&&this.$emit("input",(null==t?void 0:t.toISO())??"")},onDateInput(t){t&&!this.iso.time&&(this.iso.time=this.now().time),this.iso.date=t,this.onInput()},onTimeInput(t){t&&!this.iso.date&&(this.iso.date=this.now().date),this.iso.time=t,this.onInput()},onTimesInput(t){var e;null==(e=this.$refs.times)||e.close(),this.onTimeInput(t+":00")},toIso(t){const e=this.$library.dayjs.iso(t);return{date:(null==e?void 0:e.toISO("date"))??null,time:(null==e?void 0:e.toISO("time"))??null}}}};const Hs=ut(Rs,function(){var t=this,e=t._self._c;return e("k-field",t._b({class:["k-date-field",t.$attrs.class],style:t.$attrs.style,attrs:{input:t.id}},"k-field",t.$props,!1),[e("div",{ref:"body",staticClass:"k-date-field-body",attrs:{"data-has-time":Boolean(t.time)}},[e("k-input",t._b({ref:"dateInput",attrs:{type:"date"},on:{input:t.onDateInput,submit:function(e){return t.$emit("submit")}},scopedSlots:t._u([t.calendar?{key:"icon",fn:function(){return[e("k-button",{staticClass:"k-input-icon-button",attrs:{disabled:t.disabled,icon:t.icon,title:t.$t("date.select")},on:{click:function(e){return t.$refs.calendar.toggle()}}}),e("k-dropdown-content",{ref:"calendar",attrs:{"align-x":"end"}},[e("k-calendar",{attrs:{value:t.iso.date,min:t.min,max:t.max},on:{input:t.onDateInput}})],1)]},proxy:!0}:null],null,!0)},"k-input",t.$props,!1)),t.time?e("k-input",{ref:"timeInput",attrs:{disabled:t.disabled,display:t.time.display,required:t.required,step:t.time.step,value:t.iso.time,icon:t.time.icon,type:"time"},on:{input:t.onTimeInput,submit:function(e){return t.$emit("submit")}},scopedSlots:t._u([t.times?{key:"icon",fn:function(){return[e("k-button",{staticClass:"k-input-icon-button",attrs:{disabled:t.disabled,icon:t.time.icon??"clock",title:t.$t("time.select")},on:{click:function(e){return t.$refs.times.toggle()}}}),e("k-dropdown-content",{ref:"times",attrs:{"align-x":"end"}},[e("k-timeoptions-input",{attrs:{display:t.time.display,value:t.value},on:{input:t.onTimesInput}})],1)]},proxy:!0}:null],null,!0)}):t._e()],1)])},[]).exports,Us={mixins:[js],props:{autocomplete:{type:String,default:"email"},placeholder:{type:String,default:()=>window.panel.t("email.placeholder")}}};const Vs=ut({mixins:[Is,Us]},function(){var t=this;return(0,t._self._c)("k-string-input",t._b({staticClass:"k-email-input",attrs:{type:"email"},on:{input:function(e){return t.$emit("input",e)}}},"k-string-input",t.$props,!1))},[]).exports;const Ks=ut({mixins:[Ne,Ve,Us],inheritAttrs:!1,props:{link:{type:Boolean,default:!0},icon:{type:String,default:"email"}},computed:{mailto(){var t;return(null==(t=this.value)?void 0:t.length)>0?"mailto:"+this.value:null}},methods:{focus(){this.$refs.input.focus()}}},function(){var t=this,e=t._self._c;return e("k-field",t._b({class:["k-email-field",t.$attrs.class],style:t.$attrs.style,attrs:{input:t.id}},"k-field",t.$props,!1),[e("k-input",t._b({ref:"input",attrs:{type:"email"},on:{input:function(e){return t.$emit("input",e)}},scopedSlots:t._u([{key:"icon",fn:function(){return[t.link?e("k-button",{staticClass:"k-input-icon-button",attrs:{icon:t.icon,link:t.mailto,title:t.$t("open"),tabindex:"-1",target:"_blank"}}):t._e()]},proxy:!0}])},"k-input",t.$props,!1))],1)},[]).exports,Ws={mixins:[Ne,Ve],inheritAttrs:!1,props:{empty:String,field:{type:Object,default:()=>({})},max:Number,min:Number,sortable:{type:Boolean,default:!0},value:{type:Array,default:()=>[]}},emits:["input","sort"],data:()=>({entries:[]}),computed:{dragOptions(){return{disabled:!1===this.isSortable,handle:!0,list:this.entries,sort:this.isSortable}},isSortable(){return!0!==this.disabled&&(!(this.entries.length<=1)&&!1!==this.sortable)},more(){return!0!==this.disabled&&!(this.max&&this.entries.length>=this.max)},options(){return[{disabled:0===this.entries.length||this.disabled,icon:"template",text:this.$t("copy.all"),click:this.copyAll},"-",{disabled:0===this.entries.length||this.disabled,icon:"trash",text:this.$t("delete.all"),click:this.removeAll}]},values(){return this.entries.map(t=>t.value)}},watch:{value:{handler(t){t??(t=[]),t!==this.values&&(this.entries=t.map(t=>({id:this.$helper.uuid(),value:t})))},immediate:!0}},methods:{async add(t=null,e=null){var s;if(!1===this.more||!0===this.disabled)return;e??(e=null==(s=this.$helper.field.form({field:this.field}))?void 0:s.field);const i={id:this.$helper.uuid(),value:e??""};t??(t=this.entries.length),this.entries.splice(t,0,i),this.save(),await this.$nextTick(),this.focus(t)},copyAll(){const t=this.values.map(t=>"- "+t).join("\n");this.$helper.clipboard.write(t),this.$panel.notification.success(this.$t("copy.success"))},async duplicate(t){if(!1===this.more||!0===this.disabled||void 0===this.entries[t])return;const e={...this.entries[t],id:this.$helper.uuid()};this.entries.splice(t+1,0,e),this.save(),await this.$nextTick(),this.focus(t+1)},focus(t,e="input"){var s,i,n;null==(n=null==(i=null==(s=this.$refs["entry-"+t+"-"+e])?void 0:s[0])?void 0:i.focus)||n.call(i)},onInput(t,e){this.entries[t].value=e,this.save()},remove(t){!0!==this.disabled&&(this.entries.splice(t,1),this.save(),this.focus(t-1))},removeAll(){this.$panel.dialog.open({component:"k-remove-dialog",props:{text:this.$t("field.entries.delete.confirm.all")},on:{submit:()=>{this.entries=[],this.save(),this.$panel.dialog.close()}}})},save(){this.$emit("input",this.values)},async sort(t,e){if(!1===this.isSortable)return;const s=this.entries[t];this.entries.splice(t,1),this.entries.splice(t+e,0,s),this.save(),await this.$nextTick(),this.focus(t+e,"sort-handle")},sortDown(t){t>=this.entries.length-1||this.sort(t,1)},sortUp(t){t<=0||this.sort(t,-1)}}};const Js=ut(Ws,function(){var t=this,e=t._self._c;return e("k-field",t._b({class:["k-entries-field",t.$attrs.class],style:t.$attrs.style,attrs:{input:t.id},nativeOn:{click:function(t){t.stopPropagation()}},scopedSlots:t._u([t.disabled?null:{key:"options",fn:function(){return[e("k-button-group",{attrs:{layout:"collapsed"}},[t.more?e("k-button",{staticClass:"input-focus",attrs:{autofocus:t.autofocus,responsive:!0,text:t.$t("add"),icon:"add",variant:"filled",size:"xs"},on:{click:function(e){return t.add()}}}):t._e(),e("k-button",{attrs:{icon:"dots",variant:"filled",size:"xs"},on:{click:function(e){return t.$refs.options.toggle()}}}),e("k-dropdown-content",{ref:"options",attrs:{options:t.options,"align-x":"end"}})],1)]},proxy:!0}],null,!0)},"k-field",t.$props,!1),[e("k-input-validator",t._b({attrs:{value:JSON.stringify(t.entries)}},"k-input-validator",{id:t.id,min:t.min,max:t.max,required:t.required},!1),[0===t.entries.length?e("k-empty",{attrs:{icon:"list-bullet"},on:{click:function(e){return t.add()}}},[t._v(" "+t._s(t.empty??t.$t("field.entries.empty"))+" ")]):e("k-draggable",t._b({staticClass:"k-entries-field-items",on:{sort:t.save}},"k-draggable",t.dragOptions,!1),t._l(t.entries,function(s,i){return e("div",{key:s.id,staticClass:"k-entries-field-item"},[t.isSortable?e("k-button",{ref:"entry-"+i+"-sort-handle",refInFor:!0,staticClass:"k-sort-handle k-entries-field-item-sort-handle",attrs:{title:t.$t("sort.drag"),icon:"sort",size:"sm"},nativeOn:{keydown:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"up",38,e.key,["Up","ArrowUp"])?null:t.sortUp(i)},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"down",40,e.key,["Down","ArrowDown"])?null:t.sortDown(i)}]}}):t._e(),e(`k-${t.field.type}-field`,t._b({ref:"entry-"+i+"-input",refInFor:!0,tag:"component",staticClass:"k-entries-field-item-input",attrs:{disabled:t.disabled,value:s.value,counter:!1,label:!1},on:{input:function(e){return t.onInput(i,e)}}},"component",t.field,!1)),e("k-button-group",{staticClass:"k-entries-field-item-options",attrs:{layout:"collapsed"}},[t.more?e("k-button",{attrs:{title:t.$t("add"),icon:"add",size:"sm"},on:{click:function(e){return t.add(i+1)}}}):t._e(),t.more?e("k-button",{attrs:{title:t.$t("duplicate"),icon:"copy",size:"sm"},on:{click:function(e){return t.duplicate(i)}}}):t._e(),t.disabled?t._e():e("k-button",{attrs:{title:t.$t("remove"),icon:"trash",size:"sm"},on:{click:function(e){return t.remove(i)}}})],1)],1)}),0)],1),t.more?e("footer",{staticClass:"k-entries-field-footer"},[e("k-button",{attrs:{title:t.$t("add"),icon:"add",size:"xs",variant:"filled"},on:{click:function(e){return t.add()}}})],1):t._e()],1)},[]).exports,Gs={type:"model",mixins:[Ne,W,et],inheritAttrs:!1,props:{empty:String,info:String,link:Boolean,max:Number,min:Number,multiple:Boolean,parent:String,search:Boolean,size:String,text:String,value:{type:Array,default:()=>[]}},emits:["change","input"],data(){return{selected:this.value}},computed:{buttons(){return[{autofocus:this.autofocus,text:this.$t("select"),icon:"checklist",responsive:!0,click:()=>this.open()}]},collection(){return{empty:this.emptyProps,items:this.selected,layout:this.layout,link:this.link,size:this.size,sortable:!this.disabled&&this.selected.length>1,theme:this.disabled?"disabled":null}},hasDropzone:()=>!1,more(){return!this.max||this.max>this.selected.length}},watch:{value(t){this.selected=t}},methods:{drop(){},focus(){},onInput(){this.$emit("input",this.selected)},open(){if(this.disabled)return!1;this.$panel.dialog.open({component:`k-${this.$options.type}-dialog`,props:{endpoint:this.endpoints.field,hasSearch:this.search,max:this.max,multiple:this.multiple,value:this.selected.map(t=>t.id)},on:{submit:t=>{this.select(t),this.$panel.dialog.close()}}})},remove(t){this.selected.splice(t,1),this.onInput()},removeById(t){this.selected=this.selected.filter(e=>e.id!==t),this.onInput()},select(t){if(0===t.length)return this.selected=[],void this.onInput();this.selected=this.selected.filter(e=>t.find(t=>t.id===e.id));for(const e of t)this.selected.find(t=>e.id===t.id)||this.selected.push(e);this.onInput()}}};const Xs=ut(Gs,function(){var t=this,e=t._self._c;return e("k-field",t._b({class:["k-models-field",`k-${t.$options.type}-field`,t.$attrs.class],style:t.$attrs.style,attrs:{input:t.id},scopedSlots:t._u([t.disabled?null:{key:"options",fn:function(){return[e("k-button-group",{ref:"buttons",staticClass:"k-field-options",attrs:{buttons:t.buttons,layout:"collapsed",size:"xs",variant:"filled"}})]},proxy:!0}],null,!0)},"k-field",t.$props,!1),[e("k-dropzone",{attrs:{disabled:!t.hasDropzone},on:{drop:t.drop}},[e("k-input-validator",t._b({attrs:{value:JSON.stringify(t.value)}},"k-input-validator",{id:t.id,min:t.min,max:t.max,required:t.required},!1),[e("k-collection",t._b({on:{empty:t.open,sort:t.onInput,sortChange:function(e){return t.$emit("change",e)}},scopedSlots:t._u([t.disabled?null:{key:"options",fn:function({index:s}){return[e("k-button",{attrs:{title:t.$t("remove"),icon:"remove"},on:{click:function(e){return t.remove(s)}}})]}}],null,!0)},"k-collection",t.collection,!1))],1)],1)],1)},[]).exports;const Zs=ut({extends:Xs,type:"files",props:{uploads:[Boolean,Object,Array]},computed:{buttons(){const t=Xs.computed.buttons.call(this);return this.hasDropzone&&t.unshift({autofocus:this.autofocus,text:this.$t("upload"),responsive:!0,icon:"upload",click:()=>this.$panel.upload.pick(this.uploadOptions)}),t},emptyProps(){return{icon:"image",text:this.empty??(this.multiple&&1!==this.max?this.$t("field.files.empty"):this.$t("field.files.empty.single"))}},hasDropzone(){return!this.disabled&&this.more&&this.uploads},uploadOptions(){return{accept:this.uploads.accept,max:this.max,multiple:this.multiple,preview:this.uploads.preview,url:this.$panel.urls.api+"/"+this.endpoints.field+"/upload",on:{done:async t=>{!1===this.multiple&&(this.selected=[]);for(const e of t)void 0===this.selected.find(t=>t.id===e.id)&&this.selected.push(e);this.onInput(),await this.$panel.content.update()}}}}},mounted(){this.$events.on("file.delete",this.removeById)},destroyed(){this.$events.off("file.delete",this.removeById)},methods:{drop(t){return!1!==this.uploads&&this.$panel.upload.open(t,this.uploadOptions)}}},null,null).exports;const Qs=ut({},function(){return(0,this._self._c)("div",{staticClass:"k-field k-gap-field"})},[]).exports;const ti=ut({mixins:[Z,tt],inheritAttrs:!1},function(){var t=this,e=t._self._c;return e("div",{class:["k-headline-field",t.$attrs.class],style:t.$attrs.style},[e("k-headline",{staticClass:"h2"},[t._v(" "+t._s(t.label)+" ")]),t.help?e("footer",{staticClass:"k-field-footer"},[e("k-text",{staticClass:"k-help k-field-help",attrs:{html:t.help}})],1):t._e()],1)},[]).exports;const ei=ut({mixins:[Z,tt],props:{icon:String,text:String,theme:{type:String,default:"info"}}},function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-field k-info-field"},[t.label?e("k-headline",[t._v(t._s(t.label))]):t._e(),e("k-box",{attrs:{icon:t.icon,theme:t.theme}},[e("k-text",{attrs:{html:t.text}})],1),t.help?e("footer",{staticClass:"k-field-footer"},[e("k-text",{staticClass:"k-help k-field-help",attrs:{html:t.help}})],1):t._e()],1)},[]).exports,si={mixins:[G],props:{endpoints:Object,fieldsetGroups:Object,fieldsets:Object,id:String,isSelected:Boolean}};const ii=ut({mixins:[si],props:{blocks:Array,width:{type:String,default:"1/1"}},emits:["input"]},function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-column k-layout-column",style:{"--width":t.width},attrs:{id:t.id,tabindex:"0"},on:{dblclick:function(e){return t.$refs.blocks.choose(t.blocks.length)}}},[e("k-blocks",t._b({ref:"blocks",on:{input:function(e){return t.$emit("input",e)}},nativeOn:{dblclick:function(t){t.stopPropagation()}}},"k-blocks",{disabled:t.disabled,endpoints:t.endpoints,fieldsets:t.fieldsets,fieldsetGroups:t.fieldsetGroups,group:"layout",value:t.blocks},!1))],1)},[]).exports,ni={mixins:[si],props:{columns:Array,layouts:{type:Array,default:()=>[["1/1"]]},settings:Object}};const oi=ut({mixins:[ni],props:{attrs:[Array,Object]},emits:["append","change","copy","duplicate","prepend","remove","select","updateAttrs","updateColumn"],computed:{options(){return[{click:()=>this.$emit("prepend"),icon:"angle-up",text:this.$t("insert.before")},{click:()=>this.$emit("append"),icon:"angle-down",text:this.$t("insert.after")},"-",{click:()=>this.openSettings(),icon:"settings",text:this.$t("settings"),when:!1===this.$helper.object.isEmpty(this.settings)},{click:()=>this.$emit("duplicate"),icon:"copy",text:this.$t("duplicate")},{click:()=>this.$emit("change"),disabled:1===this.layouts.length,icon:"dashboard",text:this.$t("field.layout.change")},"-",{click:()=>this.$emit("copy"),icon:"template",text:this.$t("copy")},{click:()=>this.$emit("paste"),icon:"download",text:this.$t("paste.after")},"-",{click:()=>this.remove(),icon:"trash",text:this.$t("field.layout.delete")}]},tabs(){let t=this.settings.tabs;for(const[e,s]of Object.entries(t))for(const i in s.fields)t[e].fields[i].endpoints={field:this.endpoints.field+"/fields/"+i,section:this.endpoints.section,model:this.endpoints.model};return t}},methods:{openSettings(){this.$panel.drawer.open({component:"k-form-drawer",props:{icon:"settings",tabs:this.tabs,title:this.$t("settings"),value:this.attrs},on:{input:t=>this.$emit("updateAttrs",t)}})},remove(){this.$panel.dialog.open({component:"k-remove-dialog",props:{text:this.$t("field.layout.delete.confirm")},on:{submit:()=>{this.$emit("remove"),this.$panel.dialog.close()}}})}}},function(){var t=this,e=t._self._c;return e("section",{staticClass:"k-layout",attrs:{"data-disabled":t.disabled,"data-selected":t.isSelected,tabindex:"0"},on:{click:function(e){return t.$emit("select")}}},[e("k-grid",{staticClass:"k-layout-columns"},t._l(t.columns,function(s,i){return e("k-layout-column",t._b({key:s.id,on:{input:function(e){return t.$emit("updateColumn",{column:s,columnIndex:i,blocks:e})}}},"k-layout-column",{...s,disabled:t.disabled,endpoints:t.endpoints,fieldsetGroups:t.fieldsetGroups,fieldsets:t.fieldsets},!1))}),1),t.disabled?t._e():e("nav",{staticClass:"k-layout-toolbar"},[t.settings?e("k-button",{staticClass:"k-layout-toolbar-button",attrs:{title:t.$t("settings"),icon:"settings"},on:{click:t.openSettings}}):t._e(),e("k-button",{staticClass:"k-layout-toolbar-button",attrs:{icon:"angle-down"},on:{click:function(e){return t.$refs.options.toggle()}}}),e("k-dropdown-content",{ref:"options",attrs:{options:t.options,"align-x":"end"}}),e("k-sort-handle")],1)],1)},[]).exports,ri={mixins:[ni,Q],props:{empty:String,min:Number,max:Number,selector:Object,value:{type:Array,default:()=>[]}}},ai={mixins:[ri],emits:["input"],data(){return{current:null,nextIndex:null,rows:this.value,selected:null}},computed:{draggableOptions(){return{handle:!0,list:this.rows}},hasFieldsets(){return this.$helper.object.length(this.fieldsets)>0}},watch:{value(){this.rows=this.value}},methods:{copy(t,e){if(0===this.rows.length)return!1;const s=void 0!==e?this.rows[e]:this.rows;this.$helper.clipboard.write(JSON.stringify(s),t),this.$panel.notification.success({message:this.$t("copy.success.multiple",{count:s.length??1}),icon:"template"})},change(t,e){const s=e.columns.map(t=>t.width),i=this.layouts.findIndex(t=>t.toString()===s.toString());this.$panel.dialog.open({component:"k-layout-selector",props:{label:this.$t("field.layout.change"),layouts:this.layouts,selector:this.selector,value:this.layouts[i]},on:{submit:s=>{this.onChange(s,i,{rowIndex:t,layoutIndex:i,layout:e}),this.$panel.dialog.close()}}})},duplicate(t,e){const s=this.$helper.object.clone(e),i=this.updateIds(s);this.rows.splice(t+1,0,...i),this.save()},async onAdd(t){let e=await this.$api.post(this.endpoints.field+"/layout",{columns:t});this.rows.splice(this.nextIndex,0,e),this.save()},async onChange(t,e,s){if(e===this.layouts[s.layoutIndex])return;const i=s.layout,n=await this.$api.post(this.endpoints.field+"/layout",{attrs:i.attrs,columns:t}),o=i.columns.filter(t=>{var e;return(null==(e=null==t?void 0:t.blocks)?void 0:e.length)>0}),r=[];if(0===o.length)r.push(n);else{const t=Math.ceil(o.length/n.columns.length)*n.columns.length;for(let e=0;e<t;e+=n.columns.length){const t={...this.$helper.object.clone(n),id:this.$helper.uuid()};t.columns=t.columns.map((t,s)=>{var i;return t.blocks=(null==(i=o[s+e])?void 0:i.blocks)??[],t}),t.columns.filter(t=>{var e;return null==(e=null==t?void 0:t.blocks)?void 0:e.length}).length&&r.push(t)}}this.rows.splice(s.rowIndex,1,...r),this.save()},async paste(t,e=this.rows.length){let s=await this.$api.post(this.endpoints.field+"/layout/paste",{json:this.$helper.clipboard.read(t)});s.length&&(this.rows.splice(e,0,...s),this.save()),this.$panel.notification.success({message:this.$t("paste.success",{count:s.length}),icon:"download"})},pasteboard(t){this.$panel.dialog.open({component:"k-block-pasteboard",on:{paste:e=>this.paste(e,t)}})},remove(t){const e=this.rows.findIndex(e=>e.id===t.id);-1!==e&&this.$delete(this.rows,e),this.save()},removeAll(){this.$panel.dialog.open({component:"k-remove-dialog",props:{text:this.$t("field.layout.delete.confirm.all")},on:{submit:()=>{this.rows=[],this.save(),this.$panel.dialog.close()}}})},save(){this.$emit("input",this.rows)},select(t){if(this.nextIndex=t,1===this.layouts.length)return this.onAdd(this.layouts[0]);this.$panel.dialog.open({component:"k-layout-selector",props:{layouts:this.layouts,selector:this.selector,value:null},on:{submit:t=>{this.onAdd(t),this.$panel.dialog.close()}}})},updateAttrs(t,e){this.rows[t].attrs=e,this.save()},updateColumn(t){this.rows[t.index].columns[t.columnIndex].blocks=t.blocks,this.save()},updateIds(t){return!1===Array.isArray(t)&&(t=[t]),t.map(t=>(t.id=this.$helper.uuid(),t.columns=t.columns.map(t=>(t.id=this.$helper.uuid(),t.blocks=t.blocks.map(t=>(t.id=this.$helper.uuid(),t)),t)),t))}}};const li=ut(ai,function(){var t=this,e=t._self._c;return e("div",[t.hasFieldsets&&t.rows.length?[e("k-draggable",t._b({staticClass:"k-layouts",on:{sort:t.save}},"k-draggable",t.draggableOptions,!1),t._l(t.rows,function(s,i){return e("k-layout",t._b({key:s.id,on:{append:function(e){return t.select(i+1)},change:function(e){return t.change(i,s)},copy:function(e){return t.copy(e,i)},duplicate:function(e){return t.duplicate(i,s)},paste:function(e){return t.pasteboard(i+1)},prepend:function(e){return t.select(i)},remove:function(e){return t.remove(s)},select:function(e){t.selected=s.id},updateAttrs:function(e){return t.updateAttrs(i,e)},updateColumn:function(e){return t.updateColumn({layout:s,index:i,...e})}}},"k-layout",{...s,disabled:t.disabled,endpoints:t.endpoints,fieldsetGroups:t.fieldsetGroups,fieldsets:t.fieldsets,isSelected:t.selected===s.id,layouts:t.layouts,settings:t.settings},!1))}),1)]:!1===t.hasFieldsets?e("k-empty",{staticClass:"k-layout-empty",attrs:{icon:"dashboard"}},[t._v(" "+t._s(t.$t("field.blocks.fieldsets.empty"))+" ")]):e("k-empty",{staticClass:"k-layout-empty",attrs:{icon:"dashboard"},on:{click:function(e){return t.select(0)}}},[t._v(" "+t._s(t.empty??t.$t("field.layout.empty"))+" ")])],2)},[]).exports;const ci=ut({mixins:[Ne,ri,W],inheritAttrs:!1,computed:{hasFieldsets(){return this.$helper.object.length(this.fieldsets)>0},isEmpty(){return 0===this.value.length},options(){return[{click:()=>this.$refs.layouts.copy(),disabled:this.isEmpty,icon:"template",text:this.$t("copy.all")},{click:()=>this.$refs.layouts.pasteboard(),icon:"download",text:this.$t("paste")},"-",{click:()=>this.$refs.layouts.removeAll(),disabled:this.isEmpty,icon:"trash",text:this.$t("delete.all")}]}}},function(){var t=this,e=t._self._c;return e("k-field",t._b({class:["k-layout-field",t.$attrs.class],style:t.$attrs.style,attrs:{input:t.id},scopedSlots:t._u([!t.disabled&&t.hasFieldsets?{key:"options",fn:function(){return[e("k-button-group",{attrs:{layout:"collapsed"}},[e("k-button",{staticClass:"input-focus",attrs:{autofocus:t.autofocus,text:t.$t("add"),icon:"add",variant:"filled",size:"xs"},on:{click:function(e){return t.$refs.layouts.select(0)}}}),e("k-button",{attrs:{icon:"dots",variant:"filled",size:"xs"},on:{click:function(e){return t.$refs.options.toggle()}}}),e("k-dropdown-content",{ref:"options",attrs:{options:t.options,"align-x":"end"}})],1)]},proxy:!0}:null],null,!0)},"k-field",t.$props,!1),[e("k-input-validator",t._b({attrs:{value:JSON.stringify(t.value)}},"k-input-validator",{id:t.id,min:t.min,max:t.max,required:t.required},!1),[e("k-layouts",t._b({ref:"layouts",on:{input:function(e){return t.$emit("input",e)}}},"k-layouts",t.$props,!1))],1),!t.disabled&&t.hasFieldsets?e("footer",[e("k-button",{attrs:{title:t.$t("add"),icon:"add",size:"xs",variant:"filled"},on:{click:function(e){return t.$refs.layouts.select(t.value.length)}}})],1):t._e()],1)},[]).exports;const ui=ut({},function(){return(0,this._self._c)("hr",{staticClass:"k-line-field"})},[]).exports,pi={mixins:[{mixins:[Ne,Ve,Ee,ot],props:{value:{default:"",type:String}}}],inheritAttrs:!1,data:()=>({linkType:null,linkValue:null,expanded:!1}),computed:{activeTypes(){return this.$helper.link.types(this.options)},activeTypesOptions(){const t=[];for(const e in this.activeTypes)t.push({click:()=>this.switchType(e),current:e===this.currentType.id,icon:this.activeTypes[e].icon,label:this.activeTypes[e].label});return t},currentType(){return this.activeTypes[this.linkType]??Object.values(this.activeTypes)[0]}},watch:{value:{async handler(t,e){if(t===e||t===this.linkValue)return;const s=this.$helper.link.detect(t,this.activeTypes);s&&(this.linkType=s.type,this.linkValue=s.link)},immediate:!0}},mounted(){this.$events.on("click",this.onOutsideClick)},destroyed(){this.$events.off("click",this.onOutsideClick)},methods:{clear(){this.linkValue="",this.$emit("input","")},focus(){var t;null==(t=this.$refs.input)||t.focus()},onInput(t){const e=(null==t?void 0:t.trim())??"";if(this.linkType??(this.linkType=this.currentType.id),this.linkValue=e,!e.length)return this.clear();this.$emit("input",this.currentType.value(e))},onOutsideClick(t){!1===this.$el.contains(t.target)&&(this.expanded=!1)},removeModel(){this.clear(),this.expanded=!1},selectModel(t){t.uuid?this.onInput(t.uuid):(this.switchType("url"),this.onInput(t.url))},async switchType(t){t!==this.currentType.id&&(this.linkType=t,this.clear(),"page"===this.currentType.id||"file"===this.currentType.id?this.expanded=!0:this.expanded=!1,await this.$nextTick(),this.focus())},toggle(){this.expanded=!this.expanded}}};const di=ut(pi,function(){var t=this,e=t._self._c;return e("k-field",t._b({class:["k-link-field",t.$attrs.class],style:t.$attrs.style,attrs:{input:t.id}},"k-field",t.$props,!1),[e("k-input",t._b({attrs:{icon:!1}},"k-input",t.$props,!1),[e("div",{staticClass:"k-link-input-header"},[e("k-button",{staticClass:"k-link-input-toggle",attrs:{disabled:t.disabled,dropdown:!t.disabled&&t.activeTypesOptions.length>1,icon:t.currentType.icon,variant:"filled"},on:{click:function(e){t.activeTypesOptions.length>1?t.$refs.types.toggle():t.toggle()}}},[t._v(" "+t._s(t.currentType.label)+" ")]),e("k-dropdown-content",{ref:"types",attrs:{options:t.activeTypesOptions}}),"page"===t.currentType.id||"file"===t.currentType.id?e("div",{staticClass:"k-link-input-model",on:{click:t.toggle}},[e("k-link-field-preview",{attrs:{removable:!0,type:t.currentType.id,value:t.value},on:{remove:t.removeModel},scopedSlots:t._u([{key:"placeholder",fn:function(){return[e("k-button",{staticClass:"k-link-input-model-placeholder"},[t._v(" "+t._s(t.currentType.placeholder)+" ")])]},proxy:!0}],null,!1,3171606015)}),e("k-button",{staticClass:"k-link-input-model-toggle",attrs:{icon:"bars"}})],1):e("k-"+t.currentType.input+"-input",{ref:"input",tag:"component",attrs:{id:t.id,disabled:t.disabled,pattern:t.currentType.pattern??null,placeholder:t.currentType.placeholder,required:t.required,value:t.linkValue},on:{input:t.onInput}})],1),"page"===t.currentType.id?e("div",{directives:[{name:"show",rawName:"v-show",value:t.expanded,expression:"expanded"}],staticClass:"k-link-input-body",attrs:{"data-type":"page"}},[e("div",{staticClass:"k-page-browser"},[e("k-page-tree",{attrs:{current:t.$helper.link.getPageUUID(t.value),root:!1},on:{select:function(e){return t.selectModel(e)}}})],1)]):"file"===t.currentType.id?e("div",{directives:[{name:"show",rawName:"v-show",value:t.expanded,expression:"expanded"}],staticClass:"k-link-input-body",attrs:{"data-type":"file"}},[e("k-file-browser",{attrs:{opened:t.$panel.view.props.model.uuid??t.$panel.view.props.model.id,selected:t.$helper.link.getFileUUID(t.value)},on:{select:function(e){return t.selectModel(e)}}})],1):t._e()])],1)},[]).exports;const hi=t=>({$from:e})=>((t,e)=>{for(let s=t.depth;s>0;s--){const i=t.node(s);if(e(i))return{pos:s>0?t.before(s):0,start:t.start(s),depth:s,node:i}}})(e,t),mi=t=>e=>{if((t=>t instanceof p)(e)){const{node:s,$from:i}=e;if(((t,e)=>Array.isArray(t)&&t.indexOf(e.type)>-1||e.type===t)(t,s))return{node:s,pos:i.pos,depth:i.depth}}},fi=(t,e,s={})=>{const i=mi(e)(t.selection)||hi(t=>t.type===e)(t.selection);return 0!==wt(s)&&i?i.node.hasMarkup(e,{...i.node.attrs,...s}):!!i};function gi(t=null,e=null){if(!t||!e)return!1;const s=t.parent.childAfter(t.parentOffset);if(!s.node)return!1;const i=s.node.marks.find(t=>t.type===e);if(!i)return!1;let n=t.index(),o=t.start()+s.offset,r=n+1,a=o+s.node.nodeSize;for(;n>0&&i.isInSet(t.parent.child(n-1).marks);)n-=1,o-=t.parent.child(n).nodeSize;for(;r<t.parent.childCount&&i.isInSet(t.parent.child(r).marks);)a+=t.parent.child(r).nodeSize,r+=1;return{from:o,to:a}}function ki(t,e){return t.type===e.nodes.bulletList||t.type===e.nodes.orderedList||t.type===e.nodes.todoList}const bi={chainCommands:_,exitCode:x,lift:f,setBlockType:d,toggleMark:w,wrapIn:g,wrappingInputRule:$,textblockTypeInputRule:v,addListNodes:y,wrapInList:m,splitListItem:b,liftListItem:h,sinkListItem:k,getMarkAttrs:function(t,e){const{from:s,to:i}=t.selection;let n=[];t.doc.nodesBetween(s,i,t=>{n=[...n,...t.marks]});const o=n.find(t=>t.type.name===e.name);return o?o.attrs:{}},getNodeAttrs:function(t,e){const{from:s,to:i}=t.selection;let n=[];t.doc.nodesBetween(s,i,t=>{n=[...n,t]});const o=n.reverse().find(t=>t.type.name===e.name);return o?o.attrs:{}},insertNode:function(t,e,s,i){return(n,o)=>{o(n.tr.replaceSelectionWith(t.create(e,s,i)).scrollIntoView())}},markInputRule:function(t,e,s){return new a(t,(t,i,n,o)=>{const r=s instanceof Function?s(i):s,{tr:a}=t,l=i.length-1;let c=o,u=n;if(i[l]){const s=n+i[0].indexOf(i[l-1]),r=s+i[l-1].length-1,p=s+i[l-1].lastIndexOf(i[l]),d=p+i[l].length,h=function(t,e,s){let i=[];return s.doc.nodesBetween(t,e,(t,e)=>{i=[...i,...t.marks.map(s=>({start:e,end:e+t.nodeSize,mark:s}))]}),i}(n,o,t).filter(t=>{const{excluded:s}=t.mark.type;return s.find(t=>t.name===e.name)}).filter(t=>t.end>s);if(h.length)return!1;d<r&&a.delete(d,r),p>s&&a.delete(s,p),u=s,c=u+i[l].length}return a.addMark(u,c,e.create(r)),a.removeStoredMark(e),a})},markIsActive:function(t,e){const{from:s,$from:i,to:n,empty:o}=t.selection;return o?!!e.isInSet(t.storedMarks||i.marks()):!!t.doc.rangeHasMark(s,n,e)},markPasteRule:function(t,e,s){const i=(n,o)=>{const r=[];return n.forEach(n=>{var a;if(n.isText){const{text:i,marks:l}=n;let c,u=0;const p=!!l.filter(t=>"link"===t.type.name)[0];for(;!p&&null!==(c=t.exec(i));)if((null==(a=null==o?void 0:o.type)?void 0:a.allowsMarkType(e))&&c[1]){const t=c.index,i=t+c[0].length,o=t+c[0].indexOf(c[1]),a=o+c[1].length,l=s instanceof Function?s(c):s;t>0&&r.push(n.cut(u,t)),r.push(n.cut(o,a).mark(e.create(l).addToSet(n.marks))),u=i}u<i.length&&r.push(n.cut(u))}else r.push(n.copy(i(n.content,n)))}),u.fromArray(r)};return new l({props:{transformPasted:t=>new c(i(t.content),t.openStart,t.openEnd)}})},minMax:function(t=0,e=0,s=0){return Math.min(Math.max(parseInt(t,10),e),s)},nodeIsActive:fi,nodeInputRule:function(t,e,s){return new a(t,(t,i,n,o)=>{const r=s instanceof Function?s(i):s,{tr:a}=t;return i[0]&&a.replaceWith(n,o,e.create(r)),a})},pasteRule:function(t,e,s){const i=n=>{const o=[];return n.forEach(n=>{if(n.isText){const{text:i}=n;let r,a=0;do{if(r=t.exec(i),r){const t=r.index,i=t+r[0].length,l=s instanceof Function?s(r[0]):s;t>0&&o.push(n.cut(a,t)),o.push(n.cut(t,i).mark(e.create(l).addToSet(n.marks))),a=i}}while(r);a<i.length&&o.push(n.cut(a))}else o.push(n.copy(i(n.content)))}),u.fromArray(o)};return new l({props:{transformPasted:t=>new c(i(t.content),t.openStart,t.openEnd)}})},removeMark:function(t){return(e,s)=>{const{tr:i,selection:n}=e;let{from:o,to:r}=n;const{$from:a,empty:l}=n;if(l){const e=gi(a,t);o=e.from,r=e.to}return i.removeMark(o,r,t),s(i)}},toggleBlockType:function(t,e,s={}){return(i,n,o)=>fi(i,t,s)?d(e)(i,n,o):d(t,s)(i,n,o)},toggleList:function(t,e){return(s,i,n)=>{const{schema:o,selection:r}=s,{$from:a,$to:l}=r,c=a.blockRange(l);if(!c)return!1;const u=hi(t=>ki(t,o))(r);if(c.depth>=1&&u&&c.depth-u.depth<=1){if(u.node.type===t)return h(e)(s,i,n);if(ki(u.node,o)&&t.validContent(u.node.content)){const{tr:e}=s;return e.setNodeMarkup(u.pos,t),i&&i(e),!1}}return m(t)(s,i,n)}},toggleWrap:function(t,e={}){return(s,i,n)=>fi(s,t,e)?f(s,i):g(t,e)(s,i,n)},updateMark:function(t,e){return(s,i)=>{const{tr:n,selection:o,doc:r}=s,{ranges:a,empty:l}=o;if(l){const{from:s,to:i}=gi(o.$from,t);r.rangeHasMark(s,i,t)&&n.removeMark(s,i,t),n.addMark(s,i,t.create(e))}else a.forEach(s=>{const{$to:i,$from:o}=s;r.rangeHasMark(o.pos,i.pos,t)&&n.removeMark(o.pos,i.pos,t),n.addMark(o.pos,i.pos,t.create(e))});return i(n)}}};class yi{emit(t,...e){this._callbacks??(this._callbacks={});const s=this._callbacks[t]??[];for(const i of s)i.apply(this,e);return this}off(t,e){if(arguments.length){const s=this._callbacks?this._callbacks[t]:null;s&&(e?this._callbacks[t]=s.filter(t=>t!==e):delete this._callbacks[t])}else this._callbacks={};return this}on(t,e){var s;return this._callbacks??(this._callbacks={}),(s=this._callbacks)[t]??(s[t]=[]),this._callbacks[t].push(e),this}}class vi{constructor(t=[],e){for(const s of t)s.bindEditor(e),s.init();this.extensions=t}commands({schema:t,view:e}){return this.extensions.filter(t=>t.commands).reduce((s,i)=>{const{name:n,type:o}=i,r={},a=i.commands({schema:t,utils:bi,...["node","mark"].includes(o)?{type:t[`${o}s`][n]}:{}}),l=(t,s)=>{r[t]=t=>{if("function"!=typeof s||!e.editable)return!1;e.focus();const i=s(t);return"function"==typeof i?i(e.state,e.dispatch,e):i}};if("object"==typeof a)for(const[t,e]of Object.entries(a))l(t,e);else l(n,a);return{...s,...r}},{})}buttons(t="mark"){const e={};for(const s of this.extensions)if(s.type===t&&s.button)if(Array.isArray(s.button))for(const t of s.button)e[t.id??t.name]=t;else e[s.name]={name:s.name,...s.button};return e}getAllowedExtensions(t){return t instanceof Array||!t?t instanceof Array?this.extensions.filter(e=>!t.includes(e.name)):this.extensions:[]}getFromExtensions(t,e,s=this.extensions){return s.filter(t=>["extension"].includes(t.type)).filter(e=>e[t]).map(s=>s[t]({...e,utils:bi}))}getFromNodesAndMarks(t,e,s=this.extensions){return s.filter(t=>["node","mark"].includes(t.type)).filter(e=>e[t]).map(s=>s[t]({...e,type:e.schema[`${s.type}s`][s.name],utils:bi}))}inputRules({schema:t,excludedExtensions:e}){const s=this.getAllowedExtensions(e);return[...this.getFromExtensions("inputRules",{schema:t},s),...this.getFromNodesAndMarks("inputRules",{schema:t},s)].reduce((t,e)=>[...t,...e],[])}keymaps({schema:t}){return[...this.getFromExtensions("keys",{schema:t}),...this.getFromNodesAndMarks("keys",{schema:t})].map(t=>S(t))}get marks(){return this.extensions.filter(t=>"mark"===t.type).reduce((t,{name:e,schema:s})=>({...t,[e]:s}),{})}get markViews(){return this.extensions.filter(t=>["mark"].includes(t.type)).filter(t=>t.view).reduce((t,{name:e,view:s})=>({...t,[e]:s}),{})}get nodes(){return this.extensions.filter(t=>"node"===t.type).reduce((t,{name:e,schema:s})=>({...t,[e]:s}),{})}get nodeViews(){return this.extensions.filter(t=>["node"].includes(t.type)).filter(t=>t.view).reduce((t,{name:e,view:s})=>({...t,[e]:s}),{})}get options(){const{view:t}=this;return this.extensions.reduce((e,s)=>({...e,[s.name]:new Proxy(s.options,{set(e,s,i){const n=e[s]!==i;return Object.assign(e,{[s]:i}),n&&t.updateState(t.state),!0}})}),{})}pasteRules({schema:t,excludedExtensions:e}){const s=this.getAllowedExtensions(e);return[...this.getFromExtensions("pasteRules",{schema:t},s),...this.getFromNodesAndMarks("pasteRules",{schema:t},s)].reduce((t,e)=>[...t,...e],[])}plugins({schema:t}){return[...this.getFromExtensions("plugins",{schema:t}),...this.getFromNodesAndMarks("plugins",{schema:t})].reduce((t,e)=>[...t,...e],[]).map(t=>t instanceof l?t:new l(t))}}class $i{constructor(t={}){this.options={...this.defaults,...t}}init(){return null}bindEditor(t=null){this.editor=t}get name(){return null}get type(){return"extension"}get defaults(){return{}}plugins(){return[]}inputRules(){return[]}pasteRules(){return[]}keys(){return{}}}class wi extends $i{constructor(t={}){super(t)}get type(){return"node"}get schema(){return{}}commands(){return{}}}class xi extends wi{get defaults(){return{inline:!1}}get name(){return"doc"}get schema(){return{content:this.options.inline?"inline*":"block+"}}}class _i extends wi{get button(){return{id:this.name,icon:"paragraph",label:window.panel.$t("toolbar.button.paragraph"),name:this.name,separator:!0}}commands({utils:t,schema:e,type:s}){return{paragraph:()=>this.editor.activeNodes.includes("bulletList")?t.toggleList(e.nodes.bulletList,e.nodes.listItem):this.editor.activeNodes.includes("orderedList")?t.toggleList(e.nodes.orderedList,e.nodes.listItem):this.editor.activeNodes.includes("quote")?t.toggleWrap(e.nodes.quote):t.setBlockType(s)}}get schema(){return{content:"inline*",group:"block",draggable:!1,parseDOM:[{tag:"p"}],toDOM:()=>["p",0]}}get name(){return"paragraph"}}let Si=class extends wi{get name(){return"text"}get schema(){return{group:"inline"}}};class Ci extends yi{constructor(t={}){super(),this.defaults={autofocus:!1,content:"",disableInputRules:!1,disablePasteRules:!1,editable:!0,element:null,extensions:[],emptyDocument:{type:"doc",content:[]},events:{},inline:!1,parseOptions:{},topNode:"doc",useBuiltInExtensions:!0},this.init(t)}blur(){this.view.dom.blur()}get builtInExtensions(){return!0!==this.options.useBuiltInExtensions?[]:[new xi({inline:this.options.inline}),new Si,new _i]}buttons(t){return this.extensions.buttons(t)}clearContent(t=!1){this.setContent(this.options.emptyDocument,t)}command(t,...e){var s,i;null==(i=(s=this.commands)[t])||i.call(s,...e)}createCommands(){return this.extensions.commands({schema:this.schema,view:this.view})}createDocument(t,e=this.options.parseOptions){if(null===t)return this.schema.nodeFromJSON(this.options.emptyDocument);if("object"==typeof t)try{return this.schema.nodeFromJSON(t)}catch(s){return window.console.warn("Invalid content.","Passed value:",t,"Error:",s),this.schema.nodeFromJSON(this.options.emptyDocument)}if("string"==typeof t){const s=`<div>${t}</div>`,i=(new window.DOMParser).parseFromString(s,"text/html").body.firstElementChild;return C.fromSchema(this.schema).parse(i,e)}return!1}createEvents(){const t=this.options.events??{};for(const[e,s]of Object.entries(t))this.on(e,s);return t}createExtensions(){return new vi([...this.builtInExtensions,...this.options.extensions],this)}createFocusEvents(){const t=(t,e,s=!0)=>{this.focused=s,this.emit(s?"focus":"blur",{event:e,state:t.state,view:t});const i=this.state.tr.setMeta("focused",s);this.view.dispatch(i)};return new l({props:{attributes:{tabindex:0},handleDOMEvents:{focus:(e,s)=>t(e,s,!0),blur:(e,s)=>t(e,s,!1)}}})}createInputRules(){return this.extensions.inputRules({schema:this.schema,excludedExtensions:this.options.disableInputRules})}createKeymaps(){return this.extensions.keymaps({schema:this.schema})}createMarks(){return this.extensions.marks}createMarkViews(){return this.extensions.markViews}createNodes(){return this.extensions.nodes}createNodeViews(){return this.extensions.nodeViews}createPasteRules(){return this.extensions.pasteRules({schema:this.schema,excludedExtensions:this.options.disablePasteRules})}createPlugins(){return this.extensions.plugins({schema:this.schema})}createSchema(){return new O({topNode:this.options.topNode,nodes:this.nodes,marks:this.marks})}createState(){return A.create({schema:this.schema,doc:this.createDocument(this.options.content),plugins:[...this.plugins,M({rules:this.inputRules}),...this.pasteRules,...this.keymaps,S({Backspace:I}),S(B),this.createFocusEvents()]})}createView(){return new D(this.element,{dispatchTransaction:this.dispatchTransaction.bind(this),attributes:{class:"k-text"},editable:()=>this.options.editable,handlePaste:(t,e)=>{if("function"==typeof this.events.paste){const t=e.clipboardData.getData("text/html"),s=e.clipboardData.getData("text/plain");if(!0===this.events.paste(e,t,s))return!0}},handleDrop:(...t)=>{this.emit("drop",...t)},markViews:this.createMarkViews(),nodeViews:this.createNodeViews(),state:this.createState()})}destroy(){this.view&&this.view.destroy()}dispatchTransaction(t){const e=this.state,s=this.state.apply(t);this.view.updateState(s),this.setActiveNodesAndMarks();const i={editor:this,getHTML:this.getHTML.bind(this),getJSON:this.getJSON.bind(this),state:this.state,transaction:t};this.emit("transaction",i),t.docChanged&&!t.getMeta("preventUpdate")&&t.steps.length>0&&this.emit("update",i);const{from:n,to:o}=this.state.selection,r=!e||!e.selection.eq(s.selection);this.emit(s.selection.empty?"deselect":"select",{...i,from:n,hasChanged:r,to:o})}focus(t=null){if(this.view.focused&&null===t||!1===t)return;const{from:e,to:s}=this.selectionAtPosition(t);this.setSelection(e,s),setTimeout(()=>this.view.focus(),10)}getHTML(t=this.state.doc.content){const e=document.createElement("div"),s=E.fromSchema(this.schema).serializeFragment(t);return e.appendChild(s),this.options.inline&&e.querySelector("p")?e.querySelector("p").innerHTML:e.innerHTML}getHTMLStartToSelection(){const t=this.state.doc.slice(0,this.selection.head).content;return this.getHTML(t)}getHTMLSelectionToEnd(){const t=this.state.doc.slice(this.selection.head).content;return this.getHTML(t)}getHTMLStartToSelectionToEnd(){return[this.getHTMLStartToSelection(),this.getHTMLSelectionToEnd()]}getJSON(){return this.state.doc.toJSON()}getMarkAttrs(t=null){return this.activeMarkAttrs[t]}getSchemaJSON(){return JSON.parse(JSON.stringify({nodes:this.nodes,marks:this.marks}))}init(t={}){this.options={...this.defaults,...t},this.element=this.options.element,this.focused=!1,this.events=this.createEvents(),this.extensions=this.createExtensions(),this.nodes=this.createNodes(),this.marks=this.createMarks(),this.schema=this.createSchema(),this.keymaps=this.createKeymaps(),this.inputRules=this.createInputRules(),this.pasteRules=this.createPasteRules(),this.plugins=this.createPlugins(),this.view=this.createView(),this.commands=this.createCommands(),this.setActiveNodesAndMarks(),!1!==this.options.autofocus&&this.focus(this.options.autofocus),this.emit("init",{view:this.view,state:this.state}),this.extensions.view=this.view,this.setContent(this.options.content)}insertText(t,e=!1){const{tr:s}=this.state,i=s.insertText(t);if(this.view.dispatch(i),e){const e=s.selection.from,i=e-t.length;this.setSelection(i,e)}}get isActive(){return Object.entries({...this.activeMarks,...this.activeNodes}).reduce((t,[e,s])=>({...t,[e]:(t={})=>s(t)}),{})}isEditable(){return this.options.editable}isEmpty(){if(this.state)return 0===this.state.doc.textContent.length}removeMark(t){if(this.schema.marks[t])return bi.removeMark(this.schema.marks[t])(this.state,this.view.dispatch)}get selection(){return this.state.selection}get selectionAtEnd(){return j.atEnd(this.state.doc)}get selectionIsAtEnd(){return this.selection.head===this.selectionAtEnd.head}get selectionAtStart(){return j.atStart(this.state.doc)}get selectionIsAtStart(){return this.selection.head===this.selectionAtStart.head}selectionAtPosition(t=null){return null===t?this.selection:"start"===t||!0===t?this.selectionAtStart:"end"===t?this.selectionAtEnd:{from:t,to:t}}setActiveNodesAndMarks(){this.activeMarks=Object.values(this.schema.marks).filter(t=>bi.markIsActive(this.state,t)).map(t=>t.name),this.activeMarkAttrs=Object.entries(this.schema.marks).reduce((t,[e,s])=>({...t,[e]:bi.getMarkAttrs(this.state,s)}),{}),this.activeNodes=Object.values(this.schema.nodes).filter(t=>bi.nodeIsActive(this.state,t)).map(t=>t.name),this.activeNodeAttrs=Object.entries(this.schema.nodes).reduce((t,[e,s])=>({...t,[e]:bi.getNodeAttrs(this.state,s)}),{})}setContent(t={},e=!1,s){const{doc:i,tr:n}=this.state,o=this.createDocument(t,s),r=n.replaceWith(0,i.content.size,o).setMeta("preventUpdate",!e);this.view.dispatch(r)}setSelection(t=0,e=0){const{doc:s,tr:i}=this.state,n=bi.minMax(t,0,s.content.size),o=bi.minMax(e,0,s.content.size),r=j.create(s,n,o),a=i.setSelection(r);this.view.dispatch(a)}get state(){var t;return null==(t=this.view)?void 0:t.state}toggleMark(t){if(this.schema.marks[t])return bi.toggleMark(this.schema.marks[t])(this.state,this.view.dispatch)}updateMark(t,e){if(this.schema.marks[t])return bi.updateMark(this.schema.marks[t],e)(this.state,this.view.dispatch)}}class Oi extends $i{command(){return()=>{}}remove(){this.editor.removeMark(this.name)}get schema(){return{}}get type(){return"mark"}toggle(){return this.editor.toggleMark(this.name)}update(t){this.editor.updateMark(this.name,t)}}class Ai extends Oi{get button(){return{icon:"bold",label:window.panel.$t("toolbar.button.bold")}}commands(){return()=>this.toggle()}inputRules({type:t,utils:e}){return[e.markInputRule(/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,t),e.markInputRule(/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,t)]}keys(){return{"Mod-b":()=>this.toggle()}}get name(){return"bold"}pasteRules({type:t,utils:e}){return[e.markPasteRule(/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,t),e.markPasteRule(/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,t)]}get schema(){return{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:t=>"normal"!==t.style.fontWeight&&null},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}],toDOM:()=>["strong",0]}}}class Mi extends Oi{get button(){return{icon:"clear",label:window.panel.$t("toolbar.button.clear")}}commands(){return()=>this.clear()}clear(){const{state:t}=this.editor,{from:e,to:s}=t.tr.selection;for(const i of this.editor.activeMarks){const n=t.schema.marks[i],o=this.editor.state.tr.removeMark(e,s,n);this.editor.view.dispatch(o)}}get name(){return"clear"}}let Di=class extends Oi{get button(){return{icon:"code",label:window.panel.$t("toolbar.button.code")}}commands(){return()=>this.toggle()}inputRules({type:t,utils:e}){return[e.markInputRule(/(?:`)([^`]+)(?:`)$/,t)]}keys(){return{"Mod-`":()=>this.toggle()}}get name(){return"code"}pasteRules({type:t,utils:e}){return[e.markPasteRule(/(?:`)([^`]+)(?:`)/g,t)]}get schema(){return{excludes:"_",parseDOM:[{tag:"code"}],toDOM:()=>["code",0]}}};class Ei extends Oi{get button(){return{icon:"email",label:window.panel.$t("toolbar.button.email")}}commands(){return{email:t=>{if(t.altKey||t.metaKey)return this.remove();this.editor.emit("email",this.editor)},insertEmail:(t={})=>{const{selection:e}=this.editor.state;if(e.empty&&this.editor.insertText(t.href,!0),t.href)return this.update(t)},removeEmail:()=>this.remove(),toggleEmail:(t={})=>{var e;(null==(e=t.href)?void 0:e.length)>0?this.editor.command("insertEmail",t):this.editor.command("removeEmail")}}}get defaults(){return{target:null}}get name(){return"email"}pasteRules({type:t,utils:e}){return[e.pasteRule(/^[\w-.]+@([\w-]+\.)+[\w-]{2,4}$/gi,t,t=>({href:t}))]}plugins(){return[{props:{handleClick:(t,e,s)=>{const i=this.editor.getMarkAttrs("email");i.href&&!0===s.altKey&&s.target instanceof HTMLAnchorElement&&(s.stopPropagation(),window.open(i.href))}}}]}get schema(){return{attrs:{href:{default:null},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href^='mailto:']",getAttrs:t=>({href:t.getAttribute("href").replace("mailto:",""),title:t.getAttribute("title")})}],toDOM:t=>["a",{...t.attrs,href:"mailto:"+t.attrs.href},0]}}}class ji extends Oi{get button(){return{icon:"italic",label:window.panel.$t("toolbar.button.italic")}}commands(){return()=>this.toggle()}inputRules({type:t,utils:e}){return[e.markInputRule(/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,t),e.markInputRule(/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,t)]}keys(){return{"Mod-i":()=>this.toggle()}}get name(){return"italic"}pasteRules({type:t,utils:e}){return[e.markPasteRule(/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,t),e.markPasteRule(/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,t)]}get schema(){return{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:()=>["em",0]}}}let Ii=class extends Oi{get button(){return{icon:"url",label:window.panel.$t("toolbar.button.link")}}commands(){return{link:t=>{if(t.altKey||t.metaKey)return this.remove();this.editor.emit("link",this.editor)},insertLink:(t={})=>{const{selection:e}=this.editor.state;if(e.empty&&!1===this.editor.activeMarks.includes("link")&&this.editor.insertText(t.href,!0),t.href)return this.update(t)},removeLink:()=>this.remove(),toggleLink:(t={})=>{var e;(null==(e=t.href)?void 0:e.length)>0?this.editor.command("insertLink",t):this.editor.command("removeLink")}}}get defaults(){return{target:null}}get name(){return"link"}pasteRules({type:t,utils:e}){return[e.pasteRule(/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z]{2,}\b([-a-zA-Z0-9@:%_+.~#?&//=,]*)/gi,t,t=>({href:t}))]}plugins(){return[{props:{handleClick:(t,e,s)=>{const i=this.editor.getMarkAttrs("link");i.href&&!0===s.altKey&&s.target instanceof HTMLAnchorElement&&(s.stopPropagation(),window.open(i.href,i.target))}}}]}get schema(){return{attrs:{href:{default:null},target:{default:null},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]:not([href^='mailto:'])",getAttrs:t=>({href:t.getAttribute("href"),target:t.getAttribute("target"),title:t.getAttribute("title")})}],toDOM:t=>["a",{...t.attrs},0]}}};class Bi extends Oi{get button(){return{icon:"strikethrough",label:window.panel.$t("toolbar.button.strike")}}commands(){return()=>this.toggle()}inputRules({type:t,utils:e}){return[e.markInputRule(/~([^~]+)~$/,t)]}keys(){return{"Mod-d":()=>this.toggle()}}get name(){return"strike"}pasteRules({type:t,utils:e}){return[e.markPasteRule(/~([^~]+)~/g,t)]}get schema(){return{parseDOM:[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",getAttrs:t=>"line-through"===t}],toDOM:()=>["s",0]}}}let Li=class extends Oi{get button(){return{icon:"superscript",label:window.panel.$t("toolbar.button.sup")}}commands(){return()=>this.toggle()}get name(){return"sup"}get schema(){return{parseDOM:[{tag:"sup"}],toDOM:()=>["sup",0]}}};class Ti extends Oi{get button(){return{icon:"subscript",label:window.panel.$t("toolbar.button.sub")}}commands(){return()=>this.toggle()}get name(){return"sub"}get schema(){return{parseDOM:[{tag:"sub"}],toDOM:()=>["sub",0]}}}class Pi extends Oi{get button(){return{icon:"underline",label:window.panel.$t("toolbar.button.underline")}}commands(){return()=>this.toggle()}keys(){return{"Mod-u":()=>this.toggle()}}get name(){return"underline"}get schema(){return{parseDOM:[{tag:"u"},{style:"text-decoration",getAttrs:t=>"underline"===t}],toDOM:()=>["u",0]}}}class qi extends wi{get button(){return{id:this.name,icon:"list-bullet",label:window.panel.$t("toolbar.button.ul"),name:this.name,when:["listItem","bulletList","orderedList","paragraph"]}}commands({type:t,schema:e,utils:s}){return()=>s.toggleList(t,e.nodes.listItem)}inputRules({type:t,utils:e}){return[e.wrappingInputRule(/^\s*([-+*])\s$/,t)]}keys({type:t,schema:e,utils:s}){return{"Shift-Ctrl-8":s.toggleList(t,e.nodes.listItem)}}get name(){return"bulletList"}get schema(){return{content:"listItem+",group:"block",parseDOM:[{tag:"ul"}],toDOM:()=>["ul",0]}}}class Ni extends wi{commands({utils:t,type:e}){return()=>this.createHardBreak(t,e)}createHardBreak(t,e){return t.chainCommands(t.exitCode,t.insertNode(e))}get defaults(){return{enter:!1,text:!1}}keys({utils:t,type:e}){const s=this.createHardBreak(t,e);let i={"Mod-Enter":s,"Shift-Enter":s};return this.options.enter&&(i.Enter=s),i}get name(){return"hardBreak"}get schema(){return{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:()=>["br"]}}}class Fi extends wi{get button(){const t=this.options.levels.map(t=>({id:`h${t}`,command:`h${t}`,icon:`h${t}`,label:window.panel.$t("toolbar.button.heading."+t),attrs:{level:t},name:this.name,when:["heading","paragraph"]}));return t[t.length-1].separator=!0,t}commands({type:t,schema:e,utils:s}){let i={toggleHeading:i=>s.toggleBlockType(t,e.nodes.paragraph,i)};for(const n of this.options.levels)i[`h${n}`]=()=>s.toggleBlockType(t,e.nodes.paragraph,{level:n});return i}get defaults(){return{levels:[1,2,3,4,5,6]}}inputRules({type:t,utils:e}){return this.options.levels.map(s=>e.textblockTypeInputRule(new RegExp(`^(#{1,${s}})\\s$`),t,()=>({level:s})))}keys({type:t,utils:e}){return this.options.levels.reduce((s,i)=>({...s,[`Shift-Ctrl-${i}`]:e.setBlockType(t,{level:i})}),{})}get name(){return"heading"}get schema(){return{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,draggable:!1,parseDOM:this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}})),toDOM:t=>[`h${t.attrs.level}`,0]}}}class zi extends wi{commands({type:t,utils:e}){return()=>e.insertNode(t)}inputRules({type:t,utils:e}){const s=e.nodeInputRule(/^(?:---|___\s|\*\*\*\s)$/,t),i=s.handler;return s.handler=(t,e,s,n)=>i(t,e,s,n).replaceWith(s-1,s,""),[s]}get name(){return"horizontalRule"}get schema(){return{group:"block",parseDOM:[{tag:"hr"}],toDOM:()=>["hr"]}}}class Yi extends wi{keys({type:t,utils:e}){return{Enter:e.splitListItem(t),"Shift-Tab":e.liftListItem(t),Tab:e.sinkListItem(t)}}get name(){return"listItem"}get schema(){return{content:"paragraph block*",defining:!0,draggable:!1,parseDOM:[{tag:"li"}],toDOM:()=>["li",0]}}}class Ri extends wi{get button(){return{id:this.name,icon:"list-numbers",label:window.panel.$t("toolbar.button.ol"),name:this.name,when:["listItem","bulletList","orderedList","paragraph"],separator:!0}}commands({type:t,schema:e,utils:s}){return()=>s.toggleList(t,e.nodes.listItem)}inputRules({type:t,utils:e}){return[e.wrappingInputRule(/^(\d+)\.\s$/,t,t=>({order:+t[1]}),(t,e)=>e.childCount+e.attrs.order===+t[1])]}keys({type:t,schema:e,utils:s}){return{"Shift-Ctrl-9":s.toggleList(t,e.nodes.listItem)}}get name(){return"orderedList"}get schema(){return{attrs:{order:{default:1}},content:"listItem+",group:"block",parseDOM:[{tag:"ol",getAttrs:t=>({order:t.hasAttribute("start")?+t.getAttribute("start"):1})}],toDOM:t=>1===t.attrs.order?["ol",0]:["ol",{start:t.attrs.order},0]}}}class Hi extends wi{get button(){return{id:this.name,icon:"quote",label:window.panel.$t("field.blocks.quote.name"),name:this.name}}commands({type:t,utils:e}){return()=>e.toggleWrap(t)}inputRules({type:t,utils:e}){return[e.wrappingInputRule(/^\s*>\s$/,t)]}keys({utils:t}){return{"Shift-Tab":(e,s)=>t.lift(e,s)}}get name(){return"quote"}get schema(){return{content:"block+",group:"block",defining:!0,draggable:!1,parseDOM:[{tag:"blockquote"}],toDOM:()=>["blockquote",0]}}}let Ui=class extends $i{commands(){return{undo:()=>q,redo:()=>P,undoDepth:()=>T,redoDepth:()=>L}}get defaults(){return{depth:"",newGroupDelay:""}}keys(){return{"Mod-z":q,"Mod-y":P,"Shift-Mod-z":P,"Mod-я":q,"Shift-Mod-я":P}}get name(){return"history"}plugins(){return[N({depth:this.options.depth,newGroupDelay:this.options.newGroupDelay})]}};class Vi extends $i{commands(){return{insertHtml:t=>(e,s)=>{let i=document.createElement("div");i.innerHTML=t.trim();const n=C.fromSchema(e.schema).parse(i);s(e.tr.replaceSelectionWith(n).scrollIntoView())}}}}class Ki extends $i{keys(){const t={};for(const e in this.options)t[e]=()=>(this.options[e](),!0);return t}}let Wi=class extends $i{constructor(t){super(),this.writer=t}get component(){return this.writer.$refs.toolbar}init(){this.editor.on("deselect",({event:t})=>{var e;return null==(e=this.component)?void 0:e.close(t)}),this.editor.on("select",({hasChanged:t})=>{var e;!1!==t&&(null==(e=this.component)||e.open())})}get type(){return"toolbar"}};const Ji={mixins:[Ee,st,it,at,ct],props:{breaks:Boolean,code:Boolean,emptyDocument:{type:Object,default:()=>({type:"doc",content:[]})},extensions:Array,headings:{default:()=>[1,2,3,4,5,6],type:[Array,Boolean]},inline:Boolean,keys:Object,marks:{type:[Array,Boolean],default:!0},nodes:{type:[Array,Boolean],default:()=>["heading","bulletList","orderedList"]},paste:{type:Function,default:()=>()=>!1},toolbar:{type:Object,default:()=>({inline:!0})},value:{type:String,default:""}}};const Gi=ut({mixins:[je,Ji],emits:["input"],data(){return{editor:null,json:{},html:this.value,isEmpty:!0}},computed:{characters(){const t=this.$helper.string.stripHTML(this.value??"");return this.$helper.string.unescapeHTML(t).length},isCursorAtEnd(){return this.editor.selectionIsAtEnd},isCursorAtStart(){return this.editor.selectionIsAtStart},toolbarOptions(){return{marks:Array.isArray(this.marks)||!1===this.marks?this.marks:void 0,...this.toolbar,editor:this.editor}}},watch:{value(t,e){t!==e&&t!==this.html&&(this.html=t,this.editor.setContent(this.html),this.isEmpty=this.editor.isEmpty())}},mounted(){this.editor=new Ci({autofocus:this.autofocus,content:this.value,editable:!this.disabled,element:this.$el,emptyDocument:this.emptyDocument,parseOptions:{preserveWhitespace:!0},events:{link:t=>{this.$panel.dialog.open({component:"k-link-dialog",props:{value:t.getMarkAttrs("link")},on:{cancel:()=>t.focus(),submit:e=>{this.$panel.dialog.close(),t.command("toggleLink",e)}}})},email:t=>{this.$panel.dialog.open({component:"k-email-dialog",props:{value:this.editor.getMarkAttrs("email")},on:{cancel:()=>t.focus(),submit:e=>{this.$panel.dialog.close(),t.command("toggleEmail",e)}}})},paste:this.paste,update:t=>{if(!this.editor)return;const e=JSON.stringify(this.editor.getJSON());e!==JSON.stringify(this.json)&&(this.json=e,this.isEmpty=t.editor.isEmpty(),this.html=t.editor.getHTML(),this.isEmpty&&(0===t.editor.activeNodes.length||t.editor.activeNodes.includes("paragraph"))&&(this.html=""),this.$emit("input",this.html),this.validate())}},extensions:[...this.createMarks(),...this.createNodes(),new Ki(this.keys),new Ui,new Vi,new Wi(this),...this.extensions||[]],inline:this.inline}),this.isEmpty=this.editor.isEmpty(),this.json=this.editor.getJSON(),this.$panel.events.on("click",this.onBlur),this.$panel.events.on("focus",this.onBlur),this.validate(),this.$props.autofocus&&this.focus()},beforeDestroy(){this.editor.destroy(),this.$panel.events.off("click",this.onBlur),this.$panel.events.off("focus",this.onBlur)},methods:{command(t,...e){this.editor.command(t,...e)},createMarks(){return this.filterExtensions({clear:new Mi,code:new Di,underline:new Pi,strike:new Bi,link:new Ii,email:new Ei,bold:new Ai,italic:new ji,sup:new Li,sub:new Ti,...this.createMarksFromPanelPlugins()},this.marks)},createMarksFromPanelPlugins(){const t=window.panel.plugins.writerMarks??{},e={};for(const s in t)e[s]=Object.create(Oi.prototype,Object.getOwnPropertyDescriptors({name:s,...t[s]}));return e},createNodes(){const t=new Ni({text:!0,enter:this.inline});return this.filterExtensions({bulletList:new qi,orderedList:new Ri,heading:new Fi({levels:this.headings}),horizontalRule:new zi,listItem:new Yi,quote:new Hi,...this.createNodesFromPanelPlugins()},this.nodes,(e,s)=>((e.includes("bulletList")||e.includes("orderedList"))&&s.push(new Yi),!0===this.inline&&(s=s.filter(t=>!0===t.schema.inline)),s.push(t),s))},createNodesFromPanelPlugins(){const t=window.panel.plugins.writerNodes??{},e={};for(const s in t)e[s]=Object.create(wi.prototype,Object.getOwnPropertyDescriptors({name:s,...t[s]}));return e},getHTML(){return this.editor.getHTML()},filterExtensions(t,e,s){!1===e?e=[]:!0!==e&&!1!==Array.isArray(e)||(e=Object.keys(t));let i=[];for(const n in t)e.includes(n)&&i.push(t[n]);return"function"==typeof s&&(i=s(e,i)),i},focus(){this.editor.focus()},getSplitContent(){return this.editor.getHTMLStartToSelectionToEnd()},onBlur(t){var e;!1===this.$el.contains(t.target)&&(null==(e=this.$refs.toolbar)||e.close())},onCommand(t,...e){this.editor.command(t,...e)},async validate(){var t;await new Promise(t=>setTimeout(()=>t(""),50));let e="";!1===this.isEmpty&&this.minlength&&this.characters<this.minlength?e=this.$t("error.validation.minlength",{min:this.minlength}):!1===this.isEmpty&&this.maxlength&&this.characters>this.maxlength&&(e=this.$t("error.validation.maxlength",{max:this.maxlength})),null==(t=this.$refs.output)||t.setCustomValidity(e)}}},function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"direction",rawName:"v-direction"}],ref:"editor",class:["k-writer","k-writer-input",t.$attrs.class],style:t.$attrs.style,attrs:{"data-disabled":t.disabled,"data-empty":t.isEmpty,"data-placeholder":t.placeholder,spellcheck:t.spellcheck}},[t.editor&&!t.disabled?e("k-writer-toolbar",t._b({ref:"toolbar",on:{command:t.onCommand}},"k-writer-toolbar",t.toolbarOptions,!1)):t._e(),e("textarea",{ref:"output",staticClass:"input-hidden",attrs:{name:t.name,required:t.required,tabindex:"-1"},domProps:{value:t.value}})],1)},[]).exports;class Xi extends xi{get schema(){return{content:this.options.nodes.join("|")}}}const Zi={mixins:[Ji],inheritAttrs:!1,props:{nodes:{type:Array,default:()=>["bulletList","orderedList"]}}};const Qi=ut({mixins:[je,Zi],data(){return{list:this.value,html:this.value}},computed:{listExtensions(){return[new Xi({inline:!0,nodes:this.nodes})]}},watch:{value(t){t!==this.html&&(this.list=t,this.html=t)}},methods:{focus(){this.$refs.input.focus()},onInput(t){let e=(new DOMParser).parseFromString(t,"text/html").querySelector("ul, ol");e&&0!==e.textContent.trim().length?(this.list=t,this.html=t.replace(/(<p>|<\/p>)/gi,""),this.$emit("input",this.html)):this.$emit("input",this.list="")}}},function(){var t=this;return(0,t._self._c)("k-writer-input",t._b({ref:"input",class:["k-list-input",t.$attrs.class],style:t.$attrs.style,attrs:{extensions:t.listExtensions,value:t.list},on:{input:t.onInput}},"k-writer-input",t.$props,!1))},[]).exports;const tn=ut({mixins:[Ne,Ve,Zi],inheritAttrs:!1,methods:{focus(){this.$refs.input.focus()}}},function(){var t=this,e=t._self._c;return e("k-field",t._b({class:["k-list-field",t.$attrs.class],style:t.$attrs.style,attrs:{counter:!1,input:t.id}},"k-field",t.$props,!1),[e("k-input",t._b({ref:"input",attrs:{type:"list"},on:{input:function(e){return t.$emit("input",e)}}},"k-input",t.$props,!1))],1)},[]).exports,en={props:{disabled:Boolean,html:{type:Boolean},removable:Boolean,theme:{type:String,default:"dark"}}};const sn=ut({mixins:[en],props:{element:String,image:{type:Object},link:String,text:String},emits:["remove"],computed:{isRemovable(){return this.removable&&!this.disabled}},methods:{remove(){this.isRemovable&&this.$emit("remove")},focus(){this.$el.focus()}}},function(){var t=this,e=t._self._c;return e(t.element??(t.link?"k-link":"button"),{tag:"component",staticClass:"k-tag",attrs:{"aria-disabled":t.disabled,"data-theme":t.theme,to:t.link,type:"button"},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:(e.preventDefault(),t.remove.apply(null,arguments))}}},[t._t("image",function(){var s;return[(null==(s=t.image)?void 0:s.src)?e("k-image-frame",t._b({staticClass:"k-tag-image"},"k-image-frame",t.image,!1)):t.image?e("k-icon-frame",t._b({staticClass:"k-tag-image"},"k-icon-frame",t.image,!1)):t._e()]}),t.text?[t.html?e("span",{staticClass:"k-tag-text",domProps:{innerHTML:t._s(t.text)}}):e("span",{staticClass:"k-tag-text"},[t._v(t._s(t.text))])]:t.$slots.default?[e("span",{staticClass:"k-tag-text"},[t._t("default")],2)]:t._e(),t.isRemovable?e("k-icon-frame",{staticClass:"k-tag-toggle",attrs:{icon:"cancel-small"},nativeOn:{click:function(e){return e.stopPropagation(),t.remove.apply(null,arguments)}}}):t._e()],2)},[]).exports,nn={mixins:[en,Q,ot],inheritAttrs:!1,props:{element:{type:String,default:"div"},layout:String,sort:{default:!1,type:Boolean},value:{default:()=>[],type:Array}}};const on=ut({mixins:[nn],props:{draggable:{default:!0,type:Boolean}},emits:["edit","input"],data:()=>({tags:[]}),computed:{dragOptions(){return{delay:1,disabled:!this.isDraggable,draggable:".k-tag",handle:".k-tag-text"}},isDraggable(){return!0!==this.sort&&!1!==this.draggable&&0!==this.tags.length&&!0!==this.disabled}},watch:{value:{handler(){let t=this.$helper.object.clone(this.value);if(!0===this.sort){const e=[];for(const s of this.options){const i=t.indexOf(s.value);-1!==i&&(e.push(s),t.splice(i,1))}e.push(...t),t=e}this.tags=t.map(this.tag).filter(t=>t)},immediate:!0}},methods:{edit(t,e,s){!1===this.disabled&&this.$emit("edit",t,e,s)},focus(t="last"){this.$refs.navigate.move(t)},index(t){return this.tags.findIndex(e=>e.value===t.value)},input(){this.$emit("input",this.tags.map(t=>t.value))},navigate(t){this.focus(t)},remove(t){this.tags.length<=1?this.navigate("last"):this.navigate("prev"),this.tags.splice(t,1),this.input()},option(t){return this.options.find(e=>e.value===t.value)},select(){this.focus()},tag(t){"object"!=typeof t&&(t={value:t});const e=this.option(t);return e||{text:this.$helper.string.escapeHTML(t.text??t.value),...t}}}},function(){var t=this,e=t._self._c;return e("k-navigate",{ref:"navigate",attrs:{axis:"list"===t.layout?"y":"x",select:":where(.k-tag, .k-tags-navigatable):not(:disabled)"}},[e("k-draggable",{class:["k-tags",t.$attrs.class],style:t.$attrs.style,attrs:{"data-layout":t.layout,element:t.element,list:t.tags,options:t.dragOptions},on:{end:t.input},scopedSlots:t._u([{key:"footer",fn:function(){return[t._t("default")]},proxy:!0}],null,!0)},t._l(t.tags,function(s,i){return e("k-tag",{key:s.id??s.value??s.text,attrs:{disabled:t.disabled,element:t.element,html:t.html,image:s.image,link:s.link,removable:t.removable&&!t.disabled,theme:t.theme,name:"tag"},on:{remove:function(e){return t.remove(i,s)}},nativeOn:{click:function(t){t.stopPropagation()},keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.edit(i,s,e)},dblclick:function(e){return t.edit(i,s,e)}}},[e("span",{domProps:{innerHTML:t._s(s.text)}})])}),1)],1)},[]).exports,rn={mixins:[nt,lt,nn,Ie],props:{value:{default:()=>[],type:Array}},methods:{open(){this.$refs.dropdown.open(this.$el)}}};const an=ut({mixins:[je,rn]},function(){var t=this,e=t._self._c;return e("div",{class:["k-multiselect-input",t.$attrs.class],style:t.$attrs.style},[e("k-input-validator",t._b({attrs:{value:JSON.stringify(t.value),anchor:".k-multiselect-input-toggle"}},"k-input-validator",{min:t.min,max:t.max,required:t.required},!1),[e("k-tags",t._b({ref:"tags",attrs:{removable:!0},on:{input:function(e){return t.$emit("input",e)}},nativeOn:{click:function(e){return e.stopPropagation(),t.open.apply(null,arguments)}}},"k-tags",t.$props,!1),[!t.max||t.value.length<t.max?e("k-button",{ref:"toggle",staticClass:"k-multiselect-input-toggle k-tags-navigatable",attrs:{id:t.id,autofocus:t.autofocus,disabled:t.disabled,size:"xs",icon:"angle-down"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.$refs.tags.focus("prev")},focus:function(e){return t.open.apply(null,arguments)}}}):t._e()],1)],1),e("k-picklist-dropdown",t._b({ref:"dropdown",attrs:{options:t.options},on:{input:function(e){return t.$emit("input",e)}}},"k-picklist-dropdown",t.$props,!1))],1)},[]).exports,ln={mixins:[rn],props:{accept:{type:String,default:"all"},separator:{type:String,default:","}}},cn={extends:an,mixins:[ln],data:()=>({editing:null}),computed:{canAdd(){return!this.max||this.value.length<this.max},creatableOptions(){return this.options.filter(t=>!1===this.value.includes(t.value))},picklist(){return{disabled:this.disabled,create:this.showCreate,ignore:this.ignore,min:this.min,max:this.max,search:this.showSearch}},replacableOptions(){return this.options.filter(t=>{var e;return!1===this.value.includes(t.value)||t.value===(null==(e=this.editing)?void 0:e.tag.value)})},showCreate(){return"options"!==this.accept&&(!this.editing||{submit:this.$t("replace.with")})},showSearch(){return!1!==this.search&&(this.editing?{placeholder:this.$t("replace.with"),...this.search}:"options"===this.accept?{placeholder:this.$t("filter"),...this.search}:this.search)}},methods:{create(t){const e=t.split(this.separator).map(t=>t.trim()),s=this.$helper.object.clone(this.value);for(let i of e)i=this.$refs.tags.tag(i,this.separator),!0===this.isAllowed(i)&&s.push(i.value);this.$emit("input",s),this.$refs.create.close()},async edit(t,e){this.editing={index:t,tag:e},this.$refs.replace.open()},focus(){this.canAdd&&this.$refs.create.open()},isAllowed(t){return"object"==typeof t&&0!==t.value.trim().length&&(!("options"===this.accept&&!this.$refs.tags.option(t))&&!0!==this.value.includes(t.value))},pick(t){this.$emit("input",t),this.$refs.create.close()},replace(t){const{index:e}=this.editing,s=this.$refs.tags.tag(t);if(this.$refs.replace.close(),this.editing=null,!1===this.isAllowed(s))return!1;const i=this.$helper.object.clone(this.value);i.splice(e,1,s.value),this.$emit("input",i),this.$refs.tags.navigate(e)},toggle(t){return!(t.metaKey||t.altKey||t.ctrlKey)&&("ArrowDown"===t.key?(this.$refs.create.open(),void t.preventDefault()):void(String.fromCharCode(t.keyCode).match(/(\w)/g)&&this.$refs.create.open()))}}};const un=ut(cn,function(){var t,e=this,s=e._self._c;return s("div",{staticClass:"k-tags-input",attrs:{"data-can-add":e.canAdd}},[s("k-input-validator",e._b({attrs:{value:JSON.stringify(e.value)}},"k-input-validator",{min:e.min,max:e.max,required:e.required},!1),[s("k-tags",e._b({ref:"tags",attrs:{removable:!0},on:{edit:e.edit,input:function(t){return e.$emit("input",t)}},nativeOn:{click:function(t){var s,i;t.stopPropagation(),null==(i=null==(s=e.$refs.toggle)?void 0:s.$el)||i.click()}}},"k-tags",e.$props,!1),[!e.max||e.value.length<e.max?s("k-button",{ref:"toggle",staticClass:"k-tags-input-toggle k-tags-navigatable input-focus",attrs:{id:e.id,autofocus:e.autofocus,disabled:e.disabled,size:"xs",icon:"add"},on:{click:function(t){return e.$refs.create.open()}},nativeOn:{keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"delete",[8,46],t.key,["Backspace","Delete","Del"])?null:e.$refs.tags.focus("prev")},function(t){return e.toggle.apply(null,arguments)}]}}):e._e()],1)],1),s("k-picklist-dropdown",e._b({ref:"replace",attrs:{multiple:!1,options:e.replacableOptions,value:(null==(t=e.editing)?void 0:t.tag.value)??""},on:{create:e.replace,input:e.replace}},"k-picklist-dropdown",e.picklist,!1)),s("k-picklist-dropdown",e._b({ref:"create",attrs:{options:e.creatableOptions,value:e.value},on:{create:e.create,input:e.pick}},"k-picklist-dropdown",e.picklist,!1))],1)},[]).exports;const pn=ut({mixins:[Ne,Ve,ln,Ds],inheritAttrs:!1,computed:{hasNoOptions(){return 0===this.options.length&&"options"===this.accept}},methods:{focus(){this.$refs.input.focus()}}},function(){var t=this,e=t._self._c;return e("k-field",t._b({class:["k-tags-field",t.$attrs.class],style:t.$attrs.style,attrs:{counter:t.counterOptions,input:t.id}},"k-field",t.$props,!1),[t.hasNoOptions?e("k-empty",{attrs:{icon:t.icon,text:t.$t("options.none")}}):e("k-input",t._b({ref:"input",attrs:{type:"tags"},on:{input:function(e){return t.$emit("input",e)}}},"k-input",t.$props,!1))],1)},[]).exports;const dn=ut({extends:pn,inheritAttrs:!1},function(){var t=this,e=t._self._c;return e("k-field",t._b({class:["k-multiselect-field",t.$attrs.class],style:t.$attrs.style,attrs:{counter:t.counterOptions,input:t.id}},"k-field",t.$props,!1),[t.hasNoOptions?e("k-empty",{attrs:{icon:t.icon,text:t.$t("options.none")}}):e("k-input",t._b({ref:"input",attrs:{type:"multiselect"},on:{input:function(e){return t.$emit("input",e)}}},"k-input",t.$props,!1))],1)},[]).exports,hn={mixins:[Ee,at],props:{max:Number,min:Number,name:[Number,String],preselect:Boolean,step:[Number,String],value:{type:[Number,String],default:""}}},mn={mixins:[je,hn],data(){return{number:this.format(this.value),timeout:null}},watch:{value(t){this.number=t}},mounted(){this.$props.autofocus&&this.focus(),this.$props.preselect&&this.select()},methods:{decimals(){const t=Number(this.step??0);return Math.floor(t)===t?0:-1!==t.toString().indexOf("e")?parseInt(t.toFixed(16).split(".")[1].split("").reverse().join("")).toString().length:t.toString().split(".")[1].length??0},format(t){if(isNaN(t)||""===t)return"";if("any"===this.step)return t;const e=this.decimals();return e?parseFloat(t).toFixed(e):Number.isInteger(this.step)?parseInt(t):parseFloat(t)},clean(){this.number=this.format(this.number)},emit(t){t=parseFloat(t),isNaN(t)&&(t=""),t!==this.value&&this.$emit("input",t)},onInput(t){this.number=t,this.emit(t)},onBlur(){this.clean(),this.emit(this.number)},select(){this.$refs.input.select()}}};const fn=ut(mn,function(){var t=this;return(0,t._self._c)("input",t._b({ref:"input",class:["k-number-input",t.$attrs.class],style:t.$attrs.style,attrs:{type:"number"},on:{blur:t.onBlur,input:function(e){return t.onInput(e.target.value)},keydown:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"s",void 0,e.key,void 0)?null:e.ctrlKey?t.clean.apply(null,arguments):null},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"s",void 0,e.key,void 0)?null:e.metaKey?t.clean.apply(null,arguments):null}]}},"input",{autofocus:t.autofocus,disabled:t.disabled,id:t.id,max:t.max,min:t.min,name:t.name,placeholder:t.placeholder,required:t.required,step:t.step,value:t.number},!1))},[]).exports;const gn=ut({mixins:[Ne,Ve,hn],inheritAttrs:!1,methods:{focus(){this.$refs.input.focus()}}},function(){var t=this,e=t._self._c;return e("k-field",t._b({class:["k-number-field",t.$attrs.class],style:t.$attrs.style,attrs:{input:t.id}},"k-field",t.$props,!1),[e("k-input",t._b({ref:"input",attrs:{type:"number"},on:{input:function(e){return t.$emit("input",e)}}},"k-input",t.$props,!1))],1)},[]).exports,kn={mixins:[Ne,Ve],props:{empty:String,fields:[Object,Array],value:[String,Object]},data:()=>({object:{}}),computed:{hasFields(){return this.$helper.object.length(this.fields)>0},isEmpty(){return null===this.object||0===this.$helper.object.length(this.object)}},watch:{value:{handler(t){this.object=this.valueToObject(t)},immediate:!0}},methods:{add(){this.object=this.$helper.field.form(this.fields),this.save(),this.open()},cell(t,e){this.$set(this.object,t,e),this.save()},form(t){const e=this.$helper.field.subfields(this,this.fields);if(t)for(const s in e)e[s].autofocus=s===t;return e},remove(){this.object={},this.save()},open(t){if(this.disabled)return!1;this.$panel.drawer.open({component:"k-form-drawer",props:{breadcrumb:[],icon:"box",tab:"object",tabs:{object:{fields:this.form(t)}},title:this.label,value:this.object},on:{input:t=>{for(const e in t)this.$set(this.object,e,t[e]);this.save()}}})},save(){this.$emit("input",this.object)},valueToObject:t=>"object"!=typeof t?{}:t}};const bn=ut(kn,function(){var t=this,e=t._self._c;return e("k-field",t._b({staticClass:"k-object-field",attrs:{input:t.id},scopedSlots:t._u([!t.disabled&&t.hasFields?{key:"options",fn:function(){return[t.isEmpty?e("k-button",{attrs:{id:t.id,icon:"add",size:"xs",variant:"filled"},on:{click:t.add}}):e("k-button",{attrs:{icon:"remove",size:"xs",variant:"filled"},on:{click:t.remove}})]},proxy:!0}:null],null,!0)},"k-field",t.$props,!1),[t.hasFields?[t.isEmpty?e("k-empty",{attrs:{icon:"box"},on:{click:t.add}},[t._v(" "+t._s(t.empty??t.$t("field.object.empty"))+" ")]):e("table",{staticClass:"k-table k-object-field-table",attrs:{"aria-disabled":t.disabled}},[e("tbody",[t._l(t.fields,function(s){return[s.saveable&&t.$helper.field.isVisible(s,t.value)?e("tr",{key:s.name,on:{click:function(e){return t.open(s.name)}}},[e("th",{attrs:{"data-has-button":"","data-mobile":"true"}},[e("button",{attrs:{type:"button"}},[t._v(t._s(s.label))])]),e("k-table-cell",{attrs:{column:s,field:s,mobile:!0,value:t.object[s.name]},on:{input:function(e){return t.cell(s.name,e)}}})],1):t._e()]})],2)])]:[e("k-empty",{attrs:{icon:"box"}},[t._v(t._s(t.$t("fields.empty")))])],e("input",{staticClass:"input-hidden",attrs:{type:"checkbox",required:t.required},domProps:{checked:!t.isEmpty}})],2)},[]).exports;const yn=ut({extends:Xs,type:"pages",computed:{emptyProps(){return{icon:"page",text:this.empty??(this.multiple&&1!==this.max?this.$t("field.pages.empty"):this.$t("field.pages.empty.single"))}}}},null,null).exports,vn={mixins:[js],props:{autocomplete:{type:String,default:"new-password"}}};const $n=ut({mixins:[Is,vn]},function(){var t=this;return(0,t._self._c)("k-string-input",t._b({staticClass:"k-password-input",attrs:{type:"password"},on:{input:function(e){return t.$emit("input",e)}}},"k-string-input",t.$props,!1))},[]).exports;const wn=ut({mixins:[Ne,Ve,vn,Ds],inheritAttrs:!1,props:{minlength:{type:Number,default:8},icon:{type:String,default:"key"}},methods:{focus(){this.$refs.input.focus()}}},function(){var t=this,e=t._self._c;return e("k-field",t._b({class:["k-password-field",t.$attrs.class],style:t.$attrs.style,attrs:{counter:t.counterOptions,input:t.id},scopedSlots:t._u([{key:"options",fn:function(){return[t._t("options")]},proxy:!0}],null,!0)},"k-field",t.$props,!1),[e("k-input",t._b({ref:"input",attrs:{type:"password"},on:{input:function(e){return t.$emit("input",e)}}},"k-input",t.$props,!1))],1)},[]).exports,xn={mixins:[Ee,ot],props:{columns:{default:1,type:Number},reset:{default:!0,type:Boolean},theme:String,value:[String,Number,Boolean]}},_n={mixins:[je,xn],computed:{choices(){return this.options.map((t,e)=>({autofocus:this.autofocus&&0===e,checked:this.value===t.value,disabled:this.disabled||t.disabled,id:`${this.id}-${e}`,info:t.info,label:t.text,name:this.name??this.id,type:"radio",value:t.value}))}},methods:{focus(){var t;null==(t=this.$el.querySelector("input"))||t.focus()},select(){this.focus()},toggle(t){t===this.value&&this.reset&&!this.required&&this.$emit("input","")}}};const Sn=ut(_n,function(){var t=this,e=t._self._c;return e("fieldset",{class:["k-radio-input",t.$attrs.class],style:t.$attrs.style,attrs:{disabled:t.disabled}},[e("legend",{staticClass:"sr-only"},[t._v(t._s(t.$t("options")))]),e("k-input-validator",{attrs:{required:t.required,value:JSON.stringify(t.value)}},[e("ul",{staticClass:"k-grid",style:{"--columns":t.columns},attrs:{"data-variant":"choices"}},t._l(t.choices,function(s,i){return e("li",{key:i},[e("k-choice-input",t._b({on:{input:function(e){return t.$emit("input",s.value)}},nativeOn:{click:function(e){return e.stopPropagation(),t.toggle(s.value)}}},"k-choice-input",s,!1))],1)}),0)])],1)},[]).exports;const Cn=ut({mixins:[Ne,Ve,xn],inheritAttrs:!1,methods:{focus(){this.$refs.input.focus()}}},function(){var t,e=this,s=e._self._c;return s("k-field",e._b({class:["k-radio-field",e.$attrs.class],style:e.$attrs.style,attrs:{input:e.id+"-0"}},"k-field",e.$props,!1),[(null==(t=e.options)?void 0:t.length)?s("k-radio-input",e._b({ref:"input",on:{input:function(t){return e.$emit("input",t)}}},"k-radio-input",e.$props,!1)):s("k-empty",{attrs:{text:e.$t("options.none"),icon:"checklist"}})],1)},[]).exports,On={mixins:[Ee],props:{default:[Number,String],max:{type:Number,default:100},min:{type:Number,default:0},step:{type:[Number,String],default:1},tooltip:{type:[Boolean,Object],default:()=>({before:null,after:null})},value:[Number,String]}},An={mixins:[je,On],computed:{baseline(){return this.min<0?0:this.min},isEmpty(){return""===this.value||void 0===this.value||null===this.value},label(){return this.required||this.value||0===this.value?this.format(this.position):"–"},maxLength(){return Math.floor(Math.abs(this.max)).toString().length},position(){return this.value||0===this.value?this.value:this.default??this.baseline}},watch:{value:{handler(){this.validate()},immediate:!0}},mounted(){this.$props.autofocus&&this.focus()},methods:{focus(){var t;null==(t=this.$el.querySelector("input"))||t.focus()},format(t){const e=document.lang?document.lang.replace("_","-"):"en",s=this.step.toString().split("."),i=s.length>1?s[1].length:0;return new Intl.NumberFormat(e,{minimumFractionDigits:i}).format(t)},onInput(t){this.$emit("input",t)},validate(){var t;const e=[];this.required&&!0===this.isEmpty&&e.push(this.$t("error.validation.required")),!1===this.isEmpty&&this.min&&this.value<this.min&&e.push(this.$t("error.validation.min",{min:this.min})),!1===this.isEmpty&&this.max&&this.value>this.max&&e.push(this.$t("error.validation.max",{max:this.max})),null==(t=this.$refs.range)||t.setCustomValidity(e.join(", "))}}};const Mn=ut(An,function(){var t=this,e=t._self._c;return e("div",{class:["k-range-input",t.$attrs.class],style:t.$attrs.style,attrs:{"data-disabled":t.disabled}},[e("input",t._b({ref:"range",attrs:{type:"range"},domProps:{value:t.position},on:{input:function(e){return t.$emit("input",e.target.valueAsNumber)}}},"input",{autofocus:t.autofocus,disabled:t.disabled,id:t.id,max:t.max,min:t.min,name:t.name,required:t.required,step:t.step},!1)),t.tooltip?e("output",{staticClass:"k-range-input-tooltip",attrs:{for:t.id}},[t.tooltip.before?e("span",{staticClass:"k-range-input-tooltip-before"},[t._v(t._s(t.tooltip.before))]):t._e(),e("span",{staticClass:"k-range-input-tooltip-text",style:`--digits: ${t.maxLength}ch`},[t._v(" "+t._s(t.label)+" ")]),t.tooltip.after?e("span",{staticClass:"k-range-input-tooltip-after"},[t._v(t._s(t.tooltip.after))]):t._e()]):t._e()])},[]).exports;const Dn=ut({mixins:[Ve,Ne,On],inheritAttrs:!1,methods:{focus(){this.$refs.input.focus()}}},function(){var t=this,e=t._self._c;return e("k-field",t._b({class:["k-range-field",t.$attrs.class],style:t.$attrs.style,attrs:{input:t.id}},"k-field",t.$props,!1),[e("k-input",t._b({ref:"input",attrs:{type:"range"},on:{input:function(e){return t.$emit("input",e)}}},"k-input",t.$props,!1))],1)},[]).exports,En={mixins:[Ee,ot,at],props:{ariaLabel:String,value:{type:[String,Number,Boolean],default:""}}},jn={mixins:[je,En],emits:["click","input"],computed:{empty(){return this.placeholder??"—"},hasEmptyOption(){return!this.required||this.isEmpty},isEmpty(){return null===this.value||void 0===this.value||""===this.value},label(){const t=this.text(this.value);return this.isEmpty||null===t?this.empty:t}},mounted(){this.$props.autofocus&&this.focus()},methods:{focus(){this.$refs.input.focus()},onClick(t){t.stopPropagation(),this.$emit("click",t)},select(){this.focus()},text(t){let e=null;for(const s of this.options)s.value==t&&(e=s.text);return e}}};const In=ut(jn,function(){var t=this,e=t._self._c;return e("span",{class:["k-select-input",t.$attrs.class],style:t.$attrs.style,attrs:{"data-disabled":t.disabled,"data-empty":t.isEmpty}},[e("select",{ref:"input",staticClass:"k-select-input-native",attrs:{id:t.id,autofocus:t.autofocus,"aria-label":t.ariaLabel,disabled:t.disabled,name:t.name,required:t.required},domProps:{value:t.value},on:{change:function(e){return t.$emit("input",e.target.value)},click:t.onClick}},[t.hasEmptyOption?e("option",{attrs:{disabled:t.required,value:""}},[t._v(" "+t._s(t.empty)+" ")]):t._e(),t._l(t.options,function(s){return e("option",{key:s.value,attrs:{disabled:s.disabled},domProps:{value:s.value}},[t._v(" "+t._s(s.text)+" ")])})],2),t._v(" "+t._s(t.label)+" ")])},[]).exports;const Bn=ut({mixins:[Ne,Ve,En],inheritAttrs:!1,props:{icon:{type:String,default:"angle-down"}},methods:{focus(){this.$refs.input.focus()}}},function(){var t=this,e=t._self._c;return e("k-field",t._b({class:["k-select-field",t.$attrs.class],style:t.$attrs.style,attrs:{input:t.id}},"k-field",t.$props,!1),[e("k-input",t._b({ref:"input",attrs:{type:"select"},on:{input:function(e){return t.$emit("input",e)}}},"k-input",t.$props,!1))],1)},[]).exports,Ln={mixins:[js],props:{autocomplete:null,spellcheck:null,allow:{type:String,default:""},formData:{type:Object,default:()=>({})},sync:{type:String}}},Tn={extends:Is,mixins:[Ln],data(){return{slug:this.sluggify(this.value),slugs:this.$panel.language.rules??this.$panel.system.slugs,syncValue:null}},watch:{formData:{handler(t){return!this.disabled&&(!(!this.sync||void 0===t[this.sync])&&(t[this.sync]!=this.syncValue&&(this.syncValue=t[this.sync],void this.onInput(this.sluggify(this.syncValue)))))},deep:!0,immediate:!0},value(t){(t=this.sluggify(t))!==this.slug&&(this.slug=t,this.$emit("input",this.slug))}},methods:{sluggify(t){return this.$helper.slug(t,[this.slugs,this.$panel.system.ascii],this.allow)},onInput(t){this.slug=this.sluggify(t),this.$emit("input",this.slug)}}};const Pn=ut(Tn,function(){var t=this;return(0,t._self._c)("k-string-input",t._b({staticClass:"k-slug-input",attrs:{spellcheck:!1,value:t.slug,autocomplete:"off"},on:{input:function(e){return t.$emit("input",e)}}},"k-string-input",t.$props,!1))},[]).exports,qn={mixins:[Ne,Ve,Ln],inheritAttrs:!1,props:{icon:{type:String,default:"url"},path:{type:String},wizard:{type:[Boolean,Object],default:!1}},data(){return{slug:this.value}},computed:{preview(){return void 0!==this.help?this.help:void 0!==this.path?this.path+this.value:null}},watch:{value(){this.slug=this.value}},methods:{focus(){this.$refs.input.focus()},onWizard(){var t;let e=null==(t=this.wizard)?void 0:t.field;if(e){const t=this.formData[e.toLowerCase()];t&&(this.slug=t)}}}};const Nn=ut(qn,function(){var t=this,e=t._self._c;return e("k-field",t._b({class:["k-slug-field",t.$attrs.class],style:t.$attrs.style,attrs:{help:t.preview,input:t.id},scopedSlots:t._u([t.wizard&&t.wizard.text?{key:"options",fn:function(){return[e("k-button",{attrs:{text:t.wizard.text,icon:"sparkling",size:"xs",variant:"filled"},on:{click:t.onWizard}})]},proxy:!0}:null],null,!0)},"k-field",t.$props,!1),[e("k-input",t._b({ref:"input",attrs:{value:t.slug,type:"slug"},on:{input:function(e){return t.$emit("input",e)}}},"k-input",t.$props,!1))],1)},[]).exports,Fn={props:{reports:{type:Array,default:()=>[]},size:{type:String,default:"large"}}};const zn=ut({mixins:[Fn]},function(){var t=this,e=t._self._c;return t.reports.length>0?e("dl",{staticClass:"k-stats",attrs:{"data-size":t.size}},t._l(t.reports,function(s,i){return e("k-stat",t._b({key:i},"k-stat",s,!1))}),1):e("k-empty",{attrs:{icon:"chart"}},[t._v(t._s(t.$t("stats.empty")))])},[]).exports;const Yn=ut({mixins:[Z,Q,tt,nt,Fn]},function(){var t=this,e=t._self._c;return e("k-field",{attrs:{id:t.id,help:t.help,input:!1,label:t.label,name:t.name,type:"stats"}},[e("k-stats",{attrs:{reports:t.reports,size:t.size}})],1)},[]).exports,Rn={data:()=>({isSelecting:!1,selected:[]}),created(){this.$events.on(this.batchEditingEvent,this.stopSelectingCollision)},destroyed(){this.$events.off(this.batchEditingEvent,this.stopSelectingCollision)},computed:{batchDeleteConfirmMessage(){return this.$t(`${this.type}.delete.confirm.selected`,{count:this.selected.length})},batchEditingButtons(){const t=[];return t.push({disabled:0===this.selected.length,icon:"trash",text:this.$t("delete")+` (${this.selected.length})`,theme:"negative",click:()=>{this.$panel.dialog.open({component:"k-remove-dialog",props:{text:this.batchDeleteConfirmMessage},on:{submit:async()=>{this.$panel.dialog.close(),0!==this.selected.length&&(await this.onBatchDelete(),this.stopSelecting())}}})},responsive:!0}),t.push({icon:"cancel",text:this.$t("cancel"),click:this.onSelectToggle,responsive:!0}),t},batchEditingEvent:()=>"selecting",batchEditingIdentifier:()=>"id",batchEditingToggle(){return{icon:"checklist",click:this.onSelectToggle,title:this.$t("select"),responsive:!0}},canSelect:()=>!0},methods:{onBatchDelete(){throw new Error("Not implemented")},onSelect(t){this.selected.includes(t)?this.selected=this.selected.filter(e=>e[this.batchEditingIdentifier]!==t[this.batchEditingIdentifier]):this.selected.push(t)},onSelectToggle(){this.isSelecting?this.stopSelecting():this.startSelecting()},startSelecting(){this.isSelecting=!0,this.selected=[],this.$events.emit(this.batchEditingEvent,this.name)},stopSelecting(){this.isSelecting=!1,this.selected=[]},stopSelectingCollision(t){t!==this.name&&this.stopSelecting()}}},Hn={mixins:[Ne,Rn],inheritAttrs:!1,props:{autofocus:Boolean,batch:{type:Boolean,default:!1},columns:Object,duplicate:{type:Boolean,default:!0},empty:String,fields:[Array,Object],limit:Number,max:Number,min:Number,prepend:{type:Boolean,default:!1},sortable:{type:Boolean,default:!0},sortBy:String,value:{type:Array,default:()=>[]}},data:()=>({items:[],page:1}),computed:{batchDeleteConfirmMessage(){return this.$t("field.structure.delete.confirm.selected",{count:this.selected.length})},batchEditingEvent:()=>"structure.selecting",batchEditingIdentifier:()=>"_id",canSelect(){return!0===this.batch&&this.items.length>0},index(){return this.limit?(this.page-1)*this.limit+1:1},hasFields(){return this.$helper.object.length(this.fields)>0},isSortable(){return!this.sortBy&&(!this.limit&&(!0!==this.disabled&&(!(this.items.length<=1)&&!1!==this.sortable)))},more(){return!0!==this.disabled&&!(this.max&&this.items.length>=this.max)},options(){return this.disabled?[]:[{icon:"edit",text:this.$t("edit"),click:"edit"},{disabled:!this.duplicate||!this.more,icon:"copy",text:this.$t("duplicate"),click:"duplicate"},"-",{icon:"trash",text:this.$t("delete"),click:"remove"}]},paginatedItems(){return this.limit?this.items.slice(this.pagination.offset,this.pagination.offset+this.limit):this.items},pagination(){let t=0;return this.limit&&(t=(this.page-1)*this.limit),{page:this.page,offset:t,limit:this.limit,total:this.items.length,align:"center",details:!0}}},watch:{value:{handler(t){this.stopSelecting(),t!==this.items&&(this.items=this.toItems(t))},immediate:!0}},methods:{add(t=null){if(!1===this.more)return!1;t??(t=this.$helper.field.form(this.fields)),t._id??(t._id=this.$helper.uuid()),!0===this.prepend?this.items.unshift(t):this.items.push(t),this.save(),this.open(t)},close(){this.$panel.drawer.close(this.id)},focus(){var t,e;null==(e=null==(t=this.$refs.add)?void 0:t.focus)||e.call(t)},form(t){const e=this.$helper.field.subfields(this,this.fields);if(t)for(const s in e)e[s].autofocus=s===t;return e},findIndex(t){return this.items.findIndex(e=>e._id===t._id)},navigate(t,e){const s=this.findIndex(t);-1!==s&&this.open(this.items[s+e],null,!0)},open(t,e,s=!1){const i=this.findIndex(t);if(-1===i)return!1;this.stopSelecting(),this.$panel.drawer.open({component:"k-structure-drawer",id:this.id,props:{disabled:this.disabled,icon:this.icon??"list-bullet",next:this.items[i+1],prev:this.items[i-1],tabs:{content:{fields:this.form(e)}},title:this.label,value:t},replace:s,on:{input:e=>{const s=this.findIndex(t);this.$panel.drawer.props.next=this.items[s+1],this.$panel.drawer.props.prev=this.items[s-1],this.$set(this.items,s,e),this.save()},next:()=>{this.navigate(t,1)},prev:()=>{this.navigate(t,-1)},remove:()=>{this.remove(t)}}})},option(t,e){switch(t){case"remove":this.remove(e);break;case"duplicate":this.add({...this.$helper.object.clone(e),_id:this.$helper.uuid()});break;case"edit":this.open(e)}},onBatchDelete(){this.removeSelected()},onTableInput(t){this.limit&&(t=this.items.toSpliced(this.pagination.offset,this.limit,...t)),this.save(t)},paginate({page:t}){this.page=t,this.stopSelecting()},remove(t){const e=this.findIndex(t);this.disabled||-1===e||this.$panel.dialog.open({component:"k-remove-dialog",props:{text:this.$t("field.structure.delete.confirm")},on:{submit:()=>{this.items.splice(e,1),this.save(),this.$panel.dialog.close(),this.close(),0===this.paginatedItems.length&&this.page>1&&this.page--}}})},removeAll(){this.$panel.dialog.open({component:"k-remove-dialog",props:{text:this.$t("field.structure.delete.confirm.all")},on:{submit:()=>{this.page=1,this.items=[],this.save(),this.$panel.dialog.close()}}})},removeSelected(){this.items=this.items.filter(t=>!this.selected.includes(t)),this.save()},save(t=this.items){this.$emit("input",t)},sort(t){return this.sortBy?this.$helper.array.sortBy(t,this.sortBy):t},toItems(t){return!1===Array.isArray(t)?[]:(t=t.map(t=>({_id:t._id??this.$helper.uuid(),...t})),this.sort(t))}}};const Un=ut(Hn,function(){var t=this,e=t._self._c;return e("k-field",t._b({class:["k-structure-field",t.$attrs.class],style:t.$attrs.style,attrs:{input:t.id},nativeOn:{click:function(t){t.stopPropagation()}},scopedSlots:t._u([t.hasFields&&!t.disabled?{key:"options",fn:function(){return[t.isSelecting?e("k-button-group",{attrs:{buttons:t.batchEditingButtons,size:"xs",variant:"filled"}}):e("k-button-group",[t.canSelect?[e("k-button",t._b({attrs:{size:"xs",variant:"filled"}},"k-button",t.batchEditingToggle,!1))]:t._e(),e("k-button-group",{attrs:{layout:"collapsed"}},[e("k-button",{attrs:{autofocus:t.autofocus,disabled:!t.more,responsive:!0,text:t.$t("add"),icon:"add",variant:"filled",size:"xs"},on:{click:function(e){return t.add()}}}),e("k-button",{attrs:{icon:"dots",size:"xs",variant:"filled"},on:{click:function(e){return t.$refs.options.toggle()}}}),e("k-dropdown-content",{ref:"options",attrs:{options:[{click:()=>t.add(),disabled:!t.more,icon:"add",text:t.$t("add")},{click:()=>t.removeAll(),disabled:0===t.items.length||t.disabled,icon:"trash",text:t.$t("delete.all")}],"align-x":"end"}})],1)],2)]},proxy:!0}:null],null,!0)},"k-field",t.$props,!1),[e("k-input-validator",t._b({attrs:{value:JSON.stringify(t.items)}},"k-input-validator",{id:t.id,min:t.min,max:t.max,required:t.required},!1),[t.hasFields?[0===t.items.length?e("k-empty",{attrs:{icon:"list-bullet"},on:{click:function(e){return t.add()}}},[t._v(" "+t._s(t.empty??t.$t("field.structure.empty"))+" ")]):[e("k-table",{attrs:{columns:t.columns,disabled:t.disabled,fields:t.fields,empty:t.$t("field.structure.empty"),index:t.index,options:t.options,pagination:!(!t.limit||t.isSelecting)&&t.pagination,rows:t.paginatedItems,selecting:t.isSelecting,sortable:t.isSortable},on:{cell:function(e){return t.open(e.row,e.columnIndex)},input:t.onTableInput,option:t.option,paginate:t.paginate,select:t.onSelect}}),t.more?e("footer",[e("k-button",{attrs:{title:t.$t("add"),icon:"add",size:"xs",variant:"filled"},on:{click:function(e){return t.add()}}})],1):t._e()]]:[e("k-empty",{attrs:{icon:"list-bullet"}},[t._v(t._s(t.$t("fields.empty")))])]],2)],1)},[]).exports,Vn={mixins:[js],props:{autocomplete:{default:"tel"},placeholder:{default:()=>window.panel.t("tel.placeholder")}}};const Kn=ut({mixins:[Is,Vn]},function(){var t=this;return(0,t._self._c)("k-string-input",t._b({staticClass:"k-tel-input",attrs:{type:"tel"},on:{input:function(e){return t.$emit("input",e)}}},"k-string-input",t.$props,!1))},[]).exports;const Wn=ut({mixins:[Ne,Ve,Vn],inheritAttrs:!1,props:{icon:{type:String,default:"phone"}},methods:{focus(){this.$refs.input.focus()}}},function(){var t=this,e=t._self._c;return e("k-field",t._b({class:["k-tel-field",t.$attrs.class],style:t.$attrs.style,attrs:{input:t.id}},"k-field",t.$props,!1),[e("k-input",t._b({ref:"input",attrs:{type:"tel"},on:{input:function(e){return t.$emit("input",e)}}},"k-input",t.$props,!1))],1)},[]).exports,Jn={mixins:[js]};const Gn=ut({mixins:[Is,Jn]},function(){var t=this;return(0,t._self._c)("k-string-input",t._b({class:["k-text-input",t.$attrs.class],attrs:{type:"text"},on:{input:function(e){return t.$emit("input",e)}}},"k-string-input",t.$props,!1))},[]).exports;const Xn=ut({mixins:[Ne,Ve,Jn,Ds],inheritAttrs:!1,computed:{inputType(){return this.$helper.isComponent(`k-${this.type}-input`)?this.type:"text"}},methods:{focus(){this.$refs.input.focus()},select(){this.$refs.input.select()}}},function(){var t=this,e=t._self._c;return e("k-field",t._b({class:["k-text-field",t.$attrs.class],style:t.$attrs.style,attrs:{counter:t.counterOptions,input:t.id},scopedSlots:t._u([{key:"options",fn:function(){return[t._t("options")]},proxy:!0}],null,!0)},"k-field",t.$props,!1),[e("k-input",t._b({ref:"input",attrs:{type:t.inputType},on:{input:function(e){return t.$emit("input",e)}}},"k-input",t.$props,!1))],1)},[]).exports,Zn={props:{buttons:{type:[Array,Boolean],default:!0},uploads:[Boolean,Object,Array]}};const Qn=ut({mixins:[Zn],emits:["command"],computed:{commands(){return{headlines:{label:this.$t("toolbar.button.headings"),icon:"title",dropdown:[{label:this.$t("toolbar.button.heading.1"),icon:"h1",click:()=>this.command("prepend","#")},{label:this.$t("toolbar.button.heading.2"),icon:"h2",click:()=>this.command("prepend","##")},{label:this.$t("toolbar.button.heading.3"),icon:"h3",click:()=>this.command("prepend","###")}]},bold:{label:this.$t("toolbar.button.bold"),icon:"bold",click:()=>this.command("toggle","**"),shortcut:"b"},italic:{label:this.$t("toolbar.button.italic"),icon:"italic",click:()=>this.command("toggle","*"),shortcut:"i"},link:{label:this.$t("toolbar.button.link"),icon:"url",click:()=>this.command("dialog","link"),shortcut:"k"},email:{label:this.$t("toolbar.button.email"),icon:"email",click:()=>this.command("dialog","email"),shortcut:"e"},file:{label:this.$t("toolbar.button.file"),icon:"attachment",click:()=>this.command("file"),dropdown:this.uploads?[{label:this.$t("toolbar.button.file.select"),icon:"check",click:()=>this.command("file")},{label:this.$t("toolbar.button.file.upload"),icon:"upload",click:()=>this.command("upload")}]:void 0},code:{label:this.$t("toolbar.button.code"),icon:"code",click:()=>this.command("toggle","`")},ul:{label:this.$t("toolbar.button.ul"),icon:"list-bullet",click:()=>this.command("insert",(t,e)=>e.split("\n").map(t=>"- "+t).join("\n"))},ol:{label:this.$t("toolbar.button.ol"),icon:"list-numbers",click:()=>this.command("insert",(t,e)=>e.split("\n").map((t,e)=>e+1+". "+t).join("\n"))}}},default:()=>["headlines","|","bold","italic","code","|","link","email","file","|","ul","ol"],layout(){if(!1===this.buttons)return[];const t=[],e=Array.isArray(this.buttons)?this.buttons:this.default,s={...this.commands,...window.panel.plugins.textareaButtons??{}};for(const i of e)if("|"===i)t.push("|");else if(s[i]){const e={...s[i],click:()=>{var t;null==(t=s[i].click)||t.call(this)}};t.push(e)}return t}},methods:{close(){this.$refs.toolbar.close()},command(t,...e){this.$emit("command",t,...e)},shortcut(t,e){var s;const i=this.layout.find(e=>e.shortcut===t);i&&(e.preventDefault(),null==(s=i.click)||s.call(i))}}},function(){return(0,this._self._c)("k-toolbar",{ref:"toolbar",staticClass:"k-textarea-toolbar",attrs:{buttons:this.layout}})},[]).exports,to={mixins:[Zn,Ee,X,st,it,at,ct],props:{endpoints:Object,preselect:Boolean,size:String,value:String}};const eo=ut({mixins:[je,to],emits:["focus","input","submit"],data:()=>({over:!1,selectionRange:null}),computed:{uploadOptions(){return{url:this.$panel.urls.api+"/"+this.endpoints.field+"/upload",multiple:!1,on:{cancel:async()=>await this.restoreSelection(),done:async t=>{await this.restoreSelection(),await this.insertUpload(t)}}}}},watch:{async value(){await this.$nextTick(),this.$library.autosize.update(this.$refs.input)}},async mounted(){await this.$nextTick(),this.$library.autosize(this.$refs.input),this.$props.autofocus&&this.focus(),this.$props.preselect&&this.select()},methods:{dialog(t){this.$panel.dialog.open({component:"k-toolbar-"+t+"-dialog",props:{value:this.parseSelection()},on:{cancel:async()=>await this.restoreSelection(),submit:async t=>{this.$panel.dialog.close(),await this.restoreSelection(),await this.insert(t)}}})},file(){this.$panel.dialog.open({component:"k-files-dialog",props:{endpoint:this.endpoints.field+"/files",multiple:!1},on:{cancel:async()=>await this.restoreSelection(),submit:async t=>{this.$panel.dialog.close(),await this.restoreSelection(),await this.insertFile(t)}}})},focus(){this.$refs.input.focus()},async insert(t){const e=this.$refs.input,s=e.value;if("function"==typeof t&&(t=t(e,this.selection())),this.focus(),document.execCommand("insertText",!1,t),e.value===s){const{start:s,end:i}=this.selectionRange,n=s===i?"end":"select";e.setRangeText(t,s,i,n)}return this.$emit("input",e.value),e.value},async insertFile(t){(null==t?void 0:t.length)>0&&await this.insert(t.map(t=>t.dragText).join("\n\n"))},async insertUpload(t){await this.insertFile(t),await this.$panel.content.update()},onCommand(t,...e){if("function"!=typeof this[t])return console.warn(t+" is not a valid command");this[t](...e)},onDrop(t){if(this.uploads&&this.$helper.isUploadEvent(t))return this.$panel.upload.open(t.dataTransfer.files,this.uploadOptions);"text"===this.$panel.drag.type&&(this.focus(),this.insert(this.$panel.drag.data))},onFocus(t){this.$emit("focus",t)},onInput(t){this.$emit("input",t.target.value)},onOut(){this.$refs.input.blur(),this.over=!1},onOver(t){if(this.uploads&&this.$helper.isUploadEvent(t))return t.dataTransfer.dropEffect="copy",this.focus(),void(this.over=!0);"text"===this.$panel.drag.type&&(t.dataTransfer.dropEffect="copy",this.focus(),this.over=!0)},onSelectionChange(){this.selectionRange={start:this.$refs.input.selectionStart,end:this.$refs.input.selectionEnd}},onShortcut(t){var e;!1!==this.buttons&&"Meta"!==t.key&&"Control"!==t.key&&(null==(e=this.$refs.toolbar)||e.shortcut(t.key,t))},onSubmit(t){return this.$emit("submit",t)},parseSelection(){const t=this.selection();if(0===(null==t?void 0:t.length))return{href:null,title:null};let e;e=this.$panel.config.kirbytext?/^\(link:\s*(?<url>.*?)(?:\s*text:\s*(?<text>.*?))?\)$/is:/^(\[(?<text>.*?)\]\((?<url>.*?)\))|(<(?<link>.*?)>)$/is;const s=e.exec(t);return null!==s?{href:s.groups.url??s.groups.link,title:s.groups.text??null}:{href:null,title:t}},async prepend(t){return this.insert(t+" "+this.selection())},async restoreSelection(){this.selectionRange&&this.$refs.input.setSelectionRange(this.selectionRange.start,this.selectionRange.end),await this.$nextTick()},restoreSelectionCallback(){return async t=>{await this.restoreSelection(),t&&t()}},select(){this.$refs.select()},selection(){if(!this.selectionRange)return"";const{start:t,end:e}=this.selectionRange;return this.$refs.input.value.substring(t,e)},async toggle(t,e){e??(e=t);const s=this.selection();return s.startsWith(t)&&s.endsWith(e)?this.insert(s.slice(t.length).slice(0,s.length-t.length-e.length)):this.wrap(t,e)},upload(){this.$panel.upload.pick(this.uploadOptions)},async wrap(t,e){e??(e=t),await this.insert(t+this.selection()+e)}}},function(){var t=this,e=t._self._c;return e("div",{class:["k-textarea-input",t.$attrs.class],style:t.$attrs.style,attrs:{"data-over":t.over,"data-size":t.size}},[e("div",{staticClass:"k-textarea-input-wrapper"},[t.buttons&&!t.disabled?e("k-textarea-toolbar",{ref:"toolbar",attrs:{buttons:t.buttons,disabled:t.disabled,uploads:t.uploads},on:{command:t.onCommand},nativeOn:{mousedown:function(t){t.preventDefault()}}}):t._e(),e("textarea",t._b({directives:[{name:"direction",rawName:"v-direction"}],ref:"input",staticClass:"k-textarea-input-native",attrs:{"data-font":t.font},on:{click:function(e){var s;null==(s=t.$refs.toolbar)||s.close()},focus:t.onFocus,input:t.onInput,keydown:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.metaKey?t.onSubmit.apply(null,arguments):null},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.ctrlKey?t.onSubmit.apply(null,arguments):null},function(e){return e.metaKey?e.ctrlKey||e.shiftKey||e.altKey?null:t.onShortcut.apply(null,arguments):null},function(e){return e.ctrlKey?e.shiftKey||e.altKey||e.metaKey?null:t.onShortcut.apply(null,arguments):null}],dragover:t.onOver,dragleave:t.onOut,drop:t.onDrop,selectionchange:t.onSelectionChange}},"textarea",{autofocus:t.autofocus,disabled:t.disabled,id:t.id,minlength:t.minlength,name:t.name,placeholder:t.placeholder,required:t.required,spellcheck:t.spellcheck,value:t.value},!1))],1)])},[]).exports;const so=ut({mixins:[Ne,Ve,to,Ds],inheritAttrs:!1,methods:{focus(){this.$refs.input.focus()}}},function(){var t=this,e=t._self._c;return e("k-field",t._b({class:["k-textarea-field",t.$attrs.class],style:t.$attrs.style,attrs:{counter:t.counterOptions,input:t.id}},"k-field",t.$props,!1),[e("k-input",t._b({ref:"input",attrs:{type:"textarea"},on:{input:function(e){return t.$emit("input",e)}}},"k-input",t.$props,!1))],1)},[]).exports,io={props:{max:String,min:String,value:String}},no={mixins:[io],props:{display:{type:String,default:"HH:mm"},step:{type:Object,default:()=>({size:5,unit:"minute"})},type:{type:String,default:"time"}}};const oo=ut({mixins:[Ys,no],computed:{inputType:()=>"time"}},null,null).exports,ro={mixins:[Ne,Ve,no],inheritAttrs:!1,props:{icon:{type:String,default:"clock"},times:{type:Boolean,default:!0}},methods:{focus(){this.$refs.input.focus()},select(t){var e;this.$emit("input",t),null==(e=this.$refs.times)||e.close()}}};const ao=ut(ro,function(){var t=this,e=t._self._c;return e("k-field",t._b({class:["k-time-field",t.$attrs.class],style:t.$attrs.style,attrs:{input:t.id}},"k-field",t.$props,!1),[e("k-input",t._b({ref:"input",attrs:{type:"time"},on:{input:function(e){return t.$emit("input",e??"")}},scopedSlots:t._u([t.times?{key:"icon",fn:function(){return[e("k-button",{staticClass:"k-input-icon-button",attrs:{disabled:t.disabled,icon:t.icon??"clock",title:t.$t("time.select")},on:{click:function(e){return t.$refs.times.toggle()}}}),e("k-dropdown-content",{ref:"times",attrs:{"align-x":"end"}},[e("k-timeoptions-input",{attrs:{display:t.display,value:t.value},on:{input:t.select}})],1)]},proxy:!0}:null],null,!0)},"k-input",t.$props,!1))],1)},[]).exports,lo={mixins:[Ee],props:{checked:{type:Boolean},info:{type:String},label:{type:String},type:{default:"checkbox",type:String},value:{type:[Boolean,Number,String]},variant:{type:String}}};const co=ut({mixins:[je,lo]},function(){var t=this,e=t._self._c;return e("label",{class:["k-choice-input",t.$attrs.class],style:t.$attrs.style,attrs:{"aria-disabled":t.disabled}},[e("input",t._b({class:["invisible"===t.variant?"sr-only":null,t.$attrs.class],attrs:{"data-variant":t.variant},on:{input:function(e){return t.$emit("input",e.target.checked)}}},"input",{autofocus:t.autofocus,id:t.id,checked:t.checked,disabled:t.disabled,name:t.name,required:t.required,type:t.type,value:t.value},!1)),t.label||t.info?e("span",{staticClass:"k-choice-input-label"},[e("span",{staticClass:"k-choice-input-label-text",domProps:{innerHTML:t._s(t.label)}}),t.info?e("span",{staticClass:"k-choice-input-label-info",domProps:{innerHTML:t._s(t.info)}}):t._e()]):t._e()])},[]).exports,uo={mixins:[lo],props:{text:{type:[Array,String]},value:Boolean}};const po=ut({mixins:[je,uo],computed:{labelText(){const t=this.text??[this.$t("off"),this.$t("on")];return Array.isArray(t)?this.value?t[1]:t[0]:t}},mounted(){this.$props.autofocus&&this.focus()},methods:{onEnter(t){"Enter"===t.key&&this.$el.click()},onInput(t){this.$emit("input",t)},select(){this.$el.focus()}}},function(){var t=this;return(0,t._self._c)("k-choice-input",t._b({class:["k-toggle-input",t.$attrs.class],style:t.$attrs.style,attrs:{checked:t.value,disabled:t.disabled,label:t.labelText,type:"checkbox",variant:"toggle"},on:{input:function(e){return t.$emit("input",e)}}},"k-choice-input",t.$props,!1))},[]).exports;const ho=ut({mixins:[Ne,Ve,uo],inheritAttrs:!1,methods:{focus(){this.$refs.input.focus()}}},function(){var t=this,e=t._self._c;return e("k-field",t._b({class:["k-toggle-field",t.$attrs.class],style:t.$attrs.style,attrs:{input:t.id}},"k-field",t.$props,!1),[e("k-input",t._b({ref:"input",attrs:{type:"toggle"},on:{input:function(e){return t.$emit("input",e)}}},"k-input",t.$props,!1))],1)},[]).exports,mo={mixins:[Ee],props:{columns:Number,grow:Boolean,labels:Boolean,options:Array,reset:Boolean,value:[String,Number,Boolean]}},fo={mixins:[je,mo],mounted(){this.$props.autofocus&&this.focus()},methods:{focus(){var t;null==(t=this.$el.querySelector("input[checked]")||this.$el.querySelector("input"))||t.focus()},onClick(t){t===this.value&&this.reset&&!this.required&&this.$emit("input","")},onInput(t){this.$emit("input",t)},select(){this.focus()}}};const go=ut(fo,function(){var t=this,e=t._self._c;return e("fieldset",{class:["k-toggles-input",t.$attrs.class],style:t.$attrs.style,attrs:{disabled:t.disabled}},[e("legend",{staticClass:"sr-only"},[t._v(t._s(t.$t("options")))]),e("k-input-validator",{attrs:{required:t.required,value:JSON.stringify(t.value)}},[e("ul",{style:{"--options":t.columns??t.options.length},attrs:{"data-labels":t.labels}},t._l(t.options,function(s,i){return e("li",{key:i},[e("input",{staticClass:"input-hidden",attrs:{id:t.id+"-"+i,"aria-label":s.text,disabled:t.disabled,name:t.id,type:"radio"},domProps:{value:s.value,checked:t.value===s.value},on:{click:function(e){return t.onClick(s.value)},change:function(e){return t.onInput(s.value)}}}),e("label",{attrs:{for:t.id+"-"+i,title:s.text}},[s.icon?e("k-icon",{attrs:{type:s.icon}}):t._e(),t.labels||!s.icon?e("span",{staticClass:"k-toggles-text",domProps:{innerHTML:t._s(s.text)}}):t._e()],1)])}),0)])],1)},[]).exports,ko={mixins:[Ne,Ve,mo],inheritAttrs:!1,methods:{focus(){this.$refs.input.focus()},onInput(t){this.$emit("input",t)}}};const bo=ut(ko,function(){var t,e=this,s=e._self._c;return s("k-field",e._b({class:["k-toggles-field",e.$attrs.class],style:e.$attrs.style,attrs:{input:e.id}},"k-field",e.$props,!1),[(null==(t=e.options)?void 0:t.length)?s("k-input",e._b({ref:"input",class:{grow:e.grow},attrs:{type:"toggles"},on:{input:function(t){return e.$emit("input",t)}}},"k-input",e.$props,!1)):s("k-empty",{attrs:{text:e.$t("options.none"),icon:"checklist"}})],1)},[]).exports,yo={mixins:[js],props:{autocomplete:{type:String,default:"url"},placeholder:{type:String,default:()=>window.panel.t("url.placeholder")}}};const vo=ut({mixins:[Is,yo],watch:{value:{handler(){this.validate()},immediate:!0}},methods:{validate(){var t;const e=[];this.value&&!1===this.$helper.url.isUrl(this.value,!0)&&e.push(this.$t("error.validation.url")),null==(t=this.$el)||t.setCustomValidity(e.join(", "))}}},function(){var t=this;return(0,t._self._c)("k-string-input",t._b({staticClass:"k-url-input",attrs:{type:"url"},on:{input:function(e){return t.$emit("input",e)}}},"k-string-input",t.$props,!1))},[]).exports;const $o=ut({mixins:[Ne,Ve,yo],inheritAttrs:!1,props:{link:{type:Boolean,default:!0},icon:{type:String,default:"url"}},computed:{isValidUrl(){return""!==this.value&&!0===this.$helper.url.isUrl(this.value,!0)}},methods:{focus(){this.$refs.input.focus()}}},function(){var t=this,e=t._self._c;return e("k-field",t._b({class:["k-url-field",t.$attrs.class],style:t.$attrs.style,attrs:{input:t.id}},"k-field",t.$props,!1),[e("k-input",t._b({ref:"input",attrs:{type:"url"},on:{input:function(e){return t.$emit("input",e)}},scopedSlots:t._u([{key:"icon",fn:function(){return[t.link&&t.isValidUrl?e("k-button",{staticClass:"k-input-icon-button",attrs:{icon:t.icon,link:t.value,title:t.$t("open"),tabindex:"-1",target:"_blank"}}):t._e()]},proxy:!0}])},"k-input",t.$props,!1))],1)},[]).exports;const wo=ut({extends:Xs,type:"users",computed:{emptyProps(){return{icon:"users",text:this.empty??(this.multiple&&1!==this.max?this.$t("field.users.empty"):this.$t("field.users.empty.single"))}}}},null,null).exports;const xo=ut({mixins:[Ne,Ve,Ji,Ds],inheritAttrs:!1,computed:{counterValue(){const t=this.$helper.string.stripHTML(this.value??"");return this.$helper.string.unescapeHTML(t)}},methods:{focus(){this.$refs.input.focus()}}},function(){var t=this,e=t._self._c;return e("k-field",t._b({class:["k-writer-field",t.$attrs.class],style:t.$attrs.style,attrs:{counter:t.counterOptions,input:t.id}},"k-field",t.$props,!1),[e("k-input",t._b({ref:"input",attrs:{after:t.after,before:t.before,icon:t.icon,type:"writer"},on:{input:function(e){return t.$emit("input",e)}}},"k-input",t.$props,!1))],1)},[]).exports,_o={install(t){t.component("k-blocks-field",Cs),t.component("k-checkboxes-field",Es),t.component("k-color-field",qs),t.component("k-date-field",Hs),t.component("k-email-field",Ks),t.component("k-entries-field",Js),t.component("k-files-field",Zs),t.component("k-gap-field",Qs),t.component("k-headline-field",ti),t.component("k-info-field",ei),t.component("k-layout-field",ci),t.component("k-line-field",ui),t.component("k-link-field",di),t.component("k-list-field",tn),t.component("k-multiselect-field",dn),t.component("k-number-field",gn),t.component("k-object-field",bn),t.component("k-pages-field",yn),t.component("k-password-field",wn),t.component("k-radio-field",Cn),t.component("k-range-field",Dn),t.component("k-select-field",Bn),t.component("k-slug-field",Nn),t.component("k-stats-field",Yn),t.component("k-structure-field",Un),t.component("k-tags-field",pn),t.component("k-text-field",Xn),t.component("k-textarea-field",so),t.component("k-tel-field",Wn),t.component("k-time-field",ao),t.component("k-toggle-field",ho),t.component("k-toggles-field",bo),t.component("k-url-field",$o),t.component("k-users-field",wo),t.component("k-writer-field",xo)}},So={mixins:[On],props:{max:null,min:null,step:{default:.01,type:Number},tooltip:{default:!1,type:[Boolean,Object]}}};const Co=ut({mixins:[Mn,So]},function(){var t=this;return(0,t._self._c)("k-range-input",t._b({staticClass:"k-alpha-input",attrs:{min:0,max:1},on:{input:function(e){return t.$emit("input",e)}}},"k-range-input",t.$props,!1))},[]).exports,Oo=["sun","mon","tue","wed","thu","fri","sat"];const Ao=ut({mixins:[Ee,Ns],data(){const t=this.$library.dayjs();return{maxdate:null,mindate:null,month:t.month(),selected:null,today:t,year:t.year()}},computed:{numberOfDays(){return this.toDate().daysInMonth()},firstWeekday(){const t=Oo[this.toDate().day()];return this.weekdays.indexOf(t)},weekdays(){const t=this.$panel.translation.weekday;return[...Oo.slice(t),...Oo.slice(0,t)]},weeks(){return Math.ceil((this.numberOfDays+this.firstWeekday)/7)},monthnames(){return["january","february","march","april","may","june","july","august","september","october","november","december"].map(t=>this.$t("months."+t))},months(){var t=[];return this.monthnames.forEach((e,s)=>{t.push({value:s,text:e})}),t},years(){const t=this.year-20,e=this.year+20;return this.toOptions(t,e)}},watch:{max:{handler(t,e){t!==e&&(this.maxdate=this.$library.dayjs.interpret(t,"date"))},immediate:!0},min:{handler(t,e){t!==e&&(this.mindate=this.$library.dayjs.interpret(t,"date"))},immediate:!0},value:{handler(t,e){t!==e&&(this.selected=this.$library.dayjs.interpret(t,"date"),this.show(this.selected))},immediate:!0}},methods:{days(t){let e=[];const s=7*(t-1)+1,i=s+7;for(let n=s;n<i;n++){const t=n-this.firstWeekday,s=t<=0||t>this.numberOfDays;e.push(s?"":t)}return e},isDisabled(t){const e=this.toDate(t);return this.disabled||e.isBefore(this.mindate,"day")||e.isAfter(this.maxdate,"day")},isSelected(t){return this.toDate(t).isSame(this.selected,"day")},isToday(t){return this.toDate(t).isSame(this.today,"day")},onNext(){const t=this.toDate().add(1,"month");this.show(t)},onPrev(){const t=this.toDate().subtract(1,"month");this.show(t)},select(t){this.$emit("input",(null==t?void 0:t.toISO("date"))??null)},show(t){this.month=(t??this.today).month(),this.year=(t??this.today).year()},toDate(t=1,e){return this.$library.dayjs(`${this.year}-${(e??this.month)+1}-${t}`)},toOptions(t,e){for(var s=[],i=t;i<=e;i++)s.push({value:i,text:this.$helper.pad(i)});return s}}},function(){var t=this,e=t._self._c;return e("fieldset",{class:["k-calendar-input",t.$attrs.class],style:t.$attrs.style,on:{click:function(t){t.stopPropagation()}}},[e("legend",{staticClass:"sr-only"},[t._v(t._s(t.$t("date.select")))]),e("nav",[e("k-button",{attrs:{title:t.$t("prev"),icon:"angle-left"},on:{click:t.onPrev}}),e("span",{staticClass:"k-calendar-selects"},[e("k-select-input",{attrs:{"aria-label":t.$t("month"),autofocus:t.autofocus,options:t.months,empty:!1,required:!0,value:t.month},on:{input:function(e){t.month=Number(e)}}}),e("k-select-input",{attrs:{"aria-label":t.$t("year"),options:t.years,empty:!1,required:!0,value:t.year},on:{input:function(e){t.year=Number(e)}}})],1),e("k-button",{attrs:{title:t.$t("next"),icon:"angle-right"},on:{click:t.onNext}})],1),e("table",{key:t.year+"-"+t.month,staticClass:"k-calendar-table"},[e("thead",[e("tr",t._l(t.weekdays,function(s){return e("th",{key:"weekday_"+s},[t._v(" "+t._s(t.$t("days."+s))+" ")])}),0)]),e("tbody",t._l(t.weeks,function(s){return e("tr",{key:"week_"+s},t._l(t.days(s),function(s,i){return e("td",{key:"day_"+i,staticClass:"k-calendar-day",attrs:{"aria-current":!!t.isToday(s)&&"date","aria-selected":!!t.isSelected(s)&&"date"}},[s?e("k-button",{attrs:{disabled:t.isDisabled(s),text:s},on:{click:function(e){t.select(t.toDate(s))}}}):t._e()],1)}),0)}),0),e("tfoot",[e("tr",[e("td",{staticClass:"k-calendar-today",attrs:{colspan:"7"}},[e("k-button",{attrs:{disabled:t.disabled,text:t.$t("today")},on:{click:function(e){t.show(t.today),t.select(t.today)}}})],1)])])]),e("input",{staticClass:"input-hidden",attrs:{id:t.id,disabled:t.disabled,min:t.min,max:t.max,name:t.name,required:t.required,tabindex:"-1",type:"date"},domProps:{value:t.value}})])},[]).exports;const Mo=ut({extends:co},null,null).exports,Do={mixins:[Sn,{mixins:[xn],props:{format:{type:String,default:"hex",validator:t=>["hex","rgb","hsl"].includes(t)},value:{type:String}}}],computed:{choices(){return this.options.map(t=>({...t,title:t.text??t.value,value:this.colorToString(t.value)}))}},methods:{colorToString(t){try{return this.$library.colors.toString(t,this.format)}catch{return t}}}};const Eo=ut(Do,function(){var t=this,e=t._self._c;return t.choices.length?e("fieldset",{staticClass:"k-coloroptions-input",attrs:{disabled:t.disabled}},[e("legend",{staticClass:"sr-only"},[t._v(t._s(t.$t("options")))]),e("ul",t._l(t.choices,function(s,i){return e("li",{key:i},[e("label",{attrs:{title:s.title}},[e("input",{staticClass:"input-hidden",attrs:{autofocus:t.autofocus&&0===i,disabled:t.disabled,name:t.name??t.id,required:t.required,type:"radio"},domProps:{checked:s.value===t.value,value:s.value},on:{click:function(e){return t.toggle(s.value)},input:function(e){return t.$emit("input",s.value)}}}),e("k-color-frame",{attrs:{color:s.value}})],1)])}),0)]):t._e()},[]).exports,jo={mixins:[je,{mixins:[Ee,ot],props:{alpha:{default:!0,type:Boolean},format:{default:"hex",type:String,validator:t=>["hex","rgb","hsl"].includes(t)},value:{type:[Object,String]}}}],data:()=>({color:{h:0,s:0,v:1,a:1},formatted:null}),computed:{coords(){return this.value?{x:100*this.color.s,y:100*(1-this.color.v)}:null},hsl(){try{const t=this.$library.colors.convert(this.color,"hsl");return{h:t.h,s:(100*t.s).toFixed()+"%",l:(100*t.l).toFixed()+"%",a:t.a}}catch{return{h:0,s:"0%",l:"0%",a:1}}}},watch:{value:{handler(t,e){if(t===e||t===this.formatted)return;const s=this.$library.colors.parseAs(t??"","hsv");s?(this.formatted=this.$library.colors.toString(s,this.format),this.color=s):(this.formatted=null,this.color={h:0,s:0,v:1,a:1})},immediate:!0}},methods:{between:(t,e,s)=>Math.min(Math.max(t,e),s),emit(){return this.formatted=this.$library.colors.toString(this.color,this.format),this.$emit("input",this.formatted)},focus(){this.$refs.coords.focus()},setAlpha(t){this.color.a=this.alpha?this.between(Number(t),0,1):1,this.emit()},setCoords(t){if(!t)return this.$emit("input","");const e=Math.round(t.x),s=Math.round(t.y);this.color.s=this.between(e/100,0,1),this.color.v=this.between(1-s/100,0,1),this.emit()},setHue(t){this.color.h=this.between(Number(t),0,360),this.emit()}}};const Io=ut(jo,function(){var t=this,e=t._self._c;return e("fieldset",{class:["k-colorpicker-input",t.$attrs.class],style:{"--h":t.hsl.h,"--s":t.hsl.s,"--l":t.hsl.l,"--a":t.hsl.a,...t.$attrs.style}},[e("legend",{staticClass:"sr-only"},[t._v(t._s(t.$t("color")))]),e("k-coords-input",{ref:"coords",attrs:{autofocus:t.autofocus,disabled:t.disabled,required:t.required,value:t.coords},on:{input:function(e){return t.setCoords(e)}}}),e("label",{attrs:{"aria-label":t.$t("hue")}},[e("k-hue-input",{attrs:{disabled:t.disabled,required:t.required,value:t.color.h},on:{input:function(e){return t.setHue(e)}}})],1),t.alpha?e("label",{attrs:{"aria-label":t.$t("alpha")}},[e("k-alpha-input",{attrs:{disabled:t.disabled,required:t.required,value:t.color.a},on:{input:function(e){return t.setAlpha(e)}}})],1):t._e(),e("k-coloroptions-input",{attrs:{disabled:t.disabled,format:t.format,options:t.options,required:t.required,value:t.value},on:{input:function(e){return t.$emit("input",e)}}}),e("input",{staticClass:"input-hidden",attrs:{name:t.name,required:t.required,tabindex:"-1",type:"text"},domProps:{value:t.formatted}})],1)},[]).exports,Bo={mixins:[je,{mixins:[Ee],props:{reset:{default:!0,type:Boolean},value:{default:()=>({x:0,y:0}),type:Object}}}],data:()=>({x:0,y:0}),watch:{value:{handler(t){const e=this.parse(t);this.x=(null==e?void 0:e.x)??0,this.y=(null==e?void 0:e.y)??0},immediate:!0}},methods:{focus(){var t;null==(t=this.$el.querySelector("button"))||t.focus()},getCoords:(t,e)=>({x:Math.min(Math.max(t.clientX-e.left,0),e.width),y:Math.min(Math.max(t.clientY-e.top,0),e.height)}),onDelete(){this.reset&&!this.required&&this.$emit("input",null)},onDrag(t){if(0!==t.button)return;const e=t=>this.onMove(t),s=()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",s)};window.addEventListener("mousemove",e),window.addEventListener("mouseup",s)},onEnter(){var t;null==(t=this.$el.form)||t.requestSubmit()},onInput(t,e){if(t.preventDefault(),t.stopPropagation(),this.disabled)return!1;this.x=Math.min(Math.max(parseFloat(e.x??this.x??0),0),100),this.y=Math.min(Math.max(parseFloat(e.y??this.y??0),0),100),this.$emit("input",{x:this.x,y:this.y})},onKeys(t){const e=t.shiftKey?10:1,s={ArrowUp:{y:this.y-e},ArrowDown:{y:this.y+e},ArrowLeft:{x:this.x-e},ArrowRight:{x:this.x+e}};s[t.key]&&this.onInput(t,s[t.key])},async onMove(t){const e=this.$el.getBoundingClientRect(),s=this.getCoords(t,e),i=s.x/e.width*100,n=s.y/e.height*100;this.onInput(t,{x:i,y:n}),await this.$nextTick(),this.focus()},parse(t){if("object"==typeof t)return t;const e={"top left":{x:0,y:0},"top center":{x:50,y:0},"top right":{x:100,y:0},"center left":{x:0,y:50},center:{x:50,y:50},"center center":{x:50,y:50},"center right":{x:100,y:50},"bottom left":{x:0,y:100},"bottom center":{x:50,y:100},"bottom right":{x:100,y:100}};if(e[t])return e[t];const s=t.split(",").map(t=>t.trim());return{x:s[0],y:s[1]??0}}}};const Lo=ut(Bo,function(){var t=this,e=t._self._c;return e("div",{class:["k-coords-input",t.$attrs.class],style:t.$attrs.style,attrs:{"aria-disabled":t.disabled,"data-empty":!t.value},on:{mousedown:t.onDrag,click:t.onMove,keydown:t.onKeys}},[t._t("default"),e("button",{staticClass:"k-coords-input-thumb",style:{left:`${t.x}%`,top:`${t.y}%`},attrs:{id:t.id,autofocus:t.autofocus,disabled:t.disabled},on:{keydown:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.onEnter.apply(null,arguments))},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.onDelete.apply(null,arguments)}]}}),e("input",{staticClass:"input-hidden",attrs:{name:t.name,required:t.required,tabindex:"-1",type:"text"},domProps:{value:t.value?[t.value.x,t.value.y]:null}})],2)},[]).exports,To={mixins:[On],props:{max:null,min:null,step:{default:1,type:Number},tooltip:{default:!1,type:[Boolean,Object]}}};const Po=ut({mixins:[Mn,To]},function(){var t=this;return(0,t._self._c)("k-range-input",t._b({staticClass:"k-hue-input",attrs:{min:0,max:360},on:{input:function(e){return t.$emit("input",e)}}},"k-range-input",t.$props,!1))},[]).exports;const qo=ut({mixins:[Is,{mixins:[js],props:{autocomplete:null,pattern:null,spellcheck:null,placeholder:{default:()=>window.panel.t("search")+" …",type:String}}}]},function(){var t=this;return(0,t._self._c)("k-string-input",t._b({staticClass:"k-search-input",attrs:{spellcheck:!1,autocomplete:"off",type:"search"},on:{input:function(e){return t.$emit("input",e)}}},"k-string-input",t.$props,!1))},[]).exports;const No=ut({mixins:[je,{mixins:[Ee,io]}],props:{display:{type:String,default:"HH:mm"},value:String},computed:{day(){return this.formatTimes([6,7,8,9,10,11,"-",12,13,14,15,16,17])},night(){return this.formatTimes([18,19,20,21,22,23,"-",0,1,2,3,4,5])}},methods:{focus(){this.$el.querySelector("button").focus()},formatTimes(t){return t.map(t=>{if("-"===t)return t;const e=this.$library.dayjs(t+":00","H:mm");return{display:e.format(this.display),select:e.toISO("time")}})},select(t){this.$emit("input",t)}}},function(){var t=this,e=t._self._c;return e("div",{class:["k-timeoptions-input",t.$attrs.class],style:t.$attrs.style},[e("div",[e("h3",[e("k-icon",{attrs:{type:"sun"}}),t._v(" "),e("span",{staticClass:"sr-only"},[t._v(t._s(t.$t("day")))])],1),e("ul",t._l(t.day,function(s,i){return e("li",{key:s.select},["-"===s?e("hr"):e("k-button",{attrs:{autofocus:t.autofocus&&0===i,disabled:t.disabled,selected:s.select===t.value&&"time"},on:{click:function(e){return t.select(s.select)}}},[t._v(" "+t._s(s.display)+" ")])],1)}),0)]),e("div",[e("h3",[e("k-icon",{attrs:{type:"moon"}}),t._v(" "),e("span",{staticClass:"sr-only"},[t._v(t._s(t.$t("night")))])],1),e("ul",t._l(t.night,function(s){return e("li",{key:s.select},["-"===s?e("hr"):e("k-button",{attrs:{disabled:t.disabled,selected:s.select===t.value&&"time"},on:{click:function(e){return t.select(s.select)}}},[t._v(" "+t._s(s.display)+" ")])],1)}),0)]),e("input",{staticClass:"input-hidden",attrs:{id:t.id,disabled:t.disabled,min:t.min,max:t.max,name:t.name,required:t.required,tabindex:"-1",type:"time"},domProps:{value:t.value}})])},[]).exports;class Fo extends HTMLElement{static get observedAttributes(){return["min","max","required","value"]}attributeChangedCallback(t,e,s){this[t]=s}constructor(){super(),this.internals=this.attachInternals(),this.entries=[],this.max=null,this.min=null,this.required=!1}connectedCallback(){this.tabIndex=0;const t=this.getAttribute("id");t&&(this.input.setAttribute("id",t),this.removeAttribute("id")),this.validate()}checkValidity(){return this.internals.checkValidity()}get form(){return this.internals.form}has(t){return this.entries.includes(t)}get input(){return this.querySelector(this.getAttribute("anchor"))??this.querySelector("input, textarea, select, button")??this.querySelector(":scope > *")}get isEmpty(){return 0===this.selected.length}get name(){return this.getAttribute("name")}reportValidity(){return this.internals.reportValidity()}get type(){return this.localName}validate(){const t=parseInt(this.getAttribute("max")),e=parseInt(this.getAttribute("min"));this.hasAttribute("required")&&"false"!==this.getAttribute("required")&&0===this.entries.length?this.internals.setValidity({valueMissing:!0},window.panel.$t("error.validation.required"),this.input):this.hasAttribute("min")&&this.entries.length<e?this.internals.setValidity({rangeUnderflow:!0},window.panel.$t("error.validation.min",{min:e}),this.input):this.hasAttribute("max")&&this.entries.length>t?this.internals.setValidity({rangeOverflow:!0},window.panel.$t("error.validation.max",{max:t}),this.input):this.internals.setValidity({})}get validity(){return this.internals.validity}get validationMessage(){return this.internals.validationMessage}get value(){return JSON.stringify(this.entries??[])}set value(t){this.entries=("string"==typeof t?JSON.parse(t):[])??[],this.validate()}get willValidate(){return this.internals.willValidate}}var zo;((t,s,i)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i})(Fo,"symbol"!=typeof(zo="formAssociated")?zo+"":zo,!0);const Yo=ut({extends:"k-writer-input",created(){window.panel.deprecated("`k-writer` will be removed in a future version. Use `k-writer-input` instead.")}},null,null).exports,Ro={install(t){customElements.define("k-input-validator",Fo),t.component("k-alpha-input",Co),t.component("k-calendar-input",Ao),t.component("k-checkbox-input",Mo),t.component("k-checkboxes-input",Ms),t.component("k-choice-input",co),t.component("k-colorname-input",Ts),t.component("k-coloroptions-input",Eo),t.component("k-colorpicker-input",Io),t.component("k-coords-input",Lo),t.component("k-date-input",Ys),t.component("k-email-input",Vs),t.component("k-hue-input",Po),t.component("k-list-input",Qi),t.component("k-multiselect-input",an),t.component("k-number-input",fn),t.component("k-password-input",$n),t.component("k-picklist-input",Le),t.component("k-radio-input",Sn),t.component("k-range-input",Mn),t.component("k-search-input",qo),t.component("k-select-input",In),t.component("k-slug-input",Pn),t.component("k-string-input",Is),t.component("k-tags-input",un),t.component("k-tel-input",Kn),t.component("k-text-input",Gn),t.component("k-textarea-input",eo),t.component("k-time-input",oo),t.component("k-timeoptions-input",No),t.component("k-toggle-input",po),t.component("k-toggles-input",go),t.component("k-url-input",vo),t.component("k-writer-input",Gi),t.component("k-calendar",Ao),t.component("k-times",No),t.component("k-writer",Yo)}};const Ho=ut({mixins:[Lt],inheritAttrs:!1,props:{cancelButton:{default:!1},label:{default(){return this.$t("field.layout.select")},type:String},layouts:{type:Array},selector:Object,submitButton:{default:!1},value:{type:Array}},emits:["cancel","input","submit"]},function(){var t,e,s=this,i=s._self._c;return i("k-dialog",s._b({class:["k-layout-selector",s.$attrs.class],style:s.$attrs.style,attrs:{size:(null==(t=s.selector)?void 0:t.size)??"medium"},on:{cancel:function(t){return s.$emit("cancel")},submit:function(t){return s.$emit("submit",s.value)}}},"k-dialog",s.$props,!1),[i("h3",{staticClass:"k-label"},[s._v(s._s(s.label))]),i("k-navigate",{staticClass:"k-layout-selector-options",style:{"--columns":Number((null==(e=s.selector)?void 0:e.columns)??3)},attrs:{axis:"x"}},s._l(s.layouts,function(t,e){return i("button",{key:e,staticClass:"k-layout-selector-option",attrs:{"aria-current":s.value===t,"aria-label":t.join(","),value:t},on:{click:function(e){return s.$emit("input",t)}}},[i("k-grid",{attrs:{"aria-hidden":""}},s._l(t,function(t,e){return i("k-column",{key:e,attrs:{width:t}})}),1)],1)}),0)],1)},[]).exports,Uo={install(t){t.component("k-layout",oi),t.component("k-layout-column",ii),t.component("k-layouts",li),t.component("k-layout-selector",Ho)}},Vo={inheritAttrs:!1,props:{column:{default:()=>({}),type:Object},field:{default:()=>({}),type:Object},value:{}}};const Ko=ut({mixins:[Vo],props:{html:{type:Boolean},value:{default:()=>[],type:[Array,String]}},computed:{tags(){let t=this.value;const e=this.column.options??this.field.options??[];return"string"==typeof t&&(t=t.split(",")),(t??[]).map(t=>{"string"==typeof t&&(t={value:t,text:t});for(const s of e)s.value===t.value&&(t.text=s.text);return t})}}},function(){var t=this,e=t._self._c;return e("ul",{class:["k-tags-field-preview","k-tags",t.$options.class,t.$attrs.class],style:t.$attrs.style},t._l(t.tags,function(s,i){return e("li",{key:s.id??s.value??s.text??i},[e("k-tag",{attrs:{html:t.html,image:s.image,link:s.link,text:s.text,element:"div",theme:"light"}})],1)}),0)},[]).exports;const Wo=ut({extends:Ko,inheritAttrs:!1,class:"k-array-field-preview",computed:{tags(){return[{text:1===this.value.length?`1 ${this.$t("entry")}`:`${this.value.length} ${this.$t("entries")}`}]}}},null,null).exports,Jo={props:{html:{type:Boolean}}};const Go=ut({mixins:[Jo],inheritAttrs:!1,props:{bubbles:[Array,String]},computed:{items(){let t=this.bubbles;return"string"==typeof t&&(t=t.split(",")),t.map(t=>"string"===t?{text:t}:t)}},mounted(){window.panel.deprecated("<k-bubbles> will be removed in a future version. Use <k-tags> instead.")}},function(){var t=this,e=t._self._c;return e("ul",{class:["k-bubbles",t.$attrs.class],style:t.$attrs.style},t._l(t.items,function(s,i){return e("li",{key:i},[e("k-bubble",t._b({attrs:{html:t.html}},"k-bubble",s,!1))],1)}),0)},[]).exports;const Xo=ut({mixins:[Vo,Jo],props:{value:{default:()=>[],type:[Array,String]}},computed:{bubbles(){let t=this.value;const e=this.column.options??this.field.options??[];return"string"==typeof t&&(t=t.split(",")),(t??[]).map(t=>{"string"==typeof t&&(t={value:t,text:t});for(const s of e)s.value===t.value&&(t.text=s.text);return t})}},mounted(){window.panel.deprecated("<k-bubbles-field-preview> will be removed in a future version. Use <k-tags-field-preview> instead.")}},function(){var t=this,e=t._self._c;return e("div",{class:["k-bubbles-field-preview",t.$options.class,t.$attrs.class],style:t.$attrs.style},[e("k-bubbles",{attrs:{bubbles:t.bubbles,html:t.html}})],1)},[]).exports,Zo={mixins:[Vo],props:{value:String},computed:{text(){var t;if(!this.value)return;const e=this.$library.colors.toString(this.value,this.field.format,this.field.alpha),s=null==(t=this.field.options)?void 0:t.find(t=>this.$library.colors.toString(t.value,this.field.format,this.field.alpha)===e);return s?s.text:null}}};const Qo=ut(Zo,function(){var t=this,e=t._self._c;return e("div",{class:["k-color-field-preview",t.$attrs.class],style:t.$attrs.style},[e("k-color-frame",{attrs:{color:t.value}}),t.text?[t._v(" "+t._s(t.text)+" ")]:t._e()],2)},[]).exports;const tr=ut({mixins:[Vo],computed:{text(){return this.value}}},function(){var t=this;return(0,t._self._c)("p",{class:["k-text-field-preview",t.$options.class,t.$attrs.class],style:t.$attrs.style},[t._v(" "+t._s(t.column.before)+" "),t._t("default",function(){return[t._v(t._s(t.text))]}),t._v(" "+t._s(t.column.after)+" ")],2)},[]).exports;const er=ut({extends:tr,props:{value:String},class:"k-date-field-preview",computed:{display(){return this.column.display??this.field.display},format(){var t;let e=this.display??"YYYY-MM-DD";return(null==(t=this.time)?void 0:t.display)&&(e+=" "+this.time.display),e},parsed(){return this.$library.dayjs(this.value)},text(){var t;return!1===this.parsed.isValid()?this.value:null==(t=this.parsed)?void 0:t.format(this.format)},time(){return this.column.time??this.field.time}}},null,null).exports;const sr=ut({mixins:[Vo],props:{value:[String,Object]},computed:{link(){return"object"==typeof this.value?this.value.href:this.value},text(){return"object"==typeof this.value?this.value.text:this.link}}},function(){var t=this,e=t._self._c;return e("p",{class:["k-url-field-preview",t.$options.class,t.$attrs.class],style:t.$attrs.style,attrs:{"data-link":Boolean(t.link)}},[t._v(" "+t._s(t.column.before)+" "),e("k-link",{attrs:{to:t.link},nativeOn:{click:function(t){t.stopPropagation()}}},[e("span",[t._v(t._s(t.text))])]),t._v(" "+t._s(t.column.after)+" ")],1)},[]).exports;const ir=ut({extends:sr,class:"k-email-field-preview"},null,null).exports;const nr=ut({extends:Ko,class:"k-files-field-preview",props:{html:{type:Boolean,default:!0}},computed:{tags(){return this.value.map(t=>({text:t.filename,link:t.link,image:t.image}))}}},null,null).exports;const or=ut({mixins:[Vo],props:{value:Object},computed:{status(){var t;return{...this.$helper.page.status(null==(t=this.value)?void 0:t.status),...this.value}}}},function(){var t=this,e=t._self._c;return t.value?e("k-button",t._b({class:["k-flag-field-preview",t.$attrs.class],style:t.$attrs.style,attrs:{size:"md"}},"k-button",t.status,!1)):t._e()},[]).exports;const rr=ut({mixins:[Vo],props:{value:String},computed:{html(){return this.value}}},function(){var t=this,e=t._self._c;return e("div",{class:["k-html-field-preview",t.$options.class,t.$attrs.class],style:t.$attrs.style},[t._v(" "+t._s(t.column.before)+" "),e("k-text",{attrs:{html:t.html}}),t._v(" "+t._s(t.column.after)+" ")],1)},[]).exports;const ar=ut({mixins:[Vo],props:{value:[Object]}},function(){var t=this,e=t._self._c;return t.value?e("k-item-image",{class:["k-image-field-preview",t.$attrs.class],style:t.$attrs.style,attrs:{image:t.value}}):t._e()},[]).exports,lr={mixins:[Vo],props:{removable:Boolean,type:String},emits:["remove"],data:()=>({model:null}),computed:{currentType(){return this.type??this.detected.type},detected(){return this.$helper.link.detect(this.value)},isLink(){return["url","email","tel"].includes(this.currentType)}},watch:{detected:{async handler(t,e){t!==e&&(this.model=await this.$helper.link.preview(this.detected))},immediate:!0},type(){this.model=null}}};const cr=ut(lr,function(){var t=this,e=t._self._c;return e("div",{class:{"k-link-field-preview":!0,"k-url-field-preview":t.isLink,[t.$attrs.class]:!0},style:t.$attrs.style},["page"===t.currentType||"file"===t.currentType?[t.model?[e("k-tag",{attrs:{image:{...t.model.image,cover:!0},removable:t.removable,text:t.model.label},on:{remove:function(e){return t.$emit("remove",e)}}})]:t._t("placeholder")]:t.isLink?[e("p",{staticClass:"k-text"},[e("a",{attrs:{href:t.value,target:"_blank"}},[e("span",[t._v(t._s(t.detected.link))])])])]:[t._v(" "+t._s(t.detected.link)+" ")]],2)},[]).exports;const ur=ut({extends:Ko,class:"k-object-field-preview",props:{value:[Array,Object]},computed:{tags(){return this.value?[{text:"{ ... }"}]:[]}}},null,null).exports;const pr=ut({extends:Ko,inheritAttrs:!1,class:"k-pages-field-preview",props:{html:{type:Boolean,default:!0}}},null,null).exports;const dr=ut({mixins:[Vo],props:{html:{type:Boolean},value:String}},function(){var t=this,e=t._self._c;return e("ul",{class:["k-tag-field-preview","k-tags-field-preview","k-tags",t.$options.class,t.$attrs.class],style:t.$attrs.style},[e("li",[e("k-tag",{attrs:{html:t.html,text:t.value,theme:"light"},nativeOn:{click:function(t){t.stopPropagation()}}})],1)])},[]).exports;const hr=ut({extends:er,class:"k-time-field-preview",computed:{format(){return this.display??"HH:mm"},parsed(){return this.$library.dayjs.iso(this.value,"time")},text(){var t;return null==(t=this.parsed)?void 0:t.format(this.format)}}},null,null).exports;const mr=ut({mixins:[Vo],props:{value:Boolean},emits:["input"],computed:{isEditable(){return!0!==this.field.disabled},text(){return!1!==this.column.text?this.field.text:null}}},function(){var t=this,e=t._self._c;return e("div",{class:["k-toggle-field-preview",t.$attrs.class],style:t.$attrs.style},[e("k-toggle-input",{attrs:{disabled:!t.isEditable,text:t.text,value:t.value},on:{input:function(e){return t.$emit("input",e)}},nativeOn:{click:function(e){t.isEditable&&e.stopPropagation()}}})],1)},[]).exports;const fr=ut({extends:Ko,class:"k-users-field-preview",props:{html:{type:Boolean,default:!0}},computed:{tags(){return this.value.map(t=>({text:t.username??t.email,link:t.link,image:t.image}))}}},null,null).exports,gr={install(t){t.component("k-array-field-preview",Wo),t.component("k-bubbles-field-preview",Xo),t.component("k-color-field-preview",Qo),t.component("k-date-field-preview",er),t.component("k-email-field-preview",ir),t.component("k-files-field-preview",nr),t.component("k-flag-field-preview",or),t.component("k-html-field-preview",rr),t.component("k-image-field-preview",ar),t.component("k-link-field-preview",cr),t.component("k-object-field-preview",ur),t.component("k-pages-field-preview",pr),t.component("k-tag-field-preview",dr),t.component("k-tags-field-preview",Ko),t.component("k-text-field-preview",tr),t.component("k-toggle-field-preview",mr),t.component("k-time-field-preview",hr),t.component("k-url-field-preview",sr),t.component("k-users-field-preview",fr),t.component("k-list-field-preview",rr),t.component("k-writer-field-preview",rr),t.component("k-checkboxes-field-preview",Ko),t.component("k-multiselect-field-preview",Ko),t.component("k-radio-field-preview",Ko),t.component("k-select-field-preview",Ko),t.component("k-toggles-field-preview",Ko)}};const kr=ut({mixins:[{props:{buttons:{type:Array,default:()=>[]},theme:{type:String,default:"light"}}}],methods:{close(){for(const t in this.$refs){const e=this.$refs[t][0];"function"==typeof(null==e?void 0:e.close)&&e.close()}}}},function(){var t=this,e=t._self._c;return t.buttons.length?e("nav",{staticClass:"k-toolbar",attrs:{"data-theme":t.theme}},[t._l(t.buttons,function(s,i){var n;return["|"===s?e("hr",{key:"separator-"+i}):s.when??1?e("k-button",{key:i,class:["k-toolbar-button",s.class],attrs:{current:s.current,disabled:s.disabled,icon:s.icon,title:s.label??s.title,tabindex:"0"},on:{click:function(e){var n,o;(null==(n=s.dropdown)?void 0:n.length)?t.$refs[i+"-dropdown"][0].toggle():null==(o=s.click)||o.call(s,e)}},nativeOn:{keydown:function(t){var e;null==(e=s.key)||e.call(s,t)}}}):t._e(),(s.when??1)&&(null==(n=s.dropdown)?void 0:n.length)?e("k-dropdown-content",{key:i+"-dropdown",ref:i+"-dropdown",refInFor:!0,attrs:{options:s.dropdown,theme:"dark"===t.theme?"light":"dark"}}):t._e()]})],2):t._e()},[]).exports;const br=ut({props:{editor:{required:!0,type:Object},inline:{default:!0,type:Boolean},marks:{default:()=>["bold","italic","underline","strike","code","|","link","email","|","clear"],type:[Array,Boolean]},nodes:{default:!0,type:[Array,Boolean]}},emits:["command"],data:()=>({isOpen:!1,position:{x:0,y:0}}),computed:{activeDropdownEntry(){return Object.values(this.dropdownEntries).findLast(this.isNodeActive)},buttons(){const t=[];this.hasDropdownEntries&&t.push(this.dropdownInlineButton),this.hasDropdownEntries&&this.hasInlineEntries&&t.push("|");for(const[e,s]of Object.entries(this.inlineEntries))t.push(this.inlineButton(s,e));return t},dropdown(){const t=[],e=Object.entries(this.dropdownEntries);let s=0;for(const[i,n]of e)t.push(this.dropdownButton(n,i)),!0===n.separator&&s!==e.length-1&&t.push("-"),s++;return t},dropdownInlineButton(){var t;return{current:Boolean(this.activeDropdownEntry),dropdown:this.dropdown,icon:(null==(t=this.activeDropdownEntry)?void 0:t.icon)??"title"}},dropdownEntries(){if(!1===this.nodes)return{};const t=this.nodesForBlock;return"block+"!==this.editor.nodes.doc.content&&t.paragraph&&delete t.paragraph,!0===this.nodes?t:Object.fromEntries(this.nodes.filter(e=>t[e]).map(e=>[e,t[e]]))},hasDropdownEntries(){return this.$helper.object.length(this.dropdownEntries)>1},hasInlineEntries(){return this.$helper.object.length(this.inlineEntries)>0},inlineEntries(){let t={};if(!0===this.nodes)t=this.nodesForInline;else if(!1!==this.nodes)for(const s of this.nodes)this.nodesForInline[s]&&(t[s]=this.nodesForInline[s]);this.$helper.object.length(t)>0&&(t["divider-inline-nodes"]="|");const e=this.editor.buttons("mark");if(!0===this.marks)return{...t,...e};if(!1!==this.marks)for(const[s,i]of this.marks.entries())"|"===i?t["divider"+s]="|":e[i]&&(t[i]=e[i]);return t},nodesForBlock(){return this.$helper.object.filter(this.editor.buttons("node"),t=>!0!==t.inline)},nodesForInline(){return this.$helper.object.filter(this.editor.buttons("node"),t=>!0===t.inline)},positions(){return!1===this.inline?null:{top:this.position.y+"px",left:this.position.x+"px"}},theme(){return this.inline?"dark":"light"}},methods:{close(t){t&&!1!==this.$el.contains(t.relatedTarget)||(this.isOpen=!1)},command(t,...e){this.$emit("command",t,...e)},dropdownButton(t,e){var s,i,n;return{current:(null==(s=this.activeDropdownEntry)?void 0:s.id)===t.id,disabled:!1===(null==(n=null==(i=this.activeDropdownEntry)?void 0:i.when)?void 0:n.includes(t.name)),icon:t.icon,label:t.label,click:()=>this.command(t.command??e)}},inlineButton(t,e){return"|"===t?"|":{current:this.isMarkActive({...t,name:e}),icon:t.icon,label:t.label,click:s=>this.command(t.command??e,s)}},isMarkActive(t){return this.editor.activeMarks.includes(t.name)},isNodeActive(t){if(!1===this.editor.activeNodes.includes(t.name))return!1;if(t.attrs){if(void 0===Object.values(this.editor.activeNodeAttrs).find(e=>JSON.stringify(e)===JSON.stringify(t.attrs)))return!1}return!0},open(){0!==this.buttons.length&&(this.isOpen=!0,this.inline&&this.$nextTick(this.setPosition))},setPosition(){const t=this.$el.getBoundingClientRect(),e=this.editor.element.getBoundingClientRect(),s=document.querySelector(".k-panel-menu").getBoundingClientRect(),{from:i,to:n}=this.editor.selection,o=this.editor.view.coordsAtPos(i),r=this.editor.view.coordsAtPos(n,!0),a=new DOMRect(o.left,o.top,r.right-o.left,r.bottom-o.top);let l=a.x-e.x+a.width/2-t.width/2,c=a.y-e.y-t.height-5;if(t.width<e.width)l<0?l=0:l+t.width>e.width&&(l=e.width-t.width);else{const i=e.x+l,n=i+t.width,o=s.width+20,r=20;i<o?l+=o-i:n>window.innerWidth-r&&(l-=n-(window.innerWidth-r))}this.position={x:l,y:c}}}},function(){var t=this,e=t._self._c;return t.isOpen||!t.inline?e("k-toolbar",{ref:"toolbar",staticClass:"k-writer-toolbar",style:t.positions,attrs:{buttons:t.buttons,"data-inline":t.inline,theme:t.theme}}):t._e()},[]).exports;const yr=ut({extends:qt,props:{fields:{default:()=>{const t=qt.props.fields.default();return t.title.label=window.panel.t("link.text"),t}}},methods:{submit(){const t=this.values.href??"",e=this.values.title??"";return this.$panel.config.kirbytext?(null==e?void 0:e.length)>0?this.$emit("submit",`(email: ${t} text: ${e})`):this.$emit("submit",`(email: ${t})`):(null==e?void 0:e.length)>0?this.$emit("submit",`[${e}](mailto:${t})`):this.$emit("submit",`<${t}>`)}}},null,null).exports;const vr=ut({extends:Gt,props:{fields:{default:()=>({href:{label:window.panel.t("link"),type:"link",placeholder:window.panel.t("url.placeholder"),icon:"url"},title:{label:window.panel.t("link.text"),type:"text",icon:"title"}})}},methods:{submit(){const t=this.values.href??"",e=this.values.title??"";return this.$panel.config.kirbytext?(null==e?void 0:e.length)>0?this.$emit("submit",`(link: ${t} text: ${e})`):this.$emit("submit",`(link: ${t})`):(null==e?void 0:e.length)>0?this.$emit("submit",`[${e}](${t})`):this.$emit("submit",`<${t}>`)}}},null,null).exports,$r={install(t){t.component("k-toolbar",kr),t.component("k-textarea-toolbar",Qn),t.component("k-writer-toolbar",br),t.component("k-toolbar-email-dialog",yr),t.component("k-toolbar-link-dialog",vr)}},wr={install(t){t.component("k-counter",qe),t.component("k-field",Fe),t.component("k-fieldset",Ye),t.component("k-form",Re),t.component("k-form-controls",Ue),t.component("k-input",Ke),t.use(Ss),t.use(Ro),t.use(_o),t.use(Uo),t.use(gr),t.use($r)}},xr={},_r=function(t,e,s){let i=Promise.resolve();if(e&&e.length>0){let t=function(t){return Promise.all(t.map(t=>Promise.resolve(t).then(t=>({status:"fulfilled",value:t}),t=>({status:"rejected",reason:t}))))};const n=document.getElementsByTagName("link"),o=document.querySelector("meta[property=csp-nonce]"),r=(null==o?void 0:o.nonce)||(null==o?void 0:o.getAttribute("nonce"));i=t(e.map(t=>{if(t=function(t,e){return new URL(t,e).href}(t,s),t in xr)return;xr[t]=!0;const e=t.endsWith(".css"),i=e?'[rel="stylesheet"]':"";if(!!s)for(let s=n.length-1;s>=0;s--){const i=n[s];if(i.href===t&&(!e||"stylesheet"===i.rel))return}else if(document.querySelector(`link[href="${t}"]${i}`))return;const o=document.createElement("link");return o.rel=e?"stylesheet":"modulepreload",e||(o.as="script"),o.crossOrigin="",o.href=t,r&&o.setAttribute("nonce",r),document.head.appendChild(o),e?new Promise((e,s)=>{o.addEventListener("load",e),o.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${t}`)))}):void 0}))}function n(t){const e=new Event("vite:preloadError",{cancelable:!0});if(e.payload=t,window.dispatchEvent(e),!e.defaultPrevented)throw t}return i.then(e=>{for(const t of e||[])"rejected"===t.status&&n(t.reason);return t().catch(n)})},Sr=()=>_r(()=>import("./IndexView.min.js"),__vite__mapDeps([0,1]),import.meta.url),Cr=()=>_r(()=>import("./DocsView.min.js"),__vite__mapDeps([2,3,1]),import.meta.url),Or=()=>_r(()=>import("./PlaygroundView.min.js"),__vite__mapDeps([4,3,1]),import.meta.url),Ar={install(t){t.component("k-lab-index-view",Sr),t.component("k-lab-docs-view",Cr),t.component("k-lab-playground-view",Or)}};const Mr=ut({props:{align:{type:String,default:"start"}}},function(){var t=this;return(0,t._self._c)("div",{staticClass:"k-bar",attrs:{"data-align":t.align}},[t._t("default")],2)},[]).exports;const Dr=ut({props:{align:{type:String,default:"start"},button:Boolean,height:String,icon:String,theme:{type:String},text:String,html:{type:Boolean}},computed:{element(){return this.button?"button":"div"},type(){return this.button?"button":null}}},function(){var t=this,e=t._self._c;return e(t.element,{tag:"component",staticClass:"k-box",style:t.height?{"--box-height":t.height}:null,attrs:{"data-align":t.align,"data-theme":t.theme,type:t.type}},[t.icon?e("k-icon",{attrs:{type:t.icon}}):t._e(),t._t("default",function(){return[t.html?e("k-text",{attrs:{html:t.text}}):e("k-text",[t._v(" "+t._s(t.text)+" ")])]},null,{html:t.html,text:t.text})],2)},[]).exports;const Er=ut({inheritAttrs:!1,props:{back:String,color:String,element:{type:String,default:"li"},html:{type:Boolean},image:Object,link:String,text:String},mounted(){window.panel.deprecated("<k-bubble> will be removed in a future version. Use <k-tag> instead.")}},function(){var t=this,e=t._self._c;return e(t.link?"k-link":"p",{tag:"component",class:["k-bubble",t.$attrs.class],style:{color:t.$helper.color(t.color),background:t.$helper.color(t.back),...t.$attrs.style},attrs:{to:t.link},nativeOn:{click:function(t){t.stopPropagation()}}},[t._t("image",function(){var s;return[(null==(s=t.image)?void 0:s.src)?e("k-image-frame",t._b({},"k-image-frame",t.image,!1)):t.image?e("k-icon-frame",t._b({},"k-icon-frame",t.image,!1)):e("span")]}),t.text?[t.html?e("span",{staticClass:"k-bubble-text",domProps:{innerHTML:t._s(t.text)}}):e("span",{staticClass:"k-bubble-text"},[t._v(t._s(t.text))])]:t._e()],2)},[]).exports;const jr=ut({props:{width:{type:String,default:"1/1"},sticky:Boolean}},function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-column",style:{"--width":t.width},attrs:{"data-sticky":t.sticky}},[t.sticky?e("div",[t._t("default")],2):t._t("default")],2)},[]).exports,Ir={props:{element:{type:String,default:"div"},fit:String,ratio:String,cover:Boolean,back:String,theme:String}};const Br=ut({mixins:[Ir],inheritAttrs:!1,computed:{background(){return this.$helper.color(this.back)}}},function(){var t=this;return(0,t._self._c)(t.element,{tag:"component",class:["k-frame",t.$attrs.class],style:{"--fit":t.fit??(t.cover?"cover":"contain"),"--ratio":t.ratio,"--back":t.background,...t.$attrs.style},attrs:{"data-theme":t.theme}},[t._t("default")],2)},[]).exports;const Lr=ut({mixins:[{mixins:[Ir],props:{color:String}}],inheritAttrs:!1},function(){var t=this;return(0,t._self._c)("k-frame",t._b({class:["k-color-frame",t.$attrs.class],style:{"--color-frame-back":t.color,...t.$attrs.style}},"k-frame",t.$props,!1),[t._t("default")],2)},[]).exports;const Tr=ut({props:{disabled:{type:Boolean}},emits:["drop"],data:()=>({files:[],dragging:!1,over:!1}),methods:{cancel(){this.reset()},reset(){this.dragging=!1,this.over=!1},onDrop(t){return!0===this.disabled||!1===this.$helper.isUploadEvent(t)?this.reset():(this.$events.emit("dropzone.drop"),this.files=t.dataTransfer.files,this.$emit("drop",this.files),void this.reset())},onEnter(t){!1===this.disabled&&this.$helper.isUploadEvent(t)&&(this.dragging=!0)},onLeave(){this.reset()},onOver(t){!1===this.disabled&&this.$helper.isUploadEvent(t)&&(t.dataTransfer.dropEffect="copy",this.over=!0)}}},function(){var t=this;return(0,t._self._c)("div",{staticClass:"k-dropzone",attrs:{"data-dragging":t.dragging,"data-over":t.over},on:{dragenter:t.onEnter,dragleave:t.onLeave,dragover:t.onOver,drop:t.onDrop}},[t._t("default")],2)},[]).exports;const Pr=ut({props:{variant:String}},function(){var t=this;return(0,t._self._c)("div",{staticClass:"k-grid",attrs:{"data-variant":t.variant}},[t._t("default")],2)},[]).exports;const qr=ut({props:{editable:Boolean},emits:["edit"]},function(){var t=this,e=t._self._c;return e("header",{staticClass:"k-header"},[e("h1",{staticClass:"k-header-title"},[t.editable?e("button",{staticClass:"k-header-title-button",attrs:{type:"button"},on:{click:function(e){return t.$emit("edit")}}},[e("span",{staticClass:"k-header-title-text"},[t._t("default")],2),e("span",{staticClass:"k-header-title-icon"},[e("k-icon",{attrs:{type:"edit"}})],1)]):e("span",{staticClass:"k-header-title-text"},[t._t("default")],2)]),t.$slots.buttons?e("div",{staticClass:"k-header-buttons"},[t._t("buttons")],2):t._e()])},[]).exports,Nr={props:{alt:String,color:String,type:String}};const Fr=ut({mixins:[Nr],computed:{isEmoji(){return this.$helper.string.hasEmoji(this.type)}}},function(){var t=this,e=t._self._c;return t.isEmoji?e("span",{attrs:{"data-type":"emoji"}},[t._v(t._s(t.type))]):e("svg",{staticClass:"k-icon",style:{color:t.$helper.color(t.color)},attrs:{"aria-label":t.alt,role:t.alt?"img":null,"aria-hidden":!t.alt,"data-type":t.type}},[e("use",{attrs:{"xlink:href":"#icon-"+t.type}})])},[]).exports;const zr=ut({mixins:[{mixins:[Ir,Nr],props:{type:null,icon:String}}],inheritAttrs:!1},function(){var t=this,e=t._self._c;return e("k-frame",t._b({class:["k-icon-frame",t.$attrs.class],style:t.$attrs.style,attrs:{element:"figure"}},"k-frame",t.$props,!1),[e("k-icon",t._b({},"k-icon",{color:t.color,type:t.icon,alt:t.alt},!1))],1)},[]).exports;const Yr=ut({mixins:[{mixins:[Ir],props:{alt:String,sizes:String,src:String,srcset:String}}],inheritAttrs:!1},function(){var t=this,e=t._self._c;return e("k-frame",t._b({class:["k-image-frame","k-image",t.$attrs.class],style:t.$attrs.style,attrs:{element:"figure"}},"k-frame",t.$props,!1),[t.src?e("img",{key:t.src,attrs:{alt:t.alt??"",src:t.src,srcset:t.srcset,sizes:t.sizes},on:{dragstart:function(t){t.preventDefault()}}}):t._e()])},[]).exports;const Rr=ut({mixins:[{props:{autofocus:{default:!0,type:Boolean},nested:{default:!1,type:Boolean},type:{default:"overlay",type:String},visible:{default:!1,type:Boolean}}}],inheritAttrs:!0,emits:["cancel","close","open"],watch:{visible(t,e){t!==e&&this.toggle()}},mounted(){this.toggle()},methods:{cancel(){this.$emit("cancel"),this.close()},close(){if(!1!==this.$refs.overlay.open)return this.nested?this.onClose():void this.$refs.overlay.close()},focus(){this.$helper.focus(this.$refs.overlay)},onCancel(t){this.nested&&(t.preventDefault(),this.cancel())},onClick(t){t.target.matches(".k-portal")&&this.cancel()},onClose(){this.$emit("close")},open(){!0!==this.$refs.overlay.open&&this.$refs.overlay.showModal(),setTimeout(()=>{!0===this.autofocus&&this.focus(),this.$emit("open")})},toggle(){!0===this.visible?this.open():this.close()}}},function(){var t=this;return(0,t._self._c)("dialog",{ref:"overlay",staticClass:"k-overlay",attrs:{"data-type":t.type},on:{cancel:t.onCancel,mousedown:t.onClick,touchdown:t.onClick,close:t.onClose}},[t._t("default")],2)},[]).exports;const Hr=ut({props:{click:Function,dialog:{type:[String,Object]},drawer:{type:[String,Object]},icon:String,info:String,label:String,link:String,theme:String,value:String},computed:{component(){return null!==this.target?"k-link":"div"},target(){return this.link?this.link:this.click?this.click:this.dialog?()=>this.$panel.dialog.open(this.dialog):this.drawer?()=>this.$panel.drawer.open(this.drawer):null}}},function(){var t=this,e=t._self._c;return e(t.component,{tag:"component",staticClass:"k-stat",attrs:{"data-theme":t.theme,to:t.target}},[t.label?e("dt",{staticClass:"k-stat-label"},[t.icon?e("k-icon",{attrs:{type:t.icon}}):t._e(),t._v(" "+t._s(t.label)+" ")],1):t._e(),t.value?e("dd",{staticClass:"k-stat-value"},[t._v(t._s(t.value))]):t._e(),t.info?e("dd",{staticClass:"k-stat-info"},[t._v(t._s(t.info))]):t._e()])},[]).exports,Ur={inheritAttrs:!1,props:{columns:{type:Object,default:()=>({})},disabled:Boolean,fields:{type:Object,default:()=>({})},empty:String,index:{type:[Number,Boolean],default:1},rows:Array,options:{default:()=>[],type:[Array,Function]},pagination:[Object,Boolean],selecting:Boolean,sortable:Boolean},emits:["cell","change","header","input","option","paginate","sort"],data(){return{values:this.rows}},computed:{colspan(){let t=this.columnsCount;return this.hasIndexColumn&&t++,this.hasOptions&&t++,t},columnsCount(){return this.$helper.object.length(this.columns)},dragOptions(){return{disabled:!this.sortable||0===this.rows.length,draggable:".k-table-sortable-row",fallbackClass:"k-table-row-fallback",ghostClass:"k-table-row-ghost"}},hasIndexColumn(){return this.sortable||!1!==this.index},hasOptions(){var t;return this.selecting||this.$scopedSlots.options||(null==(t=this.options)?void 0:t.length)>0||Object.values(this.values).filter(t=>null==t?void 0:t.options).length>0}},watch:{rows(){this.values=this.rows}},methods:{isColumnEmpty(t){return 0===this.rows.filter(e=>!1===this.$helper.object.isEmpty(e[t])).length},label(t,e){return t.label??this.$helper.string.ucfirst(e)},onChange(t){this.$emit("change",t)},onCell(t){this.$emit("cell",t)},onCellUpdate({columnIndex:t,rowIndex:e,value:s}){this.values[e][t]=s,this.$emit("input",this.values)},onHeader(t){this.$emit("header",t)},onOption(t,e,s){this.$emit("option",t,e,s)},onSort(){this.$emit("input",this.values),this.$emit("sort",this.values)},rowIsSelectable(t){return!0===this.selecting&&!1!==t.selectable},rowIsSortable(t){return!0===this.sortable&&!1===this.selecting&&!1!==t.sortable},width(t){return"string"!=typeof t?"auto":!1===t.includes("/")?t:this.$helper.ratio(t,"auto",!1)}}};const Vr=ut(Ur,function(){var t=this,e=t._self._c;return e("div",{class:["k-table",t.$attrs.class],style:t.$attrs.style,attrs:{"aria-disabled":t.disabled}},[e("table",{attrs:{"data-disabled":t.disabled,"data-indexed":t.hasIndexColumn,"data-selecting":t.selecting}},[e("thead",[e("tr",[t.hasIndexColumn?e("th",{staticClass:"k-table-index-column",attrs:{"data-mobile":"true"}},[t._v(" # ")]):t._e(),t._l(t.columns,function(s,i){return e("th",{key:i+"-header",staticClass:"k-table-column",style:{width:t.width(s.width)},attrs:{"data-align":s.align,"data-column-id":i,"data-mobile":s.mobile},on:{click:function(e){return t.onHeader({column:s,columnIndex:i})}}},[t._t("header",function(){return[t._v(" "+t._s(t.label(s,i))+" ")]},null,{column:s,columnIndex:i,label:t.label(s,i)})],2)}),t.hasOptions?e("th",{staticClass:"k-table-options-column",attrs:{"data-mobile":"true"}}):t._e()],2)]),e("k-draggable",{attrs:{list:t.values,options:t.dragOptions,handle:!0,element:"tbody"},on:{change:t.onChange,end:t.onSort}},[0===t.rows.length?e("tr",[e("td",{staticClass:"k-table-empty",attrs:{colspan:t.colspan}},[t._v(" "+t._s(t.empty)+" ")])]):t._l(t.values,function(s,i){return e("tr",{key:s.id??s._id??s.value??JSON.stringify(s),class:{"k-table-sortable-row":t.rowIsSortable(s)},attrs:{"data-selecting":t.selecting,"data-selectable":t.rowIsSelectable(s),"data-sortable":t.rowIsSortable(s)}},[t.hasIndexColumn?e("td",{staticClass:"k-table-index-column",attrs:{"data-mobile":"true"}},[t._t("index",function(){return[e("div",{staticClass:"k-table-index",domProps:{textContent:t._s(t.index+i)}})]},null,{row:s,rowIndex:i}),t.rowIsSortable(s)?e("k-sort-handle",{staticClass:"k-table-sort-handle"}):t._e()],2):t._e(),t._l(t.columns,function(n,o){return e("k-table-cell",{key:o,staticClass:"k-table-column",style:{width:t.width(n.width)},attrs:{id:o,column:n,field:t.fields[o],row:s,mobile:n.mobile,value:s[o]},on:{input:function(e){return t.onCellUpdate({columnIndex:o,rowIndex:i,value:e})}},nativeOn:{click:function(e){return t.onCell({row:s,rowIndex:i,column:n,columnIndex:o})}}})}),t.hasOptions?e("td",{staticClass:"k-table-options-column",attrs:{"data-mobile":"true"}},[t.selecting?[e("label",{staticClass:"k-table-select-checkbox"},[e("input",{attrs:{disabled:!1===s.selectable,type:"checkbox"},on:{change:function(e){return t.$emit("select",s,i)}}})])]:[t._t("options",function(){return[e("k-options-dropdown",{attrs:{options:s.options??t.options,text:(s.options??t.options).length>1},on:{option:function(e){return t.onOption(e,s,i)}}})]},null,{row:s,rowIndex:i})]],2):t._e()],2)})],2)],1),t.pagination?e("k-pagination",t._b({staticClass:"k-table-pagination",on:{paginate:function(e){return t.$emit("paginate",e)}}},"k-pagination",t.pagination,!1)):t._e()],1)},[]).exports;const Kr=ut({inheritAttrs:!1,props:{column:Object,field:Object,id:String,mobile:{type:Boolean,default:!1},row:Object,value:{default:""}},emits:["input"],computed:{component(){return this.$helper.isComponent(`k-${this.type}-field-preview`)?`k-${this.type}-field-preview`:this.$helper.isComponent(`k-table-${this.type}-cell`)?`k-table-${this.type}-cell`:Array.isArray(this.value)?"k-array-field-preview":"object"==typeof this.value?"k-object-field-preview":"k-text-field-preview"},type(){var t;return this.column.type??(null==(t=this.field)?void 0:t.type)}}},function(){var t=this,e=t._self._c;return e("td",{class:["k-table-cell",t.$attrs.class],style:t.$attrs.style,attrs:{"data-align":t.column.align,"data-column-id":t.id,"data-mobile":t.mobile}},[!1===t.$helper.object.isEmpty(t.value)?e(t.component,{tag:"component",attrs:{column:t.column,field:t.field,row:t.row,value:t.value},on:{input:function(e){return t.$emit("input",e)}}}):t._e()],1)},[]).exports;const Wr=ut({props:{tab:String,tabs:{type:Array,default:()=>[]},theme:{type:String,default:"passive"}},data(){return{observer:null,visible:this.tabs,invisible:[]}},computed:{buttons(){return this.visible.map(this.button)},current(){const t=this.tabs.find(t=>t.name===this.tab)??this.tabs[0];return null==t?void 0:t.name},dropdown(){return this.invisible.map(this.button)}},watch:{tabs:{async handler(){var t;null==(t=this.observer)||t.disconnect(),await this.$nextTick(),this.$el instanceof Element&&(this.observer=new ResizeObserver(this.resize),this.observer.observe(this.$el))},immediate:!0}},destroyed(){var t;null==(t=this.observer)||t.disconnect()},methods:{button(t){const e={...t,current:t.name===this.current,title:t.label,text:t.label??t.text??t.name};return t.badge?e.badge={theme:this.theme,text:t.badge}:delete e.badge,e},async resize(){const t=this.$el.offsetWidth;this.visible=this.tabs,this.invisible=[],await this.$nextTick();const e=[...this.$refs.visible].map(t=>t.$el.offsetWidth);let s=32;for(let i=0;i<this.tabs.length;i++)if(s+=e[i]+4,s>t)return this.visible=this.tabs.slice(0,i),void(this.invisible=this.tabs.slice(i))}}},function(){var t=this,e=t._self._c;return t.tabs.length>1?e("nav",{staticClass:"k-tabs"},[t._l(t.buttons,function(s){return e("k-button",t._b({key:s.name,ref:"visible",refInFor:!0,staticClass:"k-tabs-button",attrs:{variant:"dimmed"}},"k-button",s,!1),[t._v(" "+t._s(s.text)+" ")])}),t.invisible.length?[e("k-button",{staticClass:"k-tabs-button k-tabs-dropdown-button",attrs:{current:!!t.invisible.find(e=>t.tab===e.name),title:t.$t("more"),icon:"dots",variant:"dimmed"},on:{click:function(e){return e.stopPropagation(),t.$refs.more.toggle()}}}),e("k-dropdown-content",{ref:"more",staticClass:"k-tabs-dropdown",attrs:{options:t.dropdown,"align-x":"end"}})]:t._e()],2):t._e()},[]).exports,Jr={install(t){t.component("k-bar",Mr),t.component("k-box",Dr),t.component("k-bubble",Er),t.component("k-bubbles",Go),t.component("k-color-frame",Lr),t.component("k-column",jr),t.component("k-dropzone",Tr),t.component("k-frame",Br),t.component("k-grid",Pr),t.component("k-header",qr),t.component("k-icon-frame",zr),t.component("k-image-frame",Yr),t.component("k-image",Yr),t.component("k-overlay",Rr),t.component("k-stat",Hr),t.component("k-stats",zn),t.component("k-table",Vr),t.component("k-table-cell",Kr),t.component("k-tabs",Wr)}};const Gr=ut({props:{data:Object,disabled:Boolean,element:{type:String,default:"div"},group:String,handle:[String,Boolean],list:Array,move:Function,options:{type:Object,default:()=>({})}},emits:["change","end","sort","start"],data:()=>({sortable:null}),computed:{dragOptions(){return{group:this.group,disabled:this.disabled,handle:!0===this.handle?".k-sort-handle":this.handle,draggable:">*",filter:".k-draggable-footer",ghostClass:"k-sortable-ghost",fallbackClass:"k-sortable-fallback",forceFallback:!0,fallbackOnBody:!0,scroll:document.querySelector(".k-panel-main"),...this.options}}},watch:{dragOptions:{handler(t,e){for(const s in t)t[s]!==e[s]&&this.sortable.option(s,t[s])},deep:!0}},mounted(){this.disableFooter(),this.create()},methods:{async create(){const t=(await _r(async()=>{const{default:t}=await import("./sortable.min.js");return{default:t}},[],import.meta.url)).default;this.sortable=t.create(this.$el,{...this.dragOptions,onStart:t=>{this.$panel.drag.start("data",{}),this.$emit("start",t)},onEnd:t=>{this.$panel.drag.stop(),this.$emit("end",t)},onAdd:t=>{if(this.list){const e=this.getInstance(t.from),s=t.oldDraggableIndex,i=t.newDraggableIndex,n=e.list[s];this.list.splice(i,0,n),this.$emit("change",{added:{element:n,newIndex:i}})}},onUpdate:t=>{if(this.list){const e=t.oldDraggableIndex,s=t.newDraggableIndex,i=this.list[e];this.list.splice(e,1),this.list.splice(s,0,i),this.$emit("change",{moved:{element:i,newIndex:s,oldIndex:e}})}},onRemove:t=>{if(this.list){const e=t.oldDraggableIndex,s=this.list[e];this.list.splice(e,1),this.$emit("change",{removed:{element:s,oldIndex:e}})}},onSort:t=>{this.$emit("sort",t)},onMove:t=>{if(t.dragged.classList.contains("k-draggable-footer"))return!1;if(this.move){const e=t.dragged.__vue__;t.draggedData=e.$props;const s=this.getInstance(t.from);t.fromData=s.$props.data;const i=this.getInstance(t.to);return t.toData=i.$props.data,this.move(t)}return!0}})},disableFooter(){var t;if(this.$slots.footer){const e=[...this.$el.childNodes].slice(-1*this.$slots.footer.length);for(const s of e)null==(t=s.classList)||t.add("k-draggable-footer")}},getInstance:t=>"list"in(t=t.__vue__)?t:1===t.$children.length&&"list"in t.$children[0]?t.$children[0]:"k-draggable"===t.$parent.$options._componentTag?t.$parent:void 0}},function(){var t=this;return(0,t._self._c)(t.element,{tag:"component",class:{"k-draggable":!t.dragOptions.disabled}},[t._t("default"),t.$slots.footer?[t._t("footer")]:t._e()],2)},[]).exports;const Xr=ut({data:()=>({error:null}),errorCaptured(t){return this.$panel.debug&&window.console.warn(t),this.error=t,!1},render(){return this.error?this.$slots.error?this.$slots.error[0]:this.$scopedSlots.error?this.$scopedSlots.error({error:this.error}):o("k-box",{attrs:{theme:"negative"}},this.error.message??this.error):this.$slots.default[0]}},null,null).exports;const Zr=ut({props:{html:String},mounted(){try{let t=this.$refs.iframe.contentWindow.document;t.open(),t.write(this.html),t.close()}catch(t){console.error(t)}}},function(){var t=this,e=t._self._c;return e("k-overlay",{staticClass:"k-fatal",attrs:{visible:!0}},[e("div",{staticClass:"k-fatal-box"},[e("div",{staticClass:"k-notification",attrs:{"data-theme":"negative"}},[e("p",[t._v("The JSON response could not be parsed")]),e("k-button",{attrs:{icon:"cancel"},on:{click:function(e){return e.stopPropagation(),t.$panel.notification.close()}}})],1),e("iframe",{ref:"iframe",staticClass:"k-fatal-iframe"})])])},[]).exports;const Qr=ut({icons:window.panel.plugins.icons},function(){var t=this,e=t._self._c;return e("svg",{staticClass:"k-icons",attrs:{"aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",overflow:"hidden"}},[e("defs",t._l(t.$options.icons,function(s,i){return e("symbol",{key:i,attrs:{id:"icon-"+i,viewBox:"0 0 24 24"},domProps:{innerHTML:t._s(s)}})}),0)])},[]).exports;const ta=ut({},function(){var t=this,e=t._self._c;return t.$panel.notification.isOpen?e("div",{staticClass:"k-notification",attrs:{"data-theme":t.$panel.notification.theme}},[e("p",[t._v(t._s(t.$panel.notification.message))]),e("k-button",{attrs:{icon:"cancel"},on:{click:function(e){return t.$panel.notification.close()}}})],1):t._e()},[]).exports;const ea=ut({},function(){var t=this,e=t._self._c;return!t.$panel.system.isLocal&&t.$panel.isOffline?e("div",{staticClass:"k-offline-warning"},[e("p",[e("k-icon",{attrs:{type:"bolt"}}),t._v(" "+t._s(t.$t("error.offline")))],1)]):t._e()},[]).exports,sa={props:{value:{type:Number,default:0,validator:t=>t>=0&&t<=100}}};const ia=ut(sa,function(){var t=this;return(0,t._self._c)("progress",{staticClass:"k-progress",attrs:{max:"100"},domProps:{value:t.value}},[t._v(t._s(t.value)+"%")])},[]).exports;const na=ut({},function(){return(0,this._self._c)("k-button",{staticClass:"k-sort-handle k-sort-button",attrs:{title:this.$t("sort.drag"),icon:"sort","aria-hidden":"true"}})},[]).exports,oa={install(t){t.component("k-draggable",Gr),t.component("k-error-boundary",Xr),t.component("k-fatal",Zr),t.component("k-icon",Fr),t.component("k-icons",Qr),t.component("k-notification",ta),t.component("k-offline-warning",ea),t.component("k-progress",ia),t.component("k-sort-handle",na)}};const ra=ut({props:{crumbs:{type:Array,default:()=>[]},label:{type:String,default:"Breadcrumb"}},computed:{dropdown(){return this.crumbs.map(t=>({...t,text:t.label,icon:"angle-right"}))}}},function(){var t=this,e=t._self._c;return e("nav",{staticClass:"k-breadcrumb",attrs:{"aria-label":t.label}},[t.crumbs.length>1?e("div",{staticClass:"k-breadcrumb-dropdown"},[e("k-button",{attrs:{icon:"home"},on:{click:function(e){return t.$refs.dropdown.toggle()}}}),e("k-dropdown-content",{ref:"dropdown",attrs:{options:t.dropdown}})],1):t._e(),e("ol",t._l(t.crumbs,function(s,i){return e("li",{key:i},[e("k-button",{staticClass:"k-breadcrumb-link",attrs:{icon:s.loading?"loader":s.icon,link:s.link,disabled:!s.link,text:s.text??s.label,title:s.text??s.label,current:i===t.crumbs.length-1&&"page",variant:"dimmed",size:"sm"}})],1)}),0)])},[]).exports;const aa=ut({props:{items:{type:Array},name:{default:"items",type:String},selected:{type:String},type:{default:"radio",type:String}},emits:["select"]},function(){var t=this,e=t._self._c;return e("nav",{staticClass:"k-browser"},[e("div",{staticClass:"k-browser-items"},t._l(t.items,function(s){return e("label",{key:s.value,staticClass:"k-browser-item",attrs:{"aria-selected":t.selected===s.value}},[e("input",{attrs:{name:t.name,type:t.type},domProps:{checked:t.selected===s.value},on:{change:function(e){return t.$emit("select",s)}}}),s.image?e("k-item-image",{staticClass:"k-browser-item-image",attrs:{image:{...s.image,cover:!0,back:"black"}}}):t._e(),e("span",{staticClass:"k-browser-item-info"},[t._v(" "+t._s(s.label)+" ")])],1)}),0)])},[]).exports,la={props:{disabled:Boolean,download:Boolean,rel:String,tabindex:[String,Number],target:String,title:String}};const ca=ut({mixins:[la],props:{to:[String,Function]},emits:["click"],computed:{downloadAttr(){return this.download?this.href.split("/").pop():void 0},href(){return"function"==typeof this.to?"":"/"!==this.to[0]||this.target?!0===this.to.includes("@")&&!1===this.to.includes("/")&&!1===this.to.startsWith("mailto:")?"mailto:"+this.to:this.to:this.$url(this.to)},relAttr(){return"_blank"===this.target?"noreferrer noopener":this.rel}},methods:{isRoutable(t){if(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)return!1;if(t.defaultPrevented)return!1;if(void 0!==t.button&&0!==t.button)return!1;if(this.target)return!1;if("string"==typeof this.href){if(this.href.includes("://")||this.href.startsWith("//"))return!1;if(this.href.includes("mailto:"))return!1}return!0},onClick(t){if(!0===this.disabled)return t.preventDefault(),!1;"function"==typeof this.to&&(t.preventDefault(),this.to()),this.isRoutable(t)&&(t.preventDefault(),this.$go(this.to)),this.$emit("click",t)}}},function(){var t=this,e=t._self._c;return t.to&&!t.disabled?e("a",{ref:"link",staticClass:"k-link",attrs:{download:t.downloadAttr,href:t.href,rel:t.relAttr,tabindex:t.tabindex,target:t.target,title:t.title},on:{click:t.onClick}},[t._t("default")],2):e("span",{staticClass:"k-link",attrs:{title:t.title,"aria-disabled":""}},[t._t("default")],2)},[]).exports,ua={mixins:[la],props:{autofocus:Boolean,badge:Object,click:{type:Function,default:()=>{}},current:[String,Boolean],dialog:String,drawer:String,dropdown:Boolean,element:String,icon:String,id:[String,Number],link:String,responsive:[Boolean,String],role:String,selected:[String,Boolean],size:String,text:[String,Number],theme:String,type:{type:String,default:"button"},variant:String}};const pa=ut({mixins:[ua],inheritAttrs:!1,emits:["click"],computed:{attrs(){const t={"aria-current":this.current,"aria-disabled":this.disabled,"aria-label":this.text??this.title,"aria-selected":this.selected,"data-responsive":this.responsive,"data-size":this.size,"data-theme":this.theme,"data-variant":this.variant,id:this.id,tabindex:this.tabindex,title:this.title};return"k-link"===this.component?(t.disabled=this.disabled,t.download=this.download,t.to=this.link,t.rel=this.rel,t.target=this.target):"button"===this.component&&(t.autofocus=this.autofocus,t.role=this.role,t.type=this.type),this.dropdown&&(t["aria-haspopup"]="menu",t["data-dropdown"]=this.dropdown),t},component(){return this.element?this.element:this.link?"k-link":"button"}},methods:{focus(){var t,e;null==(e=(t=this.$el).focus)||e.call(t)},onClick(t){var e;return this.disabled?(t.preventDefault(),!1):this.dialog?this.$dialog(this.dialog):this.drawer?this.$drawer(this.drawer):(null==(e=this.click)||e.call(this,t),void this.$emit("click",t))}}},function(){var t=this,e=t._self._c;return e(t.component,t._b({tag:"component",class:["k-button",t.$attrs.class],style:t.$attrs.style,attrs:{"data-has-icon":Boolean(t.icon),"data-has-text":Boolean(t.text||t.$slots.default)},on:{click:t.onClick}},"component",t.attrs,!1),[t.icon?e("span",{staticClass:"k-button-icon"},[e("k-icon",{attrs:{type:t.icon}})],1):t._e(),t.text||t.$slots.default?e("span",{staticClass:"k-button-text"},[t._t("default",function(){return[t._v(" "+t._s(t.text)+" ")]})],2):t._e(),t.dropdown&&(t.text||t.$slots.default)?e("span",{staticClass:"k-button-arrow"},[e("k-icon",{attrs:{type:"angle-dropdown"}})],1):t._e(),t.badge?e("span",{staticClass:"k-button-badge",attrs:{"data-theme":t.badge.theme??t.theme}},[t._v(" "+t._s(t.badge.text)+" ")]):t._e()])},[]).exports;const da=ut({props:{buttons:Array,layout:String,variant:String,theme:String,size:String,responsive:Boolean}},function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-button-group",attrs:{"data-layout":t.layout}},[t.$slots.default?t._t("default"):t._l(t.buttons,function(s,i){return e("k-button",t._b({key:i},"k-button",{variant:t.variant,theme:t.theme,size:t.size,responsive:t.responsive,...s},!1))})],2)},[]).exports;const ha=ut({props:{limit:{default:50,type:Number},opened:{type:String},selected:{type:String}},emits:["select"],data(){return{files:[],page:null,pagination:null,view:this.opened?"files":"tree"}},methods:{paginate(t){this.selectPage(this.page,t.page)},selectFile(t){this.$emit("select",t)},async selectPage(t,e=1){this.page=t;const s="/"===t.id?"/site/files":"/pages/"+this.$api.pages.id(t.id)+"/files",{data:i,pagination:n}=await this.$api.get(s,{select:"filename,id,panelImage,url,uuid",limit:this.limit,page:e});this.pagination=n,this.files=i.map(t=>({label:t.filename,image:t.panelImage,id:t.id,url:t.url,uuid:t.uuid,value:t.uuid??t.url})),this.view="files"},async togglePage(){await this.$nextTick(),this.$refs.tree.scrollIntoView({behaviour:"smooth",block:"nearest",inline:"nearest"})}}},function(){var t,e,s=this,i=s._self._c;return i("div",{staticClass:"k-file-browser",attrs:{"data-view":s.view}},[i("div",{staticClass:"k-file-browser-layout"},[i("aside",{ref:"tree",staticClass:"k-file-browser-tree"},[i("k-page-tree",{attrs:{current:(null==(t=s.page)?void 0:t.value)??s.opened},on:{select:s.selectPage,toggleBranch:s.togglePage}})],1),i("div",{ref:"items",staticClass:"k-file-browser-items"},[i("k-button",{staticClass:"k-file-browser-back-button",attrs:{icon:"angle-left",text:null==(e=s.page)?void 0:e.label},on:{click:function(t){s.view="tree"}}}),s.files.length?i("k-browser",{attrs:{items:s.files,selected:s.selected},on:{select:s.selectFile}}):s._e()],1),i("div",{staticClass:"k-file-browser-pagination",on:{click:function(t){t.stopPropagation()}}},[s.pagination?i("k-pagination",s._b({attrs:{details:!0},on:{paginate:s.paginate}},"k-pagination",s.pagination,!1)):s._e()],1)])])},[]).exports;const ma=ut({props:{diff:Object,tab:String,tabs:{type:Array,default:()=>[]}},computed:{withBadges(){const t=Object.keys(this.diff);return this.tabs.map(e=>{const s=[];for(const t in e.columns)for(const i in e.columns[t].sections)if("fields"===e.columns[t].sections[i].type)for(const n in e.columns[t].sections[i].fields)s.push(n);return e.badge=s.filter(e=>t.includes(e.toLowerCase())).length,e})}}},function(){var t=this;return(0,t._self._c)("k-tabs",{staticClass:"k-model-tabs",attrs:{tab:t.tab,tabs:t.withBadges,theme:"notice"}})},[]).exports;const fa=ut({props:{axis:String,disabled:Boolean,element:{type:String,default:"div"},select:{type:String,default:":where(button, a):not(:disabled)"}},emits:["next","prev"],computed:{keys(){switch(this.axis){case"x":return{ArrowLeft:this.prev,ArrowRight:this.next};case"y":return{ArrowUp:this.prev,ArrowDown:this.next};default:return{ArrowLeft:this.prev,ArrowRight:this.next,ArrowUp:this.prev,ArrowDown:this.next}}}},mounted(){this.$el.addEventListener("keydown",this.keydown)},destroyed(){this.$el.removeEventListener("keydown",this.keydown)},methods:{focus(t=0,e){this.move(t,e)},keydown(t){var e;if(this.disabled)return!1;null==(e=this.keys[t.key])||e.apply(this,[t])},move(t=0,e){var s;const i=[...this.$el.querySelectorAll(this.select)];let n=i.findIndex(t=>t===document.activeElement||t.contains(document.activeElement));switch(-1===n&&(n=0),t){case"first":t=0;break;case"next":t=n+1;break;case"last":t=i.length-1;break;case"prev":t=n-1}t<0?this.$emit("prev"):t>=i.length?this.$emit("next"):null==(s=i[t])||s.focus(),null==e||e.preventDefault()},next(t){this.move("next",t)},prev(t){this.move("prev",t)}}},function(){var t=this;return(0,t._self._c)(t.element,{tag:"component",staticClass:"k-navigate"},[t._t("default")],2)},[]).exports;const ga=ut({name:"k-tree",inheritAttrs:!1,props:{element:{type:String,default:"k-tree"},current:{type:String},items:{type:[Array,Object]},level:{default:0,type:Number}},emits:["close","open","select","toggle"],data(){return{state:this.items}},methods:{arrow:t=>!0===t.loading?"loader":t.open?"angle-down":"angle-right",close(t){this.$set(t,"open",!1),this.$emit("close",t)},isItem:(t,e)=>t.value===e,open(t){this.$set(t,"open",!0),this.$emit("open",t)},select(t){this.$emit("select",t)},toggle(t){this.$emit("toggle",t),!0===t.open?this.close(t):this.open(t)}}},function(){var t=this,e=t._self._c;return e("ul",{class:["k-tree",t.$options.name,t.$attrs.class],style:{"--tree-level":t.level,...t.$attrs.style}},t._l(t.state,function(s){return e("li",{key:s.value,attrs:{"aria-expanded":s.open,"aria-current":t.isItem(s,t.current)}},[e("p",{staticClass:"k-tree-branch"},[e("button",{staticClass:"k-tree-toggle",attrs:{disabled:!s.hasChildren,type:"button"},on:{click:function(e){return t.toggle(s)}}},[e("k-icon",{attrs:{type:t.arrow(s)}})],1),e("button",{staticClass:"k-tree-folder",attrs:{disabled:s.disabled,type:"button"},on:{click:function(e){return t.select(s)},dblclick:function(e){return t.toggle(s)}}},[e("k-icon-frame",{attrs:{icon:s.icon??"folder"}}),e("span",{staticClass:"k-tree-folder-label"},[t._v(t._s(s.label))])],1)]),s.hasChildren&&s.open?[e(t.$options.name,t._b({ref:s.value,refInFor:!0,tag:"component",attrs:{items:s.children,level:t.level+1},on:{close:function(e){return t.$emit("close",e)},open:function(e){return t.$emit("open",e)},select:function(e){return t.$emit("select",e)},toggle:function(e){return t.$emit("toggle",e)}}},"component",t.$props,!1))]:t._e()],2)}),0)},[]).exports,ka={name:"k-page-tree",extends:ga,inheritAttrs:!1,props:{current:{type:String},move:{type:String},root:{default:!0,type:Boolean}},data:()=>({state:[]}),async mounted(){if(this.items)this.state=this.items;else{const t=await this.load(null);await this.open(t[0]),this.state=this.root?t:t[0].children,this.current&&this.preselect(this.current)}},methods:{findItem(t){return this.state.find(e=>this.isItem(e,t))},isItem:(t,e)=>t.value===e||t.uuid===e||t.id===e,async load(t){return await this.$panel.get("site/tree",{query:{move:this.move??null,parent:t}})},async open(t){if(t){if(!1===t.hasChildren)return!1;this.$set(t,"loading",!0),"string"==typeof t.children&&(t.children=await this.load(t.children)),this.$set(t,"open",!0),this.$set(t,"loading",!1)}},async preselect(t){const e=(await this.$panel.get("site/tree/parents",{query:{page:t,root:this.root}})).data;let s=this;for(let n=0;n<e.length;n++){const t=e[n],i=s.findItem(t);if(!i)return;await this.open(i),s=s.$refs[t][0]}const i=s.findItem(t);i&&this.$emit("select",i)}}};const ba=ut(ka,null,null).exports;const ya=ut({props:{details:Boolean,limit:{type:Number,default:10},page:{type:Number,default:1},total:{type:Number,default:0},validate:{type:Function,default:()=>Promise.resolve()}},emits:["paginate"],computed:{detailsText(){return 1===this.limit?this.start:this.start+"-"+this.end},end(){return Math.min(this.start-1+this.limit,this.total)},offset(){return this.start-1},pages(){return Math.ceil(this.total/this.limit)},start(){return(this.page-1)*this.limit+1}},methods:{async goTo(t){var e;try{await this.validate(t),null==(e=this.$refs.dropdown)||e.close();const s=((t=Math.max(1,Math.min(t,this.pages)))-1)*this.limit+1;this.$emit("paginate",{page:t,start:s,end:Math.min(s-1+this.limit,this.total),limit:this.limit,offset:s-1,total:this.total})}catch{}},prev(){this.goTo(this.page-1)},next(){this.goTo(this.page+1)}}},function(){var t=this,e=t._self._c;return t.pages>1?e("k-button-group",{staticClass:"k-pagination",attrs:{layout:"collapsed"},nativeOn:{keydown:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.prev.apply(null,arguments)},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"right",39,e.key,["Right","ArrowRight"])||"button"in e&&2!==e.button?null:t.next.apply(null,arguments)}]}},[e("k-button",{staticClass:"k-pagination-button",attrs:{disabled:t.start<=1,title:t.$t("prev"),icon:"angle-left",size:"xs",variant:"filled"},on:{click:t.prev}}),t.details?[e("k-button",{staticClass:"k-pagination-details",attrs:{disabled:t.total<=t.limit,text:t.total>1?`${t.detailsText} / ${t.total}`:t.total,size:"xs",variant:"filled"},on:{click:function(e){return t.$refs.dropdown.toggle()}}}),e("k-dropdown-content",{ref:"dropdown",staticClass:"k-pagination-selector",attrs:{"align-x":"end"},nativeOn:{keydown:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:void e.stopPropagation()},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"right",39,e.key,["Right","ArrowRight"])||"button"in e&&2!==e.button?null:void e.stopPropagation()}]}},[e("form",{attrs:{method:"dialog"},on:{click:function(t){t.stopPropagation()},submit:function(e){return t.goTo(t.$refs.page.value)}}},[e("label",[t._v(" "+t._s(t.$t("pagination.page"))+": "),e("select",{ref:"page",attrs:{autofocus:!0}},t._l(t.pages,function(s){return e("option",{key:s,domProps:{selected:t.page===s,value:s}},[t._v(" "+t._s(s)+" ")])}),0)]),e("k-button",{attrs:{type:"submit",icon:"check"}})],1)])]:t._e(),e("k-button",{staticClass:"k-pagination-button",attrs:{disabled:t.end>=t.total,title:t.$t("next"),icon:"angle-right",size:"xs",variant:"filled"},on:{click:t.next}})],2):t._e()},[]).exports;const va=ut({props:{prev:{type:[Boolean,Object],default:!1},next:{type:[Boolean,Object],default:!1}},computed:{buttons(){return[{...this.button(this.prev),icon:"angle-left"},{...this.button(this.next),icon:"angle-right"}]},isFullyDisabled(){return 0===this.buttons.filter(t=>!t.disabled).length}},methods:{button:t=>t||{disabled:!0,link:"#"}}},function(){var t=this,e=t._self._c;return t.isFullyDisabled?t._e():e("k-button-group",{staticClass:"k-prev-next",attrs:{buttons:t.buttons,layout:"collapsed",size:"xs"}})},[]).exports;const $a=ut({mixins:[Yt],props:{defaultType:String,isLoading:Boolean,pagination:{type:Object,default:()=>({})},results:Array,types:{type:Object,default:()=>({})}},emits:["close","more","navigate","search"],data(){return{selected:-1,type:this.types[this.defaultType]?this.defaultType:Object.keys(this.types)[0]}},computed:{typesDropdown(){return Object.values(this.types).map(t=>({...t,current:this.type===t.id,click:()=>{this.type=t.id,this.focus()}}))}},watch:{type(){this.search()}},methods:{focus(){var t;null==(t=this.$refs.input)||t.focus()},onDown(){this.select(Math.min(this.selected+1,this.results.length-1))},onEnter(){this.$emit("navigate",this.results[this.selected]??this.results[0])},onUp(){this.select(Math.max(this.selected-1,-1))},async search(){var t,e;null==(t=this.$refs.types)||t.close(),null==(e=this.select)||e.call(this,-1),this.$emit("search",{type:this.type,query:this.query})},select(t){var e;this.selected=t;const s=(null==(e=this.$refs.results)?void 0:e.$el.querySelectorAll(".k-item"))??[];for(const i of s)delete i.dataset.selected;t>=0&&(s[t].dataset.selected=!0)}}},function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-search-bar"},[e("div",{staticClass:"k-search-bar-input"},[t.typesDropdown.length>1?[e("k-button",{staticClass:"k-search-bar-types",attrs:{dropdown:!0,icon:t.types[t.type].icon,text:t.types[t.type].label,variant:"dimmed"},on:{click:function(e){return t.$refs.types.toggle()}}}),e("k-dropdown-content",{ref:"types",attrs:{options:t.typesDropdown}})]:t._e(),e("k-search-input",{ref:"input",attrs:{"aria-label":t.$t("search"),autofocus:!0,value:t.query},on:{input:function(e){t.query=e}},nativeOn:{keydown:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"down",40,e.key,["Down","ArrowDown"])?null:(e.preventDefault(),t.onDown.apply(null,arguments))},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"up",38,e.key,["Up","ArrowUp"])?null:(e.preventDefault(),t.onUp.apply(null,arguments))},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onEnter.apply(null,arguments)}]}}),e("k-button",{staticClass:"k-search-bar-close",attrs:{icon:t.isLoading?"loader":"cancel",title:t.$t("close")},on:{click:function(e){return t.$emit("close")}}})],2),t.results?e("div",{staticClass:"k-search-bar-results"},[t.results.length?e("k-collection",{ref:"results",attrs:{items:t.results},nativeOn:{mouseout:function(e){return t.select(-1)}}}):t._e(),e("footer",{staticClass:"k-search-bar-footer"},[0===t.results.length?e("p",[t._v(" "+t._s(t.$t("search.results.none"))+" ")]):t._e(),t.results.length<t.pagination.total?e("k-button",{attrs:{icon:"search",variant:"dimmed"},on:{click:function(e){return t.$emit("more",{type:t.type,query:t.query})}}},[t._v(" "+t._s(t.$t("search.all",{count:t.pagination.total}))+" ")]):t._e()],1)],1):t._e()])},[]).exports,wa={install(t){t.component("k-breadcrumb",ra),t.component("k-browser",aa),t.component("k-button",pa),t.component("k-button-group",da),t.component("k-file-browser",ha),t.component("k-link",ca),t.component("k-model-tabs",ma),t.component("k-navigate",fa),t.component("k-page-tree",ba),t.component("k-pagination",ya),t.component("k-prev-next",va),t.component("k-search-bar",$a),t.component("k-tag",sn),t.component("k-tags",on),t.component("k-tree",ga)}};const xa=ut({props:{buttons:Array,headline:String,invalid:Boolean,label:String,link:String,required:Boolean}},function(){var t=this,e=t._self._c;return e("section",{staticClass:"k-section",attrs:{"data-invalid":t.invalid}},[t.label||t.headline||t.buttons||t.$slots.options?e("header",{staticClass:"k-section-header"},[e("k-label",{attrs:{invalid:t.invalid,link:t.link,required:t.required,title:t.label??t.headline,type:"section"}},[t._v(" "+t._s(t.label??t.headline)+" ")]),t._t("options",function(){return[t.buttons?e("k-button-group",{staticClass:"k-section-buttons",attrs:{buttons:t.buttons,size:"xs",variant:"filled"}}):t._e()]})],2):t._e(),t._t("default")],2)},[]).exports;const _a=ut({props:{blueprint:String,content:Object,empty:String,lock:[Boolean,Object],parent:String,tab:Object},emits:["input","submit"],methods:{exists(t){return this.$helper.isComponent(`k-${t}-section`)},isVisible(t){return this.$helper.field.isVisible(t,this.content)}}},function(){var t=this,e=t._self._c;return 0===t.tab.columns.length?e("k-box",{attrs:{html:!0,text:t.empty,theme:"info"}}):e("k-grid",{staticClass:"k-sections",attrs:{variant:"columns"}},t._l(t.tab.columns,function(s,i){return e("k-column",{key:t.parent+"-column-"+i,attrs:{width:s.width,sticky:s.sticky}},[t._l(s.sections,function(n,o){return[t.isVisible(n)?[t.exists(n.type)?e("k-"+n.type+"-section",t._b({key:t.parent+"-column-"+i+"-section-"+o+"-"+t.blueprint,tag:"component",class:"k-section-name-"+n.name,attrs:{column:s.width,content:t.content,lock:t.lock,name:n.name,parent:t.parent,timestamp:t.$panel.view.timestamp},on:{input:function(e){return t.$emit("input",e)},submit:function(e){return t.$emit("submit",e)}}},"component",n,!1)):[e("k-box",{key:t.parent+"-column-"+i+"-section-"+o,attrs:{text:t.$t("error.section.type.invalid",{type:n.type}),icon:"alert",theme:"negative"}})]]:t._e()]})],2)}),1)},[]).exports,Sa={props:{blueprint:String,help:String,lock:[Boolean,Object],name:String,parent:String,timestamp:Number},methods:{load(){return this.$api.get(this.parent+"/sections/"+this.name)}}};const Ca=ut({mixins:[Sa],inheritAttrs:!1,props:{content:Object},emits:["input","submit"],data:()=>({fields:{},isLoading:!0,issue:null}),watch:{timestamp(){this.fetch()}},mounted(){this.fetch()},methods:{async fetch(){try{const t=await this.load();this.fields=t.fields;for(const e in this.fields)this.fields[e].section=this.name,this.fields[e].endpoints={field:this.parent+"/fields/"+e,section:this.parent+"/sections/"+this.name,model:this.parent}}catch(t){this.issue=t}finally{this.isLoading=!1}}}},function(){var t=this,e=t._self._c;return t.isLoading?t._e():e("k-section",{class:["k-fields-section",t.$attrs.class],style:t.$attrs.style,attrs:{headline:t.issue?t.$t("error"):null}},[t.issue?e("k-box",{attrs:{text:t.issue.message,html:!1,icon:"alert",theme:"negative"}}):t._e(),e("k-form",{attrs:{fields:t.fields,validate:!0,value:t.content,disabled:t.lock&&"lock"===t.lock.state},on:{input:function(e){return t.$emit("input",e)},submit:function(e){return t.$emit("submit",e)}}})],1)},[]).exports;const Oa=ut({mixins:[Sa,Rn],inheritAttrs:!1,props:{column:String},data:()=>({data:[],error:null,isLoading:!1,isProcessing:!1,options:{batch:!1,columns:{},empty:null,fields:{},headline:null,help:null,layout:"list",link:null,max:null,min:null,size:null,sortable:null},pagination:{page:null},searchterm:null,searching:!1}),computed:{addIcon:()=>"add",batchDeleteConfirmMessage(){return this.$t(`${this.type}.delete.confirm.selected`,{count:this.selected.length})},batchEditingEvent:()=>"section.selecting",buttons(){let t=[];return this.isSelecting?this.batchEditingButtons:(this.canSearch&&t.push({icon:"filter",text:this.$t("filter"),click:this.onSearchToggle,responsive:!0}),this.canSelect&&t.push(this.batchEditingToggle),this.canAdd&&t.push({icon:this.addIcon,text:this.$t("add"),click:this.onAdd,responsive:!0}),t)},canAdd:()=>!0,canDrop:()=>!1,canSearch(){return this.options.search},canSelect(){return this.options.batch&&this.items.length>0},collection(){return{columns:this.options.columns,empty:this.emptyPropsWithSearch,fields:this.fields,layout:this.options.layout,help:this.options.help,items:this.items,pagination:this.pagination,selecting:!this.isProcessing&&this.isSelecting,sortable:!this.isProcessing&&this.options.sortable,size:this.options.size}},emptyProps(){return{icon:"page",text:this.$t("pages.empty")}},emptyPropsWithSearch(){return{...this.emptyProps,text:this.searching?this.$t("search.results.none"):this.options.empty??this.emptyProps.text}},fields(){var t;const e={};for(const s in this.options.columns??{})e[s]={...(null==(t=this.options.fields)?void 0:t[s])??this.options.columns[s],disabled:!0};return e},items(){return this.data},isInvalid(){var t;return!((null==(t=this.searchterm)?void 0:t.length)>0)&&(!!(this.options.min&&this.data.length<this.options.min)||!!(this.options.max&&this.data.length>this.options.max))},paginationId(){return"kirby$pagination$"+this.parent+"/"+this.name},type:()=>"models"},watch:{searchterm(){this.search()},timestamp(){this.reload()}},created(){this.$events.on("model.update",this.reload)},destroyed(){this.$events.off("model.update",this.reload)},mounted(){this.search=zt(this.search,200),this.load()},methods:{async deleteSelected(){if(0!==this.selected.length){this.isProcessing=!0;try{await this.$api.delete(this.parent+"/sections/"+this.name+"/delete",{ids:this.selected.map(t=>t.id)})}catch(t){this.$panel.notification.error(t)}finally{this.$panel.events.emit("model.update"),this.isProcessing=!1}}},async load(t){this.isProcessing=!0,t||(this.isLoading=!0);const e=this.pagination.page??sessionStorage.getItem(this.paginationId)??null;try{const t=await this.$api.get(this.parent+"/sections/"+this.name,{page:e,searchterm:this.searchterm});this.options=t.options,this.pagination=t.pagination,this.data=t.data}catch(s){this.error=s.message}finally{this.isProcessing=!1,this.isLoading=!1}},onAction(){},onAdd(){},onBatchDelete(){this.deleteSelected()},onChange(){},onDrop(){},onPaginate(t){sessionStorage.setItem(this.paginationId,t.page),this.pagination=t,this.reload()},onSearchToggle(){this.searching=!this.searching,this.searchterm=null},onSort(){},async reload(){this.stopSelecting(),await this.load(!0)},async search(){this.pagination.page=0,await this.reload()},update(){this.reload(),this.$events.emit("model.update")}}},function(){var t=this,e=t._self._c;return!1===t.isLoading?e("k-section",{class:["k-models-section",`k-${t.type}-section`,t.$attrs.class],style:t.$attrs.style,attrs:{buttons:t.buttons,"data-processing":t.isProcessing,headline:t.options.headline??" ",invalid:t.isInvalid,link:t.options.link,required:Boolean(t.options.min)}},[t.error?e("k-box",{attrs:{icon:"alert",theme:"negative"}},[e("k-text",{attrs:{size:"small"}},[e("strong",[t._v(" "+t._s(t.$t("error.section.notLoaded",{name:t.name}))+": ")]),t._v(" "+t._s(t.error)+" ")])],1):[e("k-dropzone",{attrs:{disabled:!t.canDrop},on:{drop:t.onDrop}},[t.searching&&t.options.search?e("k-input",{staticClass:"k-models-section-search",attrs:{autofocus:!0,placeholder:t.$t("filter")+" …",value:t.searchterm,icon:"search",type:"text"},on:{input:function(e){t.searchterm=e}},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:t.onSearchToggle.apply(null,arguments)}}}):t._e(),e("k-collection",t._g(t._b({on:{action:t.onAction,change:t.onChange,select:t.onSelect,sort:t.onSort,paginate:t.onPaginate}},"k-collection",t.collection,!1),t.canAdd?{empty:t.onAdd}:{}))],1)]],2):t._e()},[]).exports;const Aa=ut({extends:Oa,computed:{addIcon:()=>"upload",canAdd(){return this.$panel.permissions.files.create&&!1!==this.options.upload},canDrop(){return!1!==this.canAdd},emptyProps(){return{icon:"image",text:this.$t("files.empty")}},items(){return this.data.map(t=>{const e=t.permissions.sort&&this.options.sortable&&!this.isSelecting,s=t.permissions.delete&&this.data.length>this.options.min;return{...t,column:this.column,data:{"data-id":t.id,"data-template":t.template},options:this.$dropdown(t.link,{query:{delete:s,sort:e,view:"list"}}),selectable:this.isSelecting&&s,sortable:e}})},type:()=>"files",uploadOptions(){return{...this.options.upload,url:this.$panel.urls.api+"/"+this.options.upload.api}}},mounted(){this.$events.on("file.sort",this.reload)},destroyed(){this.$events.off("file.sort",this.reload)},methods:{onAction(t,e){"replace"===t&&this.replace(e)},onAdd(){this.canAdd&&this.$panel.upload.pick(this.uploadOptions)},onDrop(t){this.canAdd&&this.$panel.upload.open(t,this.uploadOptions)},async onSort(t){if(!1===this.options.sortable)return!1;this.isProcessing=!0;try{await this.$api.patch(this.options.apiUrl+"/sort",{files:t.map(t=>t.id),index:this.pagination.offset}),this.$panel.notification.success(),this.$events.emit("file.sort")}catch(e){this.$panel.error(e),this.reload()}finally{this.isProcessing=!1}},replace(t){this.$panel.upload.replace(t,this.uploadOptions)}}},null,null).exports;const Ma=ut({mixins:[Sa],inheritAttrs:!1,data:()=>({icon:null,label:null,text:null,theme:null}),async mounted(){const t=await this.load();this.icon=t.icon,this.label=t.label,this.text=t.text,this.theme=t.theme??"info"}},function(){var t=this,e=t._self._c;return e("k-section",{class:["k-info-section",t.$attrs.class],style:t.$attrs.style,attrs:{headline:t.label}},[e("k-box",{attrs:{html:!0,icon:t.icon,text:t.text,theme:t.theme}})],1)},[]).exports;const Da=ut({extends:Oa,computed:{canAdd(){return this.options.add&&this.$panel.permissions.pages.create},items(){return this.data.map(t=>{const e=t.permissions.sort&&this.options.sortable&&!this.isSelecting,s=t.permissions.delete&&this.data.length>this.options.min,i={...this.$helper.page.status(t.status,!1===t.permissions.changeStatus),click:()=>this.$dialog(t.link+"/changeStatus")};return{...t,buttons:[i,...t.buttons??[]],column:this.column,data:{"data-id":t.id,"data-status":t.status,"data-template":t.template},flag:i,deletable:s,options:this.$dropdown(t.link,{query:{view:"list",delete:s,sort:e}}),selectable:this.isSelecting&&s,sortable:e}})},type:()=>"pages"},mounted(){this.$events.on("page.changeStatus",this.reload),this.$events.on("page.sort",this.reload)},destroyed(){this.$events.off("page.changeStatus",this.reload),this.$events.off("page.sort",this.reload)},methods:{onAdd(){this.canAdd&&this.$dialog("pages/create",{query:{parent:this.options.link??this.parent,view:this.parent,section:this.name}})},async onChange(t){let e=null;if(t.added&&(e="added"),t.moved&&(e="moved"),e){this.isProcessing=!0;const i=t[e].element,n=t[e].newIndex+1+this.pagination.offset;try{await this.$api.pages.changeStatus(i.id,"listed",n),this.$panel.notification.success(),this.$events.emit("page.sort",i)}catch(s){this.$panel.error({message:s.message,details:s.details}),await this.reload()}finally{this.isProcessing=!1}}}}},null,null).exports;const Ea=ut({mixins:[Sa],data:()=>({headline:null,isLoading:!0,reports:null,size:null}),async mounted(){const t=await this.load();this.isLoading=!1,this.headline=t.headline,this.reports=t.reports,this.size=t.size},methods:{}},function(){var t=this,e=t._self._c;return!1===t.isLoading?e("k-section",{staticClass:"k-stats-section",attrs:{headline:t.headline}},[e("k-stats",{attrs:{reports:t.reports,size:t.size}})],1):t._e()},[]).exports,ja={install(t){t.component("k-section",xa),t.component("k-sections",_a),t.component("k-fields-section",Ca),t.component("k-files-section",Aa),t.component("k-info-section",Ma),t.component("k-pages-section",Da),t.component("k-stats-section",Ea)}};const Ia=ut({components:{"k-highlight":()=>_r(()=>import("./Highlight.min.js"),__vite__mapDeps([5,1]),import.meta.url)},props:{language:{type:String}}},function(){var t=this,e=t._self._c;return e("k-highlight",[e("div",[e("pre",{staticClass:"k-code",attrs:{"data-language":t.language}},[e("code",{key:t.$slots.default[0].text+"-"+t.language,class:t.language?`language-${t.language}`:null},[t._t("default")],2)])])])},[]).exports;const Ba=ut({props:{link:String,tag:{type:String,default:"h2"}},emits:["click"]},function(){var t=this,e=t._self._c;return e(t.tag,{tag:"component",staticClass:"k-headline",on:{click:function(e){return t.$emit("click",e)}}},[t.link?e("k-link",{attrs:{to:t.link}},[t._t("default")],2):t._t("default")],2)},[]).exports;const La=ut({props:{input:{type:[String,Number,Boolean]},invalid:{type:Boolean},link:{type:String},required:{default:!1,type:Boolean},type:{default:"field",type:String}},computed:{element(){return"section"===this.type||!1===this.input?"h2":"label"}}},function(){var t=this,e=t._self._c;return e(t.element,{tag:"component",staticClass:"k-label",class:"k-"+t.type+"-label",attrs:{for:t.input}},[t.link?e("k-link",{attrs:{to:t.link}},[e("span",{staticClass:"k-label-text"},[t._t("default")],2)]):e("span",{staticClass:"k-label-text"},[t._t("default")],2),!1!==t.input?[t.required?e("abbr",{attrs:{title:t.$t(t.type+".required")}},[t._v("✶")]):t._e(),e("abbr",{staticClass:"k-label-invalid",attrs:{title:t.$t(t.type+".invalid"),"data-theme":"negative"}},[t._v(" × ")])]:t._e()],2)},[]).exports;const Ta=ut({props:{align:String,html:String,size:String},computed:{attrs(){return{class:"k-text","data-align":this.align,"data-size":this.size}}}},function(){var t=this,e=t._self._c;return t.html?e("div",t._b({domProps:{innerHTML:t._s(t.html)}},"div",t.attrs,!1)):e("div",t._b({},"div",t.attrs,!1),[t._t("default")],2)},[]).exports,Pa={install(t){t.component("k-code",Ia),t.component("k-headline",Ba),t.component("k-label",La),t.component("k-text",Ta)}},qa={props:{back:String,color:String,cover:{type:Boolean,default:!0},icon:String,type:String,url:String}};const Na=ut({mixins:[qa],computed:{fallbackColor(){var t,e,s;return(null==(t=this.type)?void 0:t.startsWith("image/"))?"orange-500":(null==(e=this.type)?void 0:e.startsWith("audio/"))?"aqua-500":(null==(s=this.type)?void 0:s.startsWith("video/"))?"yellow-500":"white"},fallbackIcon(){var t,e,s;return(null==(t=this.type)?void 0:t.startsWith("image/"))?"image":(null==(e=this.type)?void 0:e.startsWith("audio/"))?"audio":(null==(s=this.type)?void 0:s.startsWith("video/"))?"video":"file"},isPreviewable(){return["image/jpeg","image/jpg","image/gif","image/png","image/webp","image/avif","image/svg+xml"].includes(this.type)}}},function(){var t=this,e=t._self._c;return e("a",{staticClass:"k-upload-item-preview",attrs:{href:t.url,target:"_blank"}},[t.isPreviewable?e("k-image",{attrs:{cover:t.cover,src:t.url,back:t.back??"pattern"}}):e("k-icon-frame",{attrs:{color:t.color??t.fallbackColor,icon:t.icon??t.fallbackIcon,back:t.back??"black",ratio:"1/1"}})],1)},[]).exports;const Fa=ut({mixins:[qa],props:{completed:Boolean,editable:{type:Boolean,default:!0},error:[String,Boolean],extension:String,id:String,name:String,niceSize:String,progress:Number,removable:{type:Boolean,default:!0}},emits:["remove","rename"]},function(){var t=this,e=t._self._c;return e("li",{staticClass:"k-upload-item",attrs:{"data-completed":t.completed}},[e("k-upload-item-preview",{attrs:{back:t.back,color:t.color,cover:t.cover,icon:t.icon,type:t.type,url:t.url}}),e("k-input",{staticClass:"k-upload-item-input",attrs:{disabled:t.completed||!t.editable,after:"."+t.extension,required:!0,value:t.name,allow:"a-z0-9@._-",type:"slug"},on:{input:function(e){return t.$emit("rename",e)}}}),e("div",{staticClass:"k-upload-item-body"},[e("p",{staticClass:"k-upload-item-meta"},[t._v(" "+t._s(t.niceSize)+" "),t.progress?[t._v(" - "+t._s(t.progress)+"% ")]:t._e()],2),t.error?e("p",{staticClass:"k-upload-item-error",attrs:{"data-theme":"negative"}},[t._v(" "+t._s(t.error)+" ")]):t.progress?e("k-progress",{staticClass:"k-upload-item-progress",attrs:{value:t.progress}}):t._e()],1),e("div",{staticClass:"k-upload-item-toggle"},[t.completed||t.progress||!t.removable?!t.completed&&t.progress?e("k-button",{attrs:{disabled:!0,icon:"loader"}}):t.completed?e("k-button",{attrs:{icon:"check",theme:"positive"},on:{click:function(e){return t.$emit("remove")}}}):t._e():e("k-button",{attrs:{icon:"remove"},on:{click:function(e){return t.$emit("remove")}}})],1)],1)},[]).exports;const za=ut({props:{items:Array},emits:["remove","rename"]},function(){var t=this,e=t._self._c;return e("ul",{staticClass:"k-upload-items"},t._l(t.items,function(s){return e("k-upload-item",t._b({key:s.id,on:{rename:function(e){return t.$emit("rename",s,e)},remove:function(e){return t.$emit("remove",s)}}},"k-upload-item",s,!1))}),1)},[]).exports,Ya={install(t){t.component("k-upload-item",Fa),t.component("k-upload-item-preview",Na),t.component("k-upload-items",za)}};const Ra=ut({props:{status:{default:"missing",type:String}}},function(){var t=this,e=t._self._c;return t.$panel.activation.isOpen?e("div",{staticClass:"k-activation"},[e("p",[e("strong",[t._v(t._s(t.$t(`license.status.${t.status}.bubble`)))]),"missing"===t.status?[e("a",{attrs:{href:"https://getkirby.com/buy",target:"_blank"}},[t._v(t._s(t.$t("license.buy")))]),t._v(" & "),e("button",{attrs:{type:"button"},on:{click:function(e){return t.$dialog("registration")}}},[t._v(" "+t._s(t.$t("license.activate"))+" ")])]:t._e()],2),e("k-button",{staticClass:"k-activation-toggle",attrs:{icon:"cancel-small"},on:{click:function(e){return t.$panel.activation.close()}}})],1):t._e()},[]).exports;const Ha=ut({mixins:[ua],props:{hasDiff:Boolean,options:String},computed:{changesBadge(){return this.hasDiff||this.$panel.content.hasDiff()?{theme:this.$panel.content.isLocked()?"red":"orange"}:null}},methods:{change(t){this.$reload({query:{language:t.code}})}}},function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-view-button k-languages-dropdown"},[e("k-button",t._b({attrs:{badge:t.changesBadge,dropdown:!0},on:{click:function(e){return t.$refs.dropdown.toggle()}}},"k-button",t.$props,!1)),e("k-dropdown-content",{ref:"dropdown",attrs:{options:t.$dropdown(t.options),"align-x":"end"},scopedSlots:t._u([{key:"item",fn:function({item:s,index:i}){return[e("k-button",t._b({key:"item-"+i,staticClass:"k-dropdown-item k-languages-dropdown-item",on:{click:function(e){return t.change(s)}}},"k-button",s,!1),[t._v(" "+t._s(s.text)+" "),e("span",{staticClass:"k-languages-dropdown-item-info",attrs:{"data-lock":s.lock}},[s.changes?e("k-icon",{staticClass:"k-languages-dropdown-item-icon",attrs:{alt:t.$t("lock.unsaved"),type:s.lock?"lock":"edit-line"}}):t._e(),e("span",{staticClass:"k-languages-dropdown-item-code"},[t._v(" "+t._s(s.code.toUpperCase())+" ")])],1)])]}}])})],1)},[]).exports;const Ua=ut({extends:pa,props:{options:[Array,String],size:{default:"sm"},variant:{default:"filled"}},emits:["action","click"],computed:{hasDropdown(){return!0===Array.isArray(this.options)?this.options.length>0:Boolean(this.options)}},methods:{onClick(){if(this.hasDropdown)return this.$refs.dropdown.toggle();this.$emit("click")}}},function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-view-button"},[e("k-button",t._b({attrs:{dropdown:t.dropdown||t.hasDropdown},on:{click:t.onClick}},"k-button",t.$props,!1)),t.hasDropdown?e("k-dropdown-content",{ref:"dropdown",attrs:{options:Array.isArray(t.options)?t.options:t.$dropdown(t.options),"align-x":"end"},on:{action:function(e){return t.$emit("action",e)}}}):t._e()],1)},[]).exports;const Va=ut({extends:Ua,emits:["action"]},function(){var t=this;return(0,t._self._c)("k-view-button",t._b({attrs:{disabled:t.$panel.content.isLocked()},on:{action:function(e){return t.$emit("action",e)}}},"k-view-button",t.$props,!1))},[]).exports;const Ka=ut({extends:Ua},function(){var t=this;return(0,t._self._c)("k-view-button",t._b({attrs:{disabled:t.disabled||t.$panel.content.isLocked()}},"k-view-button",t.$props,!1))},[]).exports;const Wa=ut({props:{size:String,text:{type:String,default:()=>window.panel.t("theme")},variant:String},computed:{current(){return this.$panel.theme.current},options(){return[{text:this.$t("theme.light"),icon:"sun",disabled:"light"===this.setting,click:()=>this.$panel.theme.set("light")},{text:this.$t("theme.dark"),icon:"moon",disabled:"dark"===this.setting,click:()=>this.$panel.theme.set("dark")},{text:this.$t("theme.automatic"),icon:"wand",disabled:"system"===this.setting,click:()=>this.$panel.theme.set("system")}]},setting(){return this.$panel.theme.setting??this.$panel.theme.config}}},function(){var t=this;return(0,t._self._c)("k-view-button",t._b({attrs:{icon:"light"===t.current?"sun":"moon",options:t.options}},"k-view-button",t.$props,!1))},[]).exports;const Ja=ut({props:{buttons:{type:Array,default:()=>[]}},emits:["action"],methods:{component(t){return this.$helper.isComponent(t.component)?t.component:"k-view-button"}}},function(){var t=this,e=t._self._c;return t.buttons.length?e("k-button-group",{staticClass:"k-view-buttons"},t._l(t.buttons,function(s){return e(t.component(s),t._b({key:s.key,tag:"component",on:{action:function(e){return t.$emit("action",e)}}},"component",s.props,!1))}),1):t._e()},[]).exports,Ga={install(t){t.component("k-languages-dropdown",Ha),t.component("k-settings-view-button",Va),t.component("k-status-view-button",Ka),t.component("k-theme-view-button",Wa),t.component("k-view-button",Ua),t.component("k-view-buttons",Ja)}};const Xa=ut({computed:{notification(){return"view"!==this.$panel.notification.context||this.$panel.notification.isFatal?null:this.$panel.notification}}},function(){var t=this,e=t._self._c;return e("k-panel",{staticClass:"k-panel-inside"},[e("k-panel-menu"),e("main",{staticClass:"k-panel-main"},[e("k-topbar",{attrs:{breadcrumb:t.$panel.view.breadcrumb,view:t.$panel.view}},[t._t("topbar")],2),t._t("default")],2),t.notification&&"error"!==t.notification.type?e("k-button",{staticClass:"k-panel-notification",attrs:{icon:t.notification.icon,text:t.notification.message,theme:t.notification.theme,variant:"filled"},on:{click:function(e){return t.notification.close()}}}):t._e()],1)},[]).exports;const Za=ut({data:()=>({over:!1}),computed:{activationButton(){return"missing"===this.$panel.license?{click:()=>this.$dialog("registration"),text:this.$t("activate")}:"legacy"===this.$panel.license&&{click:()=>this.$dialog("license"),text:this.$t("renew")}},hasSearch(){return this.$helper.object.length(this.$panel.searches)>0},menus(){return this.$helper.array.split(this.$panel.menu.entries,"-")}}},function(){var t=this,e=t._self._c;return e("nav",{staticClass:"k-panel-menu",attrs:{"aria-label":t.$t("menu"),"data-hover":t.$panel.menu.hover},on:{mouseenter:function(e){t.$panel.menu.hover=!0},mouseleave:function(e){t.$panel.menu.hover=!1}}},[e("div",{staticClass:"k-panel-menu-body"},[t.hasSearch?e("k-button",{staticClass:"k-panel-menu-search k-panel-menu-button",attrs:{text:t.$t("search"),icon:"search"},on:{click:function(e){return t.$panel.search()}}}):t._e(),t._l(t.menus,function(s,i){return e("menu",{key:i,staticClass:"k-panel-menu-buttons",attrs:{"data-second-last":i===t.menus.length-2}},t._l(s,function(s){return e("k-button",t._b({key:s.id,staticClass:"k-panel-menu-button",attrs:{title:s.title??s.text}},"k-button",s,!1))}),1)}),t.activationButton?e("menu",[e("k-button",t._b({staticClass:"k-activation-button k-panel-menu-button",attrs:{icon:"key",theme:"love",variant:"filled"}},"k-button",t.activationButton,!1)),e("k-activation",{attrs:{status:t.$panel.license}})],1):t._e()],2),e("k-button",{staticClass:"k-panel-menu-toggle",attrs:{icon:t.$panel.menu.isOpen?"angle-left":"angle-right",title:t.$panel.menu.isOpen?t.$t("collapse"):t.$t("expand"),size:"xs"},on:{click:function(e){return t.$panel.menu.toggle()}}})],1)},[]).exports;const Qa=ut({},function(){return(0,this._self._c)("k-panel",{staticClass:"k-panel-outside",attrs:{tabindex:"0"}},[this._t("default")],2)},[]).exports;const tl=ut({},function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-panel",attrs:{"data-dragging":t.$panel.drag.isDragging,"data-loading":t.$panel.isLoading,"data-language":t.$panel.language.code,"data-language-default":t.$panel.language.isDefault,"data-menu":t.$panel.menu.isOpen?"true":"false","data-role":t.$panel.user.role,"data-theme":t.$panel.theme.current,"data-translation":t.$panel.translation.code,"data-user":t.$panel.user.id,dir:t.$panel.direction}},[t._t("default"),t.$panel.dialog.isOpen&&!t.$panel.dialog.legacy?e("k-fiber-dialog"):t._e(),t.$panel.drawer.isOpen&&!t.$panel.drawer.legacy?e("k-fiber-drawer"):t._e(),t.$panel.notification.isFatal&&t.$panel.notification.isOpen?e("k-fatal",{attrs:{html:t.$panel.notification.message}}):t._e(),e("k-offline-warning"),e("k-icons"),e("k-overlay",{attrs:{nested:t.$panel.drawer.history.milestones.length>1,visible:t.$panel.drawer.isOpen,type:"drawer"},on:{close:function(e){return t.$panel.drawer.close()}}},[e("portal-target",{staticClass:"k-drawer-portal k-portal",attrs:{name:"drawer",multiple:""}})],1),e("k-overlay",{attrs:{nested:t.$panel.dialog.history.milestones.length>1,visible:t.$panel.dialog.isOpen,type:"dialog"},on:{close:function(e){return t.$panel.dialog.close()}}},[e("portal-target",{staticClass:"k-dialog-portal k-portal",attrs:{name:"dialog",multiple:""}})],1),e("portal-target",{staticClass:"k-overlay-portal k-portal",attrs:{name:"overlay",multiple:""}})],2)},[]).exports;const el=ut({props:{breadcrumb:Array,view:Object},computed:{crumbs(){return[{link:this.view.link,label:this.view.label??this.view.breadcrumbLabel,icon:this.view.icon,loading:this.$panel.isLoading},...this.breadcrumb]}}},function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-topbar"},[e("k-button",{staticClass:"k-panel-menu-proxy",attrs:{icon:"bars"},on:{click:function(e){return t.$panel.menu.toggle()}}}),e("k-breadcrumb",{staticClass:"k-topbar-breadcrumb",attrs:{crumbs:t.crumbs}}),e("div",{staticClass:"k-topbar-spacer"}),e("div",{staticClass:"k-topbar-signals"},[t._t("default")],2)],1)},[]).exports,sl={install(t){t.use(Ga),t.component("k-activation",Ra),t.component("k-panel",tl),t.component("k-panel-inside",Xa),t.component("k-panel-menu",Za),t.component("k-panel-outside",Qa),t.component("k-topbar",el)}};const il=ut({props:{error:String,layout:String}},function(){var t=this,e=t._self._c;return e(`k-panel-${t.layout}`,{tag:"component",staticClass:"k-error-view"},["outside"===t.layout?[e("div",[e("k-box",{attrs:{icon:"alert",theme:"negative"}},[t._v(t._s(t.error))])],1)]:[e("k-header",[t._v(t._s(t.$t("error")))]),e("k-box",{attrs:{icon:"alert",theme:"negative"}},[t._v(t._s(t.error))])]],2)},[]).exports;const nl=ut({mixins:[Yt],props:{type:{default:"pages",type:String}},data:()=>({query:new URLSearchParams(window.location.search).get("query"),pagination:{},results:[]}),computed:{currentType(){return this.$panel.searches[this.type]??Object.values(this.$panel.searches)[0]},empty(){return this.isLoading?this.$t("searching")+"…":this.query.length<2?this.$t("search.min",{min:2}):this.$t("search.results.none")},isLoading(){return this.$panel.searcher.isLoading},tabs(){const t=[];for(const e in this.$panel.searches){const s=this.$panel.searches[e];t.push({label:s.label,link:"/search/?type="+e+"&query="+this.query,name:e})}return t}},watch:{isLoading(t){this.$panel.isLoading=t},query:{handler(){this.search(1)},immediate:!0},type(){this.search()}},methods:{focus(){var t;null==(t=this.$refs.input)||t.focus()},onPaginate(t){this.search(t.page)},async search(t){t||(t=new URLSearchParams(window.location.search).get("page")??1);const e=this.$panel.url(window.location,{type:this.currentType.id,query:this.query,page:t});window.history.pushState("","",e.toString());const s=await this.$panel.search(this.currentType.id,this.query,{page:t,limit:15});s&&(this.results=s.results??[],this.pagination=s.pagination)}}},function(){var t=this,e=t._self._c;return e("k-panel-inside",{staticClass:"k-search-view"},[e("k-header",[t._v(" "+t._s(t.$t("search"))+" "),e("k-input",{ref:"input",staticClass:"k-search-view-input",attrs:{slot:"buttons","aria-label":t.$t("search"),autofocus:!0,icon:t.isLoading?"loader":"search",placeholder:t.$t("search")+" …",spellcheck:!1,value:t.query,type:"text"},on:{input:function(e){t.query=e}},slot:"buttons"})],1),e("k-tabs",{attrs:{tab:t.currentType.id,tabs:t.tabs}}),e("div",{staticClass:"k-search-view-results"},[e("k-collection",{attrs:{items:t.results,empty:{icon:t.isLoading?"loader":"search",text:t.empty},pagination:t.pagination},on:{paginate:t.onPaginate}})],1)],1)},[]).exports;const ol=ut({props:{api:String,blueprint:String,buttons:Array,id:String,link:String,lock:{type:[Boolean,Object]},model:Object,next:Object,prev:Object,permissions:{type:Object,default:()=>({})},tab:{type:Object,default:()=>({columns:[]})},tabs:{type:Array,default:()=>[]},uuid:String,versions:Object},data:()=>({isSaved:!0}),computed:{content(){return this.versions.changes},diff(){return this.$panel.content.diff()},editor(){return this.lock.user.email},hasDiff(){return this.$panel.content.hasDiff()},isLocked(){return this.lock.isLocked},isSaving(){return this.$panel.content.isProcessing},modified(){return this.lock.modified}},mounted(){this.$events.on("beforeunload",this.onBeforeUnload),this.$events.on("content.save",this.onContentSave),this.$events.on("keydown.left",this.toPrev),this.$events.on("keydown.right",this.toNext),this.$events.on("model.reload",this.$reload),this.$events.on("view.save",this.onViewSave)},destroyed(){this.$events.off("beforeunload",this.onBeforeUnload),this.$events.off("content.save",this.onContentSave),this.$events.off("keydown.left",this.toPrev),this.$events.off("keydown.right",this.toNext),this.$events.off("model.reload",this.$reload),this.$events.off("view.save",this.onViewSave)},methods:{onBeforeUnload(t){!0!==this.$panel.content.isProcessing&&!1!==this.isSaved||(t.preventDefault(),t.returnValue="")},onContentSave({api:t,language:e}){t===this.api&&e===this.$panel.language.code&&(this.isSaved=!0)},async onDiscard(){await this.$panel.content.discard({api:this.api,language:this.$panel.language.code}),this.$panel.view.refresh()},onInput(t){this.$panel.content.updateLazy(t,{api:this.api,language:this.$panel.language.code})},async onSubmit(){try{await this.$panel.content.publish(this.content,{api:this.api,language:this.$panel.language.code}),this.$panel.notification.success(),this.$events.emit("model.update"),await this.$panel.view.refresh()}catch(t){this.$panel.notification.error(t)}},onViewSave(t){var e;null==(e=null==t?void 0:t.preventDefault)||e.call(t),this.onSubmit()},toNext(t){this.next&&"body"===t.target.localName&&this.$go(this.next.link)},toPrev(t){this.prev&&"body"===t.target.localName&&this.$go(this.prev.link)}}},null,null).exports;const rl=ut({extends:ol,props:{extension:String,filename:String,mime:String,preview:Object,type:String,url:String},methods:{onAction(t){if("replace"===t)return this.$panel.upload.replace({extension:this.extension,filename:this.filename,image:this.preview.image,link:this.link,mime:this.mime,url:this.url})}}},function(){var t=this,e=t._self._c;return e("k-panel-inside",{staticClass:"k-file-view",attrs:{"data-id":t.id,"data-locked":t.isLocked,"data-template":t.blueprint},scopedSlots:t._u([{key:"topbar",fn:function(){return[e("k-prev-next",{attrs:{prev:t.prev,next:t.next}})]},proxy:!0}])},[e("k-header",{staticClass:"k-file-view-header",attrs:{editable:t.permissions.changeName&&!t.isLocked},on:{edit:function(e){return t.$dialog(t.api+"/changeName")}},scopedSlots:t._u([{key:"buttons",fn:function(){return[e("k-view-buttons",{attrs:{buttons:t.buttons},on:{action:t.onAction}}),e("k-form-controls",{attrs:{editor:t.editor,"has-diff":t.hasDiff,"is-locked":t.isLocked,"is-processing":t.isSaving,modified:t.modified},on:{discard:t.onDiscard,submit:t.onSubmit}})]},proxy:!0}])},[t._v(" "+t._s(t.filename)+" ")]),e("k-file-preview",t._b({attrs:{content:t.content,"is-locked":t.isLocked},on:{input:t.onInput,submit:t.onSubmit}},"k-file-preview",t.preview,!1)),e("k-model-tabs",{attrs:{diff:t.diff,tab:t.tab.name,tabs:t.tabs}}),e("k-sections",{attrs:{blueprint:t.blueprint,content:t.content,empty:t.$t("file.blueprint",{blueprint:t.$esc(t.blueprint)}),lock:t.lock,parent:t.api,tab:t.tab},on:{input:t.onInput,submit:t.onSubmit}})],1)},[]).exports;const al=ut({props:{component:String,content:Object,isLocked:Boolean,props:Object},emits:["input","submit"],computed:{preview(){return this.$helper.isComponent(this.component)?this.component:"k-default-file-preview"}}},function(){var t=this;return(0,t._self._c)(t.preview,t._b({tag:"component",staticClass:"k-file-preview",attrs:{content:t.content,"is-locked":t.isLocked},on:{input:function(e){return t.$emit("input",e)},submit:function(e){return t.$emit("submit",e)}}},"component",t.props,!1))},[]).exports;const ll=ut({props:{details:{default:()=>[],type:Array}}},function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-file-preview-details"},[e("dl",[t._l(t.details,function(s){return e("div",{key:s.title},[e("dt",[t._v(t._s(s.title))]),e("dd",[s.link?e("k-link",{attrs:{to:s.link,tabindex:"-1",target:"_blank"}},[t._v(" "+t._s(s.text)+" ")]):[t._v(" "+t._s(s.text)+" ")]],2)])}),t._t("default")],2)])},[]).exports;const cl=ut({props:{options:{default:()=>[],type:Array}}},function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-file-preview-frame-column"},[e("div",{staticClass:"k-file-preview-frame"},[t._t("default"),t.options.length?[e("k-button",{staticClass:"k-file-preview-frame-dropdown-toggle",attrs:{icon:"dots",size:"xs"},on:{click:function(e){return t.$refs.dropdown.toggle()}}}),e("k-dropdown-content",{ref:"dropdown",attrs:{options:t.options,theme:"light"},on:{action:function(e){return t.$emit("action",e)}}})]:t._e()],2)])},[]).exports;const ul=ut({props:{details:Array,image:{default:()=>({}),type:Object}}},function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-default-file-preview"},[e("k-file-preview-frame",[e("k-icon",{staticClass:"k-item-icon",attrs:{color:t.$helper.color(t.image.color),type:t.image.icon}})],1),e("k-file-preview-details",{attrs:{details:t.details}})],1)},[]).exports;const pl=ut({props:{details:Array,url:String}},function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-audio-file-preview"},[e("audio",{attrs:{controls:"",preload:"metadata",src:t.url}}),e("k-file-preview-details",{attrs:{details:t.details}})],1)},[]).exports;const dl=ut({props:{content:{default:()=>({}),type:Object},details:Array,focusable:Boolean,image:{default:()=>({}),type:Object},isLocked:Boolean,url:String},emits:["focus","input"],computed:{focus(){const t=this.content.focus;if(!t)return;const[e,s]=t.replaceAll("%","").split(" ");return{x:parseFloat(e),y:parseFloat(s)}},hasFocus(){return Boolean(this.focus)},isFocusable(){return!0===this.focusable&&!0!==this.isLocked},options(){return[{icon:"open",text:this.$t("open"),link:this.url,target:"_blank"},{icon:"cancel",text:this.$t("file.focus.reset"),click:()=>this.setFocus(void 0),when:this.isFocusable&&this.hasFocus},{icon:"preview",text:this.$t("file.focus.placeholder"),click:()=>this.setFocus({x:50,y:50}),when:this.isFocusable&&!this.hasFocus}]}},methods:{setFocus(t){if(!1===this.isFocusable)return!1;t?!0===this.$helper.object.isObject(t)&&(t=`${t.x.toFixed(1)}% ${t.y.toFixed(1)}%`):t=null,this.$emit("input",{focus:t})}}},function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-default-file-preview k-image-file-preview",attrs:{"data-has-focus":t.hasFocus}},[e("k-file-preview-frame",{attrs:{options:t.options}},[e("k-coords-input",{attrs:{disabled:!t.isFocusable,value:t.focus},on:{input:function(e){return t.setFocus(e)}}},[e("img",t._b({on:{dragstart:function(t){t.preventDefault()}}},"img",t.image,!1))])],1),e("k-file-preview-details",{attrs:{details:t.details}},[t.image.src?e("div",{staticClass:"k-image-file-preview-focus"},[e("dt",[t._v(t._s(t.$t("file.focus.title")))]),e("dd",[t.isFocusable?e("k-button",{ref:"focus",attrs:{icon:t.focus?"cancel-small":"preview",title:t.focus?t.$t("file.focus.reset"):void 0,size:"xs",variant:"filled"},on:{click:function(e){t.focus?t.setFocus(void 0):t.setFocus({x:50,y:50})}}},[t.hasFocus?[t._v(t._s(t.focus.x)+"% "+t._s(t.focus.y)+"%")]:[t._v(t._s(t.$t("file.focus.placeholder")))]],2):t.hasFocus?[t._v(" "+t._s(t.focus.x)+"% "+t._s(t.focus.y)+"% ")]:[t._v("–")]],2)]):t._e()])],1)},[]).exports;const hl=ut({props:{details:Array,image:{default:()=>({}),type:Object},url:String},computed:{supported:()=>window.navigator.pdfViewerEnabled}},function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-default-file-preview k-pdf-file-preview",attrs:{"data-supported":t.supported}},[e("object",{staticClass:"k-pdf-file-preview-object",attrs:{data:t.url,type:"application/pdf"}},[e("k-file-preview-frame",[e("a",{attrs:{href:t.url}},[e("k-icon",{staticClass:"k-item-icon",attrs:{color:t.$helper.color(t.image.color),type:t.image.icon}})],1)])],1),e("k-file-preview-details",{attrs:{details:t.details}})],1)},[]).exports;const ml=ut({props:{details:Array,url:String},computed:{options(){return[{icon:"download",text:this.$t("download"),link:this.url,download:!0}]}}},function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-video-file-preview"},[e("k-file-preview-frame",{attrs:{options:t.options}},[e("video",{attrs:{controls:"",preload:"metadata",src:t.url}})]),e("k-file-preview-details",{attrs:{details:t.details}})],1)},[]).exports,fl={install(t){t.component("k-file-view",rl),t.component("k-file-preview",al),t.component("k-file-preview-details",ll),t.component("k-file-preview-frame",cl),t.component("k-default-file-preview",ul),t.component("k-audio-file-preview",pl),t.component("k-image-file-preview",dl),t.component("k-pdf-file-preview",hl),t.component("k-video-file-preview",ml)}};const gl=ut({props:{isInstallable:Boolean,isInstalled:Boolean,isOk:Boolean,requirements:Object,translations:Array},data(){return{user:{name:"",email:"",language:this.$panel.translation.code,password:"",role:"admin"}}},computed:{fields(){return{email:{label:this.$t("email"),type:"email",link:!1,autofocus:!0,required:!0},password:{label:this.$t("password"),type:"password",placeholder:this.$t("password")+" …",required:!0},language:{label:this.$t("language"),type:"select",options:this.translations,icon:"translate",empty:!1,required:!0}}},isReady(){return this.isOk&&this.isInstallable},isComplete(){return this.isOk&&this.isInstalled}},methods:{async install(){try{await this.$api.system.install(this.user),await this.$reload({globals:["$system","$translation"]}),this.$panel.notification.success({message:this.$t("welcome")+"!",icon:"smile"})}catch(t){this.$panel.error(t)}}}},function(){var t=this,e=t._self._c;return e("k-panel-outside",{staticClass:"k-installation-view"},[e("div",{staticClass:"k-dialog k-installation-dialog"},[e("k-dialog-body",[t.isComplete?e("k-text",[e("k-headline",[t._v(t._s(t.$t("installation.completed")))]),e("k-link",{attrs:{to:"/login"}},[t._v(" "+t._s(t.$t("login"))+" ")])],1):t.isReady?e("form",{on:{submit:function(e){return e.preventDefault(),t.install.apply(null,arguments)}}},[e("h1",{staticClass:"sr-only"},[t._v(" "+t._s(t.$t("installation"))+" ")]),e("k-fieldset",{attrs:{fields:t.fields,value:t.user},on:{input:function(e){t.user=e}}}),e("k-button",{attrs:{text:t.$t("install"),icon:"check",size:"lg",theme:"positive",type:"submit",variant:"filled"}})],1):e("div",[e("k-headline",[t._v(" "+t._s(t.$t("installation.issues.headline"))+" ")]),e("ul",{staticClass:"k-installation-issues",attrs:{"data-theme":"negative"}},[!1===t.isInstallable?e("li",[e("k-icon",{attrs:{type:"alert"}}),e("span",{domProps:{innerHTML:t._s(t.$t("installation.disabled"))}})],1):t._e(),!1===t.requirements.php?e("li",[e("k-icon",{attrs:{type:"alert"}}),e("span",{domProps:{innerHTML:t._s(t.$t("installation.issues.php"))}})],1):t._e(),!1===t.requirements.server?e("li",[e("k-icon",{attrs:{type:"alert"}}),e("span",{domProps:{innerHTML:t._s(t.$t("installation.issues.server"))}})],1):t._e(),!1===t.requirements.mbstring?e("li",[e("k-icon",{attrs:{type:"alert"}}),e("span",{domProps:{innerHTML:t._s(t.$t("installation.issues.mbstring"))}})],1):t._e(),!1===t.requirements.curl?e("li",[e("k-icon",{attrs:{type:"alert"}}),e("span",{domProps:{innerHTML:t._s(t.$t("installation.issues.curl"))}})],1):t._e(),!1===t.requirements.accounts?e("li",[e("k-icon",{attrs:{type:"alert"}}),e("span",{domProps:{innerHTML:t._s(t.$t("installation.issues.accounts"))}})],1):t._e(),!1===t.requirements.content?e("li",[e("k-icon",{attrs:{type:"alert"}}),e("span",{domProps:{innerHTML:t._s(t.$t("installation.issues.content"))}})],1):t._e(),!1===t.requirements.media?e("li",[e("k-icon",{attrs:{type:"alert"}}),e("span",{domProps:{innerHTML:t._s(t.$t("installation.issues.media"))}})],1):t._e(),!1===t.requirements.sessions?e("li",[e("k-icon",{attrs:{type:"alert"}}),e("span",{domProps:{innerHTML:t._s(t.$t("installation.issues.sessions"))}})],1):t._e()]),e("k-button",{attrs:{text:t.$t("retry"),icon:"refresh",size:"lg",theme:"positive",variant:"filled"},on:{click:t.$reload}})],1)],1)],1)])},[]).exports,kl={install(t){t.component("k-installation-view",gl)}};const bl=ut({props:{buttons:Array,languages:{type:Array,default:()=>[]},variables:{type:Boolean,default:!0}},computed:{languagesCollection(){return this.languages.map(t=>({...t,image:{back:"black",color:"gray",icon:"translate"},link:()=>{if(!1===this.variables)return null;this.$go(`languages/${t.id}`)},options:[{icon:"edit",text:this.$t("edit"),disabled:!1===this.variables,click:()=>this.$go(`languages/${t.id}`)},{icon:"cog",text:this.$t("settings"),disabled:!this.$panel.permissions.languages.update,click:()=>this.$dialog(`languages/${t.id}/update`)},{when:t.deletable,icon:"trash",text:this.$t("delete"),disabled:!this.$panel.permissions.languages.delete,click:()=>this.$dialog(`languages/${t.id}/delete`)}]}))},primaryLanguage(){return this.languagesCollection.filter(t=>t.default)},secondaryLanguages(){return this.languagesCollection.filter(t=>!1===t.default)}}},function(){var t=this,e=t._self._c;return e("k-panel-inside",{staticClass:"k-languages-view"},[e("k-header",{scopedSlots:t._u([{key:"buttons",fn:function(){return[e("k-view-buttons",{attrs:{buttons:t.buttons}})]},proxy:!0}])},[t._v(" "+t._s(t.$t("view.languages"))+" ")]),t.languages.length>0?[e("k-section",{attrs:{headline:t.$t("languages.default")}},[e("k-collection",{attrs:{items:t.primaryLanguage}})],1),e("k-section",{attrs:{headline:t.$t("languages.secondary")}},[t.secondaryLanguages.length?e("k-collection",{attrs:{items:t.secondaryLanguages}}):e("k-empty",{attrs:{icon:"translate",disabled:!t.$panel.permissions.languages.create},on:{click:function(e){return t.$dialog("languages/create")}}},[t._v(" "+t._s(t.$t("languages.secondary.empty"))+" ")])],1)]:0===t.languages.length?[e("k-empty",{attrs:{icon:"translate",disabled:!t.$panel.permissions.languages.create},on:{click:function(e){return t.$dialog("languages/create")}}},[t._v(" "+t._s(t.$t("languages.empty"))+" ")])]:t._e()],2)},[]).exports;const yl=ut({props:{buttons:Array,code:String,deletable:Boolean,direction:String,id:String,info:Array,next:Object,name:String,prev:Object,translations:Array,url:String},computed:{canUpdate(){return this.$panel.permissions.languages.update}},methods:{createTranslation(){this.canUpdate&&this.$dialog(`languages/${this.id}/translations/create`)},option(t,e){this.canUpdate&&this.$dialog(`languages/${this.id}/translations/${window.btoa(encodeURIComponent(e.key))}/${t}`)},updateTranslation({row:t}){this.canUpdate&&this.$dialog(`languages/${this.id}/translations/${window.btoa(encodeURIComponent(t.key))}/update`)}}},function(){var t=this,e=t._self._c;return e("k-panel-inside",{staticClass:"k-language-view",scopedSlots:t._u([{key:"topbar",fn:function(){return[e("k-prev-next",{attrs:{prev:t.prev,next:t.next}})]},proxy:!0}])},[e("k-header",{attrs:{editable:t.canUpdate},on:{edit:function(e){return t.$dialog(`languages/${t.id}/update`)}},scopedSlots:t._u([{key:"buttons",fn:function(){return[e("k-view-buttons",{attrs:{buttons:t.buttons}})]},proxy:!0}])},[t._v(" "+t._s(t.name)+" ")]),e("k-section",{attrs:{headline:t.$t("language.settings")}},[e("k-stats",{attrs:{reports:t.info,size:"small"}})],1),e("k-section",{attrs:{buttons:[{click:t.createTranslation,disabled:!t.canUpdate,icon:"add",text:t.$t("add")}],headline:t.$t("language.variables")}},[t.translations.length?[e("k-table",{attrs:{columns:{key:{label:t.$t("language.variable.key"),mobile:!0,width:"1/4"},value:{label:t.$t("language.variable.value"),mobile:!0}},disabled:!t.canUpdate,rows:t.translations},on:{cell:t.updateTranslation,option:t.option}})]:[e("k-empty",{attrs:{disabled:!t.canUpdate,icon:"translate"},on:{click:t.createTranslation}},[t._v(" "+t._s(t.$t("language.variables.empty"))+" ")])]],2)],1)},[]).exports,vl={install(t){t.component("k-languages-view",bl),t.component("k-language-view",yl)}};const $l=ut({emits:["click"]},function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-notification k-login-alert",attrs:{"data-theme":"error"}},[e("p",[t._t("default")],2),e("k-button",{attrs:{icon:"cancel"},on:{click:function(e){return t.$emit("click")}}})],1)},[]).exports,wl={props:{methods:{type:Array,default:()=>[]},pending:{type:Object,default:()=>({challenge:"email"})},value:String}};const xl=ut({mixins:[wl],emits:["error"],data(){return{code:this.value??"",isLoading:!1}},computed:{mode(){return this.methods.includes("password-reset")?"password-reset":"login"},submitText(){const t=this.isLoading?" …":"";return"password-reset"===this.mode?this.$t("login.reset")+t:this.$t("login")+t}},methods:{async login(){this.$emit("error",null),this.isLoading=!0;try{await this.$api.auth.verifyCode(this.code),this.$panel.notification.success({message:this.$t("welcome")+"!",icon:"smile"}),"password-reset"===this.mode?this.$go("reset-password"):this.$reload()}catch(t){this.$emit("error",t)}finally{this.isLoading=!1}}}},function(){var t=this,e=t._self._c;return e("form",{staticClass:"k-login-form k-login-code-form",on:{submit:function(e){return e.preventDefault(),t.login.apply(null,arguments)}}},[t.pending.email?e("k-user-info",{attrs:{user:t.pending.email}}):t._e(),e("k-text-field",{attrs:{autofocus:!0,counter:!1,help:t.$t("login.code.text."+t.pending.challenge),label:t.$t("login.code.label."+t.mode),placeholder:t.$t("login.code.placeholder."+t.pending.challenge),required:!0,value:t.code,autocomplete:"one-time-code",icon:"unlock",name:"code"},on:{input:function(e){t.code=e}}}),e("footer",{staticClass:"k-login-buttons"},[e("k-button",{staticClass:"k-login-button k-login-back-button",attrs:{text:t.$t("back"),icon:"angle-left",link:"/logout",size:"lg",variant:"filled"}}),e("k-button",{staticClass:"k-login-button",attrs:{text:t.submitText,icon:"check",size:"lg",type:"submit",theme:"positive",variant:"filled"}})],1)],1)},[]).exports,_l={props:{methods:{type:Array,default:()=>[]},value:{type:Object,default:()=>({})}}};const Sl=ut({mixins:[_l],emits:["error"],data(){return{mode:null,isLoading:!1,user:{email:"",password:"",remember:!1,...this.value}}},computed:{alternateMode(){return"email-password"===this.form?"email":"email-password"},canToggle(){return null!==this.codeMode&&(!1!==this.methods.includes("password")&&(!0===this.methods.includes("password-reset")||!0===this.methods.includes("code")))},codeMode(){return!0===this.methods.includes("password-reset")?"password-reset":!0===this.methods.includes("code")?"code":null},fields(){const t={email:{autofocus:!0,label:this.$t("email"),type:"email",required:!0,link:!1}};return"email-password"===this.form&&(t.password={label:this.$t("password"),type:"password",minLength:8,required:!0,autocomplete:"current-password",counter:!1}),t},form(){return this.mode?this.mode:"password"===this.methods[0]?"email-password":"email"},isResetForm(){return"password-reset"===this.codeMode&&"email"===this.form},submitText(){const t=this.isLoading?" …":"";return this.isResetForm?this.$t("login.reset")+t:this.$t("login")+t},toggleText(){return this.$t("login.toggleText."+this.codeMode+"."+this.alternateMode)}},methods:{async login(){this.$emit("error",null),this.isLoading=!0;const t={...this.user};"email"===this.mode&&(t.password=null),!0===this.isResetForm&&(t.remember=!1);try{await this.$api.auth.login(t),this.$reload({globals:["$system","$translation"]}),this.$panel.notification.success({message:this.$t("welcome")+"!",icon:"smile"})}catch(e){this.$emit("error",e)}finally{this.isLoading=!1}},toggle(){this.mode=this.alternateMode,this.$refs.fieldset.focus("email")}}},function(){var t=this,e=t._self._c;return e("form",{staticClass:"k-login-form",on:{submit:function(e){return e.preventDefault(),t.login.apply(null,arguments)}}},[e("div",{staticClass:"k-login-fields"},[!0===t.canToggle?e("button",{staticClass:"k-login-toggler",attrs:{type:"button"},on:{click:t.toggle}},[t._v(" "+t._s(t.toggleText)+" ")]):t._e(),e("k-fieldset",{ref:"fieldset",attrs:{fields:t.fields,value:t.user},on:{input:function(e){t.user=e}}})],1),e("footer",{staticClass:"k-login-buttons"},[!1===t.isResetForm?e("k-checkbox-input",{attrs:{label:t.$t("login.remember"),checked:t.user.remember,value:t.user.remember},on:{input:function(e){t.user.remember=e}}}):t._e(),e("k-button",{staticClass:"k-login-button",attrs:{icon:"check",size:"lg",theme:"positive",type:"submit",variant:"filled"}},[t._v(" "+t._s(t.submitText)+" ")])],1)])},[]).exports;const Cl=ut({components:{"k-login-plugin-form":window.panel.plugins.login},mixins:[wl,_l],props:{value:{type:Object,default:()=>({code:"",email:"",password:""})}},data:()=>({issue:""}),computed:{component:()=>window.panel.plugins.login?"k-login-plugin-form":"k-login-form",form(){return this.pending.email?"code":"login"}},methods:{async onError(t){null!==t?(!0===t.details.challengeDestroyed&&await this.$reload({globals:["$system"]}),this.issue=t.message):this.issue=null}}},function(){var t=this,e=t._self._c;return e("k-panel-outside",{class:"code"===t.form?"k-login-code-view":"k-login-view"},[e("div",{staticClass:"k-dialog k-login k-login-dialog"},[e("h1",{staticClass:"sr-only"},[t._v(" "+t._s(t.$t("login"))+" ")]),t.issue?e("k-login-alert",{nativeOn:{click:function(e){t.issue=null}}},[t._v(" "+t._s(t.issue)+" ")]):t._e(),e("k-dialog-body",["code"===t.form?e("k-login-code-form",t._b({on:{error:t.onError}},"k-login-code-form",{methods:t.methods,pending:t.pending,value:t.value.code},!1)):e(t.component,t._b({tag:"component",on:{error:t.onError}},"component",{methods:t.methods,value:t.value},!1))],1)],1)])},[]).exports,Ol={install(t){t.component("k-login-alert",$l),t.component("k-login-code-form",xl),t.component("k-login-form",Sl),t.component("k-login-view",Cl),t.component("k-login",Sl),t.component("k-login-code",xl)}};const Al=ut({extends:ol,props:{title:String}},function(){var t=this,e=t._self._c;return e("k-panel-inside",{staticClass:"k-page-view",attrs:{"data-id":t.id,"data-locked":t.isLocked,"data-template":t.blueprint},scopedSlots:t._u([{key:"topbar",fn:function(){return[e("k-prev-next",{attrs:{prev:t.prev,next:t.next}})]},proxy:!0}])},[e("k-header",{staticClass:"k-page-view-header",attrs:{editable:t.permissions.changeTitle&&!t.isLocked},on:{edit:function(e){return t.$dialog(t.api+"/changeTitle")}},scopedSlots:t._u([{key:"buttons",fn:function(){return[e("k-view-buttons",{attrs:{buttons:t.buttons}}),e("k-form-controls",{attrs:{editor:t.editor,"has-diff":t.hasDiff,"is-locked":t.isLocked,"is-processing":t.isSaving,modified:t.modified,preview:!!t.permissions.preview&&t.api+"/preview/changes"},on:{discard:t.onDiscard,submit:t.onSubmit}})]},proxy:!0}])},[t._v(" "+t._s(t.title)+" ")]),e("k-model-tabs",{attrs:{diff:t.diff,tab:t.tab.name,tabs:t.tabs}}),e("k-sections",{attrs:{blueprint:t.blueprint,content:t.content,empty:t.$t("page.blueprint",{blueprint:t.$esc(t.blueprint)}),lock:t.lock,parent:t.api,tab:t.tab},on:{input:t.onInput,submit:t.onSubmit}})],1)},[]).exports;const Ml=ut({extends:ol,props:{title:String}},function(){var t=this,e=t._self._c;return e("k-panel-inside",{staticClass:"k-site-view",attrs:{"data-id":t.id,"data-locked":t.isLocked,"data-template":t.blueprint}},[e("k-header",{staticClass:"k-site-view-header",attrs:{editable:t.permissions.changeTitle&&!t.isLocked},on:{edit:function(e){return t.$dialog(t.api+"/changeTitle")}},scopedSlots:t._u([{key:"buttons",fn:function(){return[e("k-view-buttons",{attrs:{buttons:t.buttons}}),e("k-form-controls",{attrs:{editor:t.editor,"has-diff":t.hasDiff,"is-locked":t.isLocked,"is-processing":t.isSaving,modified:t.modified,preview:!!t.permissions.preview&&t.api+"/preview/changes"},on:{discard:t.onDiscard,submit:t.onSubmit}})]},proxy:!0}])},[t._v(" "+t._s(t.title)+" ")]),e("k-model-tabs",{attrs:{diff:t.diff,tab:t.tab.name,tabs:t.tabs}}),e("k-sections",{attrs:{blueprint:t.blueprint,content:t.content,empty:t.$t("site.blueprint"),lock:t.lock,tab:t.tab,parent:"site"},on:{input:t.onInput,submit:t.onSubmit}})],1)},[]).exports,Dl={install(t){t.component("k-page-view",Al),t.component("k-site-view",Ml)}};const El=ut({mixins:[He],props:{label:String,src:String,versionId:String},emits:["discard","submit"],computed:{srcWithPreviewParam(){const t=new URL(this.src,this.$panel.urls.site);return t.searchParams.append("_preview",!0),t.toString()}},mounted(){this.$events.on("content.discard",this.reload),this.$events.on("content.publish",this.reload)},destroyed(){this.$events.off("content.discard",this.reload),this.$events.off("content.publish",this.reload)},methods:{reload(){this.$refs.browser.contentWindow.location.reload()}}},function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-preview-browser"},[e("header",{staticClass:"k-preview-browser-header"},[e("k-headline",[e("k-icon",{attrs:{type:"git-branch"}}),t._v(" "+t._s(t.label)+" ")],1),e("k-button-group",["changes"===t.versionId?[!1===t.hasDiff?e("p",{staticClass:"k-preview-browser-message"},[t._v(" "+t._s(t.$t("lock.unsaved.empty"))+" ")]):e("k-form-controls",{attrs:{editor:t.editor,"has-diff":t.hasDiff,"is-locked":t.isLocked,"is-processing":t.isSaving,modified:t.modified,size:"xs"},on:{discard:function(e){return t.$emit("discard",e)},submit:function(e){return t.$emit("submit",e)}}})]:t._e(),e("k-button",{attrs:{link:t.src,icon:"open",size:"xs",target:"_blank"}})],2)],1),e("iframe",{ref:"browser",attrs:{src:t.srcWithPreviewParam}})])},[]).exports;const jl=ut({extends:ol,props:{back:String,versionId:String,src:Object,title:String},mounted(){this.$events.on("keydown.esc",this.exit)},destroyed(){this.$events.off("keydown.esc",this.exit)},methods:{browserProps(t){return{editor:this.editor,hasDiff:this.hasDiff,isLocked:this.isLocked,modified:this.modified,label:this.$t("version."+t),src:this.src[t],versionId:t}},exit(){this.$panel.overlays().length>0||this.$panel.view.open(this.link)},navigate(t){if(t.id===this.id)return;if(this.$refs.tree.close(),"/"===t.id)return this.$panel.view.open("site/preview/"+this.versionId);const e=this.$api.pages.url(t.id,"preview/"+this.versionId);this.$panel.view.open(e)}}},function(){var t=this,e=t._self._c;return e("k-panel",{staticClass:"k-panel-inside k-preview-view",attrs:{"data-version-id":t.versionId}},[e("header",{staticClass:"k-preview-view-header"},[e("k-button-group",[e("k-button",{attrs:{link:t.back,responsive:!0,title:t.$t("back"),icon:"angle-left",size:"sm",variant:"filled"}}),e("k-button",{staticClass:"k-preview-view-title",attrs:{icon:t.$panel.isLoading?"loader":"title",dropdown:!0},on:{click:function(e){return t.$refs.tree.toggle()}}},[t._v(" "+t._s(t.title)+" ")]),e("k-dropdown-content",{ref:"tree",staticClass:"k-preview-view-tree",attrs:{theme:"dark"}},[e("k-page-tree",{attrs:{current:t.id},on:{select:t.navigate},nativeOn:{click:function(t){t.stopPropagation()}}})],1)],1),e("k-button-group",[e("k-view-buttons",{attrs:{buttons:t.buttons}})],1)],1),e("main",{staticClass:"k-preview-view-grid"},["compare"===t.versionId?[e("k-preview-browser",t._b({on:{discard:t.onDiscard,submit:t.onSubmit}},"k-preview-browser",t.browserProps("latest"),!1)),e("k-preview-browser",t._b({on:{discard:t.onDiscard,submit:t.onSubmit}},"k-preview-browser",t.browserProps("changes"),!1))]:[e("k-preview-browser",t._b({on:{discard:t.onDiscard,submit:t.onSubmit}},"k-preview-browser",t.browserProps(t.versionId),!1))]],2)])},[]).exports,Il={install(t){t.component("k-preview-browser",El),t.component("k-preview-view",jl)}};const Bl=ut({extends:ol,props:{avatar:String,canChangeEmail:Boolean,canChangeLanguage:Boolean,canChangeName:Boolean,canChangeRole:Boolean,email:String,language:String,name:String,role:String}},function(){var t=this,e=t._self._c;return e("k-panel-inside",{staticClass:"k-user-view",attrs:{"data-id":t.id,"data-locked":t.isLocked,"data-template":t.blueprint},scopedSlots:t._u([{key:"topbar",fn:function(){return[e("k-prev-next",{attrs:{prev:t.prev,next:t.next}})]},proxy:!0}])},[e("k-header",{staticClass:"k-user-view-header",attrs:{editable:t.canChangeName},on:{edit:function(e){return t.$dialog(t.api+"/changeName")}},scopedSlots:t._u([{key:"buttons",fn:function(){return[e("k-view-buttons",{attrs:{buttons:t.buttons}}),e("k-form-controls",{attrs:{editor:t.editor,"has-diff":t.hasDiff,"is-locked":t.isLocked,"is-processing":t.isSaving,modified:t.modified},on:{discard:t.onDiscard,submit:t.onSubmit}})]},proxy:!0}])},[t.name&&0!==t.name.length?[t._v(" "+t._s(t.name)+" ")]:e("span",{staticClass:"k-user-name-placeholder"},[t._v(" "+t._s(t.$t("name"))+" … ")])],2),e("k-user-profile",{attrs:{id:t.id,api:t.api,avatar:t.avatar,email:t.email,"can-change-email":t.canChangeEmail,"can-change-language":t.canChangeLanguage,"can-change-name":t.canChangeName,"can-change-role":t.canChangeRole,"is-locked":t.isLocked,language:t.language,role:t.role}}),e("k-model-tabs",{attrs:{diff:t.diff,tab:t.tab.name,tabs:t.tabs}}),e("k-sections",{attrs:{blueprint:t.blueprint,content:t.content,empty:t.$t("user.blueprint",{blueprint:t.$esc(t.blueprint)}),lock:t.lock,parent:t.api,tab:t.tab},on:{input:t.onInput,submit:t.onSubmit}})],1)},[]).exports;const Ll=ut({extends:Bl,prevnext:!1},null,null).exports;const Tl=ut({props:{requirePassword:{type:Boolean,default:!1}},data:()=>({isLoading:!1,values:{currentPassword:null,password:null,passwordConfirmation:null}}),computed:{fields(){let t={};return!0===this.requirePassword&&(t={currentPassword:{autofocus:!0,label:this.$t("user.changePassword.current"),icon:"key",type:"password",width:"1/2"},gap:{type:"gap",width:"1/2"}}),{...t,password:{autofocus:!1===this.requirePassword,label:this.$t("user.changePassword.new"),icon:"key",type:"password",width:"1/2"},passwordConfirmation:{label:this.$t("user.changePassword.new.confirm"),icon:"key",type:"password",width:"1/2"}}}},mounted(){this.$panel.title=this.$t("view.resetPassword")},methods:{async submit(){if(!this.values.password||this.values.password.length<8)return this.$panel.notification.error(this.$t("error.user.password.invalid"));if(this.values.password!==this.values.passwordConfirmation)return this.$panel.notification.error(this.$t("error.user.password.notSame"));this.isLoading=!0;try{await this.$api.users.changePassword(this.$panel.user.id,this.values.password,this.values.currentPassword),this.$panel.notification.success(),this.$go("/")}catch(t){this.$panel.notification.error(t)}finally{this.isLoading=!1}}}},function(){var t=this,e=t._self._c;return e("k-panel-inside",{staticClass:"k-password-reset-view"},[e("form",{on:{submit:function(e){return e.preventDefault(),t.submit.apply(null,arguments)}}},[e("k-header",{scopedSlots:t._u([{key:"buttons",fn:function(){return[e("k-button",{attrs:{icon:"check",theme:"notice",type:"submit",variant:"filled",size:"sm"}},[t._v(" "+t._s(t.$t("change"))+" "),t.isLoading?[t._v(" … ")]:t._e()],2)]},proxy:!0}])},[t._v(" "+t._s(t.$t("view.resetPassword"))+" ")]),e("k-user-info",{attrs:{user:t.$panel.user}}),e("k-fieldset",{attrs:{fields:t.fields,value:t.values}})],1)])},[]).exports;const Pl=ut({props:{api:String,avatar:String,id:String,isLocked:Boolean},methods:{open(){this.avatar?this.$refs.dropdown.toggle():this.upload()},async remove(){await this.$api.users.deleteAvatar(this.id),this.$panel.notification.success(),this.$reload()},upload(){this.$panel.upload.pick({url:this.$panel.urls.api+"/"+this.api+"/avatar",accept:"image/*",immediate:!0,multiple:!1,on:{done:()=>{this.$panel.view.reload()}}})}}},function(){var t=this,e=t._self._c;return e("k-button",{staticClass:"k-user-view-image",attrs:{disabled:t.isLocked,title:t.$t("avatar")},on:{click:t.open}},[t.avatar?[e("k-image-frame",{attrs:{cover:!0,src:t.avatar}}),e("k-dropdown-content",{ref:"dropdown",attrs:{options:[{icon:"upload",text:t.$t("change"),click:t.upload},{icon:"trash",text:t.$t("delete"),click:t.remove}]}})]:e("k-icon-frame",{attrs:{icon:"user"}})],2)},[]).exports;const ql=ut({props:{user:[Object,String]}},function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-user-info"},[t.user.avatar?e("k-image-frame",{attrs:{cover:!0,src:t.user.avatar.url,ratio:"1/1"}}):e("k-icon-frame",{attrs:{color:"white",back:"black",icon:"user"}}),t._v(" "+t._s(t.user.name??t.user.email??t.user)+" ")],1)},[]).exports;const Nl=ut({props:{api:String,avatar:String,canChangeEmail:Boolean,canChangeLanguage:Boolean,canChangeRole:Boolean,email:String,id:String,isLocked:Boolean,language:String,role:String}},function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-user-profile"},[e("k-user-avatar",{attrs:{id:t.id,api:t.api,avatar:t.avatar,"is-locked":t.isLocked}}),e("k-button-group",{attrs:{buttons:[{icon:"email",text:t.email,title:`${t.$t("email")}: ${t.email}`,disabled:!t.canChangeEmail,click:()=>t.$dialog(t.api+"/changeEmail")},{icon:"bolt",text:t.role,title:`${t.$t("role")}: ${t.role}`,disabled:!t.canChangeRole,click:()=>t.$dialog(t.api+"/changeRole")},{icon:"translate",text:t.language,title:`${t.$t("language")}: ${t.language}`,disabled:!t.canChangeLanguage,click:()=>t.$dialog(t.api+"/changeLanguage")}]}})],1)},[]).exports;const Fl=ut({props:{buttons:Array,role:Object,roles:Array,search:String,title:String,users:Object},computed:{empty(){return{icon:"users",text:this.$t("role.empty")}},items(){return this.users.data.map(t=>(t.options=this.$dropdown(t.link),t))},tabs(){const t=[{name:"all",label:this.$t("role.all"),link:"/users"}];for(const e of this.roles)t.push({name:e.id,label:e.title,link:"/users?role="+e.id});return t}},methods:{create(){var t;this.$dialog("users/create",{query:{role:null==(t=this.role)?void 0:t.id}})},paginate(t){this.$reload({query:{page:t.page}})}}},function(){var t,e=this,s=e._self._c;return s("k-panel-inside",{staticClass:"k-users-view"},[s("k-header",{staticClass:"k-users-view-header",scopedSlots:e._u([{key:"buttons",fn:function(){return[s("k-view-buttons",{attrs:{buttons:e.buttons}})]},proxy:!0}])},[e._v(" "+e._s(e.$t("view.users"))+" ")]),s("k-tabs",{attrs:{tab:(null==(t=e.role)?void 0:t.id)??"all",tabs:e.tabs}}),s("k-collection",{attrs:{empty:e.empty,items:e.items,pagination:e.users.pagination},on:{paginate:e.paginate}})],1)},[]).exports,zl={install(t){t.component("k-account-view",Ll),t.component("k-reset-password-view",Tl),t.component("k-user-avatar",Pl),t.component("k-user-info",ql),t.component("k-user-profile",Nl),t.component("k-user-view",Bl),t.component("k-users-view",Fl)}};const Yl=ut({props:{plugins:Array}},function(){var t=this,e=t._self._c;return t.plugins.length?e("k-section",{attrs:{headline:t.$t("plugins"),link:"https://getkirby.com/plugins"}},[e("k-table",{attrs:{index:!1,columns:{name:{label:t.$t("name"),type:"url",mobile:!0},author:{label:t.$t("author")},license:{label:t.$t("license"),type:"license"},status:{label:t.$t("license.status"),type:"license-status"},version:{label:t.$t("version"),type:"update-status",mobile:!0,width:"10rem"}},rows:t.plugins}})],1):t._e()},[]).exports,Rl={props:{exceptions:{type:Array,default:()=>[]},security:{type:Array,default:()=>[]},urls:{type:[Object,Array],default:()=>({})}},data(){return{issues:this.$helper.object.clone(this.security)}},async mounted(){console.info("Running system health checks for the Panel system view; failed requests in the following console output are expected behavior.");const t=(Promise.allSettled??Promise.all).bind(Promise),e=Object.entries(this.urls??{}).map(this.check);await t(e),console.info(`System health checks ended. ${this.issues.length-this.security.length} issues with accessible files/folders found (see the security list in the system view).`)},methods:{async check([t,e]){if(!e)return;const{status:s}=await fetch(e,{cache:"no-store"});s<400&&this.issues.push({id:t,text:this.$t("system.issues."+t),link:"https://getkirby.com/security/"+t,icon:"folder"})},retry(){this.$go(window.location.href)}}};const Hl=ut({components:{Plugins:Yl,Security:ut(Rl,function(){var t=this,e=t._self._c;return t.issues.length?e("k-section",{attrs:{headline:t.$t("security"),buttons:[{title:t.$t("retry"),icon:"refresh",click:t.retry}]}},[e("k-items",{attrs:{items:t.issues.map(t=>({theme:"negative",image:{back:"light-dark(var(--theme-color-200), var(--theme-color-900))",icon:t.icon??"alert",color:"var(--theme-color-icon)"},target:"_blank",...t}))}})],1):t._e()},[]).exports},props:{buttons:Array,environment:Array,exceptions:Array,info:Object,plugins:Array,security:Array,urls:[Object,Array]},mounted(){this.exceptions.length>0&&(console.info("The following errors occurred during the update check of Kirby and/or plugins:"),this.exceptions.map(t=>console.warn(t)),console.info("End of errors from the update check."))},methods:{copy(){const t=JSON.stringify({info:this.info,security:this.security.map(t=>t.text),plugins:this.plugins.map(t=>({name:t.name.text,version:t.version.currentVersion}))},null,2);this.$helper.clipboard.write(t),this.$panel.notification.success({message:this.$t("system.info.copied")})}}},function(){var t=this,e=t._self._c;return e("k-panel-inside",{staticClass:"k-system-view"},[e("k-header",{scopedSlots:t._u([{key:"buttons",fn:function(){return[e("k-view-buttons",{attrs:{buttons:t.buttons}})]},proxy:!0}])},[t._v(" "+t._s(t.$t("view.system"))+" ")]),e("k-section",{attrs:{headline:t.$t("environment"),buttons:[{text:t.$t("system.info.copy"),icon:"copy",responsive:!0,click:t.copy}]}},[e("k-stats",{staticClass:"k-system-info",attrs:{reports:t.environment,size:"medium"}})],1),e("security",{attrs:{security:t.security,urls:t.urls}}),e("plugins",{attrs:{plugins:t.plugins}})],1)},[]).exports;const Ul=ut({inheritAttrs:!1,props:{value:Object}},function(){var t=this,e=t._self._c;return t.value.link?e("k-url-field-preview",{attrs:{value:{href:t.value.link,text:t.value.name}}}):e("k-text-field-preview",{attrs:{value:t.value.name}})},[]).exports;const Vl=ut({inheritAttrs:!1,props:{value:Object},computed:{element(){return this.value.dialog||this.value.drawer||this.value.link?null:"span"}}},function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-table-license-status-cell"},[e("k-button",{attrs:{dialog:t.value.dialog,drawer:t.value.drawer,element:t.element,icon:t.value.icon,link:t.value.link,theme:t.value.theme,size:"xs",target:"_blank"}},[t._v(" "+t._s(t.value.label)+" ")])],1)},[]).exports;const Kl=ut({props:{value:[String,Object]}},function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-table-update-status-cell"},["string"==typeof t.value?e("span",{staticClass:"k-table-update-status-cell-version"},[t._v(" "+t._s(t.value)+" ")]):[e("k-button",{staticClass:"k-table-update-status-cell-button",attrs:{dropdown:!0,icon:t.value.icon,href:t.value.url,text:t.value.currentVersion,theme:t.value.theme,size:"xs",variant:"filled"},on:{click:function(e){return e.stopPropagation(),t.$refs.dropdown.toggle()}}}),e("k-dropdown-content",{ref:"dropdown",attrs:{"align-x":"end"}},[e("dl",{staticClass:"k-plugin-info"},[e("dt",[t._v(t._s(t.$t("plugin")))]),e("dd",[t._v(t._s(t.value.pluginName))]),e("dt",[t._v(t._s(t.$t("version.current")))]),e("dd",[t._v(t._s(t.value.currentVersion))]),e("dt",[t._v(t._s(t.$t("version.latest")))]),e("dd",[t._v(t._s(t.value.latestVersion))]),e("dt",[t._v(t._s(t.$t("system.updateStatus")))]),e("dd",{attrs:{"data-theme":t.value.theme}},[t._v(t._s(t.value.label))])]),t.value.url?[e("hr"),e("k-button",{attrs:{icon:"open",link:t.value.url}},[t._v(" "+t._s(t.$t("versionInformation"))+" ")])]:t._e()],2)]],2)},[]).exports,Wl={install(t){t.component("k-system-view",Hl),t.component("k-table-license-cell",Ul),t.component("k-table-license-status-cell",Vl),t.component("k-table-update-status-cell",Kl)}},Jl={install(t){t.component("k-error-view",il),t.component("k-search-view",nl),t.use(fl),t.use(kl),t.use(vl),t.use(Ol),t.use(Dl),t.use(Il),t.use(Wl),t.use(zl)}},Gl={install(t){t.use(bt),t.use(ae),t.use(Ce),t.use(Pe),t.use(wr),t.use(Ar),t.use(Jr),t.use(oa),t.use(wa),t.use(ja),t.use(Pa),t.use(Ya),t.use(sl),t.use(Jl),t.use(F)}},Xl={install(t){window.onunhandledrejection=t=>{t.preventDefault(),window.panel.error(t.reason)},t.config.errorHandler=window.panel.error.bind(window.panel)}},Zl=(t={})=>{var e=t.desc?-1:1,s=-e,i=/^0/,n=/\s+/g,o=/^\s+|\s+$/g,r=/[^\x00-\x80]/,a=/^0x[0-9a-f]+$/i,l=/(0x[\da-fA-F]+|(^[\+\-]?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?(?=\D|\s|$))|\d+)/g,c=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,u=t.insensitive?function(t){return function(t){if(t.toLocaleLowerCase)return t.toLocaleLowerCase();return t.toLowerCase()}(""+t).replace(o,"")}:function(t){return(""+t).replace(o,"")};function p(t){return t.replace(l,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0")}function d(t,e){return(!t.match(i)||1===e)&&parseFloat(t)||t.replace(n," ").replace(o,"")||0}return function(t,i){var n=u(t),o=u(i);if(!n&&!o)return 0;if(!n&&o)return s;if(n&&!o)return e;var l=p(n),h=p(o),m=parseInt(n.match(a),16)||1!==l.length&&Date.parse(n),f=parseInt(o.match(a),16)||m&&o.match(c)&&Date.parse(o)||null;if(f){if(m<f)return s;if(m>f)return e}for(var g=l.length,k=h.length,b=0,y=Math.max(g,k);b<y;b++){var v=d(l[b]||"",g),$=d(h[b]||"",k);if(isNaN(v)!==isNaN($))return isNaN(v)?e:s;if(r.test(v+$)&&v.localeCompare){var w=v.localeCompare($);if(w>0)return e;if(w<0)return s;if(b===y-1)return 0}else{if(v<$)return s;if(v>$)return e}}return 0}};RegExp.escape=function(t){return t.replace(new RegExp("[-/\\\\^$*+?.()[\\]{}]","gu"),"\\$&")};function Ql(t){return Array.isArray(t)?t:[t]}const tc={fromObject:function(t){return Array.isArray(t)?t:Object.values(t??{})},search:(t,e,s={})=>{if((e??"").length<=(s.min??0))return t;const i=new RegExp(RegExp.escape(e),"ig"),n=s.field??"text",o=t.filter(t=>!!t[n]&&null!==t[n].match(i));return s.limit?o.slice(0,s.limit):o},sortBy:function(t,e){const s=e.split(" "),i=s[0],n=s[1]??"asc",o=Zl({desc:"desc"===n,insensitive:!0});return t.sort((t,e)=>{const s=String(t[i]??""),n=String(e[i]??"");return o(s,n)})},split:function(t,e){return t.reduce((t,s)=>(s===e?t.push([]):t[t.length-1].push(s),t),[[]])},wrap:Ql};const ec={read:function(t,e=!1){if(!t)return null;if("string"==typeof t)return t;if(t instanceof ClipboardEvent){if(t.preventDefault(),!0===e)return t.clipboardData.getData("text/plain");const s=t.clipboardData.getData("text/html")||t.clipboardData.getData("text/plain")||null;if(s)return s.replace(/\u00a0/g," ")}return null},write:function(t,e){if("string"!=typeof t&&(t=JSON.stringify(t,null,2)),e&&e instanceof ClipboardEvent)return e.preventDefault(),e.clipboardData.setData("text/plain",t),!0;const s=document.createElement("textarea");if(s.value=t,document.body.append(s),navigator.userAgent.match(/ipad|ipod|iphone/i)){s.contentEditable=!0,s.readOnly=!0;const t=document.createRange();t.selectNodeContents(s);const e=window.getSelection();e.removeAllRanges(),e.addRange(t),s.setSelectionRange(0,999999)}else s.select();return document.execCommand("copy"),s.remove(),!0}};function sc(t){if("string"==typeof t){if("pattern"===(t=t.toLowerCase()))return"var(--pattern)";if(!1===t.startsWith("#")&&!1===t.startsWith("var(")){const e="--color-"+t;if(window.getComputedStyle(document.documentElement).getPropertyValue(e))return`var(${e})`}return t}}function ic(t,e=!1){if(!t.match("youtu"))return!1;let s=null;try{s=new URL(t)}catch{return!1}const i=s.pathname.split("/").filter(t=>""!==t),n=i[0],o=i[1],r="https://"+(!0===e?"www.youtube-nocookie.com":s.host)+"/embed",a=t=>!!t&&null!==t.match(/^[a-zA-Z0-9_-]+$/);let l=s.searchParams,c=null;switch(i.join("/")){case"embed/videoseries":case"playlist":a(l.get("list"))&&(c=r+"/videoseries");break;case"watch":a(l.get("v"))&&(c=r+"/"+l.get("v"),l.has("t")&&l.set("start",l.get("t")),l.delete("v"),l.delete("t"));break;default:s.host.includes("youtu.be")&&a(n)?(c=!0===e?"https://www.youtube-nocookie.com/embed/"+n:"https://www.youtube.com/embed/"+n,l.has("t")&&l.set("start",l.get("t")),l.delete("t")):["embed","shorts"].includes(n)&&a(o)&&(c=r+"/"+o)}if(!c)return!1;const u=l.toString();return u.length&&(c+="?"+u),c}function nc(t,e=!1){let s=null;try{s=new URL(t)}catch{return!1}const i=s.pathname.split("/").filter(t=>""!==t);let n=s.searchParams,o=null;switch(!0===e&&n.append("dnt",1),s.host){case"vimeo.com":case"www.vimeo.com":o=i[0];break;case"player.vimeo.com":o=i[1]}if(!o||!o.match(/^[0-9]*$/))return!1;let r="https://player.vimeo.com/video/"+o;const a=n.toString();return a.length&&(r+="?"+a),r}const oc={youtube:ic,vimeo:nc,video:function(t,e=!1){return!0===t.includes("youtu")?ic(t,e):!0===t.includes("vimeo")&&nc(t,e)}};function rc(t){var e;if(void 0!==t.default)return vt(t.default);const s=window.panel.app.$options.components[`k-${t.type}-field`],i=null==(e=null==s?void 0:s.options.props)?void 0:e.value;if(void 0===i)return;const n=null==i?void 0:i.default;return"function"==typeof n?n():void 0!==n?n:null}const ac={defaultValue:rc,form:function(t){const e={};for(const s in t){const i=rc(t[s]);void 0!==i&&(e[s]=i)}return e},isVisible:function(t,e){if("hidden"===t.type||!0===t.hidden)return!1;if(!t.when)return!0;for(const s in t.when){const i=e[s.toLowerCase()],n=t.when[s];if((void 0!==i||!(""===n||Array.isArray(n)&&0===n.length))&&i!==n)return!1}return!0},subfields:function(t,e){let s={};for(const i in e){const n=e[i];n.section=t.name,t.endpoints&&(n.endpoints={field:t.endpoints.field+"+"+i,section:t.endpoints.section,model:t.endpoints.model}),s[i]=n}return s}},lc=t=>t.split(".").slice(-1).join(""),cc=t=>t.split(".").slice(0,-1).join("."),uc=t=>Intl.NumberFormat("en",{notation:"compact",style:"unit",unit:"byte",unitDisplay:"narrow"}).format(t),pc={extension:lc,name:cc,niceSize:uc};function dc(t,e){if("string"==typeof t&&(t=document.querySelector(t)),!t)return!1;if(!e&&t.contains(document.activeElement)&&t!==document.activeElement)return!1;const s=[":where([autofocus], [data-autofocus])",":where(input, textarea, select, [contenteditable=true], .input-focus)","[type=submit]","button"];e&&s.unshift(`[name="${e}"]`);const i=function(t,e){for(const s of e){const e=t.querySelector(s);if(!0===hc(e))return e}return null}(t,s);return i?(i.focus(),i):!0===hc(t)&&(t.focus(),t)}function hc(t){return!!t&&(!t.matches("[disabled], [aria-disabled], input[type=hidden]")&&(!t.closest("[aria-disabled]")&&!t.closest("[disabled]")&&"function"==typeof t.focus))}const mc=t=>"function"==typeof window.Vue.options.components[t],fc=t=>!!t.dataTransfer&&(!!t.dataTransfer.types&&(!0===t.dataTransfer.types.includes("Files")&&!1===t.dataTransfer.types.includes("text/plain")));const gc={metaKey:function(){return window.navigator.userAgent.indexOf("Mac")>-1?"cmd":"ctrl"}};function kc(t){return!0===t.startsWith("file://")||!0===t.startsWith("/@/file/")}function bc(t){return"site://"===t||!0===t.startsWith("page://")||null!==t.match(/^\/(.*\/)?@\/page\//)}function yc(t=[]){const e={url:{detect:t=>/^(http|https):\/\//.test(t),icon:"url",id:"url",label:window.panel.$t("url"),link:t=>t,placeholder:window.panel.$t("url.placeholder"),input:"url",value:t=>t},page:{detect:t=>!0===bc(t),icon:"page",id:"page",label:window.panel.$t("page"),link:t=>t,placeholder:window.panel.$t("select")+" …",input:"text",value:t=>t},file:{detect:t=>!0===kc(t),icon:"file",id:"file",label:window.panel.$t("file"),link:t=>t,placeholder:window.panel.$t("select")+" …",value:t=>t},email:{detect:t=>t.startsWith("mailto:"),icon:"email",id:"email",label:window.panel.$t("email"),link:t=>t.replace(/^mailto:/,""),placeholder:window.panel.$t("email.placeholder"),input:"email",value:t=>"mailto:"+t},tel:{detect:t=>t.startsWith("tel:"),icon:"phone",id:"tel",label:window.panel.$t("tel"),link:t=>t.replace(/^tel:/,""),pattern:"[+]{0,1}[0-9]+",placeholder:window.panel.$t("tel.placeholder"),input:"tel",value:t=>"tel:"+t},anchor:{detect:t=>t.startsWith("#"),icon:"anchor",id:"anchor",label:"Anchor",link:t=>t,pattern:"^#.+",placeholder:"#element",input:"text",value:t=>t},custom:{detect:()=>!0,icon:"title",id:"custom",label:window.panel.$t("custom"),link:t=>t,input:"text",value:t=>t}};if(!t.length)return e;const s={};for(const i of t)e[i]&&(s[i]=e[i]);return s}const vc={detect:function(t,e){if(t??(t=""),e??(e=yc()),0===t.length)return{type:Object.keys(e)[0]??"url",link:""};for(const s in e)if(!0===e[s].detect(t))return{type:s,link:e[s].link(t)}},getFileUUID:function(t){return t.replace("/@/file/","file://")},getPageUUID:function(t){return t.replace(/^\/(.*\/)?@\/page\//,"page://")},isFileUUID:kc,isPageUUID:bc,preview:async function({type:t,link:e},s){return"page"===t&&e?await async function(t,e=["title","panelImage"]){if("site://"===t)return{label:window.panel.$t("view.site")};try{const s=await window.panel.api.pages.get(t,{select:e.join(",")});return{label:s.title,image:s.panelImage}}catch{return null}}(e,s):"file"===t&&e?await async function(t,e=["filename","panelImage"]){try{const s=await window.panel.api.files.get(null,t,{select:e.join(",")});return{label:s.filename,image:s.panelImage}}catch{return null}}(e,s):e?{label:e}:null},types:yc};const $c={status:function(t,e=!1){const s={icon:"status-"+t,title:window.panel.$t("page.status")+": "+window.panel.$t("page.status."+t),disabled:e,size:"xs",style:"--icon-size: 15px"};return e&&(s.title+=` (${window.panel.$t("disabled")})`),s.theme="draft"===t?"negative-icon":"unlisted"===t?"info-icon":"positive-icon",s}},wc=(t="3/2",e="100%",s=!0)=>{const i=String(t).split("/");if(2!==i.length)return e;const n=Number(i[0]),o=Number(i[1]);let r=100;return 0!==n&&0!==o&&(r=s?r/n*o:r/o*n,r=parseFloat(String(r)).toFixed(2)),r+"%"},xc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function _c(t){return String(t).replace(/[&<>"'`=/]/g,t=>xc[t])}function Sc(t){return!t||0===String(t).length}function Cc(t){const e=String(t);return e.charAt(0).toLowerCase()+e.slice(1)}function Oc(t="",e=""){const s=new RegExp(`^(${RegExp.escape(e)})+`,"g");return t.replace(s,"")}function Ac(t){let e="";const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var i=0;i<t;i++)e+=s.charAt(Math.floor(62*Math.random()));return e}function Mc(t="",e=""){const s=new RegExp(`(${RegExp.escape(e)})+$`,"g");return t.replace(s,"")}function Dc(t,e={}){const s=(t,e={})=>{const i=e[_c(t.shift())]??"…";return"…"===i||0===t.length?i:s(t,i)},i="[{]{1,2}[\\s]?",n="[\\s]?[}]{1,2}";return(t=t.replace(new RegExp(`${i}(.*?)${n}`,"gi"),(t,i)=>s(i.split("."),e))).replace(new RegExp(`${i}.*${n}`,"gi"),"…")}function Ec(t){const e=String(t);return e.charAt(0).toUpperCase()+e.slice(1)}function jc(){let t,e,s="";for(t=0;t<32;t++)e=16*Math.random()|0,8!=t&&12!=t&&16!=t&&20!=t||(s+="-"),s+=(12==t?4:16==t?3&e|8:e).toString(16);return s}const Ic={camelToKebab:function(t){return t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()},escapeHTML:_c,hasEmoji:function(t){if("string"!=typeof t)return!1;if(!0===/^[a-z0-9_-]+$/.test(t))return!1;const e=t.match(/(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|[\ud83c\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|[\ud83c\ude32-\ude3a]|[\ud83c\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/i);return null!==e&&null!==e.length},isEmpty:Sc,lcfirst:Cc,ltrim:Oc,pad:function(t,e=2){t=String(t);let s="";for(;s.length<e-t.length;)s+="0";return s+t},random:Ac,rtrim:Mc,slug:function(t,e=[],s="",i="-"){if(!t)return"";s&&0!==s.length||(s="a-z0-9"),t=t.trim().toLowerCase();for(const n of e)for(const e in n){const s="/"!==e.slice(0,1),i=e.slice(1,e.length-1),o=s?e:i;t=t.replace(new RegExp(RegExp.escape(o),"g"),n[e])}return t=(t=(t=(t=(t=(t=t.replace("/[^\t\n\r -~]/","")).replace(new RegExp("[^"+s+"]","ig"),i)).replace(new RegExp("["+RegExp.escape(i)+"]{2,}","g"),i)).replace("/",i)).replace(new RegExp("^[^a-z0-9]+","g"),"")).replace(new RegExp("[^a-z0-9]+$","g"),"")},stripHTML:function(t){return String(t).replace(/(<([^>]+)>)/gi,"")},template:Dc,ucfirst:Ec,ucwords:function(t){return String(t).split(/ /g).map(t=>Ec(t)).join(" ")},unescapeHTML:function(t){for(const e in xc)t=String(t).replaceAll(xc[e],e);return t},uuid:jc},Bc=(t,e,s={leading:!0,trailing:!1})=>{let i=null,n=null,o=null;function r(...r){if(i)return n=this,void(o=r);s.leading?t.call(this,...r):(n=this,o=r);const a=()=>{s.trailing&&o?(t.call(n,...o),n=null,o=null,i=setTimeout(a,e)):i=null};i=setTimeout(a,e)}return r.cancel=()=>{i&&(clearTimeout(i),i=null,n=null,o=null)},r};async function Lc(t,e){return new Promise((s,i)=>{var n;const o={url:"/",field:"file",method:"POST",filename:t.name,headers:{},attributes:{},complete:()=>{},error:()=>{},success:()=>{},progress:()=>{}},r=Object.assign(o,e),a=new XMLHttpRequest,l=new FormData;l.append(r.field,t,r.filename);for(const t in r.attributes){const e=r.attributes[t];null!=e&&l.append(t,e)}const c=e=>{if(e.lengthComputable&&r.progress){const s=Math.max(0,Math.min(100,Math.ceil(e.loaded/e.total*100)));r.progress(a,t,s)}};a.upload.addEventListener("loadstart",c),a.upload.addEventListener("progress",c),a.addEventListener("load",e=>{let n=null;try{n=JSON.parse(e.target.response)}catch{n={status:"error",message:"The file could not be uploaded"}}"error"===n.status?(r.error(a,t,n),i(n)):(r.progress(a,t,100),r.success(a,t,n),s(n))}),a.addEventListener("error",e=>{const s=JSON.parse(e.target.response);r.progress(a,t,100),r.error(a,t,s),i(s)}),a.open(r.method,r.url,!0);for(const t in r.headers)a.setRequestHeader(t,r.headers[t]);null==(n=r.abort)||n.addEventListener("abort",()=>{a.abort()}),a.send(l)})}function Tc(){var t;return new URL((null==(t=document.querySelector("base"))?void 0:t.href)??window.location.origin)}function Pc(t={},e={}){e instanceof URL&&(e=e.search);const s=new URLSearchParams(e);for(const[i,n]of Object.entries(t))null!==n&&s.set(i,n);return s}function qc(t="",e={},s){return(t=Rc(t,s)).search=Pc(e,t.search),t}function Nc(t){return null!==String(t).match(/^https?:\/\//)}function Fc(t){return Rc(t).origin===window.location.origin}function zc(t,e){if((t instanceof URL||t instanceof Location)&&(t=t.toString()),"string"!=typeof t)return!1;try{new URL(t,window.location)}catch{return!1}if(!0===e){return/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:localhost)|(?:(?:[a-z0-9\u00a1-\uffff][a-z0-9\u00a1-\uffff_-]{0,62})?[a-z0-9\u00a1-\uffff]\.)+(?:[a-z\u00a1-\uffff]{2,}\.?))(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(t)}return!0}function Yc(t,e){return!0===Nc(t)?t:(e??(e=Tc()),(e=String(e).replaceAll(/\/$/g,""))+"/"+(t=String(t).replaceAll(/^\//g,"")))}function Rc(t,e){return t instanceof URL?t:new URL(Yc(t,e))}const Hc={base:Tc,buildQuery:Pc,buildUrl:qc,isAbsolute:Nc,isSameOrigin:Fc,isUrl:zc,makeAbsolute:Yc,toObject:Rc},Uc={install(t){t.prototype.$helper={array:tc,clipboard:ec,clone:_t.clone,color:sc,embed:oc,focus:dc,isComponent:mc,isUploadEvent:fc,debounce:zt,field:ac,file:pc,keyboard:gc,link:vc,object:_t,page:$c,pad:Ic.pad,ratio:wc,slug:Ic.slug,sort:Zl,string:Ic,throttle:Bc,upload:Lc,url:Hc,uuid:Ic.uuid},t.prototype.$esc=Ic.escapeHTML}},Vc={install(t){const e=(t,e,s)=>{!0!==s.context.disabled?t.dir=window.panel.language.direction:t.dir=null};t.directive("direction",{bind:e,update:e})}},Kc={install(t){const e=window.panel;t.prototype.$api=e.api,t.prototype.$dialog=e.dialog.open.bind(e.dialog),t.prototype.$drawer=e.drawer.open.bind(e.drawer),t.prototype.$dropdown=e.dropdown.openAsync.bind(e.dropdown),t.prototype.$events=e.events,t.prototype.$go=e.view.open.bind(e.view),t.prototype.$reload=e.reload,t.prototype.$t=e.$t=e.t,t.prototype.$url=e.url}},Wc=/^#?([\da-f]{3}){1,2}$/i,Jc=/^#?([\da-f]{4}){1,2}$/i,Gc=/^rgba?\(\s*(\d{1,3})(%?)(?:,|\s)+(\d{1,3})(%?)(?:,|\s)+(\d{1,3})(%?)(?:,|\s|\/)*(\d*(?:\.\d+)?)(%?)\s*\)?$/i,Xc=/^hsla?\(\s*(\d{1,3}\.?\d*)(deg|rad|grad|turn)?(?:,|\s)+(\d{1,3})%(?:,|\s)+(\d{1,3})%(?:,|\s|\/)*(\d*(?:\.\d+)?)(%?)\s*\)?$/i;function Zc(t){return"string"==typeof t&&(Wc.test(t)||Jc.test(t))}function Qc(t){return $t(t)&&"r"in t&&"g"in t&&"b"in t}function tu(t){return $t(t)&&"h"in t&&"s"in t&&"l"in t}function eu({h:t,s:e,v:s,a:i}){if(0===s)return{h:t,s:0,l:0,a:i};if(0===e&&1===s)return{h:t,s:1,l:1,a:i};const n=s*(2-e)/2;return{h:t,s:e=s*e/(1-Math.abs(2*n-1)),l:n,a:i}}function su({h:t,s:e,l:s,a:i}){const n=e*(s<.5?s:1-s);return{h:t,s:e=0===n?0:2*n/(s+n),v:s+n,a:i}}function iu(t){if(!0===Wc.test(t)||!0===Jc.test(t)){"#"===t[0]&&(t=t.slice(1)),3===t.length&&(t=t.split("").reduce((t,e)=>t+e+e,""));const e=parseInt(t,16);return!0===Wc.test(t)?{r:e>>16,g:e>>8&255,b:255&e,a:1}:{r:e>>24&255,g:e>>16&255,b:e>>8&255,a:Math.round((255&e)/255*100)/100}}throw new Error(`unknown hex color: ${t}`)}function nu({r:t,g:e,b:s,a:i=1}){let n="#"+(1<<24|t<<16|e<<8|s).toString(16).slice(1);return i<1&&(n+=(256|Math.round(255*i)).toString(16).slice(1)),n}function ou({h:t,s:e,l:s,a:i}){const n=e*Math.min(s,1-s),o=(e,i=(e+t/30)%12)=>s-n*Math.max(Math.min(i-3,9-i,1),-1);return{r:255*o(0),g:255*o(8),b:255*o(4),a:i}}function ru({r:t,g:e,b:s,a:i}){t/=255,e/=255,s/=255;const n=Math.max(t,e,s),o=n-Math.min(t,e,s),r=1-Math.abs(n+n-o-1);let a=o&&(n==t?(e-s)/o:n==e?2+(s-t)/o:4+(t-e)/o);return a=60*(a<0?a+6:a),{h:a,s:r?o/r:0,l:(n+n-o)/2,a:i}}function au(t){return nu(ou(t))}function lu(t){return ru(iu(t))}function cu(t,e){return t=Number(t),"grad"===e?t*=.9:"rad"===e?t*=180/Math.PI:"turn"===e&&(t*=360),parseInt(t%360)}function uu(t,e){if(!0===Zc(t))switch("#"!==t[0]&&(t="#"+t),e){case"hex":return t;case"rgb":return iu(t);case"hsl":return lu(t);case"hsv":return su(lu(t))}if(!0===Qc(t))switch(e){case"hex":return nu(t);case"rgb":return t;case"hsl":return ru(t);case"hsv":return function({r:t,g:e,b:s,a:i}){t/=255,e/=255,s/=255;const n=Math.max(t,e,s),o=n-Math.min(t,e,s);let r=o&&(n==t?(e-s)/o:n==e?2+(s-t)/o:4+(t-e)/o);return r=60*(r<0?r+6:r),{h:r,s:n&&o/n,v:n,a:i}}(t)}if(!0===tu(t))switch(e){case"hex":return au(t);case"rgb":return ou(t);case"hsl":return t;case"hsv":return su(t)}if(!0===function(t){return $t(t)&&"h"in t&&"s"in t&&"v"in t}(t))switch(e){case"hex":return au(eu(t));case"rgb":return function({h:t,s:e,v:s,a:i}){const n=(i,n=(i+t/60)%6)=>s-s*e*Math.max(Math.min(n,4-n,1),0);return{r:255*n(5),g:255*n(3),b:255*n(1),a:i}}(t);case"hsl":return eu(t);case"hsv":return t}throw new Error(`Invalid color conversion: ${JSON.stringify(t)} -> ${e}`)}function pu(t){let e;if(!t||"string"!=typeof t)return!1;if(!0===Zc(t))return"#"!==t[0]&&(t="#"+t),t;if(e=t.match(Gc)){const t={r:Number(e[1]),g:Number(e[3]),b:Number(e[5]),a:Number(e[7]||1)};return"%"===e[2]&&(t.r=Math.ceil(2.55*t.r)),"%"===e[4]&&(t.g=Math.ceil(2.55*t.g)),"%"===e[6]&&(t.b=Math.ceil(2.55*t.b)),"%"===e[8]&&(t.a=t.a/100),t}if(e=t.match(Xc)){let[t,s,i,n,o]=e.slice(1);const r={h:cu(t,s),s:Number(i)/100,l:Number(n)/100,a:Number(o||1)};return"%"===e[6]&&(r.a=r.a/100),r}return null}const du={convert:uu,parse:pu,parseAs:function(t,e){const s=pu(t);return s&&e?uu(s,e):s},toString:function(t,e,s=!0){var i,n;let o=t;if("string"==typeof o&&(o=pu(t)),o&&e&&(o=uu(o,e)),!0===Zc(o))return!0!==s&&(5===o.length?o=o.slice(0,4):o.length>7&&(o=o.slice(0,7))),o.toLowerCase();if(!0===Qc(o)){const t=o.r.toFixed(),e=o.g.toFixed(),n=o.b.toFixed(),r=null==(i=o.a)?void 0:i.toFixed(2);return s&&r&&r<1?`rgb(${t} ${e} ${n} / ${r})`:`rgb(${t} ${e} ${n})`}if(!0===tu(o)){const t=o.h.toFixed(),e=(100*o.s).toFixed(),i=(100*o.l).toFixed(),r=null==(n=o.a)?void 0:n.toFixed(2);return s&&r&&r<1?`hsl(${t} ${e}% ${i}% / ${r})`:`hsl(${t} ${e}% ${i}%)`}throw new Error(`Unsupported color: ${JSON.stringify(t)}`)}};z.extend(Y),z.extend((t,e,s)=>{s.interpret=(t,e="date")=>{const i={date:{"YYYY-MM-DD":!0,"YYYY-MM-D":!0,"YYYY-MM-":!0,"YYYY-MM":!0,"YYYY-M-DD":!0,"YYYY-M-D":!0,"YYYY-M-":!0,"YYYY-M":!0,"YYYY-":!0,YYYYMMDD:!0,"MMM DD YYYY":!1,"MMM D YYYY":!1,"MMM DD YY":!1,"MMM D YY":!1,"MMM YYYY":!0,"MMM DD":!1,"MMM D":!1,"MM YYYY":!0,"M YYYY":!0,"MMMM DD YYYY":!0,"MMMM D YYYY":!0,"MMMM DD YY":!0,"MMMM D YY":!0,"MMMM DD, YYYY":!0,"MMMM D, YYYY":!0,"MMMM DD, YY":!0,"MMMM D, YY":!0,"MMMM DD. YYYY":!0,"MMMM D. YYYY":!0,"MMMM DD. YY":!0,"MMMM D. YY":!0,DDMMYYYY:!0,DDMMYY:!0,"DD MMMM YYYY":!1,"DD MMMM YY":!1,"DD MMMM":!1,"D MMMM YYYY":!1,"D MMMM YY":!1,"D MMMM":!1,"DD MMM YYYY":!1,"D MMM YYYY":!1,"DD MMM YY":!1,"D MMM YY":!1,"DD MMM":!1,"D MMM":!1,"DD MM YYYY":!1,"DD M YYYY":!1,"D MM YYYY":!1,"D M YYYY":!1,"DD MM YY":!1,"D MM YY":!1,"DD M YY":!1,"D M YY":!1,YYYY:!0,MMMM:!0,MMM:!0,"DD MM":!1,"DD M":!1,"D MM":!1,"D M":!1,DD:!1,D:!1},time:{"HHmmss a":!1,"HHmm a":!1,"HH a":!1,HHmmss:!1,HHmm:!1,"HH:mm:ss a":!1,"HH:mm:ss":!1,"HH:mm a":!1,"HH:mm":!1,HH:!1}};if("string"==typeof t&&""!==t)for(const n in i[e]){const o=s(t,n,i[e][n]);if(!0===o.isValid())return o}return null}}),z.extend((t,e,s)=>{const i=t=>"date"===t?"YYYY-MM-DD":"time"===t?"HH:mm:ss":"YYYY-MM-DD HH:mm:ss";e.prototype.toISO=function(t="datetime"){return this.format(i(t))},s.iso=function(t,e){e&&(e=i(e)),e??(e=[i("datetime"),i("date"),i("time")]);const n=s(t,e);return n&&n.isValid()?n:null}}),z.extend((t,e)=>{e.prototype.merge=function(t,e="date"){let s=this.clone();if(!t||!t.isValid())return this;if("string"==typeof e){const t={date:["year","month","date"],time:["hour","minute","second"]};if(!1===Object.hasOwn(t,e))throw new Error("Invalid merge unit alias");e=t[e]}for(const i of e)s=s.set(i,t.get(i));return s}}),z.extend((t,e,s)=>{s.pattern=t=>new class{constructor(t,e){this.dayjs=t,this.pattern=e;const s={year:["YY","YYYY"],month:["M","MM","MMM","MMMM"],day:["D","DD"],hour:["h","hh","H","HH"],minute:["m","mm"],second:["s","ss"],meridiem:["a"]};this.parts=this.pattern.split(/\W/).map((t,e)=>{const i=this.pattern.indexOf(t);return{index:e,unit:Object.keys(s)[Object.values(s).findIndex(e=>e.includes(t))],start:i,end:i+(t.length-1)}})}at(t,e=t){const s=this.parts.filter(s=>s.start<=t&&s.end>=e-1);return s[0]?s[0]:this.parts.filter(e=>e.start<=t).pop()}format(t){return t&&t.isValid()?t.format(this.pattern):null}}(s,t)}),z.extend((t,e)=>{e.prototype.round=function(t="date",e=1){const s=["second","minute","hour","date","month","year"];if("day"===t&&(t="date"),!1===s.includes(t))throw new Error("Invalid rounding unit");if(["date","month","year"].includes(t)&&1!==e||"hour"===t&&24%e!=0||["second","minute"].includes(t)&&60%e!=0)throw"Invalid rounding size for "+t;let i=this.clone();const n=s.indexOf(t),o=s.slice(0,n),r=o.pop();for(const a of o)i=i.startOf(a);if(r){const e={month:12,date:i.daysInMonth(),hour:24,minute:60,second:60}[r];Math.round(i.get(r)/e)*e===e&&(i=i.add(1,"date"===t?"day":t)),i=i.startOf(t)}return i=i.set(t,Math.round(i.get(t)/e)*e),i}}),z.extend((t,e,s)=>{e.prototype.validate=function(t,e,i="day"){if(!this.isValid())return!1;if(!t)return!0;t=s.iso(t);const n={min:"isAfter",max:"isBefore"}[e];return this.isSame(t,i)||this[n](t,i)}});const hu={install(t){t.prototype.$library={autosize:R,colors:du,dayjs:z}}},mu=(t,e={})=>r({...e,key:()=>t,defaults:()=>e,reset(){return this.set(this.defaults())},set(t){this.validateState(t);for(const e in this.defaults())this[e]=t[e]??this.defaults()[e];return this.state()},state(){const t={};for(const e in this.defaults())t[e]=this[e]??this.defaults()[e];return t},validateState(t){if(!1===$t(t))throw new Error(`Invalid ${this.key()} state`);return!0}}),fu=()=>{const t=mu("activation",{isOpen:"true"!==sessionStorage.getItem("kirby$activation$card")});return r({...t,close(){sessionStorage.setItem("kirby$activation$card","true"),this.isOpen=!1},open(){sessionStorage.removeItem("kirby$activation$card"),this.isOpen=!0}})},gu=t=>({async changeName(e,s,i){return t.patch(this.url(e,s,"name"),{name:i})},async delete(e,s){return t.delete(this.url(e,s))},async get(e,s,i){let n=await t.get(this.url(e,s),i);return!0===Array.isArray(n.content)&&(n.content={}),n},id:t=>!0===t.startsWith("/@/file/")?t.replace("/@/file/","@"):!0===t.startsWith("file://")?t.replace("file://","@"):t,link(t,e,s){return"/"+this.url(t,e,s)},async update(e,s,i){return t.patch(this.url(e,s),i)},url(t,e,s){let i="files/"+this.id(e);return t&&(i=t+"/"+i),s&&(i+="/"+s),i}}),ku=t=>({async blueprint(e){return t.get("pages/"+this.id(e)+"/blueprint")},async blueprints(e,s){return t.get("pages/"+this.id(e)+"/blueprints",{section:s})},async changeSlug(e,s){return t.patch("pages/"+this.id(e)+"/slug",{slug:s})},async changeStatus(e,s,i){return t.patch("pages/"+this.id(e)+"/status",{status:s,position:i})},async changeTemplate(e,s){return t.patch("pages/"+this.id(e)+"/template",{template:s})},async changeTitle(e,s){return t.patch("pages/"+this.id(e)+"/title",{title:s})},async children(e,s){return t.post("pages/"+this.id(e)+"/children/search",s)},async create(e,s){return null===e||"/"===e?t.post("site/children",s):t.post("pages/"+this.id(e)+"/children",s)},async delete(e,s){return t.delete("pages/"+this.id(e),s)},async duplicate(e,s,i){return t.post("pages/"+this.id(e)+"/duplicate",{slug:s,children:i.children??!1,files:i.files??!1})},async get(e,s){let i=await t.get("pages/"+this.id(e),s);return!0===Array.isArray(i.content)&&(i.content={}),i},id:t=>!0===t.match(/^\/(.*\/)?@\/page\//)?t.replace(/^\/(.*\/)?@\/page\//,"@"):!0===t.startsWith("page://")?t.replace("page://","@"):t.replace(/\//g,"+"),async files(e,s){return t.post("pages/"+this.id(e)+"/files/search",s)},link(t){return"/"+this.url(t)},async preview(t){return(await this.get(this.id(t),{select:"previewUrl"})).previewUrl},async search(e,s){return e?t.post("pages/"+this.id(e)+"/children/search?select=id,title,hasChildren",s):t.post("site/children/search?select=id,title,hasChildren",s)},async update(e,s){return t.patch("pages/"+this.id(e),s)},url(t,e){let s=null===t?"pages":"pages/"+String(t).replace(/\//g,"+");return e&&(s+="/"+e),s}});class bu extends Error{constructor(t,{request:e,response:s,cause:i}){super(s.json.message??t,{cause:i}),this.request=e,this.response=s}state(){return this.response.json}}class yu extends bu{}class vu extends bu{state(){return{message:this.message,text:this.response.text}}}const $u=t=>(window.location.href=Yc(t),!1),wu=async(t,e={})=>{var s;(e={cache:"no-store",credentials:"same-origin",mode:"same-origin",...e}).body=((s=e.body)instanceof HTMLFormElement&&(s=new FormData(s)),s instanceof FormData&&(s=Object.fromEntries(s)),"object"==typeof s?JSON.stringify(s):s),e.headers=((t={},e={})=>{return{"content-type":"application/json","x-csrf":e.csrf??!1,"x-fiber":!0,"x-fiber-globals":(s=e.globals,!!s&&(!1===Array.isArray(s)?String(s):s.join(","))),"x-fiber-referrer":e.referrer??!1,...xt(t)};var s})(e.headers,e),e.url=qc(t,e.query);const i=new Request(e.url,e);return!1===Fc(i.url)?$u(i.url):await xu(i,await fetch(i))},xu=async(t,e)=>{var s;if(!1===e.headers.get("Content-Type").includes("application/json"))return $u(e.url);try{e.text=await e.text(),e.json=JSON.parse(e.text)}catch(i){throw new vu("Invalid JSON response",{cause:i,request:t,response:e})}if(401===e.status)throw new yu("Unauthenticated",{request:t,response:e});if("error"===(null==(s=e.json)?void 0:s.status))throw e.json;if(!1===e.ok)throw new bu(`The request to ${e.url} failed`,{request:t,response:e});return{request:t,response:e}},_u=t=>({blueprint:async e=>t.get("users/"+e+"/blueprint"),blueprints:async(e,s)=>t.get("users/"+e+"/blueprints",{section:s}),changeEmail:async(e,s)=>t.patch("users/"+e+"/email",{email:s}),changeLanguage:async(e,s)=>t.patch("users/"+e+"/language",{language:s}),changeName:async(e,s)=>t.patch("users/"+e+"/name",{name:s}),changePassword:async(e,s,i)=>t.patch("users/"+e+"/password",{password:s,currentPassword:i}),changeRole:async(e,s)=>t.patch("users/"+e+"/role",{role:s}),create:async e=>t.post("users",e),delete:async e=>t.delete("users/"+e),deleteAvatar:async e=>t.delete("users/"+e+"/avatar"),link(t,e){return"/"+this.url(t,e)},async list(e){return t.post(this.url(null,"search"),e)},get:async(e,s)=>t.get("users/"+e,s),async roles(e){return(await t.get(this.url(e,"roles"))).data.map(t=>({info:t.description??`(${window.panel.$t("role.description.placeholder")})`,text:t.title,value:t.name}))},search:async e=>t.post("users/search",e),update:async(e,s)=>t.patch("users/"+e,s),url(t,e){let s=t?"users/"+t:"users";return e&&(s+="/"+e),s}}),Su=t=>{var e;const s={csrf:t.system.csrf,endpoint:Mc(t.urls.api,"/"),methodOverride:(null==(e=t.config.api)?void 0:e.methodOverride)??!1,ping:null,requests:[],running:0},i=()=>{clearInterval(s.ping),s.ping=setInterval(()=>{!1===t.isOffline&&s.auth.ping()},3e5)};return s.request=async(e,n={},o=!1)=>{const r=e+"/"+JSON.stringify(n);s.requests.push(r),!1===o&&!0!==n.silent&&(t.isLoading=!0),s.language=t.language.code;try{return await(t=>async(e,s={})=>{(s={cache:"no-store",credentials:"same-origin",mode:"same-origin",...s}).headers={"content-type":"application/json","x-csrf":t.csrf,"x-language":t.language,...xt(s.headers??{})},t.methodOverride&&"GET"!==s.method&&"POST"!==s.method&&(s.headers["x-http-method-override"]=s.method,s.method="POST");for(const t in s.headers)null===s.headers[t]&&delete s.headers[t];s.url=Mc(t.endpoint,"/")+"/"+Oc(e,"/");const i=new Request(s.url,s),{response:n}=await xu(i,await fetch(i));let o=n.json;return o.data&&"model"===o.type&&(o=o.data),o})(s)(e,n)}finally{i(),s.requests=s.requests.filter(t=>t!==r),0===s.requests.length&&(t.isLoading=!1)}},s.auth=(t=>({async login(e){const s={long:e.remember??!1,email:e.email,password:e.password};return t.post("auth/login",s)},logout:async()=>t.post("auth/logout"),ping:async()=>t.post("auth/ping"),user:async e=>t.get("auth",e),verifyCode:async e=>t.post("auth/code",{code:e})}))(s),s.delete=(t=>async(e,s,i,n=!1)=>t.post(e,s,i,"DELETE",n))(s),s.files=gu(s),s.get=(t=>async(e,s,i,n=!1)=>(s&&(e+="?"+Object.keys(s).filter(t=>void 0!==s[t]&&null!==s[t]).map(t=>t+"="+s[t]).join("&")),t.request(e,Object.assign(i??{},{method:"GET"}),n)))(s),s.languages=(t=>({create:async e=>t.post("languages",e),delete:async e=>t.delete("languages/"+e),get:async e=>t.get("languages/"+e),list:async()=>t.get("languages"),update:async(e,s)=>t.patch("languages/"+e,s)}))(s),s.pages=ku(s),s.patch=(t=>async(e,s,i,n=!1)=>t.post(e,s,i,"PATCH",n))(s),s.post=(t=>async(e,s,i,n="POST",o=!1)=>t.request(e,Object.assign(i??{},{method:n,body:JSON.stringify(s)}),o))(s),s.roles=(t=>({list:async e=>t.get("roles",e),get:async e=>t.get("roles/"+e)}))(s),s.system=(t=>({get:async(e={view:"panel"})=>t.get("system",e),install:async e=>(await t.post("system/install",e)).user,register:async e=>t.post("system/register",e)}))(s),s.site=(t=>({blueprint:async()=>t.get("site/blueprint"),blueprints:async()=>t.get("site/blueprints"),changeTitle:async e=>t.patch("site/title",{title:e}),children:async e=>t.post("site/children/search",e),get:async(e={view:"panel"})=>t.get("site",e),update:async e=>t.post("site",e)}))(s),s.translations=(t=>({list:async()=>t.get("translations"),get:async e=>t.get("translations/"+e)}))(s),s.users=_u(s),i(),s},Cu=t=>{const e=r({cancelSaving(){var t;this.saveLazy.cancel(),null==(t=this.saveAbortController)||t.abort()},dialog:null,diff(t={}){if(!1===this.isCurrent(t))throw new Error("Cannot get changes for another view");const e=this.versions(),s={};for(const i in e.changes){JSON.stringify(e.changes[i])!==JSON.stringify(e.latest[i])&&(s[i]=e.changes[i])}for(const i in e.latest)void 0===e.changes[i]&&(s[i]=null);return s},async discard(e={}){var s;if(!0!==this.isProcessing){if(!1===this.isCurrent(e))throw new Error("Cannot discard content from another view");if(!0===this.isLocked(e))throw new Error("Cannot discard locked changes");this.cancelSaving(),this.isProcessing=!0;try{await this.request("discard",{},e),t.view.props.versions.changes=this.version("latest"),this.emit("discard",{},e)}catch(i){if(null==(s=i.key)?void 0:s.startsWith("error.content.lock"))return this.lockDialog(i.details);throw i}finally{this.isProcessing=!1}}},emit(e,s={},i={}){t.events.emit("content."+e,{...s,...this.env(i)})},env:(e={})=>({api:t.view.props.api,language:t.language.code,...e}),hasDiff(t={}){return wt(this.diff(t))>0},isCurrent(t={}){const e=this.env(t),s=this.env();return s.api===e.api&&s.language===e.language},isLocked(t={}){return this.lock(t).isLocked},isProcessing:!1,lock(e={}){if(!1===this.isCurrent(e))throw new Error("The lock state cannot be detected for content from another view");return t.view.props.lock},lockDialog(e){this.dialog=t.dialog,this.dialog.open({component:"k-lock-alert-dialog",props:{lock:e},on:{close:()=>{this.dialog=null,t.view.reload()}}})},merge(e={},s={}){if(!1===this.isCurrent(s))throw new Error("The content in another view cannot be merged");return!1===$t(e)&&(e={}),t.view.props.versions.changes={...this.version("changes"),...e},t.view.props.versions.changes},async publish(e={},s={}){var i,n;if(!0!==this.isProcessing){if(!1===this.isCurrent(s))throw new Error("Cannot publish content from another view");this.cancelSaving(),this.isProcessing=!0;try{await this.request("publish",this.merge(e,s),s),null==(i=this.dialog)||i.close(),t.view.props.versions.latest=this.version("changes"),this.emit("publish",{values:e},s)}catch(o){if(null==(n=o.key)?void 0:n.startsWith("error.content.lock"))return this.lockDialog(o.details);throw o}finally{this.isProcessing=!1}}},async request(e="save",s={},i={}){const{api:n,language:o}=this.env(i),r={headers:{"x-language":o}};return"save"===e&&(r.signal=this.saveAbortController.signal,r.silent=!0),t.api.post(n+"/changes/"+e,s,r)},async save(t={},e={}){var s,i;this.cancelSaving(),this.saveAbortController=new AbortController;try{await this.request("save",t,e),null==(s=this.dialog)||s.close(),!0===this.isCurrent(e)&&(this.lock(e).modified=new Date),this.emit("save",{values:t},e)}catch(n){if("AbortError"===n.name)return;if(this.isProcessing=!1,null==(i=n.key)?void 0:i.startsWith("error.content.lock"))return this.lockDialog(n.details);throw n}},saveAbortController:null,async update(t={},e={}){return await this.save(this.merge(t,e),e)},updateLazy(t={},e={}){this.saveLazy(this.merge(t,e),e)},version(t){return this.versions()[t]},versions:()=>t.view.props.versions});return e.saveLazy=Bc(e.save,1e3,{leading:!0,trailing:!0,timer:e.timer}),e},Ou=()=>({addEventListener(t,e){"function"==typeof e&&(this.on[t]=e)},addEventListeners(t){if(!1!==$t(t))for(const e in t)this.addEventListener(e,t[e])},emit(t,...e){return this.hasEventListener(t)?this.on[t](...e):()=>{}},hasEventListener(t){return"function"==typeof this.on[t]},listeners(){return this.on},on:{}}),Au=(t,e,s)=>{const i=mu(e,s);return r({...i,...Ou(),async get(e,s={}){this.isLoading=!0;try{return await t.get(e,s)}catch(i){t.error(i)}finally{this.isLoading=!1}return!1},async load(e,s={}){return!0!==s.silent&&(this.isLoading=!0),this.abortController=new AbortController,s.signal=this.abortController.signal,await t.open(e,s),this.isLoading=!1,this.addEventListeners(s.on),this.state()},async open(t,e={}){return"function"==typeof e&&(e={on:{submit:e}}),!0===zc(t)?this.load(t,e):(this.set(t),this.addEventListeners(e.on),this.emit("open",t,e),this.state())},async post(e,s={}){var i;if(!this.path)throw new Error(`The ${this.key()} cannot be posted`);this.isLoading=!0,e??(e=(null==(i=this.props)?void 0:i.value)??{});try{return await t.post(this.path,e,s)}catch(n){t.error(n)}finally{this.isLoading=!1}return!1},async refresh(t={}){t.url??(t.url=this.url());const e=(await this.get(t.url,t))["$"+this.key()];if(e&&e.component===this.component)return this.props=e.props,this.state()},async reload(t={}){if(!this.path)return!1;this.open(this.url(),t)},set(t){return i.set.call(this,t),this.on={},this.addEventListeners(t.on??{}),this.state()},url(){return t.url(this.path,this.query)}})},Mu=()=>r({add(t,e=!1){if(!t.id)throw new Error("The state needs an ID");if(!0===e)return this.replace(-1,t);!0!==this.has(t.id)&&this.milestones.push(t)},at(t){return this.milestones.at(t)},clear(){this.milestones=[]},get(t=null){return null===t?this.milestones:this.milestones.find(e=>e.id===t)},goto(t){const e=this.index(t);if(-1!==e)return this.milestones=this.milestones.slice(0,e+1),this.milestones[e]},has(t){return void 0!==this.get(t)},index(t){return this.milestones.findIndex(e=>e.id===t)},isEmpty(){return 0===this.milestones.length},last(){return this.milestones.at(-1)},milestones:[],remove(t=null){return null===t?this.removeLast():this.milestones=this.milestones.filter(e=>e.id!==t)},removeLast(){return this.milestones=this.milestones.slice(0,-1)},replace(t,e){-1===t&&(t=this.milestones.length-1),n(this.milestones,t,e)}}),Du=(t,e,s)=>{const i=Au(t,e,s);return r({...i,async cancel(){this.isOpen&&this.emit("cancel"),this.close()},async close(e){if(!1===this.isOpen)return;if(void 0!==e&&!0!==e&&e!==this.id)return;!0===e?this.history.clear():this.history.removeLast();const s=this.on.closed??(()=>{});if(!1===this.history.isEmpty()){const t=this.open(this.history.last());return s(),t}this.isOpen=!1,this.emit("close"),this.reset(),s(),0===t.overlays().length&&(document.documentElement.removeAttribute("data-overlay"),document.documentElement.style.removeProperty("--scroll-top"))},focus(t){dc(`.k-${this.key()}-portal`,t)},goTo(t){const e=this.history.goto(t);void 0!==e&&this.open(e)},history:Mu(),input(t){!1!==this.isOpen&&(n(this.props,"value",t),this.emit("input",t))},isOpen:!1,listeners(){return{...this.on,cancel:this.cancel.bind(this),close:this.close.bind(this),input:this.input.bind(this),submit:this.submit.bind(this),success:this.success.bind(this)}},async open(e,s){return!1===this.isOpen&&t.notification.close(),await i.open.call(this,e,s),this.component&&(document.documentElement.setAttribute("data-overlay","true"),document.documentElement.style.setProperty("--scroll-top",window.scrollY+"px"),this.isOpen=!0),this.state()},set(t){return i.set.call(this,t),this.id??(this.id=jc()),this.state()},async submit(t,e={}){if(!0===this.isLoading)return;if(t??(t=this.props.value),this.hasEventListener("submit"))return this.emit("submit",t,e);if(!this.path)return this.close();const s=await this.post(t,e);return!1===$t(s)?s:this.success(s["$"+this.key()]??{})},success(e){return this.hasEventListener("success")?this.emit("success",e):("string"==typeof e&&t.notification.success(e),this.close(),this.successNotification(e),this.successEvents(e),e.route||e.redirect?this.successRedirect(e):t.view.reload(e.reload),e)},successEvents(e){if(e.event){const s=Ql(e.event);for(const i of s)"string"==typeof i&&t.events.emit(i,e)}!1!==e.emit&&t.events.emit("success",e)},successNotification(e){e.message&&t.notification.success(e.message)},successRedirect(e){const s=e.route??e.redirect;return!!s&&("string"==typeof s?t.open(s):t.open(s.url,s.options))},get value(){var t;return null==(t=this.props)?void 0:t.value}})},Eu=t=>{t.events.on("dialog.save",e=>{var s;null==(s=null==e?void 0:e.preventDefault)||s.call(e),t.dialog.submit()});const e=Du(t,"dialog",{abortController:null,component:null,isLoading:!1,on:{},path:null,props:{},query:{},referrer:null,timestamp:null,id:null,legacy:!1,ref:null});return r({...e,async close(){this.ref&&(this.ref.visible=!1),e.close.call(this)},async open(t,s={}){if(t instanceof window.Vue)return this.openComponent(t);"string"==typeof t&&(t=`/dialogs/${t}`);const i=await e.open.call(this,t,s);return this.history.add(i,t.replace),i},async openComponent(s){t.deprecated("Dialog components should no longer be used in your templates");const i=await e.open.call(this,{component:s.$options._componentTag,legacy:!0,props:{...s.$attrs,...s.$props},ref:s}),n=this.listeners();for(const t in n)s.$on(t,n[t]);return s.visible=!0,i}})},ju=()=>{const t=mu("drag",{type:null,data:{}});return r({...t,get isDragging(){return null!==this.type},start(t,e){this.type=t,this.data=e},stop(){this.type=null,this.data={}}})},Iu=t=>{const e=Du(t,"drawer",{abortController:null,component:null,isLoading:!1,on:{},path:null,props:{},query:{},referrer:null,timestamp:null,id:null});return t.events.on("drawer.save",e=>{e.preventDefault(),t.drawer.submit()}),r({...e,get breadcrumb(){return this.history.milestones},get icon(){return this.props.icon??"box"},listeners(){return{...e.listeners.call(this),crumb:this.goTo.bind(this),tab:this.tab.bind(this)}},async open(t,s={}){"string"==typeof t&&(t=`/drawers/${t}`),await e.open.call(this,t,s),this.tab(t.tab);const i=this.state();return this.history.add(i,t.replace),this.focus(),i},tab(t){const e=this.props.tabs??{};if(t??(t=Object.keys(e??{})[0]),!t)return!1;n(this.props,"fields",e[t].fields),n(this.props,"tab",t),this.emit("tab",t),setTimeout(()=>{this.focus()})}})},Bu=t=>{const e=Au(t,"dropdown",{abortController:null,component:null,isLoading:!1,on:{},path:null,props:{},query:{},referrer:null,timestamp:null});return r({...e,close(){this.emit("close"),this.reset()},open(t,s={}){return"string"==typeof t&&(t=`/dropdowns/${t}`),e.open.call(this,t,s)},openAsync(t,e={}){return async s=>{await this.open(t,e);const i=this.options();if(0===i.length)throw Error("The dropdown is empty");s(i)}},options(){return!1===Array.isArray(this.props.options)?[]:this.props.options.map(e=>e.dialog?(e.click=()=>{const s="string"==typeof e.dialog?e.dialog:e.dialog.url,i="object"==typeof e.dialog?e.dialog:{};return t.dialog.open(s,i)},e):e)},set(t){return t.options&&(t.props={options:t.options}),e.set.call(this,t)}})},Lu=t=>{const e=H();e.on("online",()=>{t.isOffline=!1}),e.on("offline",()=>{t.isOffline=!0}),e.on("keydown.cmd.s",s=>{e.emit(t.context+".save",s)}),e.on("keydown.cmd.shift.f",()=>t.search()),e.on("keydown.cmd./",()=>t.search()),e.on("clipboard.write",async e=>{ec.write(e),t.notification.success(t.t("copy.success")+"!")});const s={document:{blur:!0,click:!1,copy:!0,focus:!0,paste:!0},window:{beforeunload:!1,dragenter:!1,dragexit:!1,dragleave:!1,dragover:!1,drop:!1,keydown:!1,keyup:!1,offline:!1,online:!1,popstate:!1}};return{beforeunload(t){this.emit("beforeunload",t)},blur(t){this.emit("blur",t)},click(t){this.emit("click",t)},copy(t){this.emit("copy",t)},dragenter(t){this.entered=t.target,this.prevent(t),this.emit("dragenter",t)},dragexit(t){this.prevent(t),this.entered=null,this.emit("dragexit",t)},dragleave(t){this.prevent(t),this.entered===t.target&&(this.entered=null,this.emit("dragleave",t))},dragover(t){this.prevent(t),this.emit("dragover",t)},drop(t){this.prevent(t),this.entered=null,this.emit("drop",t)},emit:e.emit,entered:null,focus(t){this.emit("focus",t)},keychain(t,e){let s=[t];(e.metaKey||e.ctrlKey)&&s.push("cmd"),!0===e.altKey&&s.push("alt"),!0===e.shiftKey&&s.push("shift");let i=e.key?Cc(e.key):null;const n={escape:"esc",arrowUp:"up",arrowDown:"down",arrowLeft:"left",arrowRight:"right"};return n[i]&&(i=n[i]),i&&!1===["alt","control","shift","meta"].includes(i)&&s.push(i),s.join(".")},keydown(t){this.emit(this.keychain("keydown",t),t),this.emit("keydown",t)},keyup(t){this.emit(this.keychain("keyup",t),t),this.emit("keyup",t)},off:e.off,offline(t){this.emit("offline",t)},on:e.on,online(t){this.emit("online",t)},paste(t){this.emit("paste",t)},popstate(t){this.emit("popstate",t)},prevent(t){t.stopPropagation(),t.preventDefault()},subscribe(){for(const t in s.document)document.addEventListener(t,this[t].bind(this),s.document[t]);for(const t in s.window)window.addEventListener(t,this[t].bind(this),s.window[t])},unsubscribe(){for(const t in s.document)document.removeEventListener(t,this[t]);for(const t in s.window)window.removeEventListener(t,this[t])}}},Tu={interval:null,start(t,e){this.stop(),t&&(this.interval=setInterval(e,t))},stop(){clearInterval(this.interval),this.interval=null}},Pu=(t={})=>{const e=mu("notification",{context:null,details:null,icon:null,isOpen:!1,message:null,theme:null,timeout:null,type:null});return r({...e,close(){return this.timer.stop(),this.reset(),this.state()},deprecated(t){console.warn("Deprecated: "+t)},error(e){if(e instanceof yu&&t.user.id)return t.redirect("logout");if(e instanceof vu)return this.fatal(e);if(e instanceof bu){const t=Object.values(e.response.json).find(t=>"string"==typeof(null==t?void 0:t.error));t&&(e.message=t.error)}return"string"==typeof e&&(e={message:e}),e={message:e.message??"Something went wrong",details:e.details??{}},"view"===t.context&&t.dialog.open({component:"k-error-dialog",props:e}),this.open({message:e.message,icon:"alert",theme:"negative",type:"error"})},info(t={}){return"string"==typeof t&&(t={message:t}),this.open({icon:"info",theme:"info",...t})},get isFatal(){return"fatal"===this.type},fatal(t){return"string"==typeof t?this.open({message:t,type:"fatal"}):t instanceof vu?this.open({message:t.response.text,type:"fatal"}):this.open({message:t.message??"Something went wrong",type:"fatal"})},open(e){return this.timer.stop(),"string"==typeof e?this.success(e):("error"!==e.type&&"fatal"!==e.type&&(e.timeout??(e.timeout=4e3)),this.set({context:t.context,...e}),this.isOpen=!0,this.timer.start(this.timeout,()=>this.close()),this.state())},success(t={}){return"string"==typeof t&&(t={message:t}),this.open({icon:"check",theme:"positive",...t})},timer:Tu})},qu=()=>{const t=mu("language",{code:null,default:!1,direction:"ltr",name:null,rules:null});return r({...t,get isDefault(){return this.default}})},Nu=(t,e,s)=>{if(!s.template&&!s.render&&!s.extends)throw new Error(`Plugin component "${e}" is not providing any template or render method, neither is it extending a component. The component has not been registered.`);return s=Fu(t,e,s),s=Yu(s),s=zu(s),!0===mc(e)&&window.console.warn(`Plugin is replacing "${e}"`),t.component(e,s),s},Fu=(t,e,s)=>"string"!=typeof(null==s?void 0:s.extends)?s:!1===mc(s.extends)?(window.console.warn(`Problem with plugin trying to register component "${e}": cannot extend non-existent component "${s.extends}"`),s.extends=null,s):(s.extends=t.options.components[s.extends].extend({options:s,components:{...t.options.components,...s.components??{}}}),s),zu=t=>{if(!1===Array.isArray(t.mixins))return t;const e={dialog:Lt,drawer:be,section:Sa};return t.mixins=t.mixins.map(i=>{if("string"==typeof i&&void 0!==e[i]){if(t.extends){if(!0===((new(s.extend(t.extends))).$options.mixins??[]).includes(e[i]))return}return e[i]}return i}).filter(t=>void 0!==t),t},Yu=t=>(t.template&&(t.render=null),t),Ru=(t,e={})=>((e={resolveComponentExtension:Fu,resolveComponentMixins:zu,resolveComponentRender:Yu,components:{},created:[],icons:{},login:null,textareaButtons:{},thirdParty:{},use:[],viewButtons:{},writerMarks:{},writerNodes:{},...e}).use=((t,e)=>{if(!1===Array.isArray(e))return[];for(const s of e)t.use(s);return e})(t,e.use),e.components=((t,e)=>{if(!1===$t(e))return;const s={};for(const[n,o]of Object.entries(e))try{s[n]=Nu(t,n,o)}catch(i){window.console.warn(i.message)}return s})(t,e.components),e),Hu=t=>{var e;const s=mu("menu",{entries:[],hover:!1,isOpen:!1}),i=null==(e=window.matchMedia)?void 0:e.call(window,"(max-width: 60rem)"),n=r({...s,blur(t){const e=document.querySelector(".k-panel-menu");if(!e||!1===i.matches)return!1;!1===document.querySelector(".k-panel-menu-proxy").contains(t.target)&&!1===e.contains(t.target)&&this.close()},close(){this.isOpen=!1,!1===i.matches&&localStorage.setItem("kirby$menu",!0)},escape(){if(!1===i.matches)return!1;this.close()},open(){this.isOpen=!0,!1===i.matches&&localStorage.removeItem("kirby$menu")},resize(){if(i.matches)return this.close();null!==localStorage.getItem("kirby$menu")?this.isOpen=!1:this.isOpen=!0},set(t){return this.entries=t,this.resize(),this.state()},toggle(){this.isOpen?this.close():this.open()}});return t.events.on("keydown.esc",n.escape.bind(n)),t.events.on("click",n.blur.bind(n)),null==i||i.addEventListener("change",n.resize.bind(n)),n},Uu=t=>({controller:null,requests:0,get isLoading(){return this.requests>0},open(e){t.menu.escape(),t.dialog.open({component:"k-search-dialog",props:{type:e}})},async query(e,s,i){var n;if(null==(n=this.controller)||n.abort(),this.controller=new AbortController,s.length<2)return{results:null,pagination:{}};this.requests++;try{const{$search:n}=await t.get(`/search/${e}`,{query:{query:s,...i},signal:this.controller.signal});return n}catch(o){if("AbortError"!==o.name)return{results:[],pagination:{}}}finally{this.requests--}}}),Vu=null==(t=window.matchMedia)?void 0:t.call(window,"(prefers-color-scheme: dark)"),Ku=t=>{const e=mu("theme",{setting:localStorage.getItem("kirby$theme"),system:(null==Vu?void 0:Vu.matches)?"dark":"light"}),s=r({...e,get config(){return t.config.theme},get current(){const t=this.setting??this.config;return"system"===t?this.system:t??this.system},reset(){this.setting=null,localStorage.removeItem("kirby$theme")},set(t){this.setting=t,localStorage.setItem("kirby$theme",t)}});return null==Vu||Vu.addEventListener("change",t=>{s.system=t.matches?"dark":"light"}),s},Wu=()=>{const t=mu("translation",{code:null,data:{},direction:"ltr",name:null,weekday:1});return r({...t,set(e){return t.set.call(this,e),document.documentElement.lang=this.code,document.body.dir=this.direction,this.state()},translate(t,e,s=null){if("string"!=typeof t)return;const i=this.data[t]??s;return"string"!=typeof i?i:Dc(i,e)}})};const Ju=t=>{const e=mu("upload",{abort:null,accept:"*",attributes:{},files:[],max:null,multiple:!0,preview:{},replacing:null,url:null});return r({...e,...Ou(),input:null,announce(){t.notification.success({context:"view"}),t.events.emit("model.update")},async cancel(){var t;await this.emit("cancel"),null==(t=this.abort)||t.abort(),this.completed.length>0&&(await this.emit("complete",this.completed),this.announce()),this.reset()},get completed(){return this.files.filter(t=>t.completed).map(t=>t.model)},async done(){t.dialog.close(),this.completed.length>0&&(await this.emit("complete",this.completed),await this.emit("done",this.completed),this.announce()),this.reset()},findDuplicate(t){return this.files.findLastIndex(e=>e.src.name===t.src.name&&e.src.type===t.src.type&&e.src.size===t.src.size&&e.src.lastModified===t.src.lastModified)},hasUniqueName(t){return this.files.filter(e=>e.name===t.name&&e.extension===t.extension).length<2},file(t){const e=URL.createObjectURL(t);return{...this.preview,completed:!1,error:null,extension:lc(t.name),filename:t.name,id:jc(),model:null,name:cc(t.name),niceSize:uc(t.size),progress:0,size:t.size,src:t,type:t.type,url:e}},open(e,s){e instanceof FileList?(this.set(s),this.select(e)):this.set(e);const i={component:"k-upload-dialog",props:{preview:this.preview},on:{open:t=>this.emit("open",t),cancel:()=>this.cancel(),submit:async()=>{t.dialog.isLoading=!0,await this.submit(),t.dialog.isLoading=!1}}};this.replacing&&(i.component="k-upload-replace-dialog",i.props.original=this.replacing),t.dialog.open(i)},pick(t){this.set(t),this.input=document.createElement("input"),this.input.type="file",this.input.classList.add("sr-only"),this.input.value=null,this.input.accept=this.accept,this.input.multiple=this.multiple,this.input.click(),this.input.addEventListener("change",e=>{!0===(null==t?void 0:t.immediate)?(this.set(t),this.select(e.target.files),this.submit()):this.open(e.target.files,t),this.input.remove()})},remove(t){this.files=this.files.filter(e=>e.id!==t)},replace(e,s){this.pick({...s,url:t.urls.api+"/"+e.link,accept:"."+e.extension+","+e.mime,multiple:!1,replacing:e})},reset(){e.reset.call(this),this.files.splice(0)},select(t,e){if(this.set(e),t instanceof Event&&(t=t.target.files),t instanceof FileList==!1)throw new Error("Please provide a FileList");t=(t=[...t]).map(t=>this.file(t)),this.files=[...this.files,...t],this.files=this.files.filter((t,e)=>this.findDuplicate(t)===e),null!==this.max&&(this.files=this.files.slice(-1*this.max)),this.emit("select",this.files)},set(t){if(t)return e.set.call(this,t),this.on={},this.addEventListeners(t.on??{}),1===this.max&&(this.multiple=!1),!1===this.multiple&&(this.max=1),this.state()},async submit(){var e;if(!this.url)throw new Error("The upload URL is missing");this.abort=new AbortController;const s=[];for(const i of this.files){if(!0===i.completed)continue;if(!1===this.hasUniqueName(i)){i.error=t.t("error.file.name.unique");continue}i.error=null,i.progress=0;const n={...this.attributes};s.push(async()=>await this.upload(i,n));const o=null==(e=this.attributes)?void 0:e.sort;null!=o&&this.attributes.sort++}if(await async function(t,e=20){let s=0,i=0;return new Promise(n=>{const o=e=>i=>{t[e]=i,s--,r()},r=()=>{if(s<e&&i<t.length)return t[i]().then(o(i)).catch(o(i)),i++,s++,r();0===s&&i===t.length&&n(t)};r()})}(s),this.files.length===this.completed.length)return this.done()},async upload(e,s){try{const i=await async function(t,e,s=5242880){var i;const n=Math.ceil(t.size/s),o=Ac(4).toLowerCase();let r;for(let a=0;a<n&&!(null==(i=e.abort)?void 0:i.aborted);a++){const i=a*s,l=Math.min(i+s,t.size),c=n>1?t.slice(i,l,t.type):t;n>1&&(e.headers={...e.headers,"Upload-Length":t.size,"Upload-Offset":i,"Upload-Id":o}),r=await Lc(c,{...e,progress:(s,n,o)=>{const r=n.size*(o/100),a=(i+r)/t.size;e.progress(s,t,Math.round(100*a))}})}return r}(e.src,{abort:this.abort.signal,attributes:s,filename:e.name+"."+e.extension,headers:{"x-csrf":t.system.csrf},url:this.url,progress:(t,s,i)=>{e.progress=i}},t.config.upload);e.completed=!0,e.model=i.data,t.events.emit("file.upload",e)}catch(i){t.error(i,!1),e.error=i.message,e.progress=0,t.events.emit("file.upload.error",e)}}})},Gu=t=>{const e=Au(t,"view",{abortController:null,component:null,isLoading:!1,on:{},path:null,props:{},query:{},referrer:null,timestamp:null,breadcrumb:[],breadcrumbLabel:null,icon:null,id:null,link:null,search:"pages",title:null});return r({...e,async load(t,s={}){var i;return null==(i=this.abortController)||i.abort(),e.load.call(this,t,s)},set(s){e.set.call(this,s),t.title=this.title;const i=this.url().toString();window.location.toString()!==i&&(window.history.pushState(null,null,i),window.scrollTo(0,0))},async submit(){throw new Error("Not yet implemented")}})},Xu={config:{},languages:[],license:"missing",multilang:!1,permissions:{},searches:{},urls:{}},Zu=["dialog","drawer"],Qu=["dropdown","language","menu","notification","system","translation","user"],tp={create(t={}){return this.isLoading=!1,this.isOffline=!1,this.activation=fu(),this.drag=ju(),this.events=Lu(this),this.searcher=Uu(this),this.theme=Ku(this),this.upload=Ju(this),this.language=qu(),this.menu=Hu(this),this.notification=Pu(this),this.system=mu("system",{ascii:{},csrf:null,isLocal:null,locales:{},slugs:[],title:null}),this.translation=Wu(),this.user=mu("user",{email:null,id:null,language:null,role:null,username:null}),this.dropdown=Bu(this),this.view=Gu(this),this.content=Cu(this),this.drawer=Iu(this),this.dialog=Eu(this),this.redirect=$u,this.reload=this.view.reload.bind(this.view),this.t=this.translation.translate.bind(this.translation),this.plugins=Ru(window.Vue,t),this.set(window.fiber),this.api=Su(this),r(this)},get context(){return this.dialog.isOpen?"dialog":this.drawer.isOpen?"drawer":"view"},get debug(){return!0===this.config.debug},deprecated(t){this.notification.deprecated(t)},get direction(){return this.translation.direction},error(t,e=!0){if("AbortError"!==t.name)return!0===this.debug&&console.error(t),!0===e?this.notification.error(t):void 0},async get(t,e={}){const{response:s}=await this.request(t,{method:"GET",...e});return(null==s?void 0:s.json)??{}},async open(t,e={}){try{if(!1===zc(t))this.set(t);else{this.isLoading=!0;const s=await this.get(t,e);this.set(s),this.isLoading=!1}return this.state()}catch(s){return this.error(s)}},overlays(){const t=[];return!0===this.drawer.isOpen&&t.push("drawer"),!0===this.dialog.isOpen&&t.push("dialog"),t},async post(t,e={},s={}){const{response:i}=await this.request(t,{method:"POST",body:e,...s});return i.json},async request(t,e={}){return wu(t,{referrer:this.view.path,csrf:this.system.csrf,...e})},async search(t,e,s){return void 0===e?this.searcher.open(t):this.searcher.query(t,e,s)},set(t={}){t=Object.fromEntries(Object.entries(t).map(([t,e])=>[t.replace("$",""),e]));for(const e in Xu){const s=t[e]??this[e]??Xu[e];typeof s==typeof Xu[e]&&(this[e]=s)}for(const e of Qu)($t(t[e])||Array.isArray(t[e]))&&this[e].set(t[e]);for(const e of Zu)if(!0===$t(t[e])){if(t[e].redirect)return this.open(t[e].redirect);this[e].open(t[e])}else void 0!==t[e]&&this[e].close(!0);!0===$t(t.dropdown)?this.dropdown.open(t.dropdown):void 0!==t.dropdown&&this.dropdown.close(),!0===$t(t.view)&&this.view.open(t.view)},state(){const t={};for(const e in Xu)t[e]=this[e]??Xu[e];for(const e of Qu)t[e]=this[e].state();for(const e of Zu)t[e]=this[e].state();return t.dropdown=this.dropdown.state(),t.view=this.view.state(),t},get title(){return document.title},set title(t){!1===Sc(this.system.title)&&(t+=" | "+this.system.title),document.title=t},url:(t="",e={},s)=>qc(t,e,s)};s.config.productionTip=!1,s.config.devtools=!0,s.use(Uc),s.use(hu),s.use(Gl),window.panel=s.prototype.$panel=tp.create(window.panel.plugins),window.panel.app=new s({render:()=>o(U)}),s.use(Vc),s.use(Xl),s.use(Kc),window.panel.app.$mount("#app");export{ut as n};
